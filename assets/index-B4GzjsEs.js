(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();const ut="modulepreload",dt=function(n){return"/vibe-drawing/"+n},Be={},ht=function(e,t,o){let a=Promise.resolve();if(t&&t.length>0){let g=function(l){return Promise.all(l.map(f=>Promise.resolve(f).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=s?.nonce||s?.getAttribute("nonce");a=g(t.map(l=>{if(l=dt(l),l in Be)return;Be[l]=!0;const f=l.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":ut,f||(u.as="script"),u.crossOrigin="",u.href=l,r&&u.setAttribute("nonce",r),document.head.appendChild(u),f)return new Promise((m,p)=>{u.addEventListener("load",m),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return a.then(s=>{for(const r of s||[])r.status==="rejected"&&i(r.reason);return e().catch(i)})};function We(){return typeof navigator<"u"&&"vibrate"in navigator}const mt="vibe.flags",Ke={hapticsEnabled:!0,debug:!1};function ft(n){if(!n)return{};try{return JSON.parse(n)}catch{return{}}}function gt(){if(typeof window>"u")return{...Ke};const n=ft(localStorage.getItem(mt));return{...Ke,...n}}let pt=gt();function Xe(n){return pt[n]}let ie=null,re=null,se=null;function Ue(n=.5){try{if(ie||(ie=new(window.AudioContext||window.webkitAudioContext)),!ie||re)return;re=ie.createOscillator(),se=ie.createGain(),re.type="square",re.frequency.value=85,se.gain.value=Math.min(1,Math.max(.05,n)),re.connect(se),se.connect(ie.destination),re.start()}catch{}}function ke(n=.5){if(!se||!ie)return;const e=Math.min(1,Math.max(.05,n));try{se.gain.exponentialRampToValueAtTime(e,ie.currentTime+.05)}catch{se.gain.value=e}}/*! Capacitor: https://capacitorjs.com/ - MIT License */var de;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(de||(de={}));class ze extends Error{constructor(e,t,o){super(e),this.message=e,this.code=t,this.data=o}}const yt=n=>{var e,t;return n?.androidBridge?"android":!((t=(e=n?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},vt=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},o=t.Plugins=t.Plugins||{},a=()=>e!==null?e.name:yt(n),i=()=>a()!=="web",s=d=>{const u=l.get(d);return!!(u?.platforms.has(a())||r(d))},r=d=>{var u;return(u=t.PluginHeaders)===null||u===void 0?void 0:u.find(m=>m.name===d)},g=d=>n.console.error(d),l=new Map,f=(d,u={})=>{const m=l.get(d);if(m)return console.warn(`Capacitor plugin "${d}" already registered. Cannot register plugins twice.`),m.proxy;const p=a(),v=r(d);let S;const h=async()=>(!S&&p in u?S=typeof u[p]=="function"?S=await u[p]():S=u[p]:e!==null&&!S&&"web"in u&&(S=typeof u.web=="function"?S=await u.web():S=u.web),S),y=(A,P)=>{var z,L;if(v){const I=v?.methods.find(k=>P===k.name);if(I)return I.rtype==="promise"?k=>t.nativePromise(d,P.toString(),k):(k,H)=>t.nativeCallback(d,P.toString(),k,H);if(A)return(z=A[P])===null||z===void 0?void 0:z.bind(A)}else{if(A)return(L=A[P])===null||L===void 0?void 0:L.bind(A);throw new ze(`"${d}" plugin is not implemented on ${p}`,de.Unimplemented)}},b=A=>{let P;const z=(...L)=>{const I=h().then(k=>{const H=y(k,A);if(H){const B=H(...L);return P=B?.remove,B}else throw new ze(`"${d}.${A}()" is not implemented on ${p}`,de.Unimplemented)});return A==="addListener"&&(I.remove=async()=>P()),I};return z.toString=()=>`${A.toString()}() { [capacitor code] }`,Object.defineProperty(z,"name",{value:A,writable:!1,configurable:!1}),z},C=b("addListener"),M=b("removeListener"),$=(A,P)=>{const z=C({eventName:A},P),L=async()=>{const k=await z;M({eventName:A,callbackId:k},P)},I=new Promise(k=>z.then(()=>k({remove:L})));return I.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await L()},I},V=new Proxy({},{get(A,P){switch(P){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return v?$:C;case"removeListener":return M;default:return b(P)}}});return o[d]=V,l.set(d,{name:d,proxy:V,platforms:new Set([...Object.keys(u),...v?[p]:[]])}),V};return t.convertFileSrc||(t.convertFileSrc=d=>d),t.getPlatform=a,t.handleError=g,t.isNativePlatform=i,t.isPluginAvailable=s,t.registerPlugin=f,t.Exception=ze,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},bt=n=>n.Capacitor=vt(n),Te=bt(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Fe=Te.registerPlugin;class Ze{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let o=!1;this.listeners[e]||(this.listeners[e]=[],o=!0),this.listeners[e].push(t);const i=this.windowListeners[e];i&&!i.registered&&this.addWindowListener(i),o&&this.sendRetainedArgumentsForEvent(e);const s=async()=>this.removeListener(e,t);return Promise.resolve({remove:s})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,o){const a=this.listeners[e];if(!a){if(o){let i=this.retainedEventArguments[e];i||(i=[]),i.push(t),this.retainedEventArguments[e]=i}return}a.forEach(i=>i(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:o=>{this.notifyListeners(t,o)}}}unimplemented(e="not implemented"){return new Te.Exception(e,de.Unimplemented)}unavailable(e="not available"){return new Te.Exception(e,de.Unavailable)}async removeListener(e,t){const o=this.listeners[e];if(!o)return;const a=o.indexOf(t);this.listeners[e].splice(a,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(o=>{this.notifyListeners(e,o)}))}}const Ge=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),_e=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class wt extends Ze{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(o=>{if(o.length<=0)return;let[a,i]=o.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=_e(a).trim(),i=_e(i).trim(),t[a]=i}),t}async setCookie(e){try{const t=Ge(e.key),o=Ge(e.value),a=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),s=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${o||""}${a}; path=${i}; ${s};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Fe("CapacitorCookies",{web:()=>new wt});const St=async n=>new Promise((e,t)=>{const o=new FileReader;o.onload=()=>{const a=o.result;e(a.indexOf(",")>=0?a.split(",")[1]:a)},o.onerror=a=>t(a),o.readAsDataURL(n)}),Mt=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(a=>a.toLocaleLowerCase()).reduce((a,i,s)=>(a[i]=n[e[s]],a),{})},Et=(n,e=!0)=>n?Object.entries(n).reduce((o,a)=>{const[i,s]=a;let r,g;return Array.isArray(s)?(g="",s.forEach(l=>{r=e?encodeURIComponent(l):l,g+=`${i}=${r}&`}),g.slice(0,-1)):(r=e?encodeURIComponent(s):s,g=`${i}=${r}`),`${o}&${g}`},"").substr(1):null,Ct=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),a=Mt(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(a.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[s,r]of Object.entries(n.data||{}))i.set(s,r);t.body=i.toString()}else if(a.includes("multipart/form-data")||n.data instanceof FormData){const i=new FormData;if(n.data instanceof FormData)n.data.forEach((r,g)=>{i.append(g,r)});else for(const r of Object.keys(n.data))i.append(r,n.data[r]);t.body=i;const s=new Headers(t.headers);s.delete("content-type"),t.headers=s}else(a.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class Tt extends Ze{async request(e){const t=Ct(e,e.webFetchExtra),o=Et(e.params,e.shouldEncodeUrlParams),a=o?`${e.url}?${o}`:e.url,i=await fetch(a,t),s=i.headers.get("content-type")||"";let{responseType:r="text"}=i.ok?e:{};s.includes("application/json")&&(r="json");let g,l;switch(r){case"arraybuffer":case"blob":l=await i.blob(),g=await St(l);break;case"json":g=await i.json();break;case"document":case"text":default:g=await i.text()}const f={};return i.headers.forEach((d,u)=>{f[u]=d}),{data:g,headers:f,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Fe("CapacitorHttp",{web:()=>new Tt});const Re=Fe("NativeHaptics",{web:()=>({async start(){},async update(){},async stop(){}})});let ae=null;(async()=>{try{ae=(await ht(()=>import("./index-Cgc13OgN.js"),[])).Haptics}catch{ae=null}})();let ye=null,ve=150,ce=22,ue=!1,Se=!1,be=.5;const we=Te.getPlatform();let et="medium",Le=!1;function Pt(n){const e=Math.max(0,Math.min(.25,0));return Math.max(.15,Math.min(1,e/.25))}function zt(n){const e=Math.max(0,Math.min(1,.5));return Math.max(.1,Math.min(1,e))}function Me(n,e){const t=Pt(),o=zt();return Math.max(.1,Math.min(1,o*.6+t*.4))}function Lt(n,e){const t=Me();return Math.round(18+t*20)}function xt(n,e){const t=Me();return Math.round(80-t*35)}function It(n,e){const t=Me();return t>.7?"heavy":t>.4?"medium":"light"}function Ve(){if(we!=="web"&&!Se)try{Re.update({intensity:be});return}catch{}if(ae){we==="ios"?ae.impact({style:et}):we==="android"?ae.vibrate({duration:ce}):We()?navigator.vibrate(ce):ue?ke(ce/40):(ue=!0,Ue(.4));return}We()?navigator.vibrate(ce):ue?ke(ce/40):(ue=!0,Ue(.4))}function At(){if(Xe("hapticsEnabled")){if(Le){kt();return}if(ue=!1,Se=!1,we!=="web")try{Re.start({intensity:be}),Se=!0,Le=!0;return}catch{}ae&&we==="ios"&&ae.impact({style:"medium"}),Ve(),ye=window.setInterval(Ve,ve),Le=!0}}function kt(n,e){if(!Xe("hapticsEnabled"))return;const t=Me(),o=Math.abs(be-t)>.05;if(be=t,Se&&o)try{Re.update({intensity:be});return}catch{Se=!1}if(o||!ye){ce=Lt(),et=It();const a=xt();Math.abs(a-ve)>2&&ye!=null?(ve=a,window.clearInterval(ye),ye=window.setInterval(Ve,ve)):ve=a}ue&&ke(Me())}class Vt{constructor(){this.name="Triangle",this.description="Bright neon triangles with glowing effects",this.icon="7",this.currentVariant=0,this.currentTheme=0,this.lastPoint=null,this.drawingSpeed=1,this.colorVariants=[{baseHue:280,saturation:85,lightness:60,name:"Mystical Purple"},{baseHue:100,saturation:100,lightness:50,name:"Electric Neon"},{baseHue:300,saturation:90,lightness:65,name:"Sunset Fuchsia"},{baseHue:180,saturation:80,lightness:55,name:"Ocean Teal"},{baseHue:0,saturation:95,lightness:60,name:"Fire Red"}],this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.glowTrails=[]}draw(e,t,o){const{x:a,y:i,width:s,height:r}=t,{isEraserMode:g}=o,l=this.calculateSizeMultiplier(t,o),f=Math.max(s,r),d=Math.min(1,Math.max(.2,f/30)),u=1,m=.4+d*.6,p=f*u*l*m;e.save(),g?(e.globalCompositeOperation="destination-out",e.fillStyle="#000000"):e.globalCompositeOperation="source-over",this.drawTriangle(e,a,i,p),e.restore()}onStart(e,t){this.glowTrails=[],this.lastPoint=e,this.drawingSpeed=1}onMove(e,t){const{ctx:o,isEraserMode:a,thicknessMultiplier:i,currentSizeLevel:s,sizeMultipliers:r,isWebApp:g}=t;e.length<2||(o.save(),o.globalCompositeOperation=a?"destination-out":"screen",e.forEach((l,f)=>{if(f===0)return;const d=e[f-1];if(!d)return;const u=((l.t||0)-(d.t||0))/16;if(u<=0)return;const m=this.calculateSizeMultiplier(l,t),p=d.x+(l.x-d.x)*u,v=d.y+(l.y-d.y)*u,S=l.width||1,h=l.height||1,y=Math.max(S,h),b=Math.min(1,Math.max(.2,y/30));Math.random()<.01&&console.log(`Touch: w=${S.toFixed(1)}, h=${h.toFixed(1)}, max=${y.toFixed(1)}, pressure=${b.toFixed(2)}`);const C=3.9,M=.4+b*.6,$=.8+Math.random()*.4,V=y*C*m*M*$;if(a)o.globalAlpha=.5,o.fillStyle="#151E35";else{const P=1+Math.sin(u*Math.PI)*.2,z=this.getGlowColor(P);o.globalAlpha=.3,o.fillStyle=z,this.drawTriangle(o,p,v,V*3),o.globalAlpha=.6,o.fillStyle=z,this.drawTriangle(o,p,v,V*2),o.globalAlpha=.9,o.fillStyle=z,this.drawTriangle(o,p,v,V),o.globalAlpha=1,o.fillStyle="#FFFFFF",this.drawTriangle(o,p,v,V*.3),this.glowTrails.push({x:p,y:v,size:V,color:z,life:1,maxLife:1}),Math.random()<.3&&this.addSparkle(o,p,v,z)}}),o.restore())}onEnd(e){this.lastPoint=null,this.drawingSpeed=1}onClear(e){this.glowTrails=[]}animate(e){const{ctx:t}=e;this.glowTrails=this.glowTrails.filter(o=>(o.life-=.03,o.life>0?(t.save(),t.globalCompositeOperation="screen",t.globalAlpha=o.life*.4,t.fillStyle=o.color,this.drawTriangle(t,o.x,o.y,o.size*2),t.restore(),!0):!1))}calculateSizeMultiplier(e,t){const{isWebApp:o,currentSizeLevel:a,sizeMultipliers:i,thicknessMultiplier:s}=t,r=Math.sqrt((e.width||1)*(e.height||1));if(o)return .4*(i[a]||1)*s;{const f=Math.max(0,Math.min(1,(r-5)/95));let d;(e.width||0)===0||(e.height||0)===0?d=3.4:d=4.2+f*.4;const m=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+d*.95*this.sizeSmoothingFactor;return this.lastSizeMultiplier=m,m*(i[a]||1)*s}}getGlowColor(e){const t=this.colorVariants[this.currentVariant],o=t.baseHue,a=t.saturation,i=t.lightness,s=Math.sin(e*Math.PI)*30;return`hsl(${(o+s+360)%360}, ${a}%, ${i}%)`}nextColorVariant(){this.currentTheme=(this.currentTheme+1)%5,this.currentVariant=this.currentTheme,console.log(`Triangle color changed to: ${["Mystical Purple","Electric Neon","Sunset Fuchsia","Ocean Teal","Fire Red"][this.currentTheme]} (variant ${this.currentVariant})`)}resetToDefault(){this.currentVariant=0,this.currentTheme=0}getCurrentVariantName(){return["Mystical Purple","Electric Neon","Sunset Fuchsia","Ocean Teal","Fire Red"][this.currentTheme]||"Unknown"}addSparkle(e,t,o,a){e.save(),e.globalAlpha=.8,e.fillStyle=a;for(let i=0;i<4;i++){const s=i*Math.PI/2,r=t+Math.cos(s)*10,g=o+Math.sin(s)*10;this.drawTriangle(e,r,g,2)}e.restore()}drawTriangle(e,t,o,a){const i=this.colorVariants[this.currentVariant],s=[`hsl(${i.baseHue}, ${i.saturation}%, ${i.lightness}%)`,`hsl(${(i.baseHue+120)%360}, ${i.saturation}%, ${i.lightness}%)`,`hsl(${(i.baseHue+240)%360}, ${i.saturation}%, ${i.lightness}%)`],r=t,g=o-a/2,l=t-a/2,f=o+a/2,d=t+a/2,u=o+a/2;e.beginPath(),e.moveTo(r,g),e.lineTo(l,f),e.strokeStyle=s[0],e.lineWidth=3,e.stroke(),e.beginPath(),e.moveTo(l,f),e.lineTo(d,u),e.strokeStyle=s[1],e.lineWidth=3,e.stroke(),e.beginPath(),e.moveTo(d,u),e.lineTo(r,g),e.strokeStyle=s[2],e.lineWidth=3,e.stroke(),e.beginPath(),e.moveTo(r,g),e.lineTo(l,f),e.lineTo(d,u),e.closePath(),e.fillStyle=`hsla(${i.baseHue}, ${i.saturation}%, ${i.lightness}%, 0.3)`,e.fill()}}class $t{constructor(){this.name="Classic",this.description="Smooth classic drawing with rainbow effects",this.currentVariant=0,this.colorVariants=[{baseHue:216,saturation:90,lightness:50,name:"Ocean Blue"},{baseHue:0,saturation:85,lightness:55,name:"Crimson Red"},{baseHue:120,saturation:80,lightness:50,name:"Forest Green"},{baseHue:45,saturation:90,lightness:60,name:"Golden Yellow"},{baseHue:280,saturation:85,lightness:55,name:"Royal Purple"}],this.styleParams={sparkleIntensity:.3,sparkleSize:2,sparkleCount:3,glowIntensity:.2,pulseSpeed:.02,sizeMultiplier:1,cycleSpeed:8,filter:"none"}}draw(e,t,o){const{x:a,y:i,width:s,height:r}=t,{isEraserMode:g,thicknessMultiplier:l,currentSizeLevel:f,sizeMultipliers:d,isWebApp:u}=o,m=Date.now()*.001,p=this.colorVariants[this.currentVariant],v=p.baseHue,S=this.styleParams.cycleSpeed||8;this.styleParams.filter&&this.styleParams.filter!=="none"&&Math.random()<.3&&(e.filter=this.styleParams.filter);const h=Math.sin(m*S)*30,y=(Math.random()-.5)*20+h,b=(Math.random()-.5)*15+Math.sin(m*3)*10,C=(Math.random()-.5)*15+Math.sin(m*2.5)*8,M=(v+y+360)%360,$=Math.max(70,Math.min(100,p.saturation+b)),V=Math.max(35,Math.min(75,p.lightness+C)),A=`hsl(${M}, ${$}%, ${V}%)`,P=Math.min(1,Math.max(.3,l*Math.max(s,r)/50)),z=P*P,k=.25*(d[f]||1)*Math.max(s,r)*(.5+z*1.5),H=u?.9+Math.random()*.2:.8+Math.random()*.4,B=1+Math.sin(Date.now()/160)*.05,x=k*H*B;if(typeof window.reportActualSize=="function"&&window.reportActualSize("Artistic Pen",f,x),e.save(),g)e.globalCompositeOperation="destination-out",e.fillStyle=A,e.beginPath(),e.arc(a,i,x*1.2,0,2*Math.PI),e.fill();else{e.globalCompositeOperation="source-over";const K=.6+z*.4;e.globalAlpha=K,e.fillStyle=A,e.beginPath(),e.arc(a,i,x,0,2*Math.PI),e.fill(),e.globalAlpha=K*.8,e.fillStyle=`hsl(${M}, ${$}%, ${Math.min(95,V+20)}%)`,e.beginPath(),e.arc(a,i,x*.6,0,2*Math.PI),e.fill();const w=.025+z*.05;if(Math.random()<w){const E=Math.floor(z*.8)+1;for(let U=0;U<E;U++){const F=x*(.5+Math.random()*5),R=Math.random()*Math.PI*2,Y=a+Math.cos(R)*F,G=i+Math.sin(R)*F,q=x*(.1+Math.random()*.9),j=`hsl(${M}, ${$}%, ${V+Math.random()*10}%)`;e.globalAlpha=.4*z,e.fillStyle=j,e.beginPath(),e.arc(Y,G,q,0,2*Math.PI),e.fill()}}if(Math.random()<.1+z*.15){const E=x*(1.1+Math.random()*.4),U=.05+z*.1;e.globalAlpha=U,e.fillStyle=`hsl(${M}, ${$*.8}%, ${V*.9}%)`,e.beginPath(),e.arc(a,i,E,0,2*Math.PI),e.fill()}}e.restore()}nextColorVariant(){this.currentVariant=(this.currentVariant+1)%this.colorVariants.length,this.colorVariants[this.currentVariant]}resetToDefault(){this.currentVariant=0}}class Ft{constructor(){this.name="3D Sphere",this.description="Three-dimensional sphere effects with depth and lighting",this.currentVariant=0,this.lastPoint=null,this.colorVariants=[{baseHue:200,saturation:85,lightness:60,name:"Deep Blue"},{baseHue:15,saturation:90,lightness:55,name:"Fire Orange"},{baseHue:120,saturation:80,lightness:50,name:"Emerald Green"},{baseHue:300,saturation:85,lightness:65,name:"Magenta Pink"},{baseHue:60,saturation:90,lightness:70,name:"Bright Yellow"}],this.styleParams={sphereIntensity:.7,depthEffect:.8,lightingAngle:45}}onStart(e,t){}onMove(e,t){const{ctx:o,isEraserMode:a}=t;e.length<2||(this.lastPoint=e[e.length-1],o.save(),o.globalCompositeOperation=a?"destination-out":"source-over",e.forEach((i,s)=>{if(s===0)return;const r=e[s-1],g=((i.t||0)-(r.t||0))/16;if(g<=0)return;const l=r.x+(i.x-r.x)*g,f=r.y+(i.y-r.y)*g;this.draw3DSphere(o,l,f,i,t)}),o.restore())}onEnd(e){const{ctx:t}=e;this.lastPoint&&this.drawFlatEnd(t,this.lastPoint.x,this.lastPoint.y,this.lastPoint,e)}draw(e,t,o){this.draw3DSphere(e,t.x,t.y,t,o)}draw3DSphere(e,t,o,a,i){const{width:s,height:r}=a,{isEraserMode:g,thicknessMultiplier:l,currentSizeLevel:f,sizeMultipliers:d}=i,u=Date.now()*.001,m=this.colorVariants[this.currentVariant],p=m.baseHue,S=.4*(d[f]||1)*l*Math.max(s,r);if(e.save(),g)e.globalCompositeOperation="destination-out",e.fillStyle="#000000",e.beginPath(),e.arc(t,o,S*1.2,0,2*Math.PI),e.fill();else{e.globalCompositeOperation="source-over";const h=(p+Math.sin(u*2)*30)%360,y=m.saturation,b=m.lightness;e.globalAlpha=1,e.fillStyle="#000000",e.beginPath(),e.arc(t+S*.2,o+S*.2,S*.6,0,2*Math.PI),e.fill(),e.globalAlpha=1,e.fillStyle=`hsl(${h}, ${y}%, ${b}%)`,e.beginPath(),e.arc(t,o,S*.7,0,2*Math.PI),e.fill()}e.restore()}drawFlatEnd(e,t,o,a,i){const{width:s,height:r}=a,{isEraserMode:g,thicknessMultiplier:l,currentSizeLevel:f,sizeMultipliers:d}=i,u=Date.now()*.001,m=this.colorVariants[this.currentVariant],p=m.baseHue,S=.4*(d[f]||1)*l*Math.max(s,r);if(e.save(),g)e.globalCompositeOperation="destination-out",e.fillStyle="#000000",e.beginPath(),e.arc(t,o,S*1.2,0,2*Math.PI),e.fill();else{e.globalCompositeOperation="source-over";const h=(p+Math.sin(u*2)*30)%360,y=m.saturation,b=m.lightness;e.globalAlpha=1,e.fillStyle="#000000",e.beginPath(),e.arc(t+S*.2,o+S*.2,S*.6,0,2*Math.PI),e.fill(),e.globalAlpha=1,e.fillStyle=`hsl(${h}, ${y}%, ${b}%)`,e.beginPath(),e.arc(t,o,S*.7,0,2*Math.PI),e.fill()}e.restore()}drawTwoLine3D(e,t,o,a,i){const{width:s,height:r}=a,{isEraserMode:g,thicknessMultiplier:l,currentSizeLevel:f,sizeMultipliers:d}=i,u=Date.now()*.001,m=this.colorVariants[this.currentVariant],p=m.baseHue,S=.4*(d[f]||1)*l*Math.max(s,r);if(e.save(),g)e.globalCompositeOperation="destination-out",e.fillStyle="#000000",e.beginPath(),e.arc(t,o,S*1.2,0,2*Math.PI),e.fill();else{e.globalCompositeOperation="source-over";const h=(p+Math.sin(u*2)*30)%360,y=m.saturation,b=m.lightness,C=S*.3;e.fillStyle=`hsl(${h}, ${y}%, ${Math.min(95,b+20)}%)`,e.beginPath(),e.arc(t-C,o-C,S*.8,0,2*Math.PI),e.fill(),e.fillStyle=`hsl(${h}, ${y}%, ${Math.max(20,b-20)}%)`,e.beginPath(),e.arc(t+C,o+C,S*.8,0,2*Math.PI),e.fill()}e.restore()}nextColorVariant(){this.currentVariant=(this.currentVariant+1)%this.colorVariants.length}resetToDefault(){this.currentVariant=0}}class Rt{constructor(){this.name="Classic Rainbow",this.description="Original rainbow cycling with sparkle effects",this.currentVariant=0,this.colorVariants=[{baseHue:216,saturation:90,lightness:50,name:"Classic Rainbow"},{baseHue:0,saturation:95,lightness:55,name:"Red Spectrum"},{baseHue:120,saturation:85,lightness:50,name:"Green Rainbow"},{baseHue:240,saturation:90,lightness:60,name:"Blue Spectrum"},{baseHue:60,saturation:95,lightness:65,name:"Yellow Rainbow"}],this.styleParams={sparkleIntensity:.3,sparkleSize:2,sparkleCount:3,glowIntensity:.2,pulseSpeed:.02,sizeMultiplier:1,cycleSpeed:8,filter:"none"}}draw(e,t,o){const{x:a,y:i,width:s,height:r}=t,{isEraserMode:g,thicknessMultiplier:l,currentSizeLevel:f,sizeMultipliers:d,isWebApp:u}=o,m=Date.now()*.001,p=this.colorVariants[this.currentVariant],v=p.baseHue,S=this.styleParams.cycleSpeed||8;this.styleParams.filter&&this.styleParams.filter!=="none"&&Math.random()<.3&&(e.filter=this.styleParams.filter);const h=Math.sin(m*S)*100,y=(Math.random()-.5)*80+h,b=(Math.random()-.5)*40+Math.sin(m*3)*20,C=(Math.random()-.5)*35+Math.sin(m*2.5)*15,M=(v+y+360)%360,$=Math.max(70,Math.min(100,p.saturation+b)),V=Math.max(35,Math.min(85,p.lightness+C)),A=`hsl(${M}, ${$}%, ${V}%)`,P=Math.max(s,r)/2*(.95+Math.random()*.1),z=1+Math.sin(Date.now()/160)*.03,L=P*z;if(typeof window.reportActualSize=="function"&&window.reportActualSize("Original Style 1",f,L),e.save(),g)e.globalCompositeOperation="source-over",e.fillStyle="#151E35",e.beginPath(),e.arc(a,i,L,0,2*Math.PI),e.fill();else if(e.globalCompositeOperation="source-over",e.fillStyle=A,e.beginPath(),e.arc(a,i,L,0,2*Math.PI),e.fill(),Math.max(s,r)>10){let I;u?I=.6:I=.3,Math.random()<I&&(e.save(),e.globalAlpha=.5,this.addSparkleEffect(e,a,i,Math.max(s,r)/2.5),e.restore())}this.styleParams.filter&&this.styleParams.filter!=="none"&&(e.filter="none"),e.restore()}addSparkleEffect(e,t,o,a){const i=Math.floor(Math.random()*4)+2,s=a*(.1+Math.random()*.2);for(let r=0;r<i;r++){const g=t+(Math.random()-.5)*a*1.5,l=o+(Math.random()-.5)*a*1.5,f=.4+Math.random()*.4;e.globalAlpha=f,e.fillStyle="#ffffff",e.beginPath(),e.arc(g,l,s,0,2*Math.PI),e.fill()}}nextColorVariant(){this.currentVariant=(this.currentVariant+1)%this.colorVariants.length}resetToDefault(){this.currentVariant=0}}class Ot{constructor(){this.name="Clean Plasma",this.description="Swirling plasma energy with dynamic particles",this.currentVariant=0,this.colorVariants=[{baseHue:280,plasmaHue:280,saturation:100,plasmaSaturation:100,lightness:50,plasmaLightness:70,name:"Purple Plasma"},{baseHue:0,plasmaHue:15,saturation:100,plasmaSaturation:95,lightness:55,plasmaLightness:75,name:"Red Energy"}],this.styleParams={swirlSpeed:.001,particleCount:1},this.plasmaTrail=[],this.lastPlasmaTime=0}draw(e,t,o){const{x:a,y:i,width:s,height:r}=t,{isEraserMode:g,thicknessMultiplier:l,currentSizeLevel:f,sizeMultipliers:d}=o,u=Date.now(),p=.5*(d[f]||1)*l*Math.max(s,r);e.save();const v=this.colorVariants[this.currentVariant],S=v.baseHue;v.plasmaHue;const h=this.styleParams.swirlSpeed||.01;this.styleParams.particleCount;const y=Math.sin(u*h)*.4+.6,b=Math.sin(u*h*1.5)*.3+.7,C=Math.sin(u*h*.7)*.2+.8,M=(y+b+C)/3,$=`hsl(${S}, ${v.saturation}%, ${v.lightness+M*30}%)`,V=Math.sin(u/200)*.4+.6,A=p*V*M;u-this.lastPlasmaTime>150&&(this.plasmaTrail.push({x:a,y:i,size:A,color:$,timestamp:u,angle:Math.random()*Math.PI*2}),this.lastPlasmaTime=u,this.plasmaTrail.length>3&&this.plasmaTrail.shift()),g?(e.globalCompositeOperation="destination-out",e.fillStyle=$,e.beginPath(),e.arc(a,i,A*1.3,0,2*Math.PI),e.fill()):(e.globalCompositeOperation="source-over",e.globalAlpha=.9*M,e.fillStyle=`hsl(${S}, ${v.saturation}%, ${v.lightness+M*15}%)`,e.beginPath(),e.arc(a,i,A*.8,0,2*Math.PI),e.fill(),this.plasmaTrail.slice(-3).forEach((P,z)=>{const L=u-P.timestamp;if(L<500){const I=L/500,k=(1-I)*M*.6,H=P.size*(1-I*.5),B=Math.sin((u-P.timestamp)*h*2)*.3+.7;e.globalAlpha=k*B,e.fillStyle=P.color,e.beginPath(),e.arc(P.x,P.y,H,0,2*Math.PI),e.fill()}})),this.plasmaTrail=this.plasmaTrail.filter(P=>u-P.timestamp<700),e.restore()}nextColorVariant(){this.currentVariant=(this.currentVariant+1)%this.colorVariants.length}resetToDefault(){this.currentVariant=0}getCurrentVariantName(){return this.colorVariants[this.currentVariant].name}}class Dt{constructor(){this.styles=[],this.currentStyleIndex=0,this.styles=[new Vt,new $t,new Ft,new Ot,new Rt],this.currentStyle=this.styles[0]}getCurrentStyle(){return this.currentStyle}getCurrentStyleIndex(){return this.currentStyleIndex}getAllStyles(){return this.styles}switchToStyle(e){e>=0&&e<this.styles.length&&(this.currentStyleIndex=e,this.currentStyle=this.styles[e])}nextStyle(){const e=(this.currentStyleIndex+1)%this.styles.length;this.switchToStyle(e)}previousStyle(){const e=this.currentStyleIndex===0?this.styles.length-1:this.currentStyleIndex-1;this.switchToStyle(e)}onStart(e,t){this.currentStyle.onStart?.(e,t)}onMove(e,t){this.currentStyle.onMove?.(e,t)}onEnd(e){this.currentStyle.onEnd?.(e)}onClear(e){this.currentStyle.onClear?.(e),this.styles.forEach(t=>{t!==this.currentStyle&&t.onClear?.(e)})}animate(e){this.currentStyle.animate?.(e),this.styles.forEach(t=>{t!==this.currentStyle&&t.animate&&t.animate(e)})}}class Ht{constructor(e,t,o){this.slices=[],this.locked=0,this.container=e,this.currentSize=t,this.locked=t+1,this.onSizeChange=o,this.init()}init(){this.container.innerHTML=`
      <div class="pizza-size-selector">
        <div class="pizza" id="pizza">
          <div class="slice s1" data-n="1"></div>
          <div class="slice s2" data-n="2"></div>
          <div class="slice s3" data-n="3"></div>
          <div class="slice s4" data-n="4"></div>
          <div class="slice s5" data-n="5"></div>
          <div class="slice s6" data-n="6"></div>
        </div>
      </div>
    `,this.setupEventListeners()}setupEventListeners(){const e=this.container.querySelector("#pizza");e&&(this.slices=Array.from(e.querySelectorAll(".slice")),e.addEventListener("touchstart",t=>{t.preventDefault(),t.stopPropagation(),e.classList.add("pressed"),this.cycleSize()}),e.addEventListener("touchend",t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("pressed")}),e.addEventListener("click",t=>{t.stopPropagation(),this.cycleSize()}),this.highlight(this.locked))}cycleSize(){this.currentSize=(this.currentSize+1)%6,this.locked=this.currentSize+1,this.highlight(this.locked),this.onSizeChange(this.currentSize)}highlight(e){this.slices.forEach(t=>{t.classList.toggle("active",parseInt(t.dataset.n||"1")<=e)})}setSize(e){this.currentSize=e,this.locked=e+1,this.highlight(this.locked),this.onSizeChange(e)}getSize(){return this.currentSize}}function Bt(){const n=document.querySelector(".one-front-credit");n&&(n.style.transform="scale(0.85)",n.style.opacity="0.7",setTimeout(()=>{n.style.transform="",n.style.opacity=""},200)),"vibrate"in navigator&&navigator.vibrate(50);const e=document.getElementById("info-popup");e&&(e.style.display="block")}function tt(){const n=document.getElementById("info-popup");n&&(n.style.display="none")}let xe=!1;function je(){const n=document.getElementById("menu-toggle"),e=document.getElementById("tools-container");!n||!e||(xe=!xe,xe?(e.classList.add("collapsed"),n.classList.add("collapsed"),n.querySelector(".menu-toggle-icon").textContent="▲",n.style.bottom="25px"):(e.classList.remove("collapsed"),n.classList.remove("collapsed"),n.querySelector(".menu-toggle-icon").textContent="▼",n.style.bottom="120px"),"vibrate"in navigator&&navigator.vibrate(30))}setTimeout(()=>{const n=document.getElementById("app"),e=document.getElementById("splash-screen");if(n&&e&&!n.querySelector("canvas")){e.style.display="none";const t=document.getElementById("info-popup");t&&(t.style.display="block")}},5e3);let c=null,oe=!1,fe=[];const N=new Dt,Q=window.innerWidth>768;let O=2;const he=[1,2,2.5,3,3.5,4];let qe=.25;const Ne=.15;let J=1;const nt=70;let Je=0;const Wt=1e3;window.emergencyClear=function(){const n=document.getElementById("drawing-canvas");n&&me(n),window.gc&&window.gc()};function Kt(){const n=Date.now();if(n-Je<Wt)return;Je=n;const e=performance.memory;if(e){const t=e.usedJSHeapSize/1024/1024,o=e.totalJSHeapSize/1024/1024;if(t/o*100>nt){const i=document.getElementById("drawing-canvas");if(i&&me(i),window.gc&&window.gc(),i){const s=i.getContext("2d");s&&(s.save(),s.fillStyle="rgba(255, 0, 0, 0.8)",s.fillRect(0,0,i.width,i.height),s.fillStyle="white",s.font="bold 24px Arial",s.textAlign="center",s.fillText("Memory Limit Reached",i.width/2,i.height/2-20),s.fillText("Canvas Auto-Cleared",i.width/2,i.height/2+20),s.restore(),setTimeout(()=>{s&&s.clearRect(0,0,i.width,i.height)},2e3))}}}}let D=!1,ee=!1,ge=!1;function Ut(){const n=document.getElementById("debugger-toggle"),e=document.getElementById("debug-info");n&&e&&(n.classList.toggle("active",ee),e.style.display=ee?"block":"none",n.addEventListener("click",t=>{t.stopPropagation(),ee=!ee,n.classList.toggle("active",ee),e.style.display=ee?"block":"none",ee&&Oe()}))}function Gt(){const n=document.getElementById("labels-toggle");if(n){n.classList.toggle("active",ge);const e=document.querySelectorAll(".tool-label");e.forEach(t=>{const o=t;o.style.display="none"}),n.addEventListener("click",t=>{t.stopPropagation(),ge=!ge,n.classList.toggle("active",ge),e.forEach(o=>{const a=o;a.style.display=ge?"block":"none"})})}}let ne={},Pe=0;function _t(n,e,t){ne[n]||(ne[n]={}),ne[n][e]=t;const o=Date.now();o-Pe>100&&(Pe=o,at())}let W=1,Ie=!1;function jt(){const n=D?Math.min(O+4,he.length-1):O;return{ctx:c,isEraserMode:D,thicknessMultiplier:J,currentSizeLevel:n,sizeMultipliers:he,isWebApp:Q}}function _(n,e,t,o,a){const i={x:e,y:t,width:o,height:a,t:Date.now()},s=jt(),r=N.getCurrentStyle();if(ee){const f=.15*(he[O]||1)*J*Math.max(o,a);ne[r.name]||(ne[r.name]={}),ne[r.name][O]=f;const d=Date.now();d-Pe>100&&(Pe=d,at())}r.draw(n,i,s)}function le(n,e){const t=Math.sqrt(n*e);if(Q)return .15*(he[O]||1)*J;{const i=Math.max(0,Math.min(1,(t-5)/95));let s;n===0||e===0?s=.2:s=.1+i*.2;const r=.98+Math.random()*.04,g=qe*(1-Ne)+s*r*Ne;return qe=g,g*(he[O]||1)*J}}function Ye(n,e,t){const o=n.getBoundingClientRect();return{x:e-o.left,y:t-o.top}}function Ae(n){const e=window.visualViewport,t=e?e.width:window.innerWidth,o=e?e.height:window.innerHeight,a=window.devicePixelRatio||1;n.width=Math.max(1,Math.floor(t*a)),n.height=Math.max(1,Math.floor(o*a)),n.style.width=t+"px",n.style.height=o+"px",c&&(c.scale(a,a),c.lineCap="round",c.lineJoin="round",c.strokeStyle="#111",me(n))}function it(){const n=document.getElementById("save-modal");n&&(n.style.display="block")}function Ee(){const n=document.getElementById("save-modal");n&&(n.style.display="none")}function ot(){const n=document.getElementById("processing-spinner");n&&(n.style.display="block")}function Z(){const n=document.getElementById("processing-spinner");n&&(n.style.display="none")}window.openSaveModal=it;window.closeSaveModal=Ee;window.showProcessingSpinner=ot;window.hideProcessingSpinner=Z;function qt(n){switch(n){case"2K":return{width:2048,height:1152};case"5K":return{width:5120,height:2880};case"10K":return{width:10240,height:5760};case"20K":return{width:16384,height:9216};default:return{width:2048,height:1152}}}function Nt(n){const t=window.devicePixelRatio||1,o=n.width/(t*2),a=n.height/(t*2),i=16384/o,s=16384/a,r=Math.min(i,s),g=Math.floor(o*r),l=Math.floor(a*r);let f="";return r>=100?f="Browser canvas limit (16K pixels)":r>=50?f="High resolution - excellent quality":r>=20?f="Medium resolution - good quality":f="Limited by canvas size",{maxScale:r,maxWidth:g,maxHeight:l,reason:f}}async function Jt(n,e,t){try{const o=new OffscreenCanvas(2e4,11250),a=o.getContext("2d");if(!a){console.error("Failed to create OffscreenCanvas context"),Z();return}a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.lineWidth=.1,a.lineCap="round",a.lineJoin="round";const i=2e4/n.width;a.scale(i,i),a.drawImage(n,0,0);const s=await o.convertToBlob({type:t==="PNG"?"image/png":"image/jpeg",quality:t==="JPEG"?1:void 0}),r=URL.createObjectURL(s),g=document.createElement("a");g.href=r,g.download=`VIBE-DRAWING-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.${t.toLowerCase()}`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(r),Z()}catch(o){console.error("OffscreenCanvas export failed:",o),Z(),st(n,e,t)}}function Yt(n,e){try{const t=n.toDataURL("image/png"),o=`
      <svg xmlns="http://www.w3.org/2000/svg" 
           width="${n.width}" 
           height="${n.height}" 
           viewBox="0 0 ${n.width} ${n.height}">
        <image href="${t}" 
               width="${n.width}" 
               height="${n.height}" 
               preserveAspectRatio="none"/>
      </svg>
    `,a=new Blob([o],{type:"image/svg+xml"}),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=`VIBE-DRAWING-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.svg`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i),Z()}catch(t){console.error("SVG export failed:",t),Z()}}function st(n,e,t){try{if(ot(),typeof OffscreenCanvas<"u"&&e==="20K"){Jt(n,e,t);return}if(t==="SVG"){Yt(n,e);return}const{width:o,height:a}=qt(e),i=16384;if(o>i||a>i){console.warn(`Resolution ${e} (${o}x${a}) exceeds browser limits. Using maximum supported size.`),Z();let x="";e==="10K"||e==="20K"?x="Please try a lower resolution like 2K or 5K.":e==="5K"?x="Please try 2K resolution.":x="Please try a lower resolution.",alert(`Resolution ${e} is too large for your browser. ${x}`);return}let s,r;if((e==="10K"||e==="20K")&&(o>i||a>i)){const x=o/a;x>1?(s=i,r=Math.round(i/x)):(r=i,s=Math.round(i*x))}else s=o,r=a;const g=document.createElement("canvas"),l=g.getContext("2d");if(!l){console.error("Failed to create temporary canvas context"),Z();return}const f=n.width/(devicePixelRatio*2),d=n.height/(devicePixelRatio*2),u=f/d;let m,p;e==="2K"?(m=600,p=12,s=f*p,r=d*p):e==="5K"?(m=1200,p=30,s=f*p,r=d*p):e==="10K"?(m=2400,p=60,s=f*p,r=d*p):e==="20K"?(m=4800,p=120,s=f*p,r=d*p):(m=144,p=2,u>o/a?(s=o,r=Math.round(o/u)):(r=a,s=Math.round(a*u)));const v=`${s}x${r}`,S=e==="20K"?"16K (browser limit)":e;if(s>i||r>i){const x=Math.min(i/f,i/d);s=f*x,r=d*x}const h=`${s}x${r}`,y=e==="20K"?"16K (browser limit)":e;if(g.width=s,g.height=r,l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.lineWidth=.5,l.lineCap="round",l.lineJoin="round",e==="20K"?(l.textBaseline="alphabetic",l.textAlign="start",l.fontKerning="normal"):e==="10K"&&(l.textBaseline="alphabetic",l.textAlign="start"),e==="20K"){const x=Nt(n),K=document.createElement("canvas"),w=K.getContext("2d");if(w){K.width=x.maxWidth,K.height=x.maxHeight,w.imageSmoothingEnabled=!1,w.textBaseline="alphabetic",w.textAlign="start",w.fontKerning="normal",w.lineWidth=.25,w.lineCap="round",w.lineJoin="round",w.scale(x.maxScale,x.maxScale);const E=w.createLinearGradient(0,0,f,d);E.addColorStop(0,"#1a1a2e"),E.addColorStop(.5,"#16213e"),E.addColorStop(1,"#151E35"),w.fillStyle=E,w.fillRect(0,0,f,d),w.fillStyle="rgba(255, 255, 255, 0.3)";for(let U=0;U<200;U++){const F=Math.random()*f,R=Math.random()*d,Y=Math.random()*3+1;w.beginPath(),w.arc(F,R,Y,0,2*Math.PI),w.fill()}w.drawImage(n,0,0,f,d),l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(K,0,0,s,r)}else l.drawImage(n,0,0,s,r)}else{const x=Math.max(s/f,r/d);if(e==="10K"||e==="20K"||x>8){const w=document.createElement("canvas"),E=w.getContext("2d");if(E)if(w.width=6144,w.height=6144*(d/f),E.imageSmoothingEnabled=!0,E.imageSmoothingQuality="high",E.textBaseline="alphabetic",E.textAlign="start",E.fontKerning="normal",E.lineWidth=.25,E.lineCap="round",E.lineJoin="round",E.drawImage(n,0,0,w.width,w.height),e==="10K"||e==="20K"||x>16){const F=document.createElement("canvas"),R=F.getContext("2d");if(R)if(F.width=12288,F.height=12288*(d/f),R.imageSmoothingEnabled=!0,R.imageSmoothingQuality="high",R.textBaseline="alphabetic",R.textAlign="start",R.fontKerning="normal",R.lineWidth=.25,R.lineCap="round",R.lineJoin="round",R.drawImage(w,0,0,F.width,F.height),e==="20K"||x>24){const G=document.createElement("canvas"),q=G.getContext("2d");q?(G.width=16384,G.height=16384*(d/f),q.imageSmoothingEnabled=!0,q.imageSmoothingQuality="high",q.textBaseline="alphabetic",q.textAlign="start",q.fontKerning="normal",q.lineWidth=.25,q.lineCap="round",q.lineJoin="round",q.drawImage(F,0,0,G.width,G.height),l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.textBaseline="alphabetic",l.textAlign="start",l.fontKerning="normal",l.lineWidth=.125,l.lineCap="round",l.lineJoin="round",l.drawImage(G,0,0,s,r)):l.drawImage(F,0,0,s,r)}else l.drawImage(F,0,0,s,r);else l.drawImage(w,0,0,s,r)}else l.drawImage(w,0,0,s,r);else l.drawImage(n,0,0,s,r)}else if(x>4){const K=Math.min(6144,Math.max(f,d)*3),w=document.createElement("canvas"),E=w.getContext("2d");E?(w.width=K,w.height=K*(d/f),E.imageSmoothingEnabled=!0,E.imageSmoothingQuality="high",E.textBaseline="alphabetic",E.textAlign="start",E.fontKerning="normal",E.lineWidth=.25,E.lineCap="round",E.lineJoin="round",E.drawImage(n,0,0,w.width,w.height),l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.textBaseline="alphabetic",l.textAlign="start",l.fontKerning="normal",l.lineWidth=.25,l.lineCap="round",l.lineJoin="round",l.drawImage(w,0,0,s,r)):l.drawImage(n,0,0,s,r)}else l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.textBaseline="alphabetic",l.textAlign="start",l.fontKerning="normal",l.lineWidth=.25,l.lineCap="round",l.lineJoin="round",l.drawImage(n,0,0,s,r)}const b=new Date,C=`VIBE DRAWING by Michael Wybraniec | one-front.com | ${b.toLocaleDateString()} | ${m} DPI`;l.save(),l.textAlign="right",l.textBaseline="bottom";const M=Math.max(8,s/300),$=Math.max(4,s/200),V=$*.8;l.font=`${M}px Inter, sans-serif`;const P=l.measureText(C).width+V*2,z=M+V*2,L=s-P-$,I=r-z-$;l.fillStyle="rgba(0, 0, 0, 0.6)",l.beginPath(),l.roundRect(L,I,P,z,$*.5),l.fill(),l.strokeStyle="rgba(255, 215, 0, 0.2)",l.lineWidth=.5,l.stroke(),l.fillStyle="rgba(255, 255, 255, 0.8)",l.font=`${M}px Inter, sans-serif`,l.fillText(C,s-$-V,r-$-V),l.restore();let k,H,B;switch(t){case"PNG":k="image/png",H=1,B="png";break;case"JPEG":k="image/jpeg",H=.95,B="jpg";break;case"WEBP":k="image/webp",H=.95,B="webp";break;case"TIFF":k="image/png",H=1,B="png",console.warn("TIFF format not supported by browsers, exporting as PNG instead");break;case"PDF":k="image/png",H=1,B="png",console.warn("PDF format not supported by browsers, exporting as PNG instead");break;default:k="image/png",H=1,B="png"}g.toBlob(x=>{if(!x){console.error("Failed to create image blob"),Z();return}Z();const K=URL.createObjectURL(x),w=document.createElement("a");w.href=K;const E=b.toISOString().replace(/[:.]/g,"").slice(0,15);w.download=`VIBE-DRAWING-${E}-${e}.${B}`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(K)},k,H)}catch(o){console.error("Error saving canvas:",o),Z()}}function Qt(n){const e=window.devicePixelRatio||1,t=n.clientWidth,o=n.clientHeight,a=2;if(n.width=t*e*a,n.height=o*e*a,n.style.width=t+"px",n.style.height=o+"px",c=n.getContext("2d",{alpha:!0,antialias:!0,willReadFrequently:!1}),!c){console.error("Failed to get 2D context!");return}c.scale(e*a,e*a),c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.lineCap="round",c.lineJoin="round",c.strokeStyle="#111",c.lineWidth=2,c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.textBaseline="alphabetic",c.textAlign="start",c.fontKerning="normal",me(n)}function me(n){if(!c){console.error("Cannot clear canvas - no context!");return}const e=n.clientWidth,t=n.clientHeight,o="#151E35";c.fillStyle=o,c.fillRect(0,0,e,t);const a=e/2,i=t/2,s=Math.sqrt(a*a+i*i),r=c.createRadialGradient(a,i,0,a,i,s);r.addColorStop(0,"rgba(0, 0, 0, 0)"),r.addColorStop(.7,"rgba(0, 0, 0, 0)"),r.addColorStop(1,"rgba(0, 0, 0, 0.15)"),c.fillStyle=r,c.fillRect(0,0,e,t),c.fillStyle="rgba(255, 255, 255, 0.3)";for(let g=0;g<50;g++){const l=Math.random()*e,f=Math.random()*t,d=Math.random()*2+1;c.beginPath(),c.arc(l,f,d,0,2*Math.PI),c.fill()}c.lineWidth=20,ee&&Oe()}function Oe(){const n=document.getElementById("debug-current-info"),e=document.getElementById("debug-size-info");if(!n||!e)return;const t=N.getCurrentStyle(),o=N.getCurrentStyleIndex(),a=performance.memory;let i="N/A",s="N/A",r="#666666",g="";if(a){const m=a.usedJSHeapSize/1024/1024,p=a.totalJSHeapSize/1024/1024,v=m/p*100;i=m.toFixed(1),s=p.toFixed(1),v<30?(r="#66ff66",g="Low"):v<60?(r="#ffff66",g="Medium"):v<80?(r="#ffaa66",g="High"):(r="#ff6666",g="Critical")}const l=[`Style ${o+1}: ${t.name}`,`Size: ${["Tiny","Small","Medium","Large","Huge","Giant"][O]} (${he[O]?.toFixed(2)}x)`,`Thickness: ${J.toFixed(2)}x (Range: 0.2x-5.0x, Arrow Keys)`,`Eraser: ${D?"ON":"OFF"}`,`Memory: <span style="color: ${r}">${i}MB/${s}MB (${g})</span> | Limit: ${nt}%`];n.innerHTML=l.map(m=>`<div>${m}</div>`).join("");const f=["T","S","M","L","H","G"];let d='<div style="color: #ffff00; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">SIZE TRACKING</div>';d+='<div style="margin: 8px 0; color: #cccccc; font-family: monospace; font-size: 11px;">Style '+f.map(m=>m.padStart(6)).join("")+"</div>";const u=Object.keys(ne);u.forEach((m,p)=>{let v=m.padEnd(6);for(let h=0;h<6;h++){const y=ne[m]?.[h];if(y!==void 0){const b=y<1?"#ff6666":y<3?"#ffff66":"#66ff66";v+=`<span style="color: ${b}">${y.toFixed(1).padStart(6)}</span>`}else v+='<span style="color: #666666">0.0'.padStart(6)+"</span>"}const S=p%2===0?"#ffffff":"#cccccc";d+=`<div style="color: ${S}; font-family: monospace; font-size: 11px; margin: 2px 0; padding-left: 8px;">${v}</div>`}),d+='<div style="margin-top: 16px; color: #ffff00; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">PROGRESSION RATIOS</div>',u.forEach(m=>{const p=ne[m];if(p){const v=[];for(let h=0;h<4;h++){const y=p[h],b=p[h+1];if(y!==void 0&&b!==void 0){const C=b/y;v.push(C.toFixed(1))}}const S=`${m}: ${v.join(" → ")}`;d+=`<div style="color: #cccccc; margin: 4px 0; padding-left: 8px; font-family: monospace; font-size: 11px;">${S}</div>`}}),e.innerHTML=d}function at(){ee&&Oe()}function Xt(n){n.addEventListener("touchstart",t=>t.preventDefault(),{passive:!1}),n.addEventListener("touchmove",t=>t.preventDefault(),{passive:!1}),n.addEventListener("touchend",t=>t.preventDefault(),{passive:!1}),n.addEventListener("pointerdown",t=>{if(t.pointerType,oe||W===2&&Ie)return;const o=t.pointerType==="pen",a=t.pointerType==="touch";t.pointerType;let i=t.pressure!==void 0?t.pressure:.5;o&&(i=Math.max(.1,Math.min(1,i))),n.setPointerCapture(t.pointerId),oe=!0,W===2&&(Ie=!0),fe=[];const{x:s,y:r}=Ye(n,t.clientX,t.clientY);let g=le(t.width||1,t.height||1);if(o?g*=.3+i*.7:a&&(g*=.5+i*.5),fe.push({x:s,y:r,t:t.timeStamp,width:10,height:10}),At(),c){const l=t.width||1,f=t.height||1;let d,u,m;Q?(d=45,u=45,m=1):(d=Math.max(l,30),u=Math.max(f,30),m=l>1||f>1?1.2:1);const p=d*g*m,v=u*g*m,S=Math.max(p,v),h=N.getCurrentStyleIndex();if(h===0)_(c,s,r,p,v);else if(h===1)if(D){c.save(),c.globalCompositeOperation="destination-out";const y=p/2*(.95+Math.random()*.1),b=1+Math.sin(Date.now()/160)*.03,M=y*b*(1+O*.3)*J,V=Math.max(3,M)*.15;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(s,r,V,0,2*Math.PI),c.fill(),c.restore()}else _(c,s,r,p,v);else if(h===2)if(D){c.save(),c.globalCompositeOperation="destination-out";const y=p/2*(.95+Math.random()*.1),b=1+Math.sin(Date.now()/160)*.03,M=y*b*.3;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(s,r,M,0,2*Math.PI),c.fill(),c.restore()}else _(c,s,r,p,v);else if(h===3)if(D){c.save(),c.globalCompositeOperation="destination-out";const y=le(p,v),C=Math.max(p,v)*.4*y*1.5;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(s,r,C,0,2*Math.PI),c.fill(),c.restore()}else _(c,s,r,p,v);else if(h===4)if(D){c.save(),c.globalCompositeOperation="destination-out";const y=le(p,v),M=Math.max(p,v)*.25*y*(1+O*.3)*J*1.5;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(s,r,M,0,2*Math.PI),c.fill(),c.restore()}else _(c,s,r,p,v);else if(h===5)if(D){c.save(),c.globalCompositeOperation="destination-out";const y=Math.max(p,v)*3;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(s,r,y,0,2*Math.PI),c.fill(),c.restore()}else _(c,s,r,p,v);else if(h===6)_(c,s,r,p,v);else if(h===7)_(c,s,r,p,v);else{c.save(),c.globalAlpha=.8;const y=1+Math.sin(Date.now()/200)*.1,b=p/2*y,C=v/2*y;if(D?(c.globalCompositeOperation="source-over",c.fillStyle="#151E35"):(c.globalCompositeOperation="source-over",c.fillStyle="#000000"),D){const M=c.createRadialGradient(s,r,0,s,r,Math.max(b,C));M.addColorStop(0,"#151E35"),M.addColorStop(.7,"#151E35"),M.addColorStop(1,"#151E35"),c.fillStyle=M}else{const M=c.createRadialGradient(s,r,0,s,r,Math.max(b,C));M.addColorStop(0,"#000000"),M.addColorStop(.7,"#333333"),M.addColorStop(1,"#666666"),c.fillStyle=M}c.beginPath(),c.ellipse(s,r,b,C,0,0,2*Math.PI),c.fill(),c.restore(),S>15&&!D&&N.getCurrentStyleIndex()===0&&Math.random()<.7&&(c.save(),c.globalAlpha=.5,c.restore())}}else console.error("Canvas context is null! Cannot draw.")}),n.addEventListener("pointermove",t=>{if(oe&&Kt(),t.pointerType,!oe)return;const{x:o,y:a}=Ye(n,t.clientX,t.clientY),i=fe[fe.length-1],s=Math.max(.001,t.timeStamp-(i.t||0)),r=o-i.x,g=a-i.y,l=Math.hypot(r,g)/s,f=l>2,d=!Q,u=t.pointerType==="pen",m=t.pointerType==="touch";t.pointerType;let p=t.pressure!==void 0?t.pressure:.5;u&&(p=Math.max(.1,Math.min(1,p)));let v=le(t.width||1,t.height||1);if(u?v*=.3+p*.7:m&&(v*=.5+p*.5),fe.push({x:o,y:a,t:t.timeStamp,speed:l,width:10,height:10}),!c)return;const S=Math.hypot(o-i.x,a-i.y);let h;u?h=W===2||W===5?.4:.3:d&&f?h=W===2||W===5?3:2.5:h=W===2||W===5?2:Q?.3:1.5;const y=Math.max(1,Math.ceil(S/h));let b;u?b=W===2||W===5?3.5:7:d&&f?b=W===2||W===5?.5:.8:b=W===2||W===5?1:Q?5:1.5;const M=Math.max(W===2||W===5?1:Q?8:2,Math.ceil(y*b)),$=t.width||1,V=t.height||1;let A,P,z;Q?(A=45,P=45,z=1):(A=Math.max($,30),P=Math.max(V,30),z=$>1||V>1?1.2:1);const L=A*v*z,I=P*v*z;c.save(),c.globalAlpha=.8;for(let k=0;k<=M;k++){const H=k/M,B=i.x+(o-i.x)*H,x=i.y+(a-i.y)*H,K=Math.sin(k*.5)*.1,w=B+K,E=x+K,U=N.getCurrentStyleIndex();if(U===0)_(c,w,E,L,I);else if(U===1)if(D){c.save(),c.globalCompositeOperation="destination-out";const F=L/2*(.95+Math.random()*.1),R=1+Math.sin(Date.now()/160)*.03,G=F*R*(1+O*.3)*J,j=Math.max(3,G)*.15;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(w,E,j,0,2*Math.PI),c.fill(),c.restore()}else _(c,w,E,L,I);else if(U===2)if(D){c.save(),c.globalCompositeOperation="destination-out";const F=L/2*(.95+Math.random()*.1),R=1+Math.sin(Date.now()/160)*.03,G=F*R*.3;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(w,E,G,0,2*Math.PI),c.fill(),c.restore()}else _(c,w,E,L,I);else if(U===3)if(D){c.save(),c.globalCompositeOperation="destination-out";const F=le(L,I),Y=Math.max(L,I)*.4*F*1.5;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(w,E,Y,0,2*Math.PI),c.fill(),c.restore()}else _(c,w,E,L,I);else if(U===4)if(D){c.save(),c.globalCompositeOperation="destination-out";const F=le(L,I),G=Math.max(L,I)*.25*F*(1+O*.3)*J*1.5;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(w,E,G,0,2*Math.PI),c.fill(),c.restore()}else _(c,w,E,L,I);else if(U===5)_(c,w,E,L,I);else if(U===6)_(c,w,E,L,I);else if(U===7)_(c,w,E,L,I);else{let F;u?F=.98+Math.random()*.04:F=.95+Math.random()*.1;const R=1+Math.sin((Date.now()+k*40)/160)*.03,Y=L/2*F*R,G=I/2*F*R;if(D?(c.globalCompositeOperation="source-over",c.fillStyle="#151E35"):c.globalCompositeOperation="source-over",c.beginPath(),c.ellipse(B,x,Y,G,0,0,2*Math.PI),c.fill(),Math.max(L,I)>10&&!D)if(N.getCurrentStyleIndex()===0){let j;Q?j=.6:d&&f?j=.1:j=.3,j&&Math.random()<j&&(c.save(),c.globalAlpha=.5,c.restore())}else{let j;u?j=.4:Q?j=.2:d&&f?j=.02:j=.1,Math.random()<j&&(c.save(),c.globalAlpha=.4,c.restore())}}}c.restore()});const e=t=>{if(oe){oe=!1,W===2&&(Ie=!1),n.releasePointerCapture(t.pointerId);try{if(T&&T.state!=="suspended"){const o=T.createOscillator(),a=T.createGain();o.connect(a),a.connect(T.destination),o.frequency.setValueAtTime(400,T.currentTime),o.frequency.exponentialRampToValueAtTime(200,T.currentTime+.2),a.gain.setValueAtTime(.15,T.currentTime),a.gain.exponentialRampToValueAtTime(.01,T.currentTime+.2),o.start(T.currentTime),o.stop(T.currentTime+.2)}}catch(o){console.error("Error playing drawing end sound:",o)}}};n.addEventListener("pointerup",e),n.addEventListener("pointercancel",e),n.addEventListener("pointerleave",e)}let T=null,Ce=!1;function De(){if(!Ce)try{T=new(window.AudioContext||window.webkitAudioContext),Ce=!0}catch{Ce=!0}}function rt(){T||De(),T&&T.state==="suspended"&&T.resume().catch(console.warn);try{if(!T){console.warn("Audio context not available for splash sound");return}const n=T.createOscillator(),e=T.createGain();n.connect(e),e.connect(T.destination),n.frequency.setValueAtTime(400,T.currentTime),n.frequency.exponentialRampToValueAtTime(800,T.currentTime+.2),n.frequency.exponentialRampToValueAtTime(600,T.currentTime+.4),n.frequency.exponentialRampToValueAtTime(900,T.currentTime+.6),e.gain.setValueAtTime(.2,T.currentTime),e.gain.exponentialRampToValueAtTime(.4,T.currentTime+.2),e.gain.exponentialRampToValueAtTime(.2,T.currentTime+.4),e.gain.exponentialRampToValueAtTime(.01,T.currentTime+.6),n.start(T.currentTime),n.stop(T.currentTime+.6)}catch(n){console.error("Error playing splash sound:",n)}}function Zt(){(!T||T.state==="suspended")&&T?.resume();try{if(!T)return;const n=T.createOscillator(),e=T.createGain();n.connect(e),e.connect(T.destination),n.frequency.setValueAtTime(300,T.currentTime),n.frequency.exponentialRampToValueAtTime(1500,T.currentTime+.3),e.gain.setValueAtTime(.3,T.currentTime),e.gain.exponentialRampToValueAtTime(.01,T.currentTime+.3),n.start(T.currentTime),n.stop(T.currentTime+.3)}catch(n){console.error("Error playing zoom sound:",n)}}function He(){Ce||(De(),rt())}document.addEventListener("click",He);document.addEventListener("touchstart",He);document.addEventListener("keydown",He);De();window.showInfoPopup=Bt;window.hideInfoPopup=tt;document.addEventListener("click",n=>{const e=document.getElementById("info-popup");e&&n.target===e&&tt()});function en(){const n=document.getElementById("app-canvas");if(!n){console.error("Canvas element not found!");return}document.addEventListener("contextmenu",h=>h.preventDefault()),document.addEventListener("selectstart",h=>h.preventDefault()),document.addEventListener("dragstart",h=>h.preventDefault()),document.addEventListener("gesturestart",h=>h.preventDefault()),document.addEventListener("gesturechange",h=>h.preventDefault()),document.addEventListener("gestureend",h=>h.preventDefault()),n.addEventListener("contextmenu",h=>h.preventDefault()),n.addEventListener("selectstart",h=>h.preventDefault()),n.addEventListener("dragstart",h=>h.preventDefault()),n.style.touchAction="none",n.style.webkitTouchCallout="none",n.style.webkitUserSelect="none",n.style.userSelect="none",Qt(n),Ae(n),c&&n&&me(n);const e=()=>Ae(n);window.addEventListener("resize",e),window.addEventListener("orientationchange",e),window.visualViewport?.addEventListener("resize",e),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&Ae(n)}),Xt(n),setTimeout(()=>{const h=document.getElementById("splash-screen");h&&(Zt(),h.classList.add("fade-out"),setTimeout(()=>{h.style.display="none";const y=document.querySelector(".one-front-credit");y&&y.classList.add("show")},300))},300),setTimeout(()=>{rt()},200);const t=document.getElementById("style-selector");if(t){const h=()=>{t.style.transform="scale(0.85)",t.style.opacity="0.7",setTimeout(()=>{t.style.transform="",t.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),N.nextStyle();const C=N.getCurrentStyle();t.textContent=(N.getCurrentStyleIndex()+1).toString(),t.style.color="white",t.title=`Current: ${C.name}
Tap to switch drawing style`};t.addEventListener("click",h),t.addEventListener("touchstart",C=>{C.preventDefault(),h()}),t.addEventListener("touchend",C=>{C.preventDefault()});const y=document.getElementById("menu-toggle");y&&(y.addEventListener("click",je),y.addEventListener("touchstart",C=>{C.preventDefault(),je()}));const b=N.getCurrentStyle();t.textContent=(N.getCurrentStyleIndex()+1).toString(),t.style.color="white",t.title=`Current: ${b.name}
Tap to switch drawing style`}const o=document.getElementById("style-switch");if(o){const h=()=>{o.style.transform="scale(0.85)",o.style.opacity="0.7",setTimeout(()=>{o.style.transform="",o.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50);const b=N.getCurrentStyle();b.nextColorVariant&&b.nextColorVariant();const C=Math.floor(Math.random()*360);o.style.color=`hsl(${C}, 85%, 55%)`};o.addEventListener("click",h),o.addEventListener("touchstart",b=>{b.preventDefault(),h()}),o.addEventListener("touchend",b=>{b.preventDefault()});const y=Math.floor(Math.random()*360);o.style.color=`hsl(${y}, 85%, 55%)`}const a=document.getElementById("size-selector"),i=document.getElementById("vibration-knob");let s=null;if(a){const h=y=>{if(O=y,"vibrate"in navigator&&navigator.vibrate(30),typeof window.audioContext<"u"&&window.gainNode){const b=window.audioContext,C=window.gainNode,M=b.createOscillator();M.connect(C),M.frequency.setValueAtTime(800+O*200,b.currentTime),M.start(),M.stop(b.currentTime+.1)}};console.log("Mobile detection:",{hasOntouchstart:"ontouchstart"in window,maxTouchPoints:window.navigator.maxTouchPoints,isWebApp:Q,windowWidth:window.innerWidth,userAgent:navigator.userAgent}),console.log("Using PizzaSizeSelector (single-click cycling for all devices)"),s=new Ht(a,O,h)}window.setSizeLevel=h=>{h>=0&&h<6&&(O=h,s&&s.setSize(h))},window.currentSizeLevel=O;let r=1;const g=()=>{i&&(r=parseFloat(i.value)),window.vibrationIntensity=r};i?.addEventListener("input",g),g();const l=h=>{const y=J,b=.2;h.key==="ArrowLeft"||h.key==="ArrowDown"?J=Math.max(.2,y-b):h.key==="ArrowRight"||h.key==="ArrowUp"?J=Math.min(5,y+b):h.key==="["||h.key==="{"?O=Math.max(0,O-1):(h.key==="]"||h.key==="}")&&(O=Math.min(4,O+1))};document.addEventListener("keydown",l);const f=document.getElementById("eraser");if(f){const h=()=>{f.style.transform="scale(0.85)",f.style.opacity="0.7",setTimeout(()=>{f.style.transform="",f.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),D=!D,D?f.classList.add("eraser-active"):f.classList.remove("eraser-active")};f.addEventListener("click",h),f.addEventListener("touchstart",y=>{y.preventDefault(),h()}),f.addEventListener("touchend",y=>{y.preventDefault()})}const d=document.getElementById("clear-canvas");if(d){const h=()=>{d.style.transform="scale(0.85)",d.style.opacity="0.7",setTimeout(()=>{d.style.transform="",d.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),c&&n&&me(n)};d.addEventListener("click",h),d.addEventListener("touchstart",h),d.addEventListener("touchend",h)}const u=document.getElementById("save-as");if(u){const h=()=>{u.style.transform="scale(0.85)",u.style.opacity="0.7",setTimeout(()=>{u.style.transform="",u.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),it()};u.addEventListener("click",h),u.addEventListener("touchstart",y=>{y.preventDefault(),h()}),u.addEventListener("touchend",y=>{y.preventDefault()})}const m=document.getElementById("cancel-save");m&&m.addEventListener("click",()=>{m.style.transform="scale(0.85)",m.style.opacity="0.7",setTimeout(()=>{m.style.transform="",m.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),Ee()});const p=document.getElementById("confirm-save");p&&p.addEventListener("click",()=>{if(p.style.transform="scale(0.85)",p.style.opacity="0.7",setTimeout(()=>{p.style.transform="",p.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),c&&n){const h=document.querySelector('input[name="quality"]:checked'),y=document.querySelector('input[name="format"]:checked');h&&y&&(st(n,h.value,y.value),Ee())}});const v=document.getElementById("save-modal");v&&v.addEventListener("click",h=>{h.target===v&&Ee()});function S(h){W=h,document.querySelectorAll(".style-button").forEach((y,b)=>{y.classList.toggle("active",b===h-1)})}document.getElementById("style-1")?.addEventListener("click",()=>S(1)),document.getElementById("style-2")?.addEventListener("click",()=>S(2)),document.getElementById("style-3")?.addEventListener("click",()=>S(3)),nn(),sn(),Ut(),Gt()}document.addEventListener("DOMContentLoaded",en);let X=null,te=!1,Qe=.8;const tn={title:"🌙 Gentle Bangs",description:"Safe frequencies with nice bangs and beautiful fades",scale:{notes:[98,110,123.47,130.81,146.83,164.81,174.61,196,220,246.94,261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25,698.46,783.99,880,987.77],name:"Safe Frequency Scale"},type:"ambient",tempo:70,melody:[{note:8,duration:1,volume:.8,bang:!0},{note:10,duration:1,volume:.8,bang:!0},{note:12,duration:2,volume:.9,bang:!0},{note:10,duration:1,volume:.8,bang:!0},{note:8,duration:1,volume:.8,bang:!0},{note:9,duration:1,volume:.8,bang:!0},{note:10,duration:2,volume:.9,bang:!0},{note:12,duration:1,volume:.8,bang:!0},{note:13,duration:1,volume:.8,bang:!0},{note:15,duration:3,volume:1,bang:!0}],harmony:[{note:4,duration:4,volume:.6,bang:!0},{note:6,duration:4,volume:.6,bang:!0},{note:8,duration:4,volume:.6,bang:!0},{note:4,duration:4,volume:.6,bang:!0}],bass:[{note:0,duration:2,volume:.7,bang:!0},{note:0,duration:2,volume:.7,bang:!0},{note:1,duration:2,volume:.7,bang:!0},{note:1,duration:2,volume:.7,bang:!0},{note:2,duration:2,volume:.7,bang:!0},{note:2,duration:2,volume:.7,bang:!0},{note:0,duration:4,volume:.8,bang:!0}]};function nn(){const n=document.getElementById("music-control");n?.addEventListener("click",e=>{if(e.preventDefault(),n&&(n.style.transform="scale(0.85)",n.style.opacity="0.7",setTimeout(()=>{n.style.transform="",n.style.opacity=""},200)),"vibrate"in navigator&&navigator.vibrate(50),n&&(n.textContent==="🎵"?n.textContent="🎶":n.textContent="🎵"),te)ct();else try{on()}catch(t){console.error("Error in playMusic:",t)}});try{new(window.AudioContext||window.webkitAudioContext)().close()}catch(e){console.error("Failed to create test audio context:",e)}}async function on(){X&&ct();const n=tn;try{const e=new(window.AudioContext||window.webkitAudioContext);e.state==="suspended"&&await e.resume();const t=e.createGain();t.gain.setValueAtTime(0,e.currentTime),t.gain.linearRampToValueAtTime(Qe*.3,e.currentTime+1),t.connect(e.destination);const o=e.createDelay(1),a=e.createGain(),i=e.createGain();o.delayTime.setValueAtTime(.4,e.currentTime),a.gain.setValueAtTime(.1,e.currentTime),i.gain.setValueAtTime(.05,e.currentTime),t.connect(o),o.connect(a),a.connect(i),i.connect(o),a.connect(e.destination);const s=e.createConvolver(),r=e.createGain();r.gain.setValueAtTime(.08,e.currentTime);const g=e.sampleRate*1,l=e.createBuffer(2,g,e.sampleRate);for(let f=0;f<2;f++){const d=l.getChannelData(f);for(let u=0;u<g;u++){const m=u/e.sampleRate,p=Math.exp(-m*1.5)*(Math.random()*2-1)*.03;d[u]=p}}s.buffer=l,a.connect(s),s.connect(r),r.connect(e.destination),lt(e,t,n),X=new Audio,X.volume=Qe*.4,$e(!0),te=!0,X.audioContext=e,X.masterGain=t,X.track=n}catch(e){console.error("Error playing music:",e),$e(!1),te=!1}}function lt(n,e,t){const o=t.scale.notes,i=60/t.tempo,s=[{note:7,duration:1,volume:.5},{note:8,duration:1,volume:.5},{note:10,duration:2,volume:.6},{note:12,duration:1,volume:.5},{note:10,duration:1,volume:.5},{note:8,duration:1,volume:.5},{note:7,duration:1,volume:.5},{note:5,duration:2,volume:.6},{note:7,duration:1,volume:.5},{note:8,duration:3,volume:.7}],r=[{note:12,duration:1,volume:.6},{note:15,duration:1,volume:.6},{note:17,duration:2,volume:.7},{note:15,duration:1,volume:.6},{note:12,duration:1,volume:.6},{note:10,duration:1,volume:.6},{note:12,duration:2,volume:.7},{note:15,duration:1,volume:.6},{note:17,duration:1,volume:.6},{note:19,duration:3,volume:.8}],g=[{note:15,duration:1,volume:.4},{note:12,duration:1,volume:.4},{note:8,duration:1,volume:.4},{note:5,duration:1,volume:.4},{note:2,duration:2,volume:.5},{note:0,duration:4,volume:.6}],l=[{note:6,duration:1,volume:.5},{note:8,duration:1,volume:.5},{note:9,duration:1,volume:.5},{note:10,duration:2,volume:.6},{note:8,duration:1,volume:.5},{note:6,duration:1,volume:.5},{note:4,duration:1,volume:.5},{note:6,duration:2,volume:.6},{note:8,duration:1,volume:.5},{note:10,duration:1,volume:.5},{note:12,duration:3,volume:.7}],f=[{note:7,duration:1,volume:.5},{note:8,duration:1,volume:.5},{note:10,duration:2,volume:.6},{note:12,duration:1,volume:.5},{note:10,duration:1,volume:.5},{note:8,duration:1,volume:.5},{note:7,duration:1,volume:.5},{note:5,duration:2,volume:.6},{note:7,duration:1,volume:.5},{note:8,duration:3,volume:.7}];pe(n,e,s,o,i),setTimeout(()=>{te&&pe(n,e,r,o,i)},s.reduce((u,m)=>u+m.duration,0)*i*1e3),setTimeout(()=>{te&&pe(n,e,g,o,i)},(s.reduce((u,m)=>u+m.duration,0)+r.reduce((u,m)=>u+m.duration,0))*i*1e3),setTimeout(()=>{te&&pe(n,e,l,o,i)},(s.reduce((u,m)=>u+m.duration,0)+r.reduce((u,m)=>u+m.duration,0)+g.reduce((u,m)=>u+m.duration,0))*i*1e3),setTimeout(()=>{te&&pe(n,e,f,o,i)},(s.reduce((u,m)=>u+m.duration,0)+r.reduce((u,m)=>u+m.duration,0)+g.reduce((u,m)=>u+m.duration,0)+l.reduce((u,m)=>u+m.duration,0))*i*1e3);const d=(s.reduce((u,m)=>u+m.duration,0)+r.reduce((u,m)=>u+m.duration,0)+g.reduce((u,m)=>u+m.duration,0)+l.reduce((u,m)=>u+m.duration,0)+f.reduce((u,m)=>u+m.duration,0))*i;setTimeout(()=>{te&&lt(n,e,t)},d*1e3)}function pe(n,e,t,o,a){let i=n.currentTime;t.forEach((s,r)=>{const g=(o[s.note]||440)*1,l=s.duration*a,f=n.createOscillator(),d=n.createGain();f.type="sine",f.frequency.setValueAtTime(g,i);const u=s.volume*.3,m=s.volume*.15;d.gain.setValueAtTime(0,i),d.gain.linearRampToValueAtTime(u,i+.01),d.gain.linearRampToValueAtTime(m,i+.1),d.gain.setValueAtTime(m,i+l-.5),d.gain.exponentialRampToValueAtTime(.001,i+l),f.connect(d),d.connect(e),f.start(i),f.stop(i+l),i+=l})}function ct(){if(X&&X.audioContext){const n=X.audioContext,e=X.masterGain;e&&e.gain.linearRampToValueAtTime(0,n.currentTime+1),setTimeout(()=>{try{n.close()}catch{}},1e3),X=null,$e(!1),te=!1}}function $e(n){const e=document.getElementById("music-control");e?n?(e.classList.add("playing"),e.textContent="🎶"):(e.classList.remove("playing"),e.textContent="🎵"):console.error("Music button not found!")}window.reportActualSize=_t;function sn(){const n=document.getElementById("fullscreen-toggle");if(!n){console.error("Full screen button not found!");return}const e={standard:!!document.fullscreenEnabled,webkit:!!document.webkitFullscreenEnabled,moz:!!document.mozFullScreenEnabled,ms:!!document.msFullscreenEnabled};console.log("Fullscreen support detection:",e),console.log("User agent:",navigator.userAgent);const t=!!navigator.brave&&navigator.brave.isBrave;if(console.log("Is Brave browser:",t),!e.standard&&!e.webkit&&!e.moz&&!e.ms){console.warn("Full screen not supported in this browser"),n.style.display="none";return}function o(){if(!n)return;!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)?(n.classList.add("fullscreen-active"),n.title="Exit full screen mode"):(n.classList.remove("fullscreen-active"),n.title="Enter full screen mode")}function a(){const i=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if(console.log("Current fullscreen state:",i),i)console.log("Attempting to exit fullscreen..."),document.exitFullscreen?document.exitFullscreen().catch(s=>{console.error("Error exiting fullscreen (standard):",s)}):document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():console.error("No exit fullscreen method available");else{console.log("Attempting to enter fullscreen...");const s=document.documentElement;(async()=>{try{s.requestFullscreen?(await s.requestFullscreen(),console.log("Fullscreen entered successfully (standard)")):s.webkitRequestFullscreen?(s.webkitRequestFullscreen(),console.log("Fullscreen entered successfully (webkit)")):s.mozRequestFullScreen?(s.mozRequestFullScreen(),console.log("Fullscreen entered successfully (moz)")):s.msRequestFullscreen?(s.msRequestFullscreen(),console.log("Fullscreen entered successfully (ms)")):console.error("No request fullscreen method available")}catch(g){if(console.error("Error entering fullscreen:",g),t){console.log("Trying Brave-specific fullscreen approach...");try{const l=document.getElementById("app");l&&l.requestFullscreen&&(await l.requestFullscreen(),console.log("Fullscreen entered successfully with app element"))}catch(l){console.error("Brave-specific fullscreen failed:",l)}}}})()}}n.addEventListener("click",i=>{i.preventDefault(),console.log("Fullscreen button clicked"),i.isTrusted?a():console.warn("Fullscreen request not from user gesture")}),n.addEventListener("touchstart",i=>{i.preventDefault(),console.log("Fullscreen button touched"),i.isTrusted?a():console.warn("Fullscreen request not from user gesture")}),document.addEventListener("fullscreenchange",o),document.addEventListener("webkitfullscreenchange",o),document.addEventListener("mozfullscreenchange",o),document.addEventListener("MSFullscreenChange",o),o()}export{Ze as W,ht as _,Fe as r};
