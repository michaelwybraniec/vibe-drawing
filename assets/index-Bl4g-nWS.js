(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const ct="modulepreload",ht=function(e){return"/vibe-drawing/"+e},Te={},ut=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){let m=function(h){return Promise.all(h.map(d=>Promise.resolve(d).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),r=a?.nonce||a?.getAttribute("nonce");o=m(n.map(h=>{if(h=ht(h),h in Te)return;Te[h]=!0;const d=h.endsWith(".css"),l=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${l}`))return;const M=document.createElement("link");if(M.rel=d?"stylesheet":ct,d||(M.as="script"),M.crossOrigin="",M.href=h,r&&M.setAttribute("nonce",r),document.head.appendChild(M),d)return new Promise((u,p)=>{M.addEventListener("load",u),M.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${h}`)))})}))}function s(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return o.then(a=>{for(const r of a||[])r.status==="rejected"&&s(r.reason);return t().catch(s)})};function Fe(){return typeof navigator<"u"&&"vibrate"in navigator}const dt="vibe.flags",$e={hapticsEnabled:!0,debug:!1};function ft(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function mt(){if(typeof window>"u")return{...$e};const e=ft(localStorage.getItem(dt));return{...$e,...e}}let gt=mt();function Ke(e){return gt[e]}let B=null,N=null,X=null;function He(e=.5){try{if(B||(B=new(window.AudioContext||window.webkitAudioContext)),!B||N)return;N=B.createOscillator(),X=B.createGain(),N.type="square",N.frequency.value=85,X.gain.value=Math.min(1,Math.max(.05,e)),N.connect(X),X.connect(B.destination),N.start()}catch{}}function we(e=.5){if(!X||!B)return;const t=Math.min(1,Math.max(.05,e));try{X.gain.exponentialRampToValueAtTime(t,B.currentTime+.05)}catch{X.gain.value=t}}/*! Capacitor: https://capacitorjs.com/ - MIT License */var Z;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(Z||(Z={}));class ge extends Error{constructor(t,n,i){super(t),this.message=t,this.code=n,this.data=i}}const pt=e=>{var t,n;return e?.androidBridge?"android":!((n=(t=e?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},Mt=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},i=n.Plugins=n.Plugins||{},o=()=>t!==null?t.name:pt(e),s=()=>o()!=="web",a=l=>{const M=h.get(l);return!!(M?.platforms.has(o())||r(l))},r=l=>{var M;return(M=n.PluginHeaders)===null||M===void 0?void 0:M.find(u=>u.name===l)},m=l=>e.console.error(l),h=new Map,d=(l,M={})=>{const u=h.get(l);if(u)return console.warn(`Capacitor plugin "${l}" already registered. Cannot register plugins twice.`),u.proxy;const p=o(),f=r(l);let w;const g=async()=>(!w&&p in M?w=typeof M[p]=="function"?w=await M[p]():w=M[p]:t!==null&&!w&&"web"in M&&(w=typeof M.web=="function"?w=await M.web():w=M.web),w),y=(v,P)=>{var k,D;if(f){const T=f?.methods.find(I=>P===I.name);if(T)return T.rtype==="promise"?I=>n.nativePromise(l,P.toString(),I):(I,_)=>n.nativeCallback(l,P.toString(),I,_);if(v)return(k=v[P])===null||k===void 0?void 0:k.bind(v)}else{if(v)return(D=v[P])===null||D===void 0?void 0:D.bind(v);throw new ge(`"${l}" plugin is not implemented on ${p}`,Z.Unimplemented)}},b=v=>{let P;const k=(...D)=>{const T=g().then(I=>{const _=y(I,v);if(_){const F=_(...D);return P=F?.remove,F}else throw new ge(`"${l}.${v}()" is not implemented on ${p}`,Z.Unimplemented)});return v==="addListener"&&(T.remove=async()=>P()),T};return k.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(k,"name",{value:v,writable:!1,configurable:!1}),k},L=b("addListener"),S=b("removeListener"),A=(v,P)=>{const k=L({eventName:v},P),D=async()=>{const I=await k;S({eventName:v,callbackId:I},P)},T=new Promise(I=>k.then(()=>I({remove:D})));return T.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await D()},T},E=new Proxy({},{get(v,P){switch(P){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return f?A:L;case"removeListener":return S;default:return b(P)}}});return i[l]=E,h.set(l,{name:l,proxy:E,platforms:new Set([...Object.keys(M),...f?[p]:[]])}),E};return n.convertFileSrc||(n.convertFileSrc=l=>l),n.getPlatform=o,n.handleError=m,n.isNativePlatform=s,n.isPluginAvailable=a,n.registerPlugin=d,n.Exception=ge,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},yt=e=>e.Capacitor=Mt(e),fe=yt(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Le=fe.registerPlugin;class Je{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let i=!1;this.listeners[t]||(this.listeners[t]=[],i=!0),this.listeners[t].push(n);const s=this.windowListeners[t];s&&!s.registered&&this.addWindowListener(s),i&&this.sendRetainedArgumentsForEvent(t);const a=async()=>this.removeListener(t,n);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,i){const o=this.listeners[t];if(!o){if(i){let s=this.retainedEventArguments[t];s||(s=[]),s.push(n),this.retainedEventArguments[t]=s}return}o.forEach(s=>s(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:i=>{this.notifyListeners(n,i)}}}unimplemented(t="not implemented"){return new fe.Exception(t,Z.Unimplemented)}unavailable(t="not available"){return new fe.Exception(t,Z.Unavailable)}async removeListener(t,n){const i=this.listeners[t];if(!i)return;const o=i.indexOf(n);this.listeners[t].splice(o,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(i=>{this.notifyListeners(t,i)}))}}const De=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Oe=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class St extends Je{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(i=>{if(i.length<=0)return;let[o,s]=i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");o=Oe(o).trim(),s=Oe(s).trim(),n[o]=s}),n}async setCookie(t){try{const n=De(t.key),i=De(t.value),o=`; expires=${(t.expires||"").replace("expires=","")}`,s=(t.path||"/").replace("path=",""),a=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${i||""}${o}; path=${s}; ${a};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}Le("CapacitorCookies",{web:()=>new St});const bt=async e=>new Promise((t,n)=>{const i=new FileReader;i.onload=()=>{const o=i.result;t(o.indexOf(",")>=0?o.split(",")[1]:o)},i.onerror=o=>n(o),i.readAsDataURL(e)}),vt=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(o=>o.toLocaleLowerCase()).reduce((o,s,a)=>(o[s]=e[t[a]],o),{})},wt=(e,t=!0)=>e?Object.entries(e).reduce((i,o)=>{const[s,a]=o;let r,m;return Array.isArray(a)?(m="",a.forEach(h=>{r=t?encodeURIComponent(h):h,m+=`${s}=${r}&`}),m.slice(0,-1)):(r=t?encodeURIComponent(a):a,m=`${s}=${r}`),`${i}&${m}`},"").substr(1):null,Pt=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),o=vt(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[a,r]of Object.entries(e.data||{}))s.set(a,r);n.body=s.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){const s=new FormData;if(e.data instanceof FormData)e.data.forEach((r,m)=>{s.append(m,r)});else for(const r of Object.keys(e.data))s.append(r,e.data[r]);n.body=s;const a=new Headers(n.headers);a.delete("content-type"),n.headers=a}else(o.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class Lt extends Je{async request(t){const n=Pt(t,t.webFetchExtra),i=wt(t.params,t.shouldEncodeUrlParams),o=i?`${t.url}?${i}`:t.url,s=await fetch(o,n),a=s.headers.get("content-type")||"";let{responseType:r="text"}=s.ok?t:{};a.includes("application/json")&&(r="json");let m,h;switch(r){case"arraybuffer":case"blob":h=await s.blob(),m=await bt(h);break;case"json":m=await s.json();break;case"document":case"text":default:m=await s.text()}const d={};return s.headers.forEach((l,M)=>{d[M]=l}),{data:m,headers:d,status:s.status,url:s.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}Le("CapacitorHttp",{web:()=>new Lt});const Ce=Le("NativeHaptics",{web:()=>({async start(){},async update(){},async stop(){}})});let Y=null;(async()=>{try{Y=(await ut(()=>import("./index-BFnUBpMy.js"),[])).Haptics}catch{Y=null}})();let ie=null,oe=150,J=22,Q=!1,le=!1,ae=.5;const re=fe.getPlatform();let Qe="medium",pe=!1;function Ct(e){const t=Math.max(0,Math.min(.25,0));return Math.max(.15,Math.min(1,t/.25))}function At(e){const t=Math.max(0,Math.min(1,.5));return Math.max(.1,Math.min(1,t))}function ce(e,t){const n=Ct(),i=At();return Math.max(.1,Math.min(1,i*.6+n*.4))}function Et(e,t){const n=ce();return Math.round(18+n*20)}function zt(e,t){const n=ce();return Math.round(80-n*35)}function kt(e,t){const n=ce();return n>.7?"heavy":n>.4?"medium":"light"}function Pe(){if(re!=="web"&&!le)try{Ce.update({intensity:ae});return}catch{}if(Y){re==="ios"?Y.impact({style:Qe}).catch(e=>console.log(`iOS haptic failed: ${e}`)):re==="android"?Y.vibrate({duration:J}).catch(e=>console.log(`Android haptic failed: ${e}`)):Fe()?navigator.vibrate(J):Q?we(J/40):(Q=!0,He(.4));return}Fe()?navigator.vibrate(J):Q?we(J/40):(Q=!0,He(.4))}function It(){if(Ke("hapticsEnabled")){if(pe){Tt();return}if(Q=!1,le=!1,re!=="web")try{Ce.start({intensity:ae}),le=!0,pe=!0;return}catch{}Y&&re==="ios"&&Y.impact({style:"medium"}).catch(e=>console.log(`iOS pre-tap failed: ${e}`)),Pe(),ie=window.setInterval(Pe,oe),pe=!0}}function Tt(e,t){if(!Ke("hapticsEnabled"))return;const n=ce(),i=Math.abs(ae-n)>.05;if(ae=n,le&&i)try{Ce.update({intensity:ae});return}catch{le=!1}if(i||!ie){J=Et(),Qe=kt();const o=zt();Math.abs(o-oe)>2&&ie!=null?(oe=o,window.clearInterval(ie),ie=window.setInterval(Pe,oe)):oe=o}Q&&we(ce())}class Ft{constructor(){this.name="Particle",this.description="Smooth particle-based drawing with haptic feedback",this.icon="1",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.previousPoint=null}onStart(t,n){console.log("🎨 Particle style started"),this.previousPoint=t}onMove(t,n){console.log("🎨 ParticleStyle.onMove called");const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:r,isWebApp:m}=n;this.previousPoint&&(i.save(),i.globalCompositeOperation="source-over",t.forEach((h,d)=>{if(!this.previousPoint)return;const l=(h.t-this.previousPoint.t)/16;if(l<=0)return;this.calculateSizeMultiplier(h,n);const M=this.previousPoint.x+(h.x-this.previousPoint.x)*l,u=this.previousPoint.y+(h.y-this.previousPoint.y)*l,p=h.width||1,f=h.height||1,w=.95+Math.random()*.1,g=1+Math.sin((Date.now()+d*40)/160)*.03,y=p/2*w*g,b=f/2*w*g;if(o)i.fillStyle="#151E35";else{const S=1+Math.sin(l*Math.PI)*.12;i.fillStyle=this.getCurrentColor(S)}i.beginPath(),i.ellipse(M,u,y,b,0,0,2*Math.PI),i.fill(),Math.max(p,f)>15&&Math.random()<.2&&(i.save(),i.globalAlpha=.4,this.addSparkleEffect(i,M,u,Math.max(p,f)/3),i.restore()),this.previousPoint=h}),i.restore())}onEnd(t){console.log("🎨 Particle style ended")}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(s[o]||1)*a;{const d=Math.max(0,Math.min(1,(r-5)/95));let l;(t.width||0)===0||(t.height||0)===0?l=.2:l=.1+d*.2;const M=.98+Math.random()*.04,u=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+l*M*this.sizeSmoothingFactor;return this.lastSizeMultiplier=u,u*a}}getCurrentColor(t){const n=Date.now()*.001,i=window.randomStyleParams?.baseHue||216;window.randomStyleParams?.cycleSpeed;const o=(Math.random()-.5)*60,s=(Math.random()-.5)*15+Math.sin(n*2)*5,a=(Math.random()-.5)*20+Math.sin(n*1.5)*8,r=(i+o+360)%360,m=Math.max(70,Math.min(100,(window.randomStyleParams?.saturation||90)+s)),h=Math.max(35,Math.min(75,(window.randomStyleParams?.lightness||50)+a));return`hsl(${r}, ${m}%, ${h}%)`}addSparkleEffect(t,n,i,o){const s=3+Math.floor(Math.random()*3);for(let a=0;a<s;a++){const r=Math.PI*2*a/s+Math.random()*.5,m=o*(.5+Math.random()*.5),h=n+Math.cos(r)*m,d=i+Math.sin(r)*m,l=o*.1*(.5+Math.random()*.5);t.fillStyle=`rgba(255, 255, 255, ${.6+Math.random()*.4})`,t.beginPath(),t.arc(h,d,l,0,2*Math.PI),t.fill()}}}class $t{constructor(){this.name="Lava",this.description="Flowing lava lines that melt and drip",this.icon="2",this.lavaLines=[],this.currentLavaLine=null,this.animationId=null}onStart(t,n){console.log("🌋 Lava style started"),this.currentLavaLine={points:[],startTime:Date.now(),isMelting:!1,meltProgress:0},this.addPointToLavaLine(t,n)}onMove(t,n){const{ctx:i}=n;this.currentLavaLine&&(t.forEach(o=>{this.addPointToLavaLine(o,n)}),this.drawLavaLines(n))}onEnd(t){console.log("🌋 Lava style ended"),this.currentLavaLine&&(this.currentLavaLine.isMelting=!0,this.lavaLines.push(this.currentLavaLine),this.currentLavaLine=null),this.animationId||this.startAnimation(context)}onClear(t){this.lavaLines=[],this.currentLavaLine=null,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}animate(t){this.drawLavaLines(t),this.lavaLines.forEach(n=>{n.isMelting&&(n.meltProgress+=.02,n.meltProgress>=1&&(n.meltProgress=1))}),this.lavaLines=this.lavaLines.filter(n=>n.meltProgress<1),this.lavaLines.length>0||this.currentLavaLine?this.animationId=requestAnimationFrame(()=>this.animate(t)):this.animationId=null}addPointToLavaLine(t,n){if(!this.currentLavaLine)return;const i={x:t.x,y:t.y,sizeMultiplier:this.calculateSizeMultiplier(t,n),touchWidth:t.width||1,touchHeight:t.height||1,time:t.t};this.currentLavaLine.points.push(i)}drawLavaLines(t){const{ctx:n,isEraserMode:i}=t;n.save(),this.currentLavaLine&&this.drawLavaLine(this.currentLavaLine,t,!1),this.lavaLines.forEach(o=>{this.drawLavaLine(o,t,!0)}),n.restore()}drawLavaLine(t,n,i){const{ctx:o,isEraserMode:s}=n;if(t.points.length<2)return;o.save();const a=o.createLinearGradient(0,0,0,o.canvas.height);a.addColorStop(0,"#ff4500"),a.addColorStop(.5,"#ff6347"),a.addColorStop(1,"#ff8c00"),o.strokeStyle=s?"#151E35":a,o.lineCap="round",o.lineJoin="round",o.beginPath(),t.points.forEach((m,h)=>{h===0?o.moveTo(m.x,m.y):o.lineTo(m.x,m.y)});const r=i?Math.max(1,(t.points[0]?.sizeMultiplier||1)*20*(1-t.meltProgress)):(t.points[0]?.sizeMultiplier||1)*20;o.lineWidth=r,o.stroke(),s||(o.shadowColor="#ff4500",o.shadowBlur=10,o.stroke(),o.shadowBlur=0),i&&t.meltProgress>.3&&this.drawDrips(t,n),o.restore()}drawDrips(t,n){const{ctx:i,isEraserMode:o}=n;i.save();const s=Math.floor(t.meltProgress*5),a=o?"#151E35":"#ff6347";for(let r=0;r<s;r++){const m=t.points[Math.floor(Math.random()*t.points.length)];if(!m)continue;const h=20+Math.random()*30,d=m.sizeMultiplier*5;i.fillStyle=a,i.beginPath(),i.ellipse(m.x+(Math.random()-.5)*10,m.y+h,d,h,0,0,2*Math.PI),i.fill()}i.restore()}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(s[o]||1)*a;{const d=Math.max(0,Math.min(1,(r-5)/95));let l;return(t.width||0)===0||(t.height||0)===0?l=.2:l=.1+d*.2,l*a}}startAnimation(t){this.animate(t)}}class Ht{constructor(){this.name="Neon",this.description="Bright neon lines with glowing effects",this.icon="3",this.neonLines=[],this.currentLine=[],this.currentColor="#00ff00"}onStart(t,n){console.log("💡 Neon style started"),this.currentLine=[t],this.currentColor=this.getNeonColor()}onMove(t,n){const{ctx:i}=n;this.currentLine.push(...t),this.drawNeonLines(n)}onEnd(t){console.log("💡 Neon style ended"),this.currentLine.length>1&&this.neonLines.push({points:[...this.currentLine],color:this.currentColor,startTime:Date.now()}),this.currentLine=[]}onClear(t){this.neonLines=[],this.currentLine=[]}drawNeonLines(t){const{ctx:n,isEraserMode:i}=t;n.save(),this.currentLine.length>1&&this.drawNeonLine(this.currentLine,this.currentColor,t,!1),this.neonLines.forEach(o=>{this.drawNeonLine(o.points,o.color,t,!0)}),n.restore()}drawNeonLine(t,n,i,o){const{ctx:s,isEraserMode:a}=i;if(t.length<2)return;s.save();const r=a?"#151E35":n,m=a?"#151E35":this.getGlowColor(n);s.lineCap="round",s.lineJoin="round";for(let h=3;h>=1;h--){if(s.strokeStyle=m,!t[0])return;s.lineWidth=this.calculateLineWidth(t[0],i)*(h*2),s.globalAlpha=.1/h,s.beginPath(),t.forEach((d,l)=>{l===0?s.moveTo(d.x,d.y):s.lineTo(d.x,d.y)}),s.stroke()}if(s.strokeStyle=r,!!t[0]){if(s.lineWidth=this.calculateLineWidth(t[0],i),s.globalAlpha=1,s.beginPath(),t.forEach((h,d)=>{d===0?s.moveTo(h.x,h.y):s.lineTo(h.x,h.y)}),s.stroke(),!a){if(s.strokeStyle="#ffffff",!t[0])return;s.lineWidth=this.calculateLineWidth(t[0],i)*.3,s.globalAlpha=.8,s.stroke()}o&&!a&&Math.random()<.1&&this.addSparkles(t,n,i),s.restore()}}addSparkles(t,n,i){const{ctx:o}=i;o.save();const s=2+Math.floor(Math.random()*3);for(let a=0;a<s;a++){const r=t[Math.floor(Math.random()*t.length)],m=2+Math.random()*3;if(!r)return;const h=r.x+(Math.random()-.5)*20,d=r.y+(Math.random()-.5)*20;o.fillStyle="#ffffff",o.globalAlpha=.8,o.beginPath(),o.arc(h,d,m,0,2*Math.PI),o.fill(),o.fillStyle=n,o.globalAlpha=.3,o.beginPath(),o.arc(h,d,m*2,0,2*Math.PI),o.fill()}o.restore()}calculateLineWidth(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(s[o]||1)*a*15;{const d=Math.max(0,Math.min(1,(r-5)/95));let l;return(t.width||0)===0||(t.height||0)===0?l=.2:l=.1+d*.2,l*a*15}}getNeonColor(){const t=["#00ff00","#ff00ff","#00ffff","#ffff00","#ff0080","#0080ff","#ff8000","#8000ff"];return t[Math.floor(Math.random()*t.length)]||"#ff6b6b"}getGlowColor(t){return t}}class Dt{constructor(){this.name="Watercolor",this.description="Soft watercolor brush strokes with color blending",this.icon="4",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.brushStrokes=[]}onStart(t,n){console.log("🎨 Watercolor style started"),this.brushStrokes=[]}onMove(t,n){console.log("🎨 WatercolorStyle.onMove called");const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:r,isWebApp:m}=n;t.length<2||(i.save(),i.globalCompositeOperation=o?"destination-out":"multiply",t.forEach((h,d)=>{if(d===0)return;const l=t[d-1];if(!l)return;const M=(h.t-l.t)/16;if(M<=0)return;const u=this.calculateSizeMultiplier(h,n),p=l.x+(h.x-l.x)*M,f=l.y+(h.y-l.y)*M,w=h.width||1;h.height;const g=.8+Math.random()*.4,y=w/2*g*u;if(o)i.globalAlpha=.3,i.fillStyle="rgba(21, 30, 53, 0.3)";else{const L=1+Math.sin(M*Math.PI)*.15,S=this.getWatercolorColor(L);for(let A=0;A<3;A++){const E=(Math.random()-.5)*y*.5,v=(Math.random()-.5)*y*.5,P=y*(.7+Math.random()*.6),k=.1+Math.random()*.2;i.globalAlpha=k,i.fillStyle=S,i.beginPath(),i.arc(p+E,f+v,P,0,2*Math.PI),i.fill()}this.brushStrokes.push({x:p,y:f,size:y,color:S,opacity:.3})}}),i.restore())}onEnd(t){console.log("🎨 Watercolor style ended")}onClear(t){this.brushStrokes=[]}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .2*(s[o]||1)*a;{const d=Math.max(0,Math.min(1,(r-5)/95));let l;(t.width||0)===0||(t.height||0)===0?l=.25:l=.15+d*.25;const M=.95+Math.random()*.1,u=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+l*M*this.sizeSmoothingFactor;return this.lastSizeMultiplier=u,u*(s[o]||1)*a}}getWatercolorColor(t){const n=["#FFB3BA","#BAFFC9","#BAE1FF","#FFFFBA","#FFB3F7","#B3FFE6","#FFD4B3","#E6B3FF"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}}class Ot{constructor(){this.name="Chalk",this.description="Dusty chalk strokes with particle effects",this.icon="5",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.particles=[]}onStart(t,n){console.log("🎨 Chalk style started"),this.particles=[]}onMove(t,n){const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:r,isWebApp:m}=n;t.length<2||(i.save(),i.globalCompositeOperation="source-over",t.forEach((h,d)=>{if(d===0)return;const l=t[d-1];if(!l)return;const M=(h.t-l.t)/16;if(M<=0)return;const u=this.calculateSizeMultiplier(h,n),p=l.x+(h.x-l.x)*M,f=l.y+(h.y-l.y)*M,w=h.width||1;h.height;const g=.7+Math.random()*.6,y=w/2*g*u;if(o)i.globalAlpha=.8,i.fillStyle="#151E35";else{const L=1+Math.sin(M*Math.PI)*.1,S=this.getChalkColor(L);i.globalAlpha=.9,i.fillStyle=S,i.beginPath(),i.arc(p,f,y,0,2*Math.PI),i.fill();for(let A=0;A<5;A++){const E=p+(Math.random()-.5)*y*2,v=f+(Math.random()-.5)*y*2,P=Math.random()*y*.3;i.globalAlpha=.6,i.fillStyle=S,i.beginPath(),i.arc(E,v,P,0,2*Math.PI),i.fill(),this.particles.push({x:E,y:v,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,life:1,maxLife:1,color:S})}for(let A=0;A<3;A++){const E=p+(Math.random()-.5)*y,v=f+(Math.random()-.5)*y,P=Math.random()*y*.2;i.globalAlpha=.3,i.fillStyle=S,i.beginPath(),i.arc(E,v,P,0,2*Math.PI),i.fill()}}}),i.restore())}onEnd(t){console.log("🎨 Chalk style ended")}onClear(t){this.particles=[]}animate(t){const{ctx:n}=t;this.particles=this.particles.filter(i=>(i.x+=i.vx,i.y+=i.vy,i.vy+=.1,i.life-=.02,i.life>0?(n.save(),n.globalAlpha=i.life*.5,n.fillStyle=i.color,n.beginPath(),n.arc(i.x,i.y,1,0,2*Math.PI),n.fill(),n.restore(),!0):!1))}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .18*(s[o]||1)*a;{const d=Math.max(0,Math.min(1,(r-5)/95));let l;(t.width||0)===0||(t.height||0)===0?l=.22:l=.12+d*.2;const M=.9+Math.random()*.2,u=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+l*M*this.sizeSmoothingFactor;return this.lastSizeMultiplier=u,u*(s[o]||1)*a}}getChalkColor(t){const n=["#FFFFFF","#F0F0F0","#E8E8E8","#D0D0D0","#FFE4E1","#E6E6FA","#F0F8FF","#F5F5DC"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}}class Wt{constructor(){this.name="Glow",this.description="Bright neon strokes with glowing effects",this.icon="6",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.glowTrails=[]}onStart(t,n){console.log("🎨 Glow style started"),this.glowTrails=[]}onMove(t,n){const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:r,isWebApp:m}=n;t.length<2||(i.save(),i.globalCompositeOperation=o?"destination-out":"screen",t.forEach((h,d)=>{if(d===0)return;const l=t[d-1];if(!l)return;const M=(h.t-l.t)/16;if(M<=0)return;const u=this.calculateSizeMultiplier(h,n),p=l.x+(h.x-l.x)*M,f=l.y+(h.y-l.y)*M,w=h.width||1;h.height;const g=.9+Math.random()*.2,y=w/2*g*u;if(o)i.globalAlpha=.5,i.fillStyle="#151E35";else{const L=1+Math.sin(M*Math.PI)*.2,S=this.getGlowColor(L);i.globalAlpha=.3,i.fillStyle=S,i.beginPath(),i.arc(p,f,y*3,0,2*Math.PI),i.fill(),i.globalAlpha=.6,i.fillStyle=S,i.beginPath(),i.arc(p,f,y*2,0,2*Math.PI),i.fill(),i.globalAlpha=.9,i.fillStyle=S,i.beginPath(),i.arc(p,f,y,0,2*Math.PI),i.fill(),i.globalAlpha=1,i.fillStyle="#FFFFFF",i.beginPath(),i.arc(p,f,y*.3,0,2*Math.PI),i.fill(),this.glowTrails.push({x:p,y:f,size:y,color:S,life:1,maxLife:1}),Math.random()<.3&&this.addSparkle(i,p,f,S)}}),i.restore())}onEnd(t){console.log("🎨 Glow style ended")}onClear(t){this.glowTrails=[]}animate(t){const{ctx:n}=t;this.glowTrails=this.glowTrails.filter(i=>(i.life-=.03,i.life>0?(n.save(),n.globalCompositeOperation="screen",n.globalAlpha=i.life*.4,n.fillStyle=i.color,n.beginPath(),n.arc(i.x,i.y,i.size*2,0,2*Math.PI),n.fill(),n.restore(),!0):!1))}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .16*(s[o]||1)*a;{const d=Math.max(0,Math.min(1,(r-5)/95));let l;(t.width||0)===0||(t.height||0)===0?l=.2:l=.1+d*.18;const M=.95+Math.random()*.1,u=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+l*M*this.sizeSmoothingFactor;return this.lastSizeMultiplier=u,u*(s[o]||1)*a}}getGlowColor(t){const n=["#FF0080","#00FFFF","#FF00FF","#00FF00","#FFFF00","#FF8000","#8000FF","#00FF80"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}addSparkle(t,n,i,o){t.save(),t.globalAlpha=.8,t.fillStyle=o;for(let s=0;s<4;s++){const a=s*Math.PI/2,r=n+Math.cos(a)*10,m=i+Math.sin(a)*10;t.beginPath(),t.arc(r,m,2,0,2*Math.PI),t.fill()}t.restore()}}class xt{constructor(){this.styles=[],this.currentStyleIndex=0,this.styles=[new Ft,new $t,new Ht,new Dt,new Ot,new Wt],this.currentStyle=this.styles[0]}getCurrentStyle(){return this.currentStyle}getCurrentStyleIndex(){return this.currentStyleIndex}getAllStyles(){return this.styles}switchToStyle(t){t>=0&&t<this.styles.length&&(this.currentStyleIndex=t,this.currentStyle=this.styles[t],console.log(`🎨 Switched to style: ${this.currentStyle.name}`))}nextStyle(){const t=(this.currentStyleIndex+1)%this.styles.length;this.switchToStyle(t)}previousStyle(){const t=this.currentStyleIndex===0?this.styles.length-1:this.currentStyleIndex-1;this.switchToStyle(t)}onStart(t,n){this.currentStyle.onStart?.(t,n)}onMove(t,n){console.log(`🎯 StyleManager.onMove called for style: ${this.currentStyle.name}, points: ${t.length}`),this.currentStyle.onMove?.(t,n)}onEnd(t){this.currentStyle.onEnd?.(t)}onClear(t){this.currentStyle.onClear?.(t),this.styles.forEach(n=>{n!==this.currentStyle&&n.onClear?.(t)})}animate(t){this.currentStyle.animate?.(t),this.styles.forEach(n=>{n!==this.currentStyle&&n.animate&&n.animate(t)})}}console.log("🎨 Vibe Drawing app starting...");console.log("📍 Current location:",window.location.href);console.log("🌐 User agent:",navigator.userAgent);setTimeout(()=>{const e=document.getElementById("app"),t=document.getElementById("splash-screen");if(e&&t&&!e.querySelector("canvas")){console.log("⚠️ Main app failed to load, showing info popup"),t.style.display="none";const n=document.getElementById("info-popup");n&&(n.style.display="block")}},5e3);let c=null,K=!1,te=[];const R=new xt,se=!("ontouchstart"in window)||window.navigator.maxTouchPoints===0;let x=2;const Me=[.2,.4,.7,1,1.5];let We=.25;const xe=.15;let $=1,W=!1,V=1,ye=!1;function O(e,t){const n=Math.sqrt(e*t);if(se){const i=.15*(Me[x]||1),o=i*$;return Math.random()<.01&&console.log("Web app size calculation:",{baseMultiplier:i,thicknessMultiplier:$,finalMultiplier:o}),o}else{const s=Math.max(0,Math.min(1,(n-5)/95));let a;e===0||t===0?a=.2:a=.1+s*.2;const r=.98+Math.random()*.04,m=We*(1-xe)+a*r*xe;We=m;const h=m*(Me[x]||1)*$;return Math.random()<.01&&console.log("Size calculation:",{smoothedMultiplier:m,sizeLevel:Me[x],thicknessMultiplier:$,finalMultiplier:h}),h}}function _t(e){const t=Date.now()*.001,n=z.baseHue,i=z.cycleSpeed||8,o=Math.sin(t*i)*180,s=(Math.random()-.5)*40+o,a=(Math.random()-.5)*20+Math.sin(t*3)*10,r=(Math.random()-.5)*15+Math.sin(t*2.5)*8,m=(n+s+360)%360,h=Math.max(75,Math.min(100,z.saturation+a)),d=Math.max(40,Math.min(80,z.lightness+r));return`hsl(${m}, ${h}%, ${d}%)`}function Se(e){const t=z.baseHue,n=z.saturation,i=z.lightness,o=[t,t+15,t+30,t+45],s=Math.floor(Math.random()*o.length),r=(o[s]||t)+(Math.random()-.5)*10,m=n+Math.random()*15,h=i+Math.random()*30;return`hsl(${r}, ${m}%, ${h}%)`}function ne(e){return _t()}function Rt(e,t,n,i,o,s){const a=Date.now(),r=400,m=a%r/r;e.save();const h=Math.max(o,s)*.1*i,d=Math.sin(m*Math.PI*8)*.5+.5;e.strokeStyle=Se(),e.lineWidth=h*(.15+d*.08),e.lineCap="round",e.globalAlpha=.85+d*.1;const l=Math.sin(m*Math.PI*2)*.4;e.beginPath(),e.moveTo(t-h*.6,n+l),e.lineTo(t+h*.6,n+l),e.stroke();const M=15;for(let w=0;w<M;w++){const g=t-h*.5+w*h*.07,y=Math.sin((m+w*.08)*Math.PI*4)*1,b=(.3+d*.6)*i,L=.7+d*.2;e.globalAlpha=L,e.fillStyle=Se(),e.beginPath(),e.arc(g,n+y,b,0,2*Math.PI),e.fill()}const u=h*.1,p=m*Math.PI*6,f=8;for(let w=0;w<f;w++){const g=p+w*Math.PI*2/f,y=t+Math.cos(g)*u,b=n+Math.sin(g)*u,L=(.15+d*.4)*i,S=.5+d*.2;e.globalAlpha=S,e.fillStyle=Se(),e.beginPath(),e.arc(y,b,L,0,2*Math.PI),e.fill()}e.restore()}function _e(e,t,n,i,o,s){Rt(e,t,n,i,o,s)}let q=[],Re=0;function Ve(e,t,n,i,o,s){const a=Date.now(),r=Math.max(o,s)*.25*i;e.save();const m=[0,120,240],d=(m[Math.floor(Math.random()*m.length)]||0)+(Math.random()-.5)*20,l=`hsl(${d}, 100%, 60%)`,M=`hsl(${d+120}, 100%, 60%)`,u=`hsl(${d+240}, 100%, 60%)`,p=Math.sin(a/100)*.4+.6,f=r*p,w=Math.sin(a/50)*8,g=t+w,y=n+(Math.random()-.5)*4;if(a-Re>30&&(q.push({x:g,y,size:f,timestamp:a,glitchOffset:w}),Re=a,q.length>12&&q.shift()),q.forEach((b,L)=>{const S=a-b.timestamp;if(S<600){const A=S/600,E=(1-A)*.7,v=b.size*(1-A*.3),P=[l,M,u],k=P[Math.floor(Math.random()*P.length)]||l;e.globalAlpha=E,e.fillStyle=k,e.fillRect(b.x-v/2+b.glitchOffset,b.y-v/2,v,v),Math.random()<.3&&(e.globalAlpha=E*.5,e.fillStyle="#ffffff",e.fillRect(b.x-v/2,b.y-v/4,v,1))}}),e.globalAlpha=.9,e.fillStyle=l,e.fillRect(g-f/2,y-f/2,f,f),e.globalAlpha=.6,e.fillStyle=M,e.fillRect(g-f/2+2,y-f/2,f/3,f),e.globalAlpha=.4,e.fillStyle=u,e.fillRect(g-f/2-2,y-f/2,f/3,f),Math.random()<.4&&(e.globalAlpha=.8,e.fillStyle="#ffffff",e.fillRect(g-f/2,y-f/4,f,2)),Math.random()<.2)for(let b=0;b<5;b++){e.globalAlpha=.6,e.fillStyle=Math.random()>.5?"#ffffff":"#000000";const L=g+(Math.random()-.5)*f,S=y+(Math.random()-.5)*f;e.fillRect(L,S,2,2)}q=q.filter(b=>a-b.timestamp<800),e.restore()}let U=[],Be=0;function qe(e,t,n,i,o,s){const a=Date.now(),r=Math.max(o,s)*.2*i;e.save();const m=[0,15,30],d=(m[Math.floor(Math.random()*m.length)]||15)+(Math.random()-.5)*10,l=Math.sin(a/150)*.5+.5,M=Math.sin(a/300)*.3+.7,u=Math.sin(a/600)*.2+.8,p=(l+M+u)/3,f=`hsl(${d}, 100%, ${50+p*30}%)`,w=`hsl(${d+5}, 100%, ${70+p*20}%)`,g=`hsl(${d+10}, 100%, ${40+p*40}%)`,y=Math.sin(a/100)*.3+.7,b=r*y*p;a-Be>50&&(U.push({x:t,y:n,size:b,color:f,timestamp:a}),Be=a,U.length>10&&U.shift()),e.globalAlpha=.9*p,e.fillStyle=w,e.beginPath(),e.arc(t,n,b*.5,0,2*Math.PI),e.fill(),e.globalAlpha=.8*p,e.fillStyle=f,e.beginPath(),e.arc(t,n,b,0,2*Math.PI),e.fill(),U.slice(-6).forEach((L,S)=>{const A=a-L.timestamp;if(A<600){const E=A/600,v=(1-E)*p*.6,P=L.size*(1-E*.3),k=Math.sin((a-L.timestamp)/100)*.3+.7;e.globalAlpha=v*k,e.fillStyle=L.color,e.beginPath(),e.arc(L.x,L.y,P,0,2*Math.PI),e.fill()}}),e.globalAlpha=.3*p,e.fillStyle=g,e.beginPath(),e.arc(t,n,b*2.5,0,2*Math.PI),e.fill(),Math.random()<.2&&(e.globalAlpha=.7*p,e.fillStyle="#ffffff",e.beginPath(),e.arc(t+(Math.random()-.5)*r,n+(Math.random()-.5)*r,2,0,2*Math.PI),e.fill()),U=U.filter(L=>a-L.timestamp<800),e.restore()}let j=[],Ue=0;function je(e,t,n,i,o,s){const a=Date.now(),r=Math.max(o,s)*.2*i;e.save();const m=z.baseHue,h=z.saturation,d=z.lightness,l=Math.sin(a/500)*60,M=m+l+(Math.random()-.5)*30,u=h+(Math.random()-.5)*20,p=d+(Math.random()-.5)*15,f=`hsl(${M}, ${u}%, ${p}%)`,w=`hsl(${M}, ${u*.7}%, ${p+5}%)`,g=`hsl(${M}, ${u*.8}%, ${p-10}%)`;if(a-Ue>20){const S=Math.random()*.5+.5,A=.4+Math.random()*1.2,E=i*(1+x*.02)*$,v=r*A*S*E,P=(Math.random()-.5)*20,k=(Math.random()-.5)*16,D=t+P,T=n+k;j.push({x:D,y:T,size:v,timestamp:a,pressure:S}),Ue=a,j.length>20&&j.shift()}j.forEach(S=>{const A=a-S.timestamp;if(A<1500){const E=A/1500,v=(1-E)*S.pressure*.6,P=S.size*(1-E*.3);e.globalAlpha=v*.4,e.fillStyle=w,e.beginPath(),e.arc(S.x,S.y,P*1.5,0,2*Math.PI),e.fill(),e.globalAlpha=v*.8,e.fillStyle=f,e.beginPath(),e.arc(S.x,S.y,P,0,2*Math.PI),e.fill(),e.globalAlpha=v*.3,e.fillStyle=g,e.beginPath(),e.arc(S.x+1,S.y+1,P*.8,0,2*Math.PI),e.fill()}});const y=Math.sin(a/100)*.3+.7,L=r*y*i*(1+x*.02)*$;if(e.globalAlpha=.4,e.fillStyle=g,e.beginPath(),e.arc(t+2,n+2,L*.7,0,2*Math.PI),e.fill(),e.globalAlpha=.9,e.fillStyle=f,e.beginPath(),e.arc(t,n,L,0,2*Math.PI),e.fill(),Math.random()<.6){const S=Math.floor(Math.random()*8)+3;for(let A=0;A<S;A++){e.globalAlpha=.6,e.fillStyle=w;const E=t+(Math.random()-.5)*r*5,v=n+(Math.random()-.5)*r*4,P=Math.random()*5+1;e.beginPath(),e.arc(E,v,P,0,2*Math.PI),e.fill()}}j=j.filter(S=>a-S.timestamp<2e3),e.restore()}let G=[],Ge=0;function Xe(e,t,n,i,o,s){const a=Date.now(),r=Math.max(o,s)*.4*i;e.save();const m=[0,60,120,180,240,300],d=(m[Math.floor(Math.random()*m.length)]||0)+(Math.random()-.5)*30,l=`hsl(${d}, 100%, 70%)`,M=`hsl(${d+30}, 80%, 60%)`,u=`hsl(${d+60}, 90%, 90%)`,p=`hsl(${d-30}, 100%, 20%)`;if(a-Ge>15){const g=["star","nebula","comet","blackhole"],y=g[Math.floor(Math.random()*g.length)],b=(Math.random()-.5)*8,L=(Math.random()-.5)*6,S=r*(.3+Math.random()*1.5);G.push({x:t,y:n,size:S,velocityX:b,velocityY:L,color:y==="star"?u:y==="nebula"?M:y==="comet"?l:p,type:y,timestamp:a,life:1}),Ge=a,G.length>30&&G.shift()}G.forEach(g=>{if(g.velocityX*=.98,g.velocityY*=.98,g.x+=g.velocityX,g.y+=g.velocityY,g.life-=.02,g.life<=0)return;const y=g.life,b=g.size*g.life;switch(e.globalAlpha=y,g.type){case"star":{const L=Math.sin(a/100+g.timestamp)*.3+.7;e.fillStyle=g.color,e.beginPath(),e.arc(g.x,g.y,b*L,0,2*Math.PI),e.fill(),e.strokeStyle=g.color,e.lineWidth=2;for(let S=0;S<4;S++){const A=S*Math.PI/2+a/1e3,E=b*2;e.beginPath(),e.moveTo(g.x,g.y),e.lineTo(g.x+Math.cos(A)*E,g.y+Math.sin(A)*E),e.stroke()}break}case"nebula":e.fillStyle=g.color,e.beginPath(),e.arc(g.x,g.y,b*2,0,2*Math.PI),e.fill(),e.globalAlpha=y*.5,e.fillStyle=M,e.beginPath(),e.arc(g.x,g.y,b*3,0,2*Math.PI),e.fill();break;case"comet":{e.fillStyle=g.color,e.beginPath(),e.arc(g.x,g.y,b,0,2*Math.PI),e.fill();const L=b*4,S=Math.atan2(g.velocityY,g.velocityX);e.strokeStyle=g.color,e.lineWidth=b/2,e.lineCap="round",e.beginPath(),e.moveTo(g.x,g.y),e.lineTo(g.x-Math.cos(S)*L,g.y-Math.sin(S)*L),e.stroke();break}case"blackhole":{e.fillStyle=p,e.beginPath(),e.arc(g.x,g.y,b,0,2*Math.PI),e.fill(),e.globalAlpha=y*.7,e.strokeStyle=l,e.lineWidth=3,e.beginPath(),e.arc(g.x,g.y,b*1.5,0,2*Math.PI),e.stroke(),e.globalAlpha=y*.4,e.beginPath(),e.arc(g.x,g.y,b*.8,0,2*Math.PI),e.stroke();break}}});const f=Math.sin(a/150)*.4+.6,w=r*f;if(e.globalAlpha=.3,e.fillStyle=l,e.beginPath(),e.arc(t,n,w*4,0,2*Math.PI),e.fill(),e.globalAlpha=.9,e.fillStyle=u,e.beginPath(),e.arc(t,n,w,0,2*Math.PI),e.fill(),Math.random()<.1){const g=w*3;for(let y=0;y<12;y++){const b=y*Math.PI*2/12,L=t+Math.cos(b)*g,S=n+Math.sin(b)*g;e.globalAlpha=.8,e.fillStyle=l,e.beginPath(),e.arc(L,S,4,0,2*Math.PI),e.fill()}}G=G.filter(g=>g.life>0),e.restore()}function ue(e,t,n,i){const o=Date.now()*.001,s=Math.floor(i/6);for(let a=0;a<s;a++){const r=Math.PI*2*a/s+Math.sin(o*5+a)*.3,m=i*(.6+Math.random()*.8),h=t+Math.cos(r)*m,d=n+Math.sin(r)*m,l=1+Math.random()*6;e.save();const M=(o*100+a*30)%360,u=80+Math.random()*20,p=60+Math.random()*40;e.fillStyle=`hsl(${M}, ${u}%, ${p}%)`,e.globalAlpha=.7+Math.random()*.3,e.beginPath(),e.arc(h,d,l,0,2*Math.PI),e.fill(),e.globalAlpha=.3,e.fillStyle=`hsl(${M}, ${u}%, ${p+20}%)`,e.beginPath(),e.arc(h,d,l*1.5,0,2*Math.PI),e.fill(),e.restore()}}function Ye(e,t,n){const i=e.getBoundingClientRect();return{x:t-i.left,y:n-i.top}}function be(e){const t=window.visualViewport,n=t?t.width:window.innerWidth,i=t?t.height:window.innerHeight,o=window.devicePixelRatio||1;e.width=Math.max(1,Math.floor(n*o)),e.height=Math.max(1,Math.floor(i*o)),e.style.width=n+"px",e.style.height=i+"px",console.log("Canvas resized to HD:",e.width,"x",e.height,"devicePixelRatio:",o),c&&(c.scale(o,o),c.lineCap="round",c.lineJoin="round",c.strokeStyle="#111",me(e))}function Vt(e){if(c=e.getContext("2d",{alpha:!0,antialias:!0,willReadFrequently:!1}),console.log("Canvas context created:",!!c,"Canvas element:",!!e),!c){console.error("Failed to get 2D context!");return}c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.lineCap="round",c.lineJoin="round",c.strokeStyle="#111",me(e),console.log("Canvas context initialized successfully")}function me(e){if(!c){console.error("Cannot clear canvas - no context!");return}q=[],U=[],j=[],G=[],console.log("Clearing canvas, size:",e.width,"x",e.height);const t=c.createLinearGradient(0,0,e.width,e.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(.5,"#16213e"),t.addColorStop(1,"#0f3460"),c.fillStyle=t,c.fillRect(0,0,e.width,e.height),c.fillStyle="rgba(255, 255, 255, 0.3)";for(let n=0;n<50;n++){const i=Math.random()*e.width,o=Math.random()*e.height,s=Math.random()*2+1;c.beginPath(),c.arc(i,o,s,0,2*Math.PI),c.fill()}c.lineWidth=10,console.log("Canvas cleared and background drawn")}function Ne(e){console.log("Pointer Event Debug:",{pointerType:e.pointerType,pressure:e.pressure,width:e.width,height:e.height,pointerId:e.pointerId,isPrimary:e.isPrimary,timeStamp:e.timeStamp})}function Bt(e){e.addEventListener("touchstart",n=>n.preventDefault(),{passive:!1}),e.addEventListener("touchmove",n=>n.preventDefault(),{passive:!1}),e.addEventListener("touchend",n=>n.preventDefault(),{passive:!1}),e.addEventListener("pointerdown",n=>{if(n.pointerType==="pen"&&Ne(n),K||V===2&&ye)return;const i=n.pointerType==="pen",o=n.pointerType==="touch";n.pointerType;let s=n.pressure!==void 0?n.pressure:.5;i&&(s=Math.max(.1,Math.min(1,s)),console.log("Apple Pencil detected - pressure:",s)),e.setPointerCapture(n.pointerId),K=!0,V===2&&(ye=!0),te=[];const{x:a,y:r}=Ye(e,n.clientX,n.clientY);let m=O(n.width||1,n.height||1);if(i?m*=.3+s*.7:o&&(m*=.5+s*.5),te.push({x:a,y:r,t:n.timeStamp}),It(),c){const h=n.width||1,d=n.height||1;let l,M,u;se?(l=45,M=45,u=1):(l=Math.max(h,30),M=Math.max(d,30),u=h>1||d>1?1.2:1);const p=l*m*u,f=M*m*u,w=Math.max(p,f),g=R.getCurrentStyleIndex();if(g===1)if(W){c.save(),c.globalCompositeOperation="destination-out";const y=Math.max(p,f)*3;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(a,r,y,0,2*Math.PI),c.fill(),c.restore()}else{const b=O(p,f)*(1+x*.3)*$;_e(c,a,r,b,p,f)}else if(g===2)if(W){c.save(),c.globalCompositeOperation="destination-out";const y=Math.max(p,f)*3;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(a,r,y,0,2*Math.PI),c.fill(),c.restore()}else{const y=O(p,f);Ve(c,a,r,y,p,f)}else if(g===3)if(W){c.save(),c.globalCompositeOperation="destination-out";const y=Math.max(p,f)*3;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(a,r,y,0,2*Math.PI),c.fill(),c.restore()}else{const y=O(p,f);qe(c,a,r,y,p,f)}else if(g===4)if(W){c.save(),c.globalCompositeOperation="destination-out";const y=Math.max(p,f)*3;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(a,r,y,0,2*Math.PI),c.fill(),c.restore()}else{const y=O(p,f);je(c,a,r,y,p,f)}else if(g===5)if(W){c.save(),c.globalCompositeOperation="destination-out";const y=Math.max(p,f)*3;c.fillStyle="rgba(0, 0, 0, 1)",c.beginPath(),c.arc(a,r,y,0,2*Math.PI),c.fill(),c.restore()}else{const y=O(p,f)*(1+x*.01);Xe(c,a,r,y,p,f)}else{c.save(),c.globalAlpha=.8,console.log("Drawing dot at:",a,r,"size:",p,"x",f,"pressure:",s);const y=1+Math.sin(Date.now()/200)*.1,b=p/2*y,L=f/2*y;if(W?(c.globalCompositeOperation="source-over",c.fillStyle="#151E35"):(c.globalCompositeOperation="source-over",c.fillStyle=ne()),W){const S=c.createRadialGradient(a,r,0,a,r,Math.max(b,L));S.addColorStop(0,"#151E35"),S.addColorStop(.7,"#151E35"),S.addColorStop(1,"#151E35"),c.fillStyle=S}else{const S=c.createRadialGradient(a,r,0,a,r,Math.max(b,L));S.addColorStop(0,ne()),S.addColorStop(.7,ne()),S.addColorStop(1,ne()),c.fillStyle=S}c.beginPath(),c.ellipse(a,r,b,L,0,0,2*Math.PI),c.fill(),c.restore(),w>15&&!W&&(R.getCurrentStyleIndex()===0?Math.random()<.7&&(c.save(),c.globalAlpha=.5,ue(c,a,r,w),c.restore()):ue(c,a,r,w))}}else console.error("Canvas context is null! Cannot draw.")}),e.addEventListener("pointermove",n=>{if(n.pointerType==="pen"&&K&&Ne(n),!K)return;const{x:i,y:o}=Ye(e,n.clientX,n.clientY),s=te[te.length-1],a=Math.max(.001,n.timeStamp-s.t),r=i-s.x,m=o-s.y,h=Math.hypot(r,m)/a,d=n.pointerType==="pen",l=n.pointerType==="touch";n.pointerType;let M=n.pressure!==void 0?n.pressure:.5;d&&(M=Math.max(.1,Math.min(1,M)));let u=O(n.width||1,n.height||1);if(d?u*=.3+M*.7:l&&(u*=.5+M*.5),te.push({x:i,y:o,t:n.timeStamp,speed:h}),!c)return;const p=Math.hypot(i-s.x,o-s.y);let f;d?f=V===2?.5:.8:f=V===2?1:se?.8:1.5;const w=Math.max(1,Math.ceil(p/f));let g;d?g=V===2?3:3.5:g=V===2||se?2.5:2;const y=Math.max(3,Math.ceil(w*g)),b=n.width||1,L=n.height||1;let S,A,E;se?(S=45,A=45,E=1):(S=Math.max(b,30),A=Math.max(L,30),E=b>1||L>1?1.2:1);const v=S*u*E,P=A*u*E;c.save(),c.globalAlpha=.8;for(let k=0;k<=y;k++){const D=k/y,T=s.x+(i-s.x)*D,I=s.y+(o-s.y)*D,_=R.getCurrentStyleIndex();if(_===1){const he=O(v,P)*(1+x*.3)*$;_e(c,T,I,he,v,P)}else if(_===2){const F=O(v,P);Ve(c,T,I,F,v,P)}else if(_===3){const F=O(v,P);qe(c,T,I,F,v,P)}else if(_===4){const F=O(v,P);je(c,T,I,F,v,P)}else if(_===5){const F=O(v,P)*(1+x*.01);Xe(c,T,I,F,v,P)}else{let F;d?F=.98+Math.random()*.04:F=.95+Math.random()*.1;const he=1+Math.sin((Date.now()+k*40)/160)*.03,nt=v/2*F*he,it=P/2*F*he;if(W)c.globalCompositeOperation="source-over",c.fillStyle="#151E35";else if(c.globalCompositeOperation="source-over",_===0){const ee=Date.now()*.001,H=window.randomStyleParams||z,Ee=H.baseHue,ot=H.cycleSpeed||8;H.filter&&H.filter!=="none"&&Math.random()<.3&&(c.filter=H.filter);const st=Math.sin(ee*ot)*100,at=(Math.random()-.5)*80+st,rt=(Math.random()-.5)*40+Math.sin(ee*3)*20,lt=(Math.random()-.5)*35+Math.sin(ee*2.5)*15,ze=(Ee+at+360)%360,ke=Math.max(70,Math.min(100,H.saturation+rt)),Ie=Math.max(35,Math.min(85,H.lightness+lt));c.fillStyle=`hsl(${ze}, ${ke}%, ${Ie}%)`,Math.floor(ee*10)%20===0&&console.log(`🎨 Style 1 DRAWING: baseHue=${Ee}, finalHue=${ze}, saturation=${ke}, lightness=${Ie}, filter=${H.filter}`),H.filter&&H.filter!=="none"&&(c.filter="none")}else c.fillStyle=ne();if(c.beginPath(),c.ellipse(T,I,nt,it,0,0,2*Math.PI),c.fill(),Math.max(v,P)>10&&!W)if(R.getCurrentStyleIndex()===0)Math.random()<.6&&(c.save(),c.globalAlpha=.5,ue(c,T,I,Math.max(v,P)/2.5),c.restore());else{let H;d?H=.4:H=.2,Math.random()<H&&(c.save(),c.globalAlpha=.4,ue(c,T,I,Math.max(v,P)/3),c.restore())}}}c.restore()});const t=n=>{if(K){K=!1,V===2&&(ye=!1),e.releasePointerCapture(n.pointerId);try{if(C&&C.state!=="suspended"){const i=C.createOscillator(),o=C.createGain();i.connect(o),o.connect(C.destination),i.frequency.setValueAtTime(400,C.currentTime),i.frequency.exponentialRampToValueAtTime(200,C.currentTime+.2),o.gain.setValueAtTime(.15,C.currentTime),o.gain.exponentialRampToValueAtTime(.01,C.currentTime+.2),i.start(C.currentTime),i.stop(C.currentTime+.2)}}catch(i){console.log("End sound failed:",i)}}};e.addEventListener("pointerup",t),e.addEventListener("pointercancel",t),e.addEventListener("pointerleave",t)}let C=null,de=!1;function Ze(){if(!de)try{C=new(window.AudioContext||window.webkitAudioContext),de=!0,console.log("Audio context initialized")}catch(e){console.log("Audio not supported"),console.log("Audio not supported",e),de=!0}}function et(){(!C||C.state==="suspended")&&C?.resume();try{if(!C)return;const e=C.createOscillator(),t=C.createGain();e.connect(t),t.connect(C.destination),e.frequency.setValueAtTime(400,C.currentTime),e.frequency.exponentialRampToValueAtTime(800,C.currentTime+.2),e.frequency.exponentialRampToValueAtTime(600,C.currentTime+.4),e.frequency.exponentialRampToValueAtTime(900,C.currentTime+.6),t.gain.setValueAtTime(.2,C.currentTime),t.gain.exponentialRampToValueAtTime(.4,C.currentTime+.2),t.gain.exponentialRampToValueAtTime(.2,C.currentTime+.4),t.gain.exponentialRampToValueAtTime(.01,C.currentTime+.6),e.start(C.currentTime),e.stop(C.currentTime+.6)}catch(e){console.log("Audio playback failed:",e)}}function qt(){(!C||C.state==="suspended")&&C?.resume();try{if(!C)return;const e=C.createOscillator(),t=C.createGain();e.connect(t),t.connect(C.destination),e.frequency.setValueAtTime(300,C.currentTime),e.frequency.exponentialRampToValueAtTime(1500,C.currentTime+.3),t.gain.setValueAtTime(.3,C.currentTime),t.gain.exponentialRampToValueAtTime(.01,C.currentTime+.3),e.start(C.currentTime),e.stop(C.currentTime+.3)}catch(e){console.log("Audio playback failed:",e)}}function Ae(){de||(Ze(),et())}document.addEventListener("click",Ae);document.addEventListener("touchstart",Ae);document.addEventListener("keydown",Ae);Ze();function Ut(){const e=document.getElementById("info-popup");e&&(e.style.display="block")}function tt(){const e=document.getElementById("info-popup");e&&(e.style.display="none")}window.showInfoPopup=Ut;window.hideInfoPopup=tt;document.addEventListener("click",e=>{const t=document.getElementById("info-popup");t&&e.target===t&&tt()});let z={baseHue:216,saturation:90,lightness:50,sparkleIntensity:.3,sparkleSize:2,sparkleCount:3,glowIntensity:.2,pulseSpeed:.02,sizeMultiplier:1,cycleSpeed:8,filter:"none"};window.randomStyleParams=z;function ve(){const e=z.baseHue,t=z.saturation,n=z.lightness;let i=Math.floor(Math.random()*360),o=90,s=50,a=0;const r=15;do{i=Math.floor(Math.random()*360);const w=[80,85,90,95,100];o=w[Math.floor(Math.random()*w.length)];const g=[35,40,45,50,55,60,65];s=g[Math.floor(Math.random()*g.length)],a++}while(a<r&&Math.abs(i-e)<60&&Math.abs(o-t)<20&&Math.abs(s-n)<20);const m=Math.random()*.6+.4,h=Math.random()*3+1,d=Math.floor(Math.random()*12)+4,l=Math.random()*.8+.2,M=Math.random()*.3+.1,u=Math.random()*2+.8,p=["none","hue-rotate(90deg)","hue-rotate(180deg)","saturate(1.5)","brightness(1.2)","contrast(1.3)"],f=p[Math.floor(Math.random()*p.length)];z={baseHue:i,saturation:o,lightness:s,sparkleIntensity:m,sparkleSize:h,sparkleCount:d,glowIntensity:l,pulseSpeed:M,sizeMultiplier:u,cycleSpeed:8,filter:f},window.randomStyleParams=z,console.log(`🎨 Style 1 NEW COLORS: baseHue=${i}, saturation=${o}, lightness=${s}`)}function jt(){const e=[{baseHue:0,saturation:100,lightness:45,cycleSpeed:9},{baseHue:60,saturation:100,lightness:55,cycleSpeed:11},{baseHue:270,saturation:95,lightness:40,cycleSpeed:7},{baseHue:210,saturation:100,lightness:60,cycleSpeed:12},{baseHue:15,saturation:100,lightness:50,cycleSpeed:6},{baseHue:200,saturation:90,lightness:45,cycleSpeed:8},{baseHue:120,saturation:85,lightness:40,cycleSpeed:7},{baseHue:280,saturation:100,lightness:55,cycleSpeed:10},{baseHue:240,saturation:90,lightness:45,cycleSpeed:8},{baseHue:160,saturation:95,lightness:50,cycleSpeed:7},{baseHue:180,saturation:85,lightness:45,cycleSpeed:6},{baseHue:300,saturation:100,lightness:50,cycleSpeed:13},{baseHue:20,saturation:100,lightness:45,cycleSpeed:8},{baseHue:220,saturation:90,lightness:65,cycleSpeed:5},{baseHue:45,saturation:95,lightness:55,cycleSpeed:7}],t=z.baseHue,n=z.saturation,i=z.lightness,o=e.filter(h=>{const d=Math.abs(h.baseHue-t),l=Math.abs(h.saturation-n),M=Math.abs(h.lightness-i);return d>30||l>15||M>15}),s=o.length>0?o:e,a=s[Math.floor(Math.random()*s.length)];z={...z,baseHue:a.baseHue,saturation:a.saturation,lightness:a.lightness,cycleSpeed:a.cycleSpeed};const r=["none","hue-rotate(90deg)","hue-rotate(180deg)","saturate(1.5)","brightness(1.2)","contrast(1.3)"],m=r[Math.floor(Math.random()*r.length)];z={...z,filter:m},window.randomStyleParams=z,console.log(`🎨 Style 1 VIBE CHANGE: baseHue=${a.baseHue}, saturation=${a.saturation}, lightness=${a.lightness}, filter=${m}`)}function Gt(){const e=document.getElementById("app-canvas");if(console.log("Init function called, canvas found:",!!e),!e){console.error("Canvas element not found!");return}console.log("Device capabilities:",{maxTouchPoints:window.navigator.maxTouchPoints,hasPointerEvents:"PointerEvent"in window}),document.addEventListener("contextmenu",u=>u.preventDefault()),document.addEventListener("selectstart",u=>u.preventDefault()),document.addEventListener("dragstart",u=>u.preventDefault()),document.addEventListener("gesturestart",u=>u.preventDefault()),document.addEventListener("gesturechange",u=>u.preventDefault()),document.addEventListener("gestureend",u=>u.preventDefault()),e.addEventListener("contextmenu",u=>u.preventDefault()),e.addEventListener("selectstart",u=>u.preventDefault()),e.addEventListener("dragstart",u=>u.preventDefault()),e.style.touchAction="none",e.style.webkitTouchCallout="none",e.style.webkitUserSelect="none",e.style.userSelect="none",console.log("Initializing canvas context..."),Vt(e),console.log("Canvas context initialized, ctx:",!!c),be(e),c&&e&&(me(e),console.log("Canvas fully initialized and cleared"));const t=()=>be(e);window.addEventListener("resize",t),window.addEventListener("orientationchange",t),window.visualViewport?.addEventListener("resize",t),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&be(e)}),console.log("Attaching pointer handlers..."),Bt(e),console.log("Pointer handlers attached"),setTimeout(()=>{const u=document.getElementById("splash-screen");u&&(qt(),u.classList.add("fade-out"),setTimeout(()=>{u.style.display="none";const p=document.querySelector(".one-front-credit");p&&p.classList.add("show")},300))},300),setTimeout(()=>{et()},200);const n=document.getElementById("style-selector");if(n){const u=()=>{R.nextStyle();const f=R.getCurrentStyle();n.textContent=f.icon,n.style.color="white",console.log(`🎨 Switched to ${f.name} style: ${f.description}`),console.log(`🎯 Style index: ${R.getCurrentStyleIndex()}`),n.title=`Current: ${f.name}
Tap to switch drawing style`};n.addEventListener("click",u),n.addEventListener("touchstart",f=>{f.preventDefault(),u()}),n.addEventListener("touchend",f=>{f.preventDefault()});const p=R.getCurrentStyle();n.textContent=p.icon,n.style.color="white",n.title=`Current: ${p.name}
Tap to switch drawing style`}const i=document.getElementById("style-switch");if(i){const u=()=>{if(R.getCurrentStyleIndex()===0){Math.random()<.4?(jt(),console.log("🎨 FORCED vibe change for Style 1!")):(ve(),console.log("🎨 Randomized colors for Style 1!")),x=Math.floor(Math.random()*5);const g=Math.floor(Math.random()*360);i.style.color=`hsl(${g}, 85%, 55%)`,console.log(`🎨 Style 1 randomized: ${["tiny","small","medium","large","huge"][x]} size + new colors!`)}else{ve(),x=Math.floor(Math.random()*5);const w=Math.floor(Math.random()*360);i.style.color=`hsl(${w}, 85%, 55%)`,console.log(`Generated new random style and changed to ${["tiny","small","medium","large","huge"][x]} size!`)}};i.addEventListener("click",u),i.addEventListener("touchstart",f=>{f.preventDefault(),u()}),i.addEventListener("touchend",f=>{f.preventDefault()}),ve();const p=Math.floor(Math.random()*360);i.style.color=`hsl(${p}, 85%, 55%)`}const o=document.getElementById("thickness-slider"),s=document.getElementById("vibration-knob"),a=document.getElementById("thickness-value");if(console.log("Thickness slider found:",!!o),o){const u=()=>{$=parseFloat(o.value),console.log("🎯 Thickness changed to:",$,"Slider value:",o.value),a&&(a.textContent=o.value),c&&e&&console.log("🔄 Thickness updated, next draw will use:",$)};o.addEventListener("input",u),o.addEventListener("change",u),$=parseFloat(o.value),console.log("🎯 Initial thickness:",$),a&&(a.textContent=o.value);const p=O(1,1);console.log("🧪 Test size calculation with thickness",$,":",p)}else console.error("Thickness slider not found!");let r=1;const m=()=>{s&&(r=parseFloat(s.value)),window.vibrationIntensity=r};s?.addEventListener("input",m),m();const h=u=>{if(!o)return;const p=parseFloat(o.value),f=parseFloat(o.step)||.2,w=parseFloat(o.min)||.2,g=parseFloat(o.max)||5;if(u.key==="ArrowLeft"||u.key==="ArrowDown"){const y=Math.max(w,p-f);o.value=y.toString(),$=y,console.log("🎯 Thickness decreased to:",y)}else if(u.key==="ArrowRight"||u.key==="ArrowUp"){const y=Math.min(g,p+f);o.value=y.toString(),$=y,console.log("🎯 Thickness increased to:",y)}};document.addEventListener("keydown",h);const d=document.getElementById("eraser");if(d){const u=()=>{W=!W,W?(d.style.backgroundColor="rgba(255, 255, 255, 0.2)",d.style.border="2px solid rgba(255, 255, 255, 0.5)",console.log("Eraser mode activated! 🧽")):(d.style.backgroundColor="transparent",d.style.border="none",console.log("Drawing mode activated! ✏️"))};d.addEventListener("click",u),d.addEventListener("touchstart",p=>{p.preventDefault(),u()}),d.addEventListener("touchend",p=>{p.preventDefault()})}const l=document.getElementById("clear-canvas");if(l){const u=()=>{c&&e&&(me(e),console.log("Canvas cleared! ✨"))};l.addEventListener("click",u),l.addEventListener("touchstart",u),l.addEventListener("touchend",u)}function M(u){V=u,console.log(`Switched to Style ${u}`),document.querySelectorAll(".style-button").forEach((p,f)=>{p.classList.toggle("active",f===u-1)})}document.getElementById("style-1")?.addEventListener("click",()=>M(1)),document.getElementById("style-2")?.addEventListener("click",()=>M(2)),document.getElementById("style-3")?.addEventListener("click",()=>M(3))}document.addEventListener("DOMContentLoaded",Gt);export{Je as W,ut as _,Le as r};
