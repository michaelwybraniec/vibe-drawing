(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const Ze="modulepreload",et=function(e){return"/vibe-drawing/"+e},Ce={},tt=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){let m=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),r=a?.nonce||a?.getAttribute("nonce");o=m(n.map(c=>{if(c=et(c),c in Ce)return;Ce[c]=!0;const f=c.endsWith(".css"),l=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${l}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":Ze,f||(y.as="script"),y.crossOrigin="",y.href=c,r&&y.setAttribute("nonce",r),document.head.appendChild(y),f)return new Promise((d,p)=>{y.addEventListener("load",d),y.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return o.then(a=>{for(const r of a||[])r.status==="rejected"&&s(r.reason);return t().catch(s)})};function Ee(){return typeof navigator<"u"&&"vibrate"in navigator}const nt="vibe.flags",ze={hapticsEnabled:!0,debug:!1};function it(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function ot(){if(typeof window>"u")return{...ze};const e=it(localStorage.getItem(nt));return{...ze,...e}}let st=ot();function se(e){return st[e]}let R=null,N=null,G=null;function ke(e=.5){try{if(R||(R=new(window.AudioContext||window.webkitAudioContext)),!R||N)return;N=R.createOscillator(),G=R.createGain(),N.type="square",N.frequency.value=85,G.gain.value=Math.min(1,Math.max(.05,e)),N.connect(G),G.connect(R.destination),N.start()}catch{}}function Se(e=.5){if(!G||!R)return;const t=Math.min(1,Math.max(.05,e));try{G.gain.exponentialRampToValueAtTime(t,R.currentTime+.05)}catch{G.gain.value=t}}/*! Capacitor: https://capacitorjs.com/ - MIT License */var te;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(te||(te={}));class me extends Error{constructor(t,n,i){super(t),this.message=t,this.code=n,this.data=i}}const at=e=>{var t,n;return e?.androidBridge?"android":!((n=(t=e?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},rt=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},i=n.Plugins=n.Plugins||{},o=()=>t!==null?t.name:at(e),s=()=>o()!=="web",a=l=>{const y=c.get(l);return!!(y?.platforms.has(o())||r(l))},r=l=>{var y;return(y=n.PluginHeaders)===null||y===void 0?void 0:y.find(d=>d.name===l)},m=l=>e.console.error(l),c=new Map,f=(l,y={})=>{const d=c.get(l);if(d)return console.warn(`Capacitor plugin "${l}" already registered. Cannot register plugins twice.`),d.proxy;const p=o(),u=r(l);let w;const g=async()=>(!w&&p in y?w=typeof y[p]=="function"?w=await y[p]():w=y[p]:t!==null&&!w&&"web"in y&&(w=typeof y.web=="function"?w=await y.web():w=y.web),w),M=(v,P)=>{var z,$;if(u){const T=u?.methods.find(k=>P===k.name);if(T)return T.rtype==="promise"?k=>n.nativePromise(l,P.toString(),k):(k,x)=>n.nativeCallback(l,P.toString(),k,x);if(v)return(z=v[P])===null||z===void 0?void 0:z.bind(v)}else{if(v)return($=v[P])===null||$===void 0?void 0:$.bind(v);throw new me(`"${l}" plugin is not implemented on ${p}`,te.Unimplemented)}},S=v=>{let P;const z=(...$)=>{const T=g().then(k=>{const x=M(k,v);if(x){const I=x(...$);return P=I?.remove,I}else throw new me(`"${l}.${v}()" is not implemented on ${p}`,te.Unimplemented)});return v==="addListener"&&(T.remove=async()=>P()),T};return z.toString=()=>`${v.toString()}() { [capacitor code] }`,Object.defineProperty(z,"name",{value:v,writable:!1,configurable:!1}),z},L=S("addListener"),b=S("removeListener"),C=(v,P)=>{const z=L({eventName:v},P),$=async()=>{const k=await z;b({eventName:v,callbackId:k},P)},T=new Promise(k=>z.then(()=>k({remove:$})));return T.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await $()},T},E=new Proxy({},{get(v,P){switch(P){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return u?C:L;case"removeListener":return b;default:return S(P)}}});return i[l]=E,c.set(l,{name:l,proxy:E,platforms:new Set([...Object.keys(y),...u?[p]:[]])}),E};return n.convertFileSrc||(n.convertFileSrc=l=>l),n.getPlatform=o,n.handleError=m,n.isNativePlatform=s,n.isPluginAvailable=a,n.registerPlugin=f,n.Exception=me,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},lt=e=>e.Capacitor=rt(e),de=lt(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Pe=de.registerPlugin;class Ye{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let i=!1;this.listeners[t]||(this.listeners[t]=[],i=!0),this.listeners[t].push(n);const s=this.windowListeners[t];s&&!s.registered&&this.addWindowListener(s),i&&this.sendRetainedArgumentsForEvent(t);const a=async()=>this.removeListener(t,n);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,i){const o=this.listeners[t];if(!o){if(i){let s=this.retainedEventArguments[t];s||(s=[]),s.push(n),this.retainedEventArguments[t]=s}return}o.forEach(s=>s(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:i=>{this.notifyListeners(n,i)}}}unimplemented(t="not implemented"){return new de.Exception(t,te.Unimplemented)}unavailable(t="not available"){return new de.Exception(t,te.Unavailable)}async removeListener(t,n){const i=this.listeners[t];if(!i)return;const o=i.indexOf(n);this.listeners[t].splice(o,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(i=>{this.notifyListeners(t,i)}))}}const Te=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Ie=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ct extends Ye{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(i=>{if(i.length<=0)return;let[o,s]=i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");o=Ie(o).trim(),s=Ie(s).trim(),n[o]=s}),n}async setCookie(t){try{const n=Te(t.key),i=Te(t.value),o=`; expires=${(t.expires||"").replace("expires=","")}`,s=(t.path||"/").replace("path=",""),a=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${i||""}${o}; path=${s}; ${a};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}Pe("CapacitorCookies",{web:()=>new ct});const ht=async e=>new Promise((t,n)=>{const i=new FileReader;i.onload=()=>{const o=i.result;t(o.indexOf(",")>=0?o.split(",")[1]:o)},i.onerror=o=>n(o),i.readAsDataURL(e)}),dt=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(o=>o.toLocaleLowerCase()).reduce((o,s,a)=>(o[s]=e[t[a]],o),{})},ut=(e,t=!0)=>e?Object.entries(e).reduce((i,o)=>{const[s,a]=o;let r,m;return Array.isArray(a)?(m="",a.forEach(c=>{r=t?encodeURIComponent(c):c,m+=`${s}=${r}&`}),m.slice(0,-1)):(r=t?encodeURIComponent(a):a,m=`${s}=${r}`),`${i}&${m}`},"").substr(1):null,ft=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),o=dt(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[a,r]of Object.entries(e.data||{}))s.set(a,r);n.body=s.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){const s=new FormData;if(e.data instanceof FormData)e.data.forEach((r,m)=>{s.append(m,r)});else for(const r of Object.keys(e.data))s.append(r,e.data[r]);n.body=s;const a=new Headers(n.headers);a.delete("content-type"),n.headers=a}else(o.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class mt extends Ye{async request(t){const n=ft(t,t.webFetchExtra),i=ut(t.params,t.shouldEncodeUrlParams),o=i?`${t.url}?${i}`:t.url,s=await fetch(o,n),a=s.headers.get("content-type")||"";let{responseType:r="text"}=s.ok?t:{};a.includes("application/json")&&(r="json");let m,c;switch(r){case"arraybuffer":case"blob":c=await s.blob(),m=await ht(c);break;case"json":m=await s.json();break;case"document":case"text":default:m=await s.text()}const f={};return s.headers.forEach((l,y)=>{f[y]=l}),{data:m,headers:f,status:s.status,url:s.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}Pe("CapacitorHttp",{web:()=>new mt});const Le=Pe("NativeHaptics",{web:()=>({async start(){},async update(){},async stop(){}})});let V=null;(async()=>{try{V=(await tt(()=>import("./index-B2YvK0Go.js"),[])).Haptics}catch{V=null}})();let ae=null,J=70,D=22,Q=!1,ne=!1,q=.5;const Z=de.getPlatform();let ve="medium",ge=!1;function gt(e){const t=Math.max(0,Math.min(.25,0));return Math.max(.15,Math.min(1,t/.25))}function pt(e){const t=Math.max(0,Math.min(1,.5));return Math.max(.1,Math.min(1,t))}function le(e,t){const n=gt(),i=pt();return Math.max(.1,Math.min(1,i*.6+n*.4))}function Mt(e,t){const n=le();return Math.round(18+n*20)}function yt(e,t){const n=le();return Math.round(80-n*35)}function bt(e,t){const n=le();return n>.7?"heavy":n>.4?"medium":"light"}function we(){if(console.log(`Haptic tick - platform: ${Z}, usingNativeHaptics: ${ne}, HapticsBasic: ${!!V}`),Z!=="web"&&!ne)try{Le.update({intensity:q}),console.log(`Native haptics update: ${q}`);return}catch(e){console.log(`Native haptics failed: ${e}`)}if(V){Z==="ios"?(console.log(`iOS haptic impact: ${ve}`),V.impact({style:ve}).catch(e=>console.log(`iOS haptic failed: ${e}`))):Z==="android"?(console.log(`Android vibrate: ${D}ms`),V.vibrate({duration:D}).catch(e=>console.log(`Android haptic failed: ${e}`))):Ee()?(console.log(`Web vibrate: ${D}ms`),navigator.vibrate(D)):(console.log(`Audio fallback: ${D/40}`),Q?Se(D/40):(Q=!0,ke(.4)));return}Ee()?(console.log(`Fallback web vibrate: ${D}ms`),navigator.vibrate(D)):(console.log(`Fallback audio: ${D/40}`),Q?Se(D/40):(Q=!0,ke(.4)))}function St(){if(se("hapticsEnabled")){if(ge){vt();return}if(Q=!1,ne=!1,Z!=="web")try{console.log(`Starting native haptics with intensity: ${q}`),Le.start({intensity:q}),ne=!0,ge=!0,console.log("Native haptics started successfully");return}catch(e){console.log(`Native haptics start failed: ${e}`)}V&&Z==="ios"&&(console.log("iOS pre-tap"),V.impact({style:"medium"}).catch(e=>console.log(`iOS pre-tap failed: ${e}`))),we(),ae=window.setInterval(we,J),ge=!0,console.log(`Started haptic timer with interval: ${J}ms`)}}function vt(e,t){if(!se("hapticsEnabled"))return;const n=le(),i=Math.abs(q-n)>.05;if(q=n,se("debug")&&Math.random()<.05&&console.log(`hapticsUpdate - speed: ${e?.toFixed(3)}, pressure: ${t?.toFixed(3)}, intensity: ${n.toFixed(3)}`),ne&&i)try{Le.update({intensity:q}),se("debug")&&console.log(`Native haptics updated to: ${q.toFixed(3)}`);return}catch(o){se("debug")&&console.log(`Native haptics update failed: ${o}`),ne=!1}if(i||!ae){D=Mt(),ve=bt();const o=yt();Math.abs(o-J)>2&&ae!=null?(J=o,window.clearInterval(ae),ae=window.setInterval(we,J)):J=o}Q&&Se(le())}class wt{constructor(){this.name="Particle",this.description="Smooth particle-based drawing with haptic feedback",this.icon="1",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.previousPoint=null}onStart(t,n){console.log("🎨 Particle style started"),this.previousPoint=t}onMove(t,n){console.log("🎨 ParticleStyle.onMove called");const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:r,isWebApp:m}=n;this.previousPoint&&(i.save(),i.globalCompositeOperation="source-over",t.forEach((c,f)=>{if(!this.previousPoint)return;const l=(c.t-this.previousPoint.t)/16;if(l<=0)return;this.calculateSizeMultiplier(c,n);const y=this.previousPoint.x+(c.x-this.previousPoint.x)*l,d=this.previousPoint.y+(c.y-this.previousPoint.y)*l,p=c.width||1,u=c.height||1,w=.95+Math.random()*.1,g=1+Math.sin((Date.now()+f*40)/160)*.03,M=p/2*w*g,S=u/2*w*g;if(o)i.fillStyle="#151E35";else{const b=1+Math.sin(l*Math.PI)*.12;i.fillStyle=this.getCurrentColor(b)}i.beginPath(),i.ellipse(y,d,M,S,0,0,2*Math.PI),i.fill(),Math.max(p,u)>15&&Math.random()<.2&&(i.save(),i.globalAlpha=.4,this.addSparkleEffect(i,y,d,Math.max(p,u)/3),i.restore()),this.previousPoint=c}),i.restore())}onEnd(t){console.log("🎨 Particle style ended")}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(s[o]||1)*a;{const f=Math.max(0,Math.min(1,(r-5)/95));let l;(t.width||0)===0||(t.height||0)===0?l=.2:l=.1+f*.2;const y=.98+Math.random()*.04,d=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+l*y*this.sizeSmoothingFactor;return this.lastSizeMultiplier=d,d*a}}getCurrentColor(t){const n=Date.now()*.1%360,i=80+Math.sin(Date.now()*.001)*20,o=50+Math.sin(Date.now()*.002)*30;return`hsl(${n}, ${i}%, ${o}%)`}addSparkleEffect(t,n,i,o){const s=3+Math.floor(Math.random()*3);for(let a=0;a<s;a++){const r=Math.PI*2*a/s+Math.random()*.5,m=o*(.5+Math.random()*.5),c=n+Math.cos(r)*m,f=i+Math.sin(r)*m,l=o*.1*(.5+Math.random()*.5);t.fillStyle=`rgba(255, 255, 255, ${.6+Math.random()*.4})`,t.beginPath(),t.arc(c,f,l,0,2*Math.PI),t.fill()}}}class Pt{constructor(){this.name="Lava",this.description="Flowing lava lines that melt and drip",this.icon="2",this.lavaLines=[],this.currentLavaLine=null,this.animationId=null}onStart(t,n){console.log("🌋 Lava style started"),this.currentLavaLine={points:[],startTime:Date.now(),isMelting:!1,meltProgress:0},this.addPointToLavaLine(t,n)}onMove(t,n){const{ctx:i}=n;this.currentLavaLine&&(t.forEach(o=>{this.addPointToLavaLine(o,n)}),this.drawLavaLines(n))}onEnd(t){console.log("🌋 Lava style ended"),this.currentLavaLine&&(this.currentLavaLine.isMelting=!0,this.lavaLines.push(this.currentLavaLine),this.currentLavaLine=null),this.animationId||this.startAnimation(context)}onClear(t){this.lavaLines=[],this.currentLavaLine=null,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}animate(t){this.drawLavaLines(t),this.lavaLines.forEach(n=>{n.isMelting&&(n.meltProgress+=.02,n.meltProgress>=1&&(n.meltProgress=1))}),this.lavaLines=this.lavaLines.filter(n=>n.meltProgress<1),this.lavaLines.length>0||this.currentLavaLine?this.animationId=requestAnimationFrame(()=>this.animate(t)):this.animationId=null}addPointToLavaLine(t,n){if(!this.currentLavaLine)return;const i={x:t.x,y:t.y,sizeMultiplier:this.calculateSizeMultiplier(t,n),touchWidth:t.width||1,touchHeight:t.height||1,time:t.t};this.currentLavaLine.points.push(i)}drawLavaLines(t){const{ctx:n,isEraserMode:i}=t;n.save(),this.currentLavaLine&&this.drawLavaLine(this.currentLavaLine,t,!1),this.lavaLines.forEach(o=>{this.drawLavaLine(o,t,!0)}),n.restore()}drawLavaLine(t,n,i){const{ctx:o,isEraserMode:s}=n;if(t.points.length<2)return;o.save();const a=o.createLinearGradient(0,0,0,o.canvas.height);a.addColorStop(0,"#ff4500"),a.addColorStop(.5,"#ff6347"),a.addColorStop(1,"#ff8c00"),o.strokeStyle=s?"#151E35":a,o.lineCap="round",o.lineJoin="round",o.beginPath(),t.points.forEach((m,c)=>{c===0?o.moveTo(m.x,m.y):o.lineTo(m.x,m.y)});const r=i?Math.max(1,(t.points[0]?.sizeMultiplier||1)*20*(1-t.meltProgress)):(t.points[0]?.sizeMultiplier||1)*20;o.lineWidth=r,o.stroke(),s||(o.shadowColor="#ff4500",o.shadowBlur=10,o.stroke(),o.shadowBlur=0),i&&t.meltProgress>.3&&this.drawDrips(t,n),o.restore()}drawDrips(t,n){const{ctx:i,isEraserMode:o}=n;i.save();const s=Math.floor(t.meltProgress*5),a=o?"#151E35":"#ff6347";for(let r=0;r<s;r++){const m=t.points[Math.floor(Math.random()*t.points.length)];if(!m)continue;const c=20+Math.random()*30,f=m.sizeMultiplier*5;i.fillStyle=a,i.beginPath(),i.ellipse(m.x+(Math.random()-.5)*10,m.y+c,f,c,0,0,2*Math.PI),i.fill()}i.restore()}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(s[o]||1)*a;{const f=Math.max(0,Math.min(1,(r-5)/95));let l;return(t.width||0)===0||(t.height||0)===0?l=.2:l=.1+f*.2,l*a}}startAnimation(t){this.animate(t)}}class Lt{constructor(){this.name="Neon",this.description="Bright neon lines with glowing effects",this.icon="3",this.neonLines=[],this.currentLine=[],this.currentColor="#00ff00"}onStart(t,n){console.log("💡 Neon style started"),this.currentLine=[t],this.currentColor=this.getNeonColor()}onMove(t,n){const{ctx:i}=n;this.currentLine.push(...t),this.drawNeonLines(n)}onEnd(t){console.log("💡 Neon style ended"),this.currentLine.length>1&&this.neonLines.push({points:[...this.currentLine],color:this.currentColor,startTime:Date.now()}),this.currentLine=[]}onClear(t){this.neonLines=[],this.currentLine=[]}drawNeonLines(t){const{ctx:n,isEraserMode:i}=t;n.save(),this.currentLine.length>1&&this.drawNeonLine(this.currentLine,this.currentColor,t,!1),this.neonLines.forEach(o=>{this.drawNeonLine(o.points,o.color,t,!0)}),n.restore()}drawNeonLine(t,n,i,o){const{ctx:s,isEraserMode:a}=i;if(t.length<2)return;s.save();const r=a?"#151E35":n,m=a?"#151E35":this.getGlowColor(n);s.lineCap="round",s.lineJoin="round";for(let c=3;c>=1;c--){if(s.strokeStyle=m,!t[0])return;s.lineWidth=this.calculateLineWidth(t[0],i)*(c*2),s.globalAlpha=.1/c,s.beginPath(),t.forEach((f,l)=>{l===0?s.moveTo(f.x,f.y):s.lineTo(f.x,f.y)}),s.stroke()}if(s.strokeStyle=r,!!t[0]){if(s.lineWidth=this.calculateLineWidth(t[0],i),s.globalAlpha=1,s.beginPath(),t.forEach((c,f)=>{f===0?s.moveTo(c.x,c.y):s.lineTo(c.x,c.y)}),s.stroke(),!a){if(s.strokeStyle="#ffffff",!t[0])return;s.lineWidth=this.calculateLineWidth(t[0],i)*.3,s.globalAlpha=.8,s.stroke()}o&&!a&&Math.random()<.1&&this.addSparkles(t,n,i),s.restore()}}addSparkles(t,n,i){const{ctx:o}=i;o.save();const s=2+Math.floor(Math.random()*3);for(let a=0;a<s;a++){const r=t[Math.floor(Math.random()*t.length)],m=2+Math.random()*3;if(!r)return;const c=r.x+(Math.random()-.5)*20,f=r.y+(Math.random()-.5)*20;o.fillStyle="#ffffff",o.globalAlpha=.8,o.beginPath(),o.arc(c,f,m,0,2*Math.PI),o.fill(),o.fillStyle=n,o.globalAlpha=.3,o.beginPath(),o.arc(c,f,m*2,0,2*Math.PI),o.fill()}o.restore()}calculateLineWidth(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(s[o]||1)*a*15;{const f=Math.max(0,Math.min(1,(r-5)/95));let l;return(t.width||0)===0||(t.height||0)===0?l=.2:l=.1+f*.2,l*a*15}}getNeonColor(){const t=["#00ff00","#ff00ff","#00ffff","#ffff00","#ff0080","#0080ff","#ff8000","#8000ff"];return t[Math.floor(Math.random()*t.length)]||"#ff6b6b"}getGlowColor(t){return t}}class At{constructor(){this.name="Watercolor",this.description="Soft watercolor brush strokes with color blending",this.icon="4",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.brushStrokes=[]}onStart(t,n){console.log("🎨 Watercolor style started"),this.brushStrokes=[]}onMove(t,n){console.log("🎨 WatercolorStyle.onMove called");const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:r,isWebApp:m}=n;t.length<2||(i.save(),i.globalCompositeOperation=o?"destination-out":"multiply",t.forEach((c,f)=>{if(f===0)return;const l=t[f-1];if(!l)return;const y=(c.t-l.t)/16;if(y<=0)return;const d=this.calculateSizeMultiplier(c,n),p=l.x+(c.x-l.x)*y,u=l.y+(c.y-l.y)*y,w=c.width||1;c.height;const g=.8+Math.random()*.4,M=w/2*g*d;if(o)i.globalAlpha=.3,i.fillStyle="rgba(21, 30, 53, 0.3)";else{const L=1+Math.sin(y*Math.PI)*.15,b=this.getWatercolorColor(L);for(let C=0;C<3;C++){const E=(Math.random()-.5)*M*.5,v=(Math.random()-.5)*M*.5,P=M*(.7+Math.random()*.6),z=.1+Math.random()*.2;i.globalAlpha=z,i.fillStyle=b,i.beginPath(),i.arc(p+E,u+v,P,0,2*Math.PI),i.fill()}this.brushStrokes.push({x:p,y:u,size:M,color:b,opacity:.3})}}),i.restore())}onEnd(t){console.log("🎨 Watercolor style ended")}onClear(t){this.brushStrokes=[]}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .2*(s[o]||1)*a;{const f=Math.max(0,Math.min(1,(r-5)/95));let l;(t.width||0)===0||(t.height||0)===0?l=.25:l=.15+f*.25;const y=.95+Math.random()*.1,d=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+l*y*this.sizeSmoothingFactor;return this.lastSizeMultiplier=d,d*(s[o]||1)*a}}getWatercolorColor(t){const n=["#FFB3BA","#BAFFC9","#BAE1FF","#FFFFBA","#FFB3F7","#B3FFE6","#FFD4B3","#E6B3FF"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}}class Ct{constructor(){this.name="Chalk",this.description="Dusty chalk strokes with particle effects",this.icon="5",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.particles=[]}onStart(t,n){console.log("🎨 Chalk style started"),this.particles=[]}onMove(t,n){const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:r,isWebApp:m}=n;t.length<2||(i.save(),i.globalCompositeOperation="source-over",t.forEach((c,f)=>{if(f===0)return;const l=t[f-1];if(!l)return;const y=(c.t-l.t)/16;if(y<=0)return;const d=this.calculateSizeMultiplier(c,n),p=l.x+(c.x-l.x)*y,u=l.y+(c.y-l.y)*y,w=c.width||1;c.height;const g=.7+Math.random()*.6,M=w/2*g*d;if(o)i.globalAlpha=.8,i.fillStyle="#151E35";else{const L=1+Math.sin(y*Math.PI)*.1,b=this.getChalkColor(L);i.globalAlpha=.9,i.fillStyle=b,i.beginPath(),i.arc(p,u,M,0,2*Math.PI),i.fill();for(let C=0;C<5;C++){const E=p+(Math.random()-.5)*M*2,v=u+(Math.random()-.5)*M*2,P=Math.random()*M*.3;i.globalAlpha=.6,i.fillStyle=b,i.beginPath(),i.arc(E,v,P,0,2*Math.PI),i.fill(),this.particles.push({x:E,y:v,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,life:1,maxLife:1,color:b})}for(let C=0;C<3;C++){const E=p+(Math.random()-.5)*M,v=u+(Math.random()-.5)*M,P=Math.random()*M*.2;i.globalAlpha=.3,i.fillStyle=b,i.beginPath(),i.arc(E,v,P,0,2*Math.PI),i.fill()}}}),i.restore())}onEnd(t){console.log("🎨 Chalk style ended")}onClear(t){this.particles=[]}animate(t){const{ctx:n}=t;this.particles=this.particles.filter(i=>(i.x+=i.vx,i.y+=i.vy,i.vy+=.1,i.life-=.02,i.life>0?(n.save(),n.globalAlpha=i.life*.5,n.fillStyle=i.color,n.beginPath(),n.arc(i.x,i.y,1,0,2*Math.PI),n.fill(),n.restore(),!0):!1))}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .18*(s[o]||1)*a;{const f=Math.max(0,Math.min(1,(r-5)/95));let l;(t.width||0)===0||(t.height||0)===0?l=.22:l=.12+f*.2;const y=.9+Math.random()*.2,d=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+l*y*this.sizeSmoothingFactor;return this.lastSizeMultiplier=d,d*(s[o]||1)*a}}getChalkColor(t){const n=["#FFFFFF","#F0F0F0","#E8E8E8","#D0D0D0","#FFE4E1","#E6E6FA","#F0F8FF","#F5F5DC"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}}class Et{constructor(){this.name="Glow",this.description="Bright neon strokes with glowing effects",this.icon="6",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.glowTrails=[]}onStart(t,n){console.log("🎨 Glow style started"),this.glowTrails=[]}onMove(t,n){const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:r,isWebApp:m}=n;t.length<2||(i.save(),i.globalCompositeOperation=o?"destination-out":"screen",t.forEach((c,f)=>{if(f===0)return;const l=t[f-1];if(!l)return;const y=(c.t-l.t)/16;if(y<=0)return;const d=this.calculateSizeMultiplier(c,n),p=l.x+(c.x-l.x)*y,u=l.y+(c.y-l.y)*y,w=c.width||1;c.height;const g=.9+Math.random()*.2,M=w/2*g*d;if(o)i.globalAlpha=.5,i.fillStyle="#151E35";else{const L=1+Math.sin(y*Math.PI)*.2,b=this.getGlowColor(L);i.globalAlpha=.3,i.fillStyle=b,i.beginPath(),i.arc(p,u,M*3,0,2*Math.PI),i.fill(),i.globalAlpha=.6,i.fillStyle=b,i.beginPath(),i.arc(p,u,M*2,0,2*Math.PI),i.fill(),i.globalAlpha=.9,i.fillStyle=b,i.beginPath(),i.arc(p,u,M,0,2*Math.PI),i.fill(),i.globalAlpha=1,i.fillStyle="#FFFFFF",i.beginPath(),i.arc(p,u,M*.3,0,2*Math.PI),i.fill(),this.glowTrails.push({x:p,y:u,size:M,color:b,life:1,maxLife:1}),Math.random()<.3&&this.addSparkle(i,p,u,b)}}),i.restore())}onEnd(t){console.log("🎨 Glow style ended")}onClear(t){this.glowTrails=[]}animate(t){const{ctx:n}=t;this.glowTrails=this.glowTrails.filter(i=>(i.life-=.03,i.life>0?(n.save(),n.globalCompositeOperation="screen",n.globalAlpha=i.life*.4,n.fillStyle=i.color,n.beginPath(),n.arc(i.x,i.y,i.size*2,0,2*Math.PI),n.fill(),n.restore(),!0):!1))}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,r=Math.sqrt((t.width||1)*(t.height||1));if(i)return .16*(s[o]||1)*a;{const f=Math.max(0,Math.min(1,(r-5)/95));let l;(t.width||0)===0||(t.height||0)===0?l=.2:l=.1+f*.18;const y=.95+Math.random()*.1,d=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+l*y*this.sizeSmoothingFactor;return this.lastSizeMultiplier=d,d*(s[o]||1)*a}}getGlowColor(t){const n=["#FF0080","#00FFFF","#FF00FF","#00FF00","#FFFF00","#FF8000","#8000FF","#00FF80"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}addSparkle(t,n,i,o){t.save(),t.globalAlpha=.8,t.fillStyle=o;for(let s=0;s<4;s++){const a=s*Math.PI/2,r=n+Math.cos(a)*10,m=i+Math.sin(a)*10;t.beginPath(),t.arc(r,m,2,0,2*Math.PI),t.fill()}t.restore()}}class zt{constructor(){this.styles=[],this.currentStyleIndex=0,this.styles=[new wt,new Pt,new Lt,new At,new Ct,new Et],this.currentStyle=this.styles[0]}getCurrentStyle(){return this.currentStyle}getCurrentStyleIndex(){return this.currentStyleIndex}getAllStyles(){return this.styles}switchToStyle(t){t>=0&&t<this.styles.length&&(this.currentStyleIndex=t,this.currentStyle=this.styles[t],console.log(`🎨 Switched to style: ${this.currentStyle.name}`))}nextStyle(){const t=(this.currentStyleIndex+1)%this.styles.length;this.switchToStyle(t)}previousStyle(){const t=this.currentStyleIndex===0?this.styles.length-1:this.currentStyleIndex-1;this.switchToStyle(t)}onStart(t,n){this.currentStyle.onStart?.(t,n)}onMove(t,n){console.log(`🎯 StyleManager.onMove called for style: ${this.currentStyle.name}, points: ${t.length}`),this.currentStyle.onMove?.(t,n)}onEnd(t){this.currentStyle.onEnd?.(t)}onClear(t){this.currentStyle.onClear?.(t),this.styles.forEach(n=>{n!==this.currentStyle&&n.onClear?.(t)})}animate(t){this.currentStyle.animate?.(t),this.styles.forEach(n=>{n!==this.currentStyle&&n.animate&&n.animate(t)})}}console.log("🎨 Vibe Drawing app starting...");console.log("📍 Current location:",window.location.href);console.log("🌐 User agent:",navigator.userAgent);setTimeout(()=>{const e=document.getElementById("app"),t=document.getElementById("splash-screen");if(e&&t&&!e.querySelector("canvas")){console.log("⚠️ Main app failed to load, showing info popup"),t.style.display="none";const n=document.getElementById("info-popup");n&&(n.style.display="block")}},5e3);let h=null,K=!1,ie=[];const ee=new zt,re=!("ontouchstart"in window)||window.navigator.maxTouchPoints===0;let H=2;const pe=[.2,.4,.7,1,1.5];let Fe=.25;const $e=.15;let F=1,W=!1,B=1,Me=!1;function O(e,t){const n=Math.sqrt(e*t);if(re){const i=.15*(pe[H]||1),o=i*F;return Math.random()<.01&&console.log("Web app size calculation:",{baseMultiplier:i,thicknessMultiplier:F,finalMultiplier:o}),o}else{const s=Math.max(0,Math.min(1,(n-5)/95));let a;e===0||t===0?a=.2:a=.1+s*.2;const r=.98+Math.random()*.04,m=Fe*(1-$e)+a*r*$e;Fe=m;const c=m*(pe[H]||1)*F;return Math.random()<.01&&console.log("Size calculation:",{smoothedMultiplier:m,sizeLevel:pe[H],thicknessMultiplier:F,finalMultiplier:c}),c}}function kt(e){const t=_.baseHue,n=_.saturation,i=_.lightness,o=(Math.random()-.5)*40,s=(Math.random()-.5)*30,a=(Math.random()-.5)*20,r=(t+o+360)%360,m=Math.max(60,Math.min(100,n+s)),c=Math.max(30,Math.min(70,i+a));return`hsl(${r}, ${m}%, ${c}%)`}function ye(e){const t=_.baseHue,n=_.saturation,i=_.lightness,o=[t,t+15,t+30,t+45],s=Math.floor(Math.random()*o.length),r=(o[s]||t)+(Math.random()-.5)*10,m=n+Math.random()*15,c=i+Math.random()*30;return`hsl(${r}, ${m}%, ${c}%)`}function oe(e){return kt()}function Tt(e,t,n,i,o,s){const a=Date.now(),r=400,m=a%r/r;e.save();const c=Math.max(o,s)*.1*i,f=Math.sin(m*Math.PI*8)*.5+.5;e.strokeStyle=ye(),e.lineWidth=c*(.15+f*.08),e.lineCap="round",e.globalAlpha=.85+f*.1;const l=Math.sin(m*Math.PI*2)*.4;e.beginPath(),e.moveTo(t-c*.6,n+l),e.lineTo(t+c*.6,n+l),e.stroke();const y=15;for(let w=0;w<y;w++){const g=t-c*.5+w*c*.07,M=Math.sin((m+w*.08)*Math.PI*4)*1,S=(.3+f*.6)*i,L=.7+f*.2;e.globalAlpha=L,e.fillStyle=ye(),e.beginPath(),e.arc(g,n+M,S,0,2*Math.PI),e.fill()}const d=c*.1,p=m*Math.PI*6,u=8;for(let w=0;w<u;w++){const g=p+w*Math.PI*2/u,M=t+Math.cos(g)*d,S=n+Math.sin(g)*d,L=(.15+f*.4)*i,b=.5+f*.2;e.globalAlpha=b,e.fillStyle=ye(),e.beginPath(),e.arc(M,S,L,0,2*Math.PI),e.fill()}e.restore()}function Oe(e,t,n,i,o,s){Tt(e,t,n,i,o,s)}let U=[],We=0;function De(e,t,n,i,o,s){const a=Date.now(),r=Math.max(o,s)*.25*i;e.save();const m=[0,120,240],f=(m[Math.floor(Math.random()*m.length)]||0)+(Math.random()-.5)*20,l=`hsl(${f}, 100%, 60%)`,y=`hsl(${f+120}, 100%, 60%)`,d=`hsl(${f+240}, 100%, 60%)`,p=Math.sin(a/100)*.4+.6,u=r*p,w=Math.sin(a/50)*8,g=t+w,M=n+(Math.random()-.5)*4;if(a-We>30&&(U.push({x:g,y:M,size:u,timestamp:a,glitchOffset:w}),We=a,U.length>12&&U.shift()),U.forEach((S,L)=>{const b=a-S.timestamp;if(b<600){const C=b/600,E=(1-C)*.7,v=S.size*(1-C*.3),P=[l,y,d],z=P[Math.floor(Math.random()*P.length)]||l;e.globalAlpha=E,e.fillStyle=z,e.fillRect(S.x-v/2+S.glitchOffset,S.y-v/2,v,v),Math.random()<.3&&(e.globalAlpha=E*.5,e.fillStyle="#ffffff",e.fillRect(S.x-v/2,S.y-v/4,v,1))}}),e.globalAlpha=.9,e.fillStyle=l,e.fillRect(g-u/2,M-u/2,u,u),e.globalAlpha=.6,e.fillStyle=y,e.fillRect(g-u/2+2,M-u/2,u/3,u),e.globalAlpha=.4,e.fillStyle=d,e.fillRect(g-u/2-2,M-u/2,u/3,u),Math.random()<.4&&(e.globalAlpha=.8,e.fillStyle="#ffffff",e.fillRect(g-u/2,M-u/4,u,2)),Math.random()<.2)for(let S=0;S<5;S++){e.globalAlpha=.6,e.fillStyle=Math.random()>.5?"#ffffff":"#000000";const L=g+(Math.random()-.5)*u,b=M+(Math.random()-.5)*u;e.fillRect(L,b,2,2)}U=U.filter(S=>a-S.timestamp<800),e.restore()}let j=[],He=0;function xe(e,t,n,i,o,s){const a=Date.now(),r=Math.max(o,s)*.2*i;e.save();const m=[0,15,30],f=(m[Math.floor(Math.random()*m.length)]||15)+(Math.random()-.5)*10,l=Math.sin(a/150)*.5+.5,y=Math.sin(a/300)*.3+.7,d=Math.sin(a/600)*.2+.8,p=(l+y+d)/3,u=`hsl(${f}, 100%, ${50+p*30}%)`,w=`hsl(${f+5}, 100%, ${70+p*20}%)`,g=`hsl(${f+10}, 100%, ${40+p*40}%)`,M=Math.sin(a/100)*.3+.7,S=r*M*p;a-He>50&&(j.push({x:t,y:n,size:S,color:u,timestamp:a}),He=a,j.length>10&&j.shift()),e.globalAlpha=.9*p,e.fillStyle=w,e.beginPath(),e.arc(t,n,S*.5,0,2*Math.PI),e.fill(),e.globalAlpha=.8*p,e.fillStyle=u,e.beginPath(),e.arc(t,n,S,0,2*Math.PI),e.fill(),j.slice(-6).forEach((L,b)=>{const C=a-L.timestamp;if(C<600){const E=C/600,v=(1-E)*p*.6,P=L.size*(1-E*.3),z=Math.sin((a-L.timestamp)/100)*.3+.7;e.globalAlpha=v*z,e.fillStyle=L.color,e.beginPath(),e.arc(L.x,L.y,P,0,2*Math.PI),e.fill()}}),e.globalAlpha=.3*p,e.fillStyle=g,e.beginPath(),e.arc(t,n,S*2.5,0,2*Math.PI),e.fill(),Math.random()<.2&&(e.globalAlpha=.7*p,e.fillStyle="#ffffff",e.beginPath(),e.arc(t+(Math.random()-.5)*r,n+(Math.random()-.5)*r,2,0,2*Math.PI),e.fill()),j=j.filter(L=>a-L.timestamp<800),e.restore()}let X=[],_e=0;function Be(e,t,n,i,o,s){const a=Date.now(),r=Math.max(o,s)*.2*i;e.save();const m=_.baseHue,c=_.saturation,f=_.lightness,l=Math.sin(a/500)*60,y=m+l+(Math.random()-.5)*30,d=c+(Math.random()-.5)*20,p=f+(Math.random()-.5)*15,u=`hsl(${y}, ${d}%, ${p}%)`,w=`hsl(${y}, ${d*.7}%, ${p+5}%)`,g=`hsl(${y}, ${d*.8}%, ${p-10}%)`;if(a-_e>20){const b=Math.random()*.5+.5,C=.4+Math.random()*1.2,E=i*(1+H*.02)*F,v=r*C*b*E,P=(Math.random()-.5)*20,z=(Math.random()-.5)*16,$=t+P,T=n+z;X.push({x:$,y:T,size:v,timestamp:a,pressure:b}),_e=a,X.length>20&&X.shift()}X.forEach(b=>{const C=a-b.timestamp;if(C<1500){const E=C/1500,v=(1-E)*b.pressure*.6,P=b.size*(1-E*.3);e.globalAlpha=v*.4,e.fillStyle=w,e.beginPath(),e.arc(b.x,b.y,P*1.5,0,2*Math.PI),e.fill(),e.globalAlpha=v*.8,e.fillStyle=u,e.beginPath(),e.arc(b.x,b.y,P,0,2*Math.PI),e.fill(),e.globalAlpha=v*.3,e.fillStyle=g,e.beginPath(),e.arc(b.x+1,b.y+1,P*.8,0,2*Math.PI),e.fill()}});const M=Math.sin(a/100)*.3+.7,L=r*M*i*(1+H*.02)*F;if(e.globalAlpha=.4,e.fillStyle=g,e.beginPath(),e.arc(t+2,n+2,L*.7,0,2*Math.PI),e.fill(),e.globalAlpha=.9,e.fillStyle=u,e.beginPath(),e.arc(t,n,L,0,2*Math.PI),e.fill(),Math.random()<.6){const b=Math.floor(Math.random()*8)+3;for(let C=0;C<b;C++){e.globalAlpha=.6,e.fillStyle=w;const E=t+(Math.random()-.5)*r*5,v=n+(Math.random()-.5)*r*4,P=Math.random()*5+1;e.beginPath(),e.arc(E,v,P,0,2*Math.PI),e.fill()}}X=X.filter(b=>a-b.timestamp<2e3),e.restore()}let Y=[],Re=0;function Ve(e,t,n,i,o,s){const a=Date.now(),r=Math.max(o,s)*.4*i;e.save();const m=[0,60,120,180,240,300],f=(m[Math.floor(Math.random()*m.length)]||0)+(Math.random()-.5)*30,l=`hsl(${f}, 100%, 70%)`,y=`hsl(${f+30}, 80%, 60%)`,d=`hsl(${f+60}, 90%, 90%)`,p=`hsl(${f-30}, 100%, 20%)`;if(a-Re>15){const g=["star","nebula","comet","blackhole"],M=g[Math.floor(Math.random()*g.length)],S=(Math.random()-.5)*8,L=(Math.random()-.5)*6,b=r*(.3+Math.random()*1.5);Y.push({x:t,y:n,size:b,velocityX:S,velocityY:L,color:M==="star"?d:M==="nebula"?y:M==="comet"?l:p,type:M,timestamp:a,life:1}),Re=a,Y.length>30&&Y.shift()}Y.forEach(g=>{if(g.velocityX*=.98,g.velocityY*=.98,g.x+=g.velocityX,g.y+=g.velocityY,g.life-=.02,g.life<=0)return;const M=g.life,S=g.size*g.life;switch(e.globalAlpha=M,g.type){case"star":{const L=Math.sin(a/100+g.timestamp)*.3+.7;e.fillStyle=g.color,e.beginPath(),e.arc(g.x,g.y,S*L,0,2*Math.PI),e.fill(),e.strokeStyle=g.color,e.lineWidth=2;for(let b=0;b<4;b++){const C=b*Math.PI/2+a/1e3,E=S*2;e.beginPath(),e.moveTo(g.x,g.y),e.lineTo(g.x+Math.cos(C)*E,g.y+Math.sin(C)*E),e.stroke()}break}case"nebula":e.fillStyle=g.color,e.beginPath(),e.arc(g.x,g.y,S*2,0,2*Math.PI),e.fill(),e.globalAlpha=M*.5,e.fillStyle=y,e.beginPath(),e.arc(g.x,g.y,S*3,0,2*Math.PI),e.fill();break;case"comet":{e.fillStyle=g.color,e.beginPath(),e.arc(g.x,g.y,S,0,2*Math.PI),e.fill();const L=S*4,b=Math.atan2(g.velocityY,g.velocityX);e.strokeStyle=g.color,e.lineWidth=S/2,e.lineCap="round",e.beginPath(),e.moveTo(g.x,g.y),e.lineTo(g.x-Math.cos(b)*L,g.y-Math.sin(b)*L),e.stroke();break}case"blackhole":{e.fillStyle=p,e.beginPath(),e.arc(g.x,g.y,S,0,2*Math.PI),e.fill(),e.globalAlpha=M*.7,e.strokeStyle=l,e.lineWidth=3,e.beginPath(),e.arc(g.x,g.y,S*1.5,0,2*Math.PI),e.stroke(),e.globalAlpha=M*.4,e.beginPath(),e.arc(g.x,g.y,S*.8,0,2*Math.PI),e.stroke();break}}});const u=Math.sin(a/150)*.4+.6,w=r*u;if(e.globalAlpha=.3,e.fillStyle=l,e.beginPath(),e.arc(t,n,w*4,0,2*Math.PI),e.fill(),e.globalAlpha=.9,e.fillStyle=d,e.beginPath(),e.arc(t,n,w,0,2*Math.PI),e.fill(),Math.random()<.1){const g=w*3;for(let M=0;M<12;M++){const S=M*Math.PI*2/12,L=t+Math.cos(S)*g,b=n+Math.sin(S)*g;e.globalAlpha=.8,e.fillStyle=l,e.beginPath(),e.arc(L,b,4,0,2*Math.PI),e.fill()}}Y=Y.filter(g=>g.life>0),e.restore()}function qe(e,t,n,i){const o=Math.floor(i/10);for(let s=0;s<o;s++){const a=Math.PI*2*s/o,r=i*(.8+Math.random()*.4),m=t+Math.cos(a)*r,c=n+Math.sin(a)*r,f=2+Math.random()*4;e.save(),e.globalAlpha=.6+Math.random()*.4,e.fillStyle="white",e.beginPath(),e.arc(m,c,f,0,2*Math.PI),e.fill(),e.restore()}}function Ue(e,t,n){const i=e.getBoundingClientRect();return{x:t-i.left,y:n-i.top}}function be(e){const t=window.visualViewport,n=t?t.width:window.innerWidth,i=t?t.height:window.innerHeight,o=window.devicePixelRatio||1;e.width=Math.max(1,Math.floor(n*o)),e.height=Math.max(1,Math.floor(i*o)),e.style.width=n+"px",e.style.height=i+"px",console.log("Canvas resized to HD:",e.width,"x",e.height,"devicePixelRatio:",o),h&&(h.scale(o,o),h.lineCap="round",h.lineJoin="round",h.strokeStyle="#111",ue(e))}function It(e){if(h=e.getContext("2d",{alpha:!0,antialias:!0,willReadFrequently:!1}),console.log("Canvas context created:",!!h,"Canvas element:",!!e),!h){console.error("Failed to get 2D context!");return}h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.lineCap="round",h.lineJoin="round",h.strokeStyle="#111",ue(e),console.log("Canvas context initialized successfully")}function ue(e){if(!h){console.error("Cannot clear canvas - no context!");return}U=[],j=[],X=[],Y=[],console.log("Clearing canvas, size:",e.width,"x",e.height);const t=h.createLinearGradient(0,0,e.width,e.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(.5,"#16213e"),t.addColorStop(1,"#0f3460"),h.fillStyle=t,h.fillRect(0,0,e.width,e.height),h.fillStyle="rgba(255, 255, 255, 0.3)";for(let n=0;n<50;n++){const i=Math.random()*e.width,o=Math.random()*e.height,s=Math.random()*2+1;h.beginPath(),h.arc(i,o,s,0,2*Math.PI),h.fill()}h.lineWidth=10,console.log("Canvas cleared and background drawn")}function je(e){console.log("Pointer Event Debug:",{pointerType:e.pointerType,pressure:e.pressure,width:e.width,height:e.height,pointerId:e.pointerId,isPrimary:e.isPrimary,timeStamp:e.timeStamp})}function Ft(e){e.addEventListener("touchstart",n=>n.preventDefault(),{passive:!1}),e.addEventListener("touchmove",n=>n.preventDefault(),{passive:!1}),e.addEventListener("touchend",n=>n.preventDefault(),{passive:!1}),e.addEventListener("pointerdown",n=>{if(n.pointerType==="pen"&&je(n),K||B===2&&Me)return;const i=n.pointerType==="pen",o=n.pointerType==="touch";n.pointerType;let s=n.pressure!==void 0?n.pressure:.5;i&&(s=Math.max(.1,Math.min(1,s)),console.log("Apple Pencil detected - pressure:",s)),e.setPointerCapture(n.pointerId),K=!0,B===2&&(Me=!0),ie=[];const{x:a,y:r}=Ue(e,n.clientX,n.clientY);let m=O(n.width||1,n.height||1);if(i?m*=.3+s*.7:o&&(m*=.5+s*.5),ie.push({x:a,y:r,t:n.timeStamp}),St(),h){const c=n.width||1,f=n.height||1;let l,y,d;re?(l=45,y=45,d=1):(l=Math.max(c,30),y=Math.max(f,30),d=c>1||f>1?1.2:1);const p=l*m*d,u=y*m*d,w=Math.max(p,u),g=ee.getCurrentStyleIndex();if(g===1)if(W){h.save(),h.globalCompositeOperation="destination-out";const M=Math.max(p,u)*3;h.fillStyle="rgba(0, 0, 0, 1)",h.beginPath(),h.arc(a,r,M,0,2*Math.PI),h.fill(),h.restore()}else{const S=O(p,u)*(1+H*.3)*F;Oe(h,a,r,S,p,u)}else if(g===2)if(W){h.save(),h.globalCompositeOperation="destination-out";const M=Math.max(p,u)*3;h.fillStyle="rgba(0, 0, 0, 1)",h.beginPath(),h.arc(a,r,M,0,2*Math.PI),h.fill(),h.restore()}else{const M=O(p,u);De(h,a,r,M,p,u)}else if(g===3)if(W){h.save(),h.globalCompositeOperation="destination-out";const M=Math.max(p,u)*3;h.fillStyle="rgba(0, 0, 0, 1)",h.beginPath(),h.arc(a,r,M,0,2*Math.PI),h.fill(),h.restore()}else{const M=O(p,u);xe(h,a,r,M,p,u)}else if(g===4)if(W){h.save(),h.globalCompositeOperation="destination-out";const M=Math.max(p,u)*3;h.fillStyle="rgba(0, 0, 0, 1)",h.beginPath(),h.arc(a,r,M,0,2*Math.PI),h.fill(),h.restore()}else{const M=O(p,u);Be(h,a,r,M,p,u)}else if(g===5)if(W){h.save(),h.globalCompositeOperation="destination-out";const M=Math.max(p,u)*3;h.fillStyle="rgba(0, 0, 0, 1)",h.beginPath(),h.arc(a,r,M,0,2*Math.PI),h.fill(),h.restore()}else{const M=O(p,u)*(1+H*.01);Ve(h,a,r,M,p,u)}else{h.save(),h.globalAlpha=.8,console.log("Drawing dot at:",a,r,"size:",p,"x",u,"pressure:",s);const M=1+Math.sin(Date.now()/200)*.1,S=W?3:1,L=p/2*M*S,b=u/2*M*S;if(W?(h.globalCompositeOperation="destination-out",h.fillStyle="rgba(0, 0, 0, 1)"):(h.globalCompositeOperation="source-over",h.fillStyle=oe()),W){const C=h.createRadialGradient(a,r,0,a,r,Math.max(L,b));C.addColorStop(0,"rgba(0, 0, 0, 1)"),C.addColorStop(.7,"rgba(0, 0, 0, 0.8)"),C.addColorStop(1,"rgba(0, 0, 0, 0.6)"),h.fillStyle=C}else{const C=h.createRadialGradient(a,r,0,a,r,Math.max(L,b));C.addColorStop(0,oe()),C.addColorStop(.7,oe()),C.addColorStop(1,oe()),h.fillStyle=C}h.beginPath(),h.ellipse(a,r,L,b,0,0,2*Math.PI),h.fill(),h.restore(),w>20&&qe(h,a,r,w)}}else console.error("Canvas context is null! Cannot draw.")}),e.addEventListener("pointermove",n=>{if(n.pointerType==="pen"&&K&&je(n),!K)return;const{x:i,y:o}=Ue(e,n.clientX,n.clientY),s=ie[ie.length-1],a=Math.max(.001,n.timeStamp-s.t),r=i-s.x,m=o-s.y,c=Math.hypot(r,m)/a,f=n.pointerType==="pen",l=n.pointerType==="touch";n.pointerType;let y=n.pressure!==void 0?n.pressure:.5;f&&(y=Math.max(.1,Math.min(1,y)));let d=O(n.width||1,n.height||1);if(f?d*=.3+y*.7:l&&(d*=.5+y*.5),ie.push({x:i,y:o,t:n.timeStamp,speed:c}),!h)return;const p=Math.hypot(i-s.x,o-s.y);let u;f?u=B===2?.5:.8:u=B===2?1:re?.8:1.5;const w=Math.max(1,Math.ceil(p/u));let g;f?g=B===2?3:3.5:g=B===2||re?2.5:2;const M=Math.max(3,Math.ceil(w*g)),S=n.width||1,L=n.height||1;let b,C,E;re?(b=45,C=45,E=1):(b=Math.max(S,30),C=Math.max(L,30),E=S>1||L>1?1.2:1);const v=b*d*E,P=C*d*E;h.save(),h.globalAlpha=.8;for(let z=0;z<=M;z++){const $=z/M,T=s.x+(i-s.x)*$,k=s.y+(o-s.y)*$,x=ee.getCurrentStyleIndex();if(x===1){const ce=O(v,P)*(1+H*.3)*F;Oe(h,T,k,ce,v,P)}else if(x===2){const I=O(v,P);De(h,T,k,I,v,P)}else if(x===3){const I=O(v,P);xe(h,T,k,I,v,P)}else if(x===4){const I=O(v,P);Be(h,T,k,I,v,P)}else if(x===5){const I=O(v,P)*(1+H*.01);Ve(h,T,k,I,v,P)}else{let I;f?I=.98+Math.random()*.04:I=.95+Math.random()*.1;const ce=1+Math.sin((Date.now()+z*40)/160)*.03,Je=v/2*I*ce,Qe=P/2*I*ce;if(W?(h.globalCompositeOperation="source-over",h.fillStyle="#151E35"):(h.globalCompositeOperation="source-over",h.fillStyle=oe()),h.beginPath(),h.ellipse(T,k,Je,Qe,0,0,2*Math.PI),h.fill(),Math.max(v,P)>15){let fe;f?fe=.4:fe=.2,Math.random()<fe&&(h.save(),h.globalAlpha=.4,qe(h,T,k,Math.max(v,P)/3),h.restore())}}}h.restore()});const t=n=>{if(K){K=!1,B===2&&(Me=!1),e.releasePointerCapture(n.pointerId);try{if(A&&A.state!=="suspended"){const i=A.createOscillator(),o=A.createGain();i.connect(o),o.connect(A.destination),i.frequency.setValueAtTime(400,A.currentTime),i.frequency.exponentialRampToValueAtTime(200,A.currentTime+.2),o.gain.setValueAtTime(.15,A.currentTime),o.gain.exponentialRampToValueAtTime(.01,A.currentTime+.2),i.start(A.currentTime),i.stop(A.currentTime+.2)}}catch(i){console.log("End sound failed:",i)}}};e.addEventListener("pointerup",t),e.addEventListener("pointercancel",t),e.addEventListener("pointerleave",t)}let A=null,he=!1;function Ge(){if(!he)try{A=new(window.AudioContext||window.webkitAudioContext),he=!0,console.log("Audio context initialized")}catch(e){console.log("Audio not supported"),console.log("Audio not supported",e),he=!0}}function Ne(){(!A||A.state==="suspended")&&A?.resume();try{if(!A)return;const e=A.createOscillator(),t=A.createGain();e.connect(t),t.connect(A.destination),e.frequency.setValueAtTime(400,A.currentTime),e.frequency.exponentialRampToValueAtTime(800,A.currentTime+.2),e.frequency.exponentialRampToValueAtTime(600,A.currentTime+.4),e.frequency.exponentialRampToValueAtTime(900,A.currentTime+.6),t.gain.setValueAtTime(.2,A.currentTime),t.gain.exponentialRampToValueAtTime(.4,A.currentTime+.2),t.gain.exponentialRampToValueAtTime(.2,A.currentTime+.4),t.gain.exponentialRampToValueAtTime(.01,A.currentTime+.6),e.start(A.currentTime),e.stop(A.currentTime+.6)}catch(e){console.log("Audio playback failed:",e)}}function $t(){(!A||A.state==="suspended")&&A?.resume();try{if(!A)return;const e=A.createOscillator(),t=A.createGain();e.connect(t),t.connect(A.destination),e.frequency.setValueAtTime(300,A.currentTime),e.frequency.exponentialRampToValueAtTime(1500,A.currentTime+.3),t.gain.setValueAtTime(.3,A.currentTime),t.gain.exponentialRampToValueAtTime(.01,A.currentTime+.3),e.start(A.currentTime),e.stop(A.currentTime+.3)}catch(e){console.log("Audio playback failed:",e)}}function Ae(){he||(Ge(),Ne())}document.addEventListener("click",Ae);document.addEventListener("touchstart",Ae);document.addEventListener("keydown",Ae);Ge();function Ot(){const e=document.getElementById("info-popup");e&&(e.style.display="block")}function Ke(){const e=document.getElementById("info-popup");e&&(e.style.display="none")}window.showInfoPopup=Ot;window.hideInfoPopup=Ke;document.addEventListener("click",e=>{const t=document.getElementById("info-popup");t&&e.target===t&&Ke()});let _={baseHue:216,saturation:90,lightness:50};function Xe(){const e=Math.floor(Math.random()*360),t=[70,75,80,85,90,95,100],n=t[Math.floor(Math.random()*t.length)],i=[40,45,50,55,60],o=i[Math.floor(Math.random()*i.length)],s=Math.random()*.6+.4,a=Math.random()*3+1,r=Math.floor(Math.random()*12)+4,m=Math.random()*.8+.2,c=Math.random()*.3+.1,f=Math.random()*2+.8;_={baseHue:e,saturation:n,lightness:o,sparkleIntensity:s,sparkleSize:a,sparkleCount:r,glowIntensity:m,pulseSpeed:c,sizeMultiplier:f},console.log(`Generated aggressive pen style: hsl(${e}, ${n}%, ${o}%) - Intensity: ${s.toFixed(2)}`)}function Wt(){const e=document.getElementById("app-canvas");if(console.log("Init function called, canvas found:",!!e),!e){console.error("Canvas element not found!");return}console.log("Device capabilities:",{maxTouchPoints:window.navigator.maxTouchPoints,hasPointerEvents:"PointerEvent"in window}),document.addEventListener("contextmenu",d=>d.preventDefault()),document.addEventListener("selectstart",d=>d.preventDefault()),document.addEventListener("dragstart",d=>d.preventDefault()),document.addEventListener("gesturestart",d=>d.preventDefault()),document.addEventListener("gesturechange",d=>d.preventDefault()),document.addEventListener("gestureend",d=>d.preventDefault()),e.addEventListener("contextmenu",d=>d.preventDefault()),e.addEventListener("selectstart",d=>d.preventDefault()),e.addEventListener("dragstart",d=>d.preventDefault()),e.style.touchAction="none",e.style.webkitTouchCallout="none",e.style.webkitUserSelect="none",e.style.userSelect="none",console.log("Initializing canvas context..."),It(e),console.log("Canvas context initialized, ctx:",!!h),be(e),h&&e&&(ue(e),console.log("Canvas fully initialized and cleared"));const t=()=>be(e);window.addEventListener("resize",t),window.addEventListener("orientationchange",t),window.visualViewport?.addEventListener("resize",t),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&be(e)}),console.log("Attaching pointer handlers..."),Ft(e),console.log("Pointer handlers attached"),setTimeout(()=>{const d=document.getElementById("splash-screen");d&&($t(),d.classList.add("fade-out"),setTimeout(()=>{d.style.display="none";const p=document.querySelector(".one-front-credit");p&&p.classList.add("show")},300))},300),setTimeout(()=>{Ne()},200);const n=document.getElementById("style-selector");if(n){const d=()=>{ee.nextStyle();const u=ee.getCurrentStyle();n.textContent=u.icon,n.style.color="white",console.log(`🎨 Switched to ${u.name} style: ${u.description}`),console.log(`🎯 Style index: ${ee.getCurrentStyleIndex()}`),n.title=`Current: ${u.name}
Tap to switch drawing style`};n.addEventListener("click",d),n.addEventListener("touchstart",u=>{u.preventDefault(),d()}),n.addEventListener("touchend",u=>{u.preventDefault()});const p=ee.getCurrentStyle();n.textContent=p.icon,n.style.color="white",n.title=`Current: ${p.name}
Tap to switch drawing style`}const i=document.getElementById("style-switch");if(i){const d=()=>{Xe(),H=Math.floor(Math.random()*5);const u=Math.floor(Math.random()*360);i.style.color=`hsl(${u}, 85%, 55%)`,console.log(`Generated new random style and changed to ${["tiny","small","medium","large","huge"][H]} size!`)};i.addEventListener("click",d),i.addEventListener("touchstart",u=>{u.preventDefault(),d()}),i.addEventListener("touchend",u=>{u.preventDefault()}),Xe();const p=Math.floor(Math.random()*360);i.style.color=`hsl(${p}, 85%, 55%)`}const o=document.getElementById("thickness-slider"),s=document.getElementById("vibration-knob"),a=document.getElementById("thickness-value");if(console.log("Thickness slider found:",!!o),o){const d=()=>{F=parseFloat(o.value),console.log("🎯 Thickness changed to:",F,"Slider value:",o.value),a&&(a.textContent=o.value),h&&e&&console.log("🔄 Thickness updated, next draw will use:",F)};o.addEventListener("input",d),o.addEventListener("change",d),F=parseFloat(o.value),console.log("🎯 Initial thickness:",F),a&&(a.textContent=o.value);const p=O(1,1);console.log("🧪 Test size calculation with thickness",F,":",p)}else console.error("Thickness slider not found!");let r=1;const m=()=>{s&&(r=parseFloat(s.value)),window.vibrationIntensity=r};s?.addEventListener("input",m),m();const c=d=>{if(!o)return;const p=parseFloat(o.value),u=parseFloat(o.step)||.2,w=parseFloat(o.min)||.2,g=parseFloat(o.max)||5;if(d.key==="ArrowLeft"||d.key==="ArrowDown"){const M=Math.max(w,p-u);o.value=M.toString(),F=M,console.log("🎯 Thickness decreased to:",M)}else if(d.key==="ArrowRight"||d.key==="ArrowUp"){const M=Math.min(g,p+u);o.value=M.toString(),F=M,console.log("🎯 Thickness increased to:",M)}};document.addEventListener("keydown",c);const f=document.getElementById("eraser");if(f){const d=()=>{W=!W,W?(f.style.backgroundColor="rgba(255, 255, 255, 0.2)",f.style.border="2px solid rgba(255, 255, 255, 0.5)",console.log("Eraser mode activated! 🧽")):(f.style.backgroundColor="transparent",f.style.border="none",console.log("Drawing mode activated! ✏️"))};f.addEventListener("click",d),f.addEventListener("touchstart",p=>{p.preventDefault(),d()}),f.addEventListener("touchend",p=>{p.preventDefault()})}const l=document.getElementById("clear-canvas");if(l){const d=()=>{h&&e&&(ue(e),console.log("Canvas cleared! ✨"))};l.addEventListener("click",d),l.addEventListener("touchstart",d),l.addEventListener("touchend",d)}function y(d){B=d,console.log(`Switched to Style ${d}`),document.querySelectorAll(".style-button").forEach((p,u)=>{p.classList.toggle("active",u===d-1)})}document.getElementById("style-1")?.addEventListener("click",()=>y(1)),document.getElementById("style-2")?.addEventListener("click",()=>y(2)),document.getElementById("style-3")?.addEventListener("click",()=>y(3))}document.addEventListener("DOMContentLoaded",Wt);export{Ye as W,tt as _,Pe as r};
