(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const dt="modulepreload",ut=function(e){return"/vibe-drawing/"+e},He={},ft=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){let u=function(r){return Promise.all(r.map(d=>Promise.resolve(d).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");o=u(n.map(r=>{if(r=ut(r),r in He)return;He[r]=!0;const d=r.endsWith(".css"),c=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${c}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":dt,d||(m.as="script"),m.crossOrigin="",m.href=r,l&&m.setAttribute("nonce",l),document.head.appendChild(m),d)return new Promise((S,f)=>{m.addEventListener("load",S),m.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${r}`)))})}))}function a(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return o.then(s=>{for(const l of s||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})};function We(){return typeof navigator<"u"&&"vibrate"in navigator}const gt="vibe.flags",De={hapticsEnabled:!0,debug:!1};function mt(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function pt(){if(typeof window>"u")return{...De};const e=mt(localStorage.getItem(gt));return{...De,...e}}let Mt=pt();function qe(e){return Mt[e]}let Q=null,ne=null,ee=null;function Re(e=.5){try{if(Q||(Q=new(window.AudioContext||window.webkitAudioContext)),!Q||ne)return;ne=Q.createOscillator(),ee=Q.createGain(),ne.type="square",ne.frequency.value=85,ee.gain.value=Math.min(1,Math.max(.05,e)),ne.connect(ee),ee.connect(Q.destination),ne.start()}catch{}}function Ae(e=.5){if(!ee||!Q)return;const t=Math.min(1,Math.max(.05,e));try{ee.gain.exponentialRampToValueAtTime(t,Q.currentTime+.05)}catch{ee.gain.value=t}}/*! Capacitor: https://capacitorjs.com/ - MIT License */var ae;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(ae||(ae={}));class we extends Error{constructor(t,n,i){super(t),this.message=t,this.code=n,this.data=i}}const yt=e=>{var t,n;return e?.androidBridge?"android":!((n=(t=e?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},bt=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},i=n.Plugins=n.Plugins||{},o=()=>t!==null?t.name:yt(e),a=()=>o()!=="web",s=c=>{const m=r.get(c);return!!(m?.platforms.has(o())||l(c))},l=c=>{var m;return(m=n.PluginHeaders)===null||m===void 0?void 0:m.find(S=>S.name===c)},u=c=>e.console.error(c),r=new Map,d=(c,m={})=>{const S=r.get(c);if(S)return console.warn(`Capacitor plugin "${c}" already registered. Cannot register plugins twice.`),S.proxy;const f=o(),M=l(c);let P;const g=async()=>(!P&&f in m?P=typeof m[f]=="function"?P=await m[f]():P=m[f]:t!==null&&!P&&"web"in m&&(P=typeof m.web=="function"?P=await m.web():P=m.web),P),p=(C,v)=>{var L,$;if(M){const _=M?.methods.find(x=>v===x.name);if(_)return _.rtype==="promise"?x=>n.nativePromise(c,v.toString(),x):(x,R)=>n.nativeCallback(c,v.toString(),x,R);if(C)return(L=C[v])===null||L===void 0?void 0:L.bind(C)}else{if(C)return($=C[v])===null||$===void 0?void 0:$.bind(C);throw new we(`"${c}" plugin is not implemented on ${f}`,ae.Unimplemented)}},b=C=>{let v;const L=(...$)=>{const _=g().then(x=>{const R=p(x,C);if(R){const B=R(...$);return v=B?.remove,B}else throw new we(`"${c}.${C}()" is not implemented on ${f}`,ae.Unimplemented)});return C==="addListener"&&(_.remove=async()=>v()),_};return L.toString=()=>`${C.toString()}() { [capacitor code] }`,Object.defineProperty(L,"name",{value:C,writable:!1,configurable:!1}),L},w=b("addListener"),y=b("removeListener"),E=(C,v)=>{const L=w({eventName:C},v),$=async()=>{const x=await L;y({eventName:C,callbackId:x},v)},_=new Promise(x=>L.then(()=>x({remove:$})));return _.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await $()},_},T=new Proxy({},{get(C,v){switch(v){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return M?E:w;case"removeListener":return y;default:return b(v)}}});return i[c]=T,r.set(c,{name:c,proxy:T,platforms:new Set([...Object.keys(m),...M?[f]:[]])}),T};return n.convertFileSrc||(n.convertFileSrc=c=>c),n.getPlatform=o,n.handleError=u,n.isNativePlatform=a,n.isPluginAvailable=s,n.registerPlugin=d,n.Exception=we,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},St=e=>e.Capacitor=bt(e),be=St(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),ke=be.registerPlugin;class Qe{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let i=!1;this.listeners[t]||(this.listeners[t]=[],i=!0),this.listeners[t].push(n);const a=this.windowListeners[t];a&&!a.registered&&this.addWindowListener(a),i&&this.sendRetainedArgumentsForEvent(t);const s=async()=>this.removeListener(t,n);return Promise.resolve({remove:s})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,i){const o=this.listeners[t];if(!o){if(i){let a=this.retainedEventArguments[t];a||(a=[]),a.push(n),this.retainedEventArguments[t]=a}return}o.forEach(a=>a(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:i=>{this.notifyListeners(n,i)}}}unimplemented(t="not implemented"){return new be.Exception(t,ae.Unimplemented)}unavailable(t="not available"){return new be.Exception(t,ae.Unavailable)}async removeListener(t,n){const i=this.listeners[t];if(!i)return;const o=i.indexOf(n);this.listeners[t].splice(o,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(i=>{this.notifyListeners(t,i)}))}}const Be=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Oe=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class wt extends Qe{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(i=>{if(i.length<=0)return;let[o,a]=i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");o=Oe(o).trim(),a=Oe(a).trim(),n[o]=a}),n}async setCookie(t){try{const n=Be(t.key),i=Be(t.value),o=`; expires=${(t.expires||"").replace("expires=","")}`,a=(t.path||"/").replace("path=",""),s=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${i||""}${o}; path=${a}; ${s};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}ke("CapacitorCookies",{web:()=>new wt});const vt=async e=>new Promise((t,n)=>{const i=new FileReader;i.onload=()=>{const o=i.result;t(o.indexOf(",")>=0?o.split(",")[1]:o)},i.onerror=o=>n(o),i.readAsDataURL(e)}),Pt=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(o=>o.toLocaleLowerCase()).reduce((o,a,s)=>(o[a]=e[t[s]],o),{})},Ct=(e,t=!0)=>e?Object.entries(e).reduce((i,o)=>{const[a,s]=o;let l,u;return Array.isArray(s)?(u="",s.forEach(r=>{l=t?encodeURIComponent(r):r,u+=`${a}=${l}&`}),u.slice(0,-1)):(l=t?encodeURIComponent(s):s,u=`${a}=${l}`),`${i}&${u}`},"").substr(1):null,Et=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),o=Pt(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){const a=new URLSearchParams;for(const[s,l]of Object.entries(e.data||{}))a.set(s,l);n.body=a.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){const a=new FormData;if(e.data instanceof FormData)e.data.forEach((l,u)=>{a.append(u,l)});else for(const l of Object.keys(e.data))a.append(l,e.data[l]);n.body=a;const s=new Headers(n.headers);s.delete("content-type"),n.headers=s}else(o.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class Lt extends Qe{async request(t){const n=Et(t,t.webFetchExtra),i=Ct(t.params,t.shouldEncodeUrlParams),o=i?`${t.url}?${i}`:t.url,a=await fetch(o,n),s=a.headers.get("content-type")||"";let{responseType:l="text"}=a.ok?t:{};s.includes("application/json")&&(l="json");let u,r;switch(l){case"arraybuffer":case"blob":r=await a.blob(),u=await vt(r);break;case"json":u=await a.json();break;case"document":case"text":default:u=await a.text()}const d={};return a.headers.forEach((c,m)=>{d[m]=c}),{data:u,headers:d,status:a.status,url:a.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}ke("CapacitorHttp",{web:()=>new Lt});const ze=ke("NativeHaptics",{web:()=>({async start(){},async update(){},async stop(){}})});let te=null;(async()=>{try{te=(await ft(()=>import("./index-Bv1f0IQS.js"),[])).Haptics}catch{te=null}})();let ce=null,he=150,oe=22,se=!1,ge=!1,ue=.5;const fe=be.getPlatform();let Ze="medium",ve=!1;function At(e){const t=Math.max(0,Math.min(.25,0));return Math.max(.15,Math.min(1,t/.25))}function It(e){const t=Math.max(0,Math.min(1,.5));return Math.max(.1,Math.min(1,t))}function me(e,t){const n=At(),i=It();return Math.max(.1,Math.min(1,i*.6+n*.4))}function kt(e,t){const n=me();return Math.round(18+n*20)}function zt(e,t){const n=me();return Math.round(80-n*35)}function Tt(e,t){const n=me();return n>.7?"heavy":n>.4?"medium":"light"}function Ie(){if(fe!=="web"&&!ge)try{ze.update({intensity:ue});return}catch{}if(te){fe==="ios"?te.impact({style:Ze}).catch(e=>console.log(`iOS haptic failed: ${e}`)):fe==="android"?te.vibrate({duration:oe}).catch(e=>console.log(`Android haptic failed: ${e}`)):We()?navigator.vibrate(oe):se?Ae(oe/40):(se=!0,Re(.4));return}We()?navigator.vibrate(oe):se?Ae(oe/40):(se=!0,Re(.4))}function $t(){if(qe("hapticsEnabled")){if(ve){xt();return}if(se=!1,ge=!1,fe!=="web")try{ze.start({intensity:ue}),ge=!0,ve=!0;return}catch{}te&&fe==="ios"&&te.impact({style:"medium"}).catch(e=>console.log(`iOS pre-tap failed: ${e}`)),Ie(),ce=window.setInterval(Ie,he),ve=!0}}function xt(e,t){if(!qe("hapticsEnabled"))return;const n=me(),i=Math.abs(ue-n)>.05;if(ue=n,ge&&i)try{ze.update({intensity:ue});return}catch{ge=!1}if(i||!ce){oe=kt(),Ze=Tt();const o=zt();Math.abs(o-he)>2&&ce!=null?(he=o,window.clearInterval(ce),ce=window.setInterval(Ie,he)):he=o}se&&Ae(me())}class Ft{constructor(){this.name="Particle",this.description="Smooth particle-based drawing with haptic feedback",this.icon="1",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.previousPoint=null}onStart(t,n){console.log("🎨 Particle style started"),this.previousPoint=t}onMove(t,n){console.log("🎨 ParticleStyle.onMove called");const{ctx:i,isEraserMode:o,thicknessMultiplier:a,currentSizeLevel:s,sizeMultipliers:l,isWebApp:u}=n;this.previousPoint&&(i.save(),i.globalCompositeOperation="source-over",t.forEach((r,d)=>{if(!this.previousPoint)return;const c=(r.t-this.previousPoint.t)/16;if(c<=0)return;this.calculateSizeMultiplier(r,n);const m=this.previousPoint.x+(r.x-this.previousPoint.x)*c,S=this.previousPoint.y+(r.y-this.previousPoint.y)*c,f=r.width||1,M=r.height||1,P=.95+Math.random()*.1,g=1+Math.sin((Date.now()+d*40)/160)*.03,p=f/2*P*g,b=M/2*P*g;if(o)i.fillStyle="#151E35";else{const y=1+Math.sin(c*Math.PI)*.12;i.fillStyle=this.getCurrentColor(y)}i.beginPath(),i.ellipse(m,S,p,b,0,0,2*Math.PI),i.fill(),Math.max(f,M)>15&&Math.random()<.2&&(i.save(),i.globalAlpha=.4,this.addSparkleEffect(i,m,S,Math.max(f,M)/3),i.restore()),this.previousPoint=r}),i.restore())}onEnd(t){console.log("🎨 Particle style ended")}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:a,thicknessMultiplier:s}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(a[o]||1)*s;{const d=Math.max(0,Math.min(1,(l-5)/95));let c;(t.width||0)===0||(t.height||0)===0?c=.2:c=.1+d*.2;const m=.98+Math.random()*.04,S=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+c*m*this.sizeSmoothingFactor;return this.lastSizeMultiplier=S,S*s}}getCurrentColor(t){const n=Date.now()*.001,i=window.randomStyleParams?.baseHue||216;window.randomStyleParams?.cycleSpeed;const o=(Math.random()-.5)*60,a=(Math.random()-.5)*15+Math.sin(n*2)*5,s=(Math.random()-.5)*20+Math.sin(n*1.5)*8,l=(i+o+360)%360,u=Math.max(70,Math.min(100,(window.randomStyleParams?.saturation||90)+a)),r=Math.max(35,Math.min(75,(window.randomStyleParams?.lightness||50)+s));return`hsl(${l}, ${u}%, ${r}%)`}addSparkleEffect(t,n,i,o){const a=3+Math.floor(Math.random()*3);for(let s=0;s<a;s++){const l=Math.PI*2*s/a+Math.random()*.5,u=o*(.5+Math.random()*.5),r=n+Math.cos(l)*u,d=i+Math.sin(l)*u,c=o*.1*(.5+Math.random()*.5);t.fillStyle=`rgba(255, 255, 255, ${.6+Math.random()*.4})`,t.beginPath(),t.arc(r,d,c,0,2*Math.PI),t.fill()}}}class Ht{constructor(){this.name="Lava",this.description="Flowing lava lines that melt and drip",this.icon="2",this.lavaLines=[],this.currentLavaLine=null,this.animationId=null}onStart(t,n){console.log("🌋 Lava style started"),this.currentLavaLine={points:[],startTime:Date.now(),isMelting:!1,meltProgress:0},this.addPointToLavaLine(t,n)}onMove(t,n){const{ctx:i}=n;this.currentLavaLine&&(t.forEach(o=>{this.addPointToLavaLine(o,n)}),this.drawLavaLines(n))}onEnd(t){console.log("🌋 Lava style ended"),this.currentLavaLine&&(this.currentLavaLine.isMelting=!0,this.lavaLines.push(this.currentLavaLine),this.currentLavaLine=null),this.animationId||this.startAnimation(context)}onClear(t){this.lavaLines=[],this.currentLavaLine=null,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}animate(t){this.drawLavaLines(t),this.lavaLines.forEach(n=>{n.isMelting&&(n.meltProgress+=.02,n.meltProgress>=1&&(n.meltProgress=1))}),this.lavaLines=this.lavaLines.filter(n=>n.meltProgress<1),this.lavaLines.length>0||this.currentLavaLine?this.animationId=requestAnimationFrame(()=>this.animate(t)):this.animationId=null}addPointToLavaLine(t,n){if(!this.currentLavaLine)return;const i={x:t.x,y:t.y,sizeMultiplier:this.calculateSizeMultiplier(t,n),touchWidth:t.width||1,touchHeight:t.height||1,time:t.t};this.currentLavaLine.points.push(i)}drawLavaLines(t){const{ctx:n,isEraserMode:i}=t;n.save(),this.currentLavaLine&&this.drawLavaLine(this.currentLavaLine,t,!1),this.lavaLines.forEach(o=>{this.drawLavaLine(o,t,!0)}),n.restore()}drawLavaLine(t,n,i){const{ctx:o,isEraserMode:a}=n;if(t.points.length<2)return;o.save();const s=o.createLinearGradient(0,0,0,o.canvas.height);s.addColorStop(0,"#ff4500"),s.addColorStop(.5,"#ff6347"),s.addColorStop(1,"#ff8c00"),o.strokeStyle=a?"#151E35":s,o.lineCap="round",o.lineJoin="round",o.beginPath(),t.points.forEach((u,r)=>{r===0?o.moveTo(u.x,u.y):o.lineTo(u.x,u.y)});const l=i?Math.max(1,(t.points[0]?.sizeMultiplier||1)*20*(1-t.meltProgress)):(t.points[0]?.sizeMultiplier||1)*20;o.lineWidth=l,o.stroke(),a||(o.shadowColor="#ff4500",o.shadowBlur=10,o.stroke(),o.shadowBlur=0),i&&t.meltProgress>.3&&this.drawDrips(t,n),o.restore()}drawDrips(t,n){const{ctx:i,isEraserMode:o}=n;i.save();const a=Math.floor(t.meltProgress*5),s=o?"#151E35":"#ff6347";for(let l=0;l<a;l++){const u=t.points[Math.floor(Math.random()*t.points.length)];if(!u)continue;const r=20+Math.random()*30,d=u.sizeMultiplier*5;i.fillStyle=s,i.beginPath(),i.ellipse(u.x+(Math.random()-.5)*10,u.y+r,d,r,0,0,2*Math.PI),i.fill()}i.restore()}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:a,thicknessMultiplier:s}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(a[o]||1)*s;{const d=Math.max(0,Math.min(1,(l-5)/95));let c;return(t.width||0)===0||(t.height||0)===0?c=.2:c=.1+d*.2,c*s}}startAnimation(t){this.animate(t)}}class Wt{constructor(){this.name="Neon",this.description="Bright neon lines with glowing effects",this.icon="3",this.neonLines=[],this.currentLine=[],this.currentColor="#00ff00"}onStart(t,n){console.log("💡 Neon style started"),this.currentLine=[t],this.currentColor=this.getNeonColor()}onMove(t,n){const{ctx:i}=n;this.currentLine.push(...t),this.drawNeonLines(n)}onEnd(t){console.log("💡 Neon style ended"),this.currentLine.length>1&&this.neonLines.push({points:[...this.currentLine],color:this.currentColor,startTime:Date.now()}),this.currentLine=[]}onClear(t){this.neonLines=[],this.currentLine=[]}drawNeonLines(t){const{ctx:n,isEraserMode:i}=t;n.save(),this.currentLine.length>1&&this.drawNeonLine(this.currentLine,this.currentColor,t,!1),this.neonLines.forEach(o=>{this.drawNeonLine(o.points,o.color,t,!0)}),n.restore()}drawNeonLine(t,n,i,o){const{ctx:a,isEraserMode:s}=i;if(t.length<2)return;a.save();const l=s?"#151E35":n,u=s?"#151E35":this.getGlowColor(n);a.lineCap="round",a.lineJoin="round";for(let r=3;r>=1;r--){if(a.strokeStyle=u,!t[0])return;a.lineWidth=this.calculateLineWidth(t[0],i)*(r*2),a.globalAlpha=.1/r,a.beginPath(),t.forEach((d,c)=>{c===0?a.moveTo(d.x,d.y):a.lineTo(d.x,d.y)}),a.stroke()}if(a.strokeStyle=l,!!t[0]){if(a.lineWidth=this.calculateLineWidth(t[0],i),a.globalAlpha=1,a.beginPath(),t.forEach((r,d)=>{d===0?a.moveTo(r.x,r.y):a.lineTo(r.x,r.y)}),a.stroke(),!s){if(a.strokeStyle="#ffffff",!t[0])return;a.lineWidth=this.calculateLineWidth(t[0],i)*.3,a.globalAlpha=.8,a.stroke()}o&&!s&&Math.random()<.1&&this.addSparkles(t,n,i),a.restore()}}addSparkles(t,n,i){const{ctx:o}=i;o.save();const a=2+Math.floor(Math.random()*3);for(let s=0;s<a;s++){const l=t[Math.floor(Math.random()*t.length)],u=2+Math.random()*3;if(!l)return;const r=l.x+(Math.random()-.5)*20,d=l.y+(Math.random()-.5)*20;o.fillStyle="#ffffff",o.globalAlpha=.8,o.beginPath(),o.arc(r,d,u,0,2*Math.PI),o.fill(),o.fillStyle=n,o.globalAlpha=.3,o.beginPath(),o.arc(r,d,u*2,0,2*Math.PI),o.fill()}o.restore()}calculateLineWidth(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:a,thicknessMultiplier:s}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(a[o]||1)*s*15;{const d=Math.max(0,Math.min(1,(l-5)/95));let c;return(t.width||0)===0||(t.height||0)===0?c=.2:c=.1+d*.2,c*s*15}}getNeonColor(){const t=["#00ff00","#ff00ff","#00ffff","#ffff00","#ff0080","#0080ff","#ff8000","#8000ff"];return t[Math.floor(Math.random()*t.length)]||"#ff6b6b"}getGlowColor(t){return t}}class Dt{constructor(){this.name="Watercolor",this.description="Soft watercolor brush strokes with color blending",this.icon="4",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.brushStrokes=[]}onStart(t,n){console.log("🎨 Watercolor style started"),this.brushStrokes=[]}onMove(t,n){console.log("🎨 WatercolorStyle.onMove called");const{ctx:i,isEraserMode:o,thicknessMultiplier:a,currentSizeLevel:s,sizeMultipliers:l,isWebApp:u}=n;t.length<2||(i.save(),i.globalCompositeOperation=o?"destination-out":"multiply",t.forEach((r,d)=>{if(d===0)return;const c=t[d-1];if(!c)return;const m=(r.t-c.t)/16;if(m<=0)return;const S=this.calculateSizeMultiplier(r,n),f=c.x+(r.x-c.x)*m,M=c.y+(r.y-c.y)*m,P=r.width||1;r.height;const g=.8+Math.random()*.4,p=P/2*g*S;if(o)i.globalAlpha=.3,i.fillStyle="rgba(21, 30, 53, 0.3)";else{const w=1+Math.sin(m*Math.PI)*.15,y=this.getWatercolorColor(w);for(let E=0;E<3;E++){const T=(Math.random()-.5)*p*.5,C=(Math.random()-.5)*p*.5,v=p*(.7+Math.random()*.6),L=.1+Math.random()*.2;i.globalAlpha=L,i.fillStyle=y,i.beginPath(),i.arc(f+T,M+C,v,0,2*Math.PI),i.fill()}this.brushStrokes.push({x:f,y:M,size:p,color:y,opacity:.3})}}),i.restore())}onEnd(t){console.log("🎨 Watercolor style ended")}onClear(t){this.brushStrokes=[]}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:a,thicknessMultiplier:s}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .2*(a[o]||1)*s;{const d=Math.max(0,Math.min(1,(l-5)/95));let c;(t.width||0)===0||(t.height||0)===0?c=.25:c=.15+d*.25;const m=.95+Math.random()*.1,S=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+c*m*this.sizeSmoothingFactor;return this.lastSizeMultiplier=S,S*(a[o]||1)*s}}getWatercolorColor(t){const n=["#FFB3BA","#BAFFC9","#BAE1FF","#FFFFBA","#FFB3F7","#B3FFE6","#FFD4B3","#E6B3FF"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}}class Rt{constructor(){this.name="Chalk",this.description="Dusty chalk strokes with particle effects",this.icon="5",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.particles=[]}onStart(t,n){console.log("🎨 Chalk style started"),this.particles=[]}onMove(t,n){const{ctx:i,isEraserMode:o,thicknessMultiplier:a,currentSizeLevel:s,sizeMultipliers:l,isWebApp:u}=n;t.length<2||(i.save(),i.globalCompositeOperation="source-over",t.forEach((r,d)=>{if(d===0)return;const c=t[d-1];if(!c)return;const m=(r.t-c.t)/16;if(m<=0)return;const S=this.calculateSizeMultiplier(r,n),f=c.x+(r.x-c.x)*m,M=c.y+(r.y-c.y)*m,P=r.width||1;r.height;const g=.7+Math.random()*.6,p=P/2*g*S;if(o)i.globalAlpha=.8,i.fillStyle="#151E35";else{const w=1+Math.sin(m*Math.PI)*.1,y=this.getChalkColor(w);i.globalAlpha=.9,i.fillStyle=y,i.beginPath(),i.arc(f,M,p,0,2*Math.PI),i.fill();for(let E=0;E<5;E++){const T=f+(Math.random()-.5)*p*2,C=M+(Math.random()-.5)*p*2,v=Math.random()*p*.3;i.globalAlpha=.6,i.fillStyle=y,i.beginPath(),i.arc(T,C,v,0,2*Math.PI),i.fill(),this.particles.push({x:T,y:C,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,life:1,maxLife:1,color:y})}for(let E=0;E<3;E++){const T=f+(Math.random()-.5)*p,C=M+(Math.random()-.5)*p,v=Math.random()*p*.2;i.globalAlpha=.3,i.fillStyle=y,i.beginPath(),i.arc(T,C,v,0,2*Math.PI),i.fill()}}}),i.restore())}onEnd(t){console.log("🎨 Chalk style ended")}onClear(t){this.particles=[]}animate(t){const{ctx:n}=t;this.particles=this.particles.filter(i=>(i.x+=i.vx,i.y+=i.vy,i.vy+=.1,i.life-=.02,i.life>0?(n.save(),n.globalAlpha=i.life*.5,n.fillStyle=i.color,n.beginPath(),n.arc(i.x,i.y,1,0,2*Math.PI),n.fill(),n.restore(),!0):!1))}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:a,thicknessMultiplier:s}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .18*(a[o]||1)*s;{const d=Math.max(0,Math.min(1,(l-5)/95));let c;(t.width||0)===0||(t.height||0)===0?c=.22:c=.12+d*.2;const m=.9+Math.random()*.2,S=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+c*m*this.sizeSmoothingFactor;return this.lastSizeMultiplier=S,S*(a[o]||1)*s}}getChalkColor(t){const n=["#FFFFFF","#F0F0F0","#E8E8E8","#D0D0D0","#FFE4E1","#E6E6FA","#F0F8FF","#F5F5DC"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}}class Bt{constructor(){this.name="Glow",this.description="Bright neon strokes with glowing effects",this.icon="6",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.glowTrails=[]}onStart(t,n){console.log("🎨 Glow style started"),this.glowTrails=[]}onMove(t,n){const{ctx:i,isEraserMode:o,thicknessMultiplier:a,currentSizeLevel:s,sizeMultipliers:l,isWebApp:u}=n;t.length<2||(i.save(),i.globalCompositeOperation=o?"destination-out":"screen",t.forEach((r,d)=>{if(d===0)return;const c=t[d-1];if(!c)return;const m=(r.t-c.t)/16;if(m<=0)return;const S=this.calculateSizeMultiplier(r,n),f=c.x+(r.x-c.x)*m,M=c.y+(r.y-c.y)*m,P=r.width||1;r.height;const g=.9+Math.random()*.2,p=P/2*g*S;if(o)i.globalAlpha=.5,i.fillStyle="#151E35";else{const w=1+Math.sin(m*Math.PI)*.2,y=this.getGlowColor(w);i.globalAlpha=.3,i.fillStyle=y,i.beginPath(),i.arc(f,M,p*3,0,2*Math.PI),i.fill(),i.globalAlpha=.6,i.fillStyle=y,i.beginPath(),i.arc(f,M,p*2,0,2*Math.PI),i.fill(),i.globalAlpha=.9,i.fillStyle=y,i.beginPath(),i.arc(f,M,p,0,2*Math.PI),i.fill(),i.globalAlpha=1,i.fillStyle="#FFFFFF",i.beginPath(),i.arc(f,M,p*.3,0,2*Math.PI),i.fill(),this.glowTrails.push({x:f,y:M,size:p,color:y,life:1,maxLife:1}),Math.random()<.3&&this.addSparkle(i,f,M,y)}}),i.restore())}onEnd(t){console.log("🎨 Glow style ended")}onClear(t){this.glowTrails=[]}animate(t){const{ctx:n}=t;this.glowTrails=this.glowTrails.filter(i=>(i.life-=.03,i.life>0?(n.save(),n.globalCompositeOperation="screen",n.globalAlpha=i.life*.4,n.fillStyle=i.color,n.beginPath(),n.arc(i.x,i.y,i.size*2,0,2*Math.PI),n.fill(),n.restore(),!0):!1))}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:a,thicknessMultiplier:s}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .16*(a[o]||1)*s;{const d=Math.max(0,Math.min(1,(l-5)/95));let c;(t.width||0)===0||(t.height||0)===0?c=.2:c=.1+d*.18;const m=.95+Math.random()*.1,S=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+c*m*this.sizeSmoothingFactor;return this.lastSizeMultiplier=S,S*(a[o]||1)*s}}getGlowColor(t){const n=["#FF0080","#00FFFF","#FF00FF","#00FF00","#FFFF00","#FF8000","#8000FF","#00FF80"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}addSparkle(t,n,i,o){t.save(),t.globalAlpha=.8,t.fillStyle=o;for(let a=0;a<4;a++){const s=a*Math.PI/2,l=n+Math.cos(s)*10,u=i+Math.sin(s)*10;t.beginPath(),t.arc(l,u,2,0,2*Math.PI),t.fill()}t.restore()}}class Ot{constructor(){this.styles=[],this.currentStyleIndex=0,this.styles=[new Ft,new Ht,new Wt,new Dt,new Rt,new Bt],this.currentStyle=this.styles[0]}getCurrentStyle(){return this.currentStyle}getCurrentStyleIndex(){return this.currentStyleIndex}getAllStyles(){return this.styles}switchToStyle(t){t>=0&&t<this.styles.length&&(this.currentStyleIndex=t,this.currentStyle=this.styles[t],console.log(`🎨 Switched to style: ${this.currentStyle.name}`))}nextStyle(){const t=(this.currentStyleIndex+1)%this.styles.length;this.switchToStyle(t)}previousStyle(){const t=this.currentStyleIndex===0?this.styles.length-1:this.currentStyleIndex-1;this.switchToStyle(t)}onStart(t,n){this.currentStyle.onStart?.(t,n)}onMove(t,n){console.log(`🎯 StyleManager.onMove called for style: ${this.currentStyle.name}, points: ${t.length}`),this.currentStyle.onMove?.(t,n)}onEnd(t){this.currentStyle.onEnd?.(t)}onClear(t){this.currentStyle.onClear?.(t),this.styles.forEach(n=>{n!==this.currentStyle&&n.onClear?.(t)})}animate(t){this.currentStyle.animate?.(t),this.styles.forEach(n=>{n!==this.currentStyle&&n.animate&&n.animate(t)})}}console.log("🎨 Vibe Drawing app starting...");console.log("📍 Current location:",window.location.href);console.log("🌐 User agent:",navigator.userAgent);setTimeout(()=>{const e=document.getElementById("app"),t=document.getElementById("splash-screen");if(e&&t&&!e.querySelector("canvas")){console.log("⚠️ Main app failed to load, showing info popup"),t.style.display="none";const n=document.getElementById("info-popup");n&&(n.style.display="block")}},5e3);let h=null,ie=!1,re=[];const Y=new Ot,de=!("ontouchstart"in window)||window.navigator.maxTouchPoints===0;let O=2;const Pe=[.2,.4,.7,1,1.5];let Ve=.25;const Ke=.15;let D=1,j=!1,K=1,Ce=!1;function G(e,t){const n=Math.sqrt(e*t);if(de){const i=.15*(Pe[O]||1),o=i*D;return Math.random()<.01&&console.log("Web app size calculation:",{baseMultiplier:i,thicknessMultiplier:D,finalMultiplier:o}),o}else{const a=Math.max(0,Math.min(1,(n-5)/95));let s;e===0||t===0?s=.2:s=.1+a*.2;const l=.98+Math.random()*.04,u=Ve*(1-Ke)+s*l*Ke;Ve=u;const r=u*(Pe[O]||1)*D;return Math.random()<.01&&console.log("Size calculation:",{smoothedMultiplier:u,sizeLevel:Pe[O],thicknessMultiplier:D,finalMultiplier:r}),r}}function Vt(e){const t=Date.now()*.001,n=F.baseHue,i=F.cycleSpeed||8,o=Math.sin(t*i)*180,a=(Math.random()-.5)*40+o,s=(Math.random()-.5)*20+Math.sin(t*3)*10,l=(Math.random()-.5)*15+Math.sin(t*2.5)*8,u=(n+a+360)%360,r=Math.max(75,Math.min(100,F.saturation+s)),d=Math.max(40,Math.min(80,F.lightness+l));return`hsl(${u}, ${r}%, ${d}%)`}function le(e){return Vt()}function Kt(e,t,n,i,o,a){const s=Date.now(),l=Math.max(o,a)*.2*i;e.save();const r=(F.baseHue+120)%360,d=`hsl(${r}, 85%, 65%)`,c=`hsl(${r+60}, 80%, 70%)`,m=`hsl(${r-60}, 80%, 70%)`,S=`hsl(${r}, 90%, 80%)`,f=s*.004,M=l*i*(1+O*.05)*D;if(Math.random()<.3){const g=Math.sin(f)*.5,p=M*(.6+Math.sin(f*2)*.15);e.globalAlpha=.8,e.strokeStyle=c,e.lineWidth=2,e.lineCap="round",e.beginPath(),e.moveTo(t,n),e.lineTo(t+Math.cos(g)*p,n+Math.sin(g)*p),e.stroke(),e.strokeStyle=m,e.beginPath(),e.moveTo(t,n),e.lineTo(t+Math.cos(-g)*p,n+Math.sin(-g)*p),e.stroke(),e.globalAlpha=.9,e.fillStyle=d,e.beginPath(),e.arc(t,n,3,0,2*Math.PI),e.fill()}else{const g=Math.cos(f)*.4,p=M*(.4+Math.cos(f*1.5)*.15);e.globalAlpha=.8,e.strokeStyle=c,e.lineWidth=2,e.lineCap="round",e.beginPath(),e.moveTo(t+Math.cos(g)*p,n+Math.sin(g)*p),e.lineTo(t,n),e.stroke(),e.strokeStyle=m,e.beginPath(),e.moveTo(t+Math.cos(-g)*p,n+Math.sin(-g)*p),e.lineTo(t,n),e.stroke(),e.globalAlpha=.95,e.fillStyle=S,e.beginPath(),e.arc(t,n,4,0,2*Math.PI),e.fill()}Math.random()<.05&&(e.globalAlpha=.6,e.fillStyle="#ffffff",e.beginPath(),e.arc(t,n,M*.1,0,2*Math.PI),e.fill()),e.restore()}function _e(e,t,n,i,o,a){Kt(e,t,n,i,o,a)}function Ue(e,t,n,i,o,a){const s=Date.now(),l=Math.max(o,a)*.8*i;e.save();const r=(F.baseHue+180)%360,d=`hsl(${r}, 85%, 60%)`,c=`hsl(${r+60}, 80%, 70%)`,m=`hsl(${r-60}, 90%, 80%)`,S=`hsl(${r}, 95%, 90%)`,f=s*.004,M=s*.006,P=s*.003,g=l*i*(1+O*.3)*D;if(Math.random()<.4){const b=g*1.2,w=g*.5,y=20;e.globalAlpha=.9,e.strokeStyle=d,e.lineWidth=2.5,e.lineCap="round",e.lineJoin="round",e.beginPath();let E=!0;for(let C=0;C<=y;C++){const v=C/y,L=t+(v-.5)*b,$=n+Math.sin(f+v*Math.PI*4)*w*.6+Math.sin(M+v*Math.PI*6)*w*.3+Math.sin(P+v*Math.PI*2)*w*.1;E?(e.moveTo(L,$),E=!1):e.lineTo(L,$)}e.stroke(),e.globalAlpha=.8,e.strokeStyle=c,e.lineWidth=2,e.beginPath(),E=!0;for(let C=0;C<=y;C++){const v=C/y,L=t+(v-.5)*b,$=n+Math.sin(f+Math.PI/3+v*Math.PI*4)*w*.5+Math.sin(M+Math.PI/2+v*Math.PI*6)*w*.4+Math.sin(P+Math.PI/4+v*Math.PI*2)*w*.2;E?(e.moveTo(L,$),E=!1):e.lineTo(L,$)}e.stroke(),e.globalAlpha=.7,e.strokeStyle=m,e.lineWidth=1.5,e.beginPath(),E=!0;for(let C=0;C<=y;C++){const v=C/y,L=t+(v-.5)*b,$=n+Math.sin(f+Math.PI/6+v*Math.PI*3)*w*.4+Math.sin(M+Math.PI/3+v*Math.PI*5)*w*.3+Math.sin(P+Math.PI/2+v*Math.PI*7)*w*.3;E?(e.moveTo(L,$),E=!1):e.lineTo(L,$)}e.stroke();const T=[.2,.5,.8];for(const C of T){const v=t+(C-.5)*b,L=n+Math.sin(f+C*Math.PI*4)*w*.3;e.globalAlpha=.9,e.fillStyle=S,e.beginPath(),e.arc(v,L,3,0,2*Math.PI),e.fill()}}else{const b=g*1,w=g*.4,y=15;e.globalAlpha=.8,e.strokeStyle=d,e.lineWidth=2,e.lineCap="round",e.beginPath();let E=!0;for(let T=0;T<=y;T++){const C=T/y,v=t+(C-.5)*b,L=n+Math.sin(f+C*Math.PI*3)*w;E?(e.moveTo(v,L),E=!1):e.lineTo(v,L)}e.stroke(),e.globalAlpha=.9,e.fillStyle=S,e.beginPath(),e.arc(t,n,2,0,2*Math.PI),e.fill()}if(Math.random()<.15){const b=t+(Math.random()-.5)*g*1.2,w=n+(Math.random()-.5)*g*1;e.globalAlpha=.8,e.fillStyle="#ffffff",e.beginPath(),e.arc(b,w,1.5,0,2*Math.PI),e.fill()}e.restore()}let Z=[],Ge=0;function je(e,t,n,i,o,a){const s=Date.now(),l=Math.max(o,a)*.2*i;e.save();const u=[0,15,30],d=(u[Math.floor(Math.random()*u.length)]||15)+(Math.random()-.5)*10,c=Math.sin(s/150)*.5+.5,m=Math.sin(s/300)*.3+.7,S=Math.sin(s/600)*.2+.8,f=(c+m+S)/3,M=`hsl(${d}, 100%, ${50+f*30}%)`,P=`hsl(${d+5}, 100%, ${70+f*20}%)`,g=`hsl(${d+10}, 100%, ${40+f*40}%)`,p=Math.sin(s/100)*.3+.7,b=l*p*f;s-Ge>50&&(Z.push({x:t,y:n,size:b,color:M,timestamp:s}),Ge=s,Z.length>10&&Z.shift()),e.globalAlpha=.9*f,e.fillStyle=P,e.beginPath(),e.arc(t,n,b*.5,0,2*Math.PI),e.fill(),e.globalAlpha=.8*f,e.fillStyle=M,e.beginPath(),e.arc(t,n,b,0,2*Math.PI),e.fill(),Z.slice(-6).forEach((w,y)=>{const E=s-w.timestamp;if(E<600){const T=E/600,C=(1-T)*f*.6,v=w.size*(1-T*.3),L=Math.sin((s-w.timestamp)/100)*.3+.7;e.globalAlpha=C*L,e.fillStyle=w.color,e.beginPath(),e.arc(w.x,w.y,v,0,2*Math.PI),e.fill()}}),e.globalAlpha=.3*f,e.fillStyle=g,e.beginPath(),e.arc(t,n,b*2.5,0,2*Math.PI),e.fill(),Math.random()<.2&&(e.globalAlpha=.7*f,e.fillStyle="#ffffff",e.beginPath(),e.arc(t+(Math.random()-.5)*l,n+(Math.random()-.5)*l,2,0,2*Math.PI),e.fill()),Z=Z.filter(w=>s-w.timestamp<800),e.restore()}function Ne(e,t,n,i,o,a){const s=Date.now(),l=Math.max(o,a)*.3*i;e.save();const r=(F.baseHue+180)%360,d=`hsl(${r}, 70%, 60%)`,c=`hsl(${r}, 50%, 85%)`,m=`hsl(${r}, 80%, 40%)`,S=Math.sin(s/200)*.1+.9,f=l*S*i*(1+O*.1)*D;e.globalAlpha=.3,e.fillStyle=m,e.beginPath(),e.arc(t+1,n+1,f*.8,0,2*Math.PI),e.fill(),e.globalAlpha=.8,e.fillStyle=d,e.beginPath(),e.arc(t,n,f,0,2*Math.PI),e.fill(),e.globalAlpha=.9,e.fillStyle=c,e.beginPath(),e.arc(t-f*.3,n-f*.3,f*.2,0,2*Math.PI),e.fill(),Math.random()<.1&&(e.globalAlpha=.7,e.fillStyle="#ffffff",e.beginPath(),e.arc(t+f*.4,n-f*.4,f*.1,0,2*Math.PI),e.fill()),e.restore()}function Xe(e,t,n,i,o,a){const s=Date.now(),l=Math.max(o,a)*.5*i;e.save();const u=F.baseHue,r=s*.001,d=(u+r*30)%360,c=(u+120+r*30)%360,m=(u+240+r*30)%360,S=`hsl(${d}, 90%, 70%)`,f=`hsl(${c}, 90%, 70%)`,M=`hsl(${m}, 90%, 70%)`,P=s*.002,g=Math.sin(s/400)*.15+.85,p=l*g*i*(1+O*.1)*D,b=t,w=n,y=p;e.globalAlpha=.8,e.fillStyle=S,e.beginPath(),e.moveTo(b,w-y),e.lineTo(b+y*Math.cos(P+Math.PI*2/3),w+y*Math.sin(P+Math.PI*2/3)),e.lineTo(b+y*Math.cos(P+Math.PI*4/3),w+y*Math.sin(P+Math.PI*4/3)),e.closePath(),e.fill(),e.globalAlpha=.8,e.fillStyle=f,e.beginPath(),e.moveTo(b,w-y),e.lineTo(b+y*Math.cos(P+Math.PI*4/3),w+y*Math.sin(P+Math.PI*4/3)),e.lineTo(b+y*Math.cos(P),w+y*Math.sin(P)),e.closePath(),e.fill(),e.globalAlpha=.8,e.fillStyle=M,e.beginPath(),e.moveTo(b,w-y),e.lineTo(b+y*Math.cos(P),w+y*Math.sin(P)),e.lineTo(b+y*Math.cos(P+Math.PI*2/3),w+y*Math.sin(P+Math.PI*2/3)),e.closePath(),e.fill(),e.globalAlpha=.9,e.fillStyle="#ffffff",e.beginPath(),e.arc(b,w,p*.2,0,2*Math.PI),e.fill(),Math.random()<.03&&(e.globalAlpha=.6,e.fillStyle="#ffffff",e.beginPath(),e.arc(b,w,p*.1,0,2*Math.PI),e.fill()),e.restore()}function pe(e,t,n,i){const o=Date.now()*.001,a=Math.floor(i/6);for(let s=0;s<a;s++){const l=Math.PI*2*s/a+Math.sin(o*5+s)*.3,u=i*(.6+Math.random()*.8),r=t+Math.cos(l)*u,d=n+Math.sin(l)*u,c=1+Math.random()*6;e.save();const m=(o*100+s*30)%360,S=80+Math.random()*20,f=60+Math.random()*40;e.fillStyle=`hsl(${m}, ${S}%, ${f}%)`,e.globalAlpha=.7+Math.random()*.3,e.beginPath(),e.arc(r,d,c,0,2*Math.PI),e.fill(),e.globalAlpha=.3,e.fillStyle=`hsl(${m}, ${S}%, ${f+20}%)`,e.beginPath(),e.arc(r,d,c*1.5,0,2*Math.PI),e.fill(),e.restore()}}function Ye(e,t,n){const i=e.getBoundingClientRect();return{x:t-i.left,y:n-i.top}}function Ee(e){const t=window.visualViewport,n=t?t.width:window.innerWidth,i=t?t.height:window.innerHeight,o=window.devicePixelRatio||1;e.width=Math.max(1,Math.floor(n*o)),e.height=Math.max(1,Math.floor(i*o)),e.style.width=n+"px",e.style.height=i+"px",console.log("Canvas resized to HD:",e.width,"x",e.height,"devicePixelRatio:",o),h&&(h.scale(o,o),h.lineCap="round",h.lineJoin="round",h.strokeStyle="#111",Se(e))}function et(){const e=document.getElementById("save-modal");e&&(e.style.display="block")}function Me(){const e=document.getElementById("save-modal");e&&(e.style.display="none")}function tt(){const e=document.getElementById("processing-spinner");e&&(e.style.display="block")}function X(){const e=document.getElementById("processing-spinner");e&&(e.style.display="none")}window.openSaveModal=et;window.closeSaveModal=Me;window.showProcessingSpinner=tt;window.hideProcessingSpinner=X;function _t(e){switch(e){case"2K":return{width:2048,height:1152};case"5K":return{width:5120,height:2880};case"10K":return{width:10240,height:5760};case"20K":return{width:16384,height:9216};default:return{width:2048,height:1152}}}function Ut(e){const n=window.devicePixelRatio||1,i=e.width/(n*2),o=e.height/(n*2),a=16384/i,s=16384/o,l=Math.min(a,s),u=Math.floor(i*l),r=Math.floor(o*l);let d="";return l>=100?d="Browser canvas limit (16K pixels)":l>=50?d="High resolution - excellent quality":l>=20?d="Medium resolution - good quality":d="Limited by canvas size",{maxScale:l,maxWidth:u,maxHeight:r,reason:d}}async function Gt(e,t,n){try{console.log("Professional OffscreenCanvas export for true high resolution");const i=new OffscreenCanvas(2e4,11250),o=i.getContext("2d");if(!o){console.error("Failed to create OffscreenCanvas context"),X();return}o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.lineWidth=.1,o.lineCap="round",o.lineJoin="round";const a=2e4/e.width;o.scale(a,a),o.drawImage(e,0,0);const s=await i.convertToBlob({type:n==="PNG"?"image/png":"image/jpeg",quality:n==="JPEG"?1:void 0}),l=URL.createObjectURL(s),u=document.createElement("a");u.href=l,u.download=`VIBE-DRAWING-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.${n.toLowerCase()}`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l),console.log("Professional OffscreenCanvas export completed: 20000x11250"),X()}catch(i){console.error("OffscreenCanvas export failed:",i),X(),nt(e,t,n)}}function jt(e,t){try{console.log("Professional SVG export for vector-like quality");const n=e.toDataURL("image/png"),i=`
      <svg xmlns="http://www.w3.org/2000/svg" 
           width="${e.width}" 
           height="${e.height}" 
           viewBox="0 0 ${e.width} ${e.height}">
        <image href="${n}" 
               width="${e.width}" 
               height="${e.height}" 
               preserveAspectRatio="none"/>
      </svg>
    `,o=new Blob([i],{type:"image/svg+xml"}),a=URL.createObjectURL(o),s=document.createElement("a");s.href=a,s.download=`VIBE-DRAWING-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.svg`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a),console.log("Professional SVG export completed - vector-like quality"),X()}catch(n){console.error("SVG export failed:",n),X()}}function nt(e,t,n){try{if(tt(),typeof OffscreenCanvas<"u"&&t==="20K"){console.log("Using OffscreenCanvas for true high-resolution export"),Gt(e,t,n);return}if(n==="SVG"){console.log("Using SVG export for vector-like quality"),jt(e,t);return}const{width:i,height:o}=_t(t),a=16384;if(i>a||o>a){console.warn(`Resolution ${t} (${i}x${o}) exceeds browser limits. Using maximum supported size.`),X();let z="";t==="10K"||t==="20K"?z="Please try a lower resolution like 2K or 5K.":t==="5K"?z="Please try 2K resolution.":z="Please try a lower resolution.",alert(`Resolution ${t} is too large for your browser. ${z}`);return}let s,l;if((t==="10K"||t==="20K")&&(i>a||o>a)){const z=i/o;z>1?(s=a,l=Math.round(a/z)):(l=a,s=Math.round(a*z)),console.log(`${t} resolution adjusted to browser limits: ${s}x${l}`)}else s=i,l=o;const u=document.createElement("canvas"),r=u.getContext("2d");if(!r){console.error("Failed to create temporary canvas context"),X();return}const d=e.width/(devicePixelRatio*2),c=e.height/(devicePixelRatio*2),m=d/c;let S,f;t==="2K"?(S=600,f=12,s=d*f,l=c*f):t==="5K"?(S=1200,f=30,s=d*f,l=c*f):t==="10K"?(S=2400,f=60,s=d*f,l=c*f):t==="20K"?(S=4800,f=120,s=d*f,l=c*f):(S=144,f=2,m>i/o?(s=i,l=Math.round(i/m)):(l=o,s=Math.round(o*m)));const M=`${s}x${l}`;if(console.log(`${t==="20K"?"16K (browser limit)":t} export: ${M} at ${S} DPI (${(s*l/1e6).toFixed(1)}M pixels)`),s>a||l>a){const z=Math.min(a/d,a/c);s=d*z,l=c*z,console.log(`${t} scaled down to browser limits: ${s}x${l}`)}const g=`${s}x${l}`;if(console.log(`${t==="20K"?"16K (browser limit)":t} export: ${g} (${(s*l/1e6).toFixed(1)}M pixels)`),u.width=s,u.height=l,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.lineWidth=.5,r.lineCap="round",r.lineJoin="round",t==="20K"?(r.textBaseline="alphabetic",r.textAlign="start",r.fontKerning="normal",console.log("20K: MAXIMUM professional rendering settings enabled")):t==="10K"&&(r.textBaseline="alphabetic",r.textAlign="start",console.log("10K: High professional rendering settings enabled")),t==="20K"){console.log(`Maximum pixel density rendering for 20K (${s}x${l})`);const z=Ut(e);console.log(`Maximum pixel density: ${z.maxWidth}x${z.maxHeight} (${z.maxScale.toFixed(1)}x scale) - ${z.reason}`);const W=document.createElement("canvas"),A=W.getContext("2d");if(A){W.width=z.maxWidth,W.height=z.maxHeight,A.imageSmoothingEnabled=!1,A.textBaseline="alphabetic",A.textAlign="start",A.fontKerning="normal",A.lineWidth=.25,A.lineCap="round",A.lineJoin="round",A.scale(z.maxScale,z.maxScale);const I=A.createLinearGradient(0,0,d,c);I.addColorStop(0,"#1a1a2e"),I.addColorStop(.5,"#16213e"),I.addColorStop(1,"#151E35"),A.fillStyle=I,A.fillRect(0,0,d,c),A.fillStyle="rgba(255, 255, 255, 0.3)";for(let J=0;J<200;J++){const N=Math.random()*d,V=Math.random()*c,q=Math.random()*3+1;A.beginPath(),A.arc(N,V,q,0,2*Math.PI),A.fill()}A.drawImage(e,0,0,d,c),r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(W,0,0,s,l),console.log(`20K: Maximum pixel density rendering completed at ${z.maxScale.toFixed(1)}x scale (${z.reason})`)}else r.drawImage(e,0,0,s,l)}else{const z=Math.max(s/d,l/c);if(t==="10K"||t==="20K"||z>8){console.log(`ENHANCED ultra-high quality rendering for ${t} (${s}x${l})`);const W=6144,A=document.createElement("canvas"),I=A.getContext("2d");if(I)if(A.width=W,A.height=W*(c/d),I.imageSmoothingEnabled=!0,I.imageSmoothingQuality="high",I.textBaseline="alphabetic",I.textAlign="start",I.fontKerning="normal",I.lineWidth=.25,I.lineCap="round",I.lineJoin="round",I.drawImage(e,0,0,A.width,A.height),t==="10K"||t==="20K"||z>16){const N=document.createElement("canvas"),V=N.getContext("2d");if(V)if(N.width=12288,N.height=12288*(c/d),V.imageSmoothingEnabled=!0,V.imageSmoothingQuality="high",V.textBaseline="alphabetic",V.textAlign="start",V.fontKerning="normal",V.lineWidth=.25,V.lineCap="round",V.lineJoin="round",V.drawImage(A,0,0,N.width,N.height),t==="20K"||z>24){const H=document.createElement("canvas"),U=H.getContext("2d");U?(H.width=16384,H.height=16384*(c/d),U.imageSmoothingEnabled=!0,U.imageSmoothingQuality="high",U.textBaseline="alphabetic",U.textAlign="start",U.fontKerning="normal",U.lineWidth=.25,U.lineCap="round",U.lineJoin="round",U.drawImage(N,0,0,H.width,H.height),r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.textBaseline="alphabetic",r.textAlign="start",r.fontKerning="normal",r.lineWidth=.125,r.lineCap="round",r.lineJoin="round",r.drawImage(H,0,0,s,l)):r.drawImage(N,0,0,s,l)}else r.drawImage(N,0,0,s,l);else r.drawImage(A,0,0,s,l)}else r.drawImage(A,0,0,s,l);else r.drawImage(e,0,0,s,l)}else if(z>4){const W=Math.min(6144,Math.max(d,c)*3),A=document.createElement("canvas"),I=A.getContext("2d");I?(A.width=W,A.height=W*(c/d),I.imageSmoothingEnabled=!0,I.imageSmoothingQuality="high",I.textBaseline="alphabetic",I.textAlign="start",I.fontKerning="normal",I.lineWidth=.25,I.lineCap="round",I.lineJoin="round",I.drawImage(e,0,0,A.width,A.height),r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.textBaseline="alphabetic",r.textAlign="start",r.fontKerning="normal",r.lineWidth=.25,r.lineCap="round",r.lineJoin="round",r.drawImage(A,0,0,s,l),console.log(`${t}: ENHANCED single-stage rendering completed (${W}px → ${s}x${l})`)):r.drawImage(e,0,0,s,l)}else r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.textBaseline="alphabetic",r.textAlign="start",r.fontKerning="normal",r.lineWidth=.25,r.lineCap="round",r.lineJoin="round",r.drawImage(e,0,0,s,l)}const b=new Date,w=`VIBE DRAWING by Michael Wybraniec | one-front.com | ${b.toLocaleDateString()} | ${S} DPI`;r.save(),r.textAlign="right",r.textBaseline="bottom";const y=Math.max(8,s/300),E=Math.max(4,s/200),T=E*.8;r.font=`${y}px Inter, sans-serif`;const v=r.measureText(w).width+T*2,L=y+T*2,$=s-v-E,_=l-L-E;r.fillStyle="rgba(0, 0, 0, 0.6)",r.beginPath(),r.roundRect($,_,v,L,E*.5),r.fill(),r.strokeStyle="rgba(255, 215, 0, 0.2)",r.lineWidth=.5,r.stroke(),r.fillStyle="rgba(255, 255, 255, 0.8)",r.font=`${y}px Inter, sans-serif`,r.fillText(w,s-E-T,l-E-T),r.restore();let x,R,B;switch(n){case"PNG":x="image/png",R=1,B="png";break;case"JPEG":x="image/jpeg",R=.95,B="jpg";break;case"WEBP":x="image/webp",R=.95,B="webp";break;case"TIFF":x="image/png",R=1,B="png",console.warn("TIFF format not supported by browsers, exporting as PNG instead");break;case"PDF":x="image/png",R=1,B="png",console.warn("PDF format not supported by browsers, exporting as PNG instead");break;default:x="image/png",R=1,B="png"}u.toBlob(z=>{if(!z){console.error("Failed to create image blob"),X();return}X();const W=URL.createObjectURL(z),A=document.createElement("a");A.href=W;const I=b.toISOString().replace(/[:.]/g,"").slice(0,15);A.download=`VIBE-DRAWING-${I}-${t}.${B}`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(W),console.log(`Canvas saved successfully as ${n} in ${t}! 💾`)},x,R)}catch(i){console.error("Error saving canvas:",i),X()}}function Nt(e){const t=window.devicePixelRatio||1,n=e.clientWidth,i=e.clientHeight,o=2;if(e.width=n*t*o,e.height=i*t*o,e.style.width=n+"px",e.style.height=i+"px",h=e.getContext("2d",{alpha:!0,antialias:!0,willReadFrequently:!1}),console.log("Canvas context created:",!!h,"Canvas element:",!!e,"High-DPI:",t*2),!h){console.error("Failed to get 2D context!");return}h.scale(t*o,t*o),h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.lineCap="round",h.lineJoin="round",h.strokeStyle="#111",h.lineWidth=2,h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.textBaseline="alphabetic",h.textAlign="start",h.fontKerning="normal",console.log(`Canvas initialized with ${o}x quality multiplier (${t*o}x total DPI)`),Se(e),console.log("Canvas context initialized successfully")}function Se(e){if(!h){console.error("Cannot clear canvas - no context!");return}Z=[],console.log("Clearing canvas, size:",e.width,"x",e.height);const t=e.clientWidth,n=e.clientHeight,i="#151E35";h.fillStyle=i,h.fillRect(0,0,t,n);const o=t/2,a=n/2,s=Math.sqrt(o*o+a*a),l=h.createRadialGradient(o,a,0,o,a,s);l.addColorStop(0,"rgba(0, 0, 0, 0)"),l.addColorStop(.7,"rgba(0, 0, 0, 0)"),l.addColorStop(1,"rgba(0, 0, 0, 0.15)"),h.fillStyle=l,h.fillRect(0,0,t,n),h.fillStyle="rgba(255, 255, 255, 0.3)";for(let u=0;u<50;u++){const r=Math.random()*t,d=Math.random()*n,c=Math.random()*2+1;h.beginPath(),h.arc(r,d,c,0,2*Math.PI),h.fill()}h.lineWidth=20,console.log("Canvas cleared and background drawn with ENHANCED line quality")}function Je(e){console.log("Pointer Event Debug:",{pointerType:e.pointerType,pressure:e.pressure,width:e.width,height:e.height,pointerId:e.pointerId,isPrimary:e.isPrimary,timeStamp:e.timeStamp})}function Xt(e){e.addEventListener("touchstart",n=>n.preventDefault(),{passive:!1}),e.addEventListener("touchmove",n=>n.preventDefault(),{passive:!1}),e.addEventListener("touchend",n=>n.preventDefault(),{passive:!1}),e.addEventListener("pointerdown",n=>{if(n.pointerType==="pen"&&Je(n),ie||K===2&&Ce)return;const i=n.pointerType==="pen",o=n.pointerType==="touch";n.pointerType;let a=n.pressure!==void 0?n.pressure:.5;i&&(a=Math.max(.1,Math.min(1,a)),console.log("Apple Pencil detected - pressure:",a)),e.setPointerCapture(n.pointerId),ie=!0,K===2&&(Ce=!0),re=[];const{x:s,y:l}=Ye(e,n.clientX,n.clientY);let u=G(n.width||1,n.height||1);if(i?u*=.3+a*.7:o&&(u*=.5+a*.5),re.push({x:s,y:l,t:n.timeStamp}),$t(),h){const r=n.width||1,d=n.height||1;let c,m,S;de?(c=45,m=45,S=1):(c=Math.max(r,30),m=Math.max(d,30),S=r>1||d>1?1.2:1);const f=c*u*S,M=m*u*S,P=Math.max(f,M),g=Y.getCurrentStyleIndex();if(g===1)if(j){h.save(),h.globalCompositeOperation="destination-out";const p=Math.max(f,M)*3;h.fillStyle="rgba(0, 0, 0, 1)",h.beginPath(),h.arc(s,l,p,0,2*Math.PI),h.fill(),h.restore()}else{const b=G(f,M)*(1+O*.3)*D;_e(h,s,l,b,f,M)}else if(g===2)if(j){h.save(),h.globalCompositeOperation="destination-out";const p=Math.max(f,M)*3;h.fillStyle="rgba(0, 0, 0, 1)",h.beginPath(),h.arc(s,l,p,0,2*Math.PI),h.fill(),h.restore()}else{const p=G(f,M);Ue(h,s,l,p,f,M)}else if(g===3)if(j){h.save(),h.globalCompositeOperation="destination-out";const p=Math.max(f,M)*3;h.fillStyle="rgba(0, 0, 0, 1)",h.beginPath(),h.arc(s,l,p,0,2*Math.PI),h.fill(),h.restore()}else{const p=G(f,M);je(h,s,l,p,f,M)}else if(g===4)if(j){h.save(),h.globalCompositeOperation="destination-out";const p=Math.max(f,M)*3;h.fillStyle="rgba(0, 0, 0, 1)",h.beginPath(),h.arc(s,l,p,0,2*Math.PI),h.fill(),h.restore()}else{const p=G(f,M);Ne(h,s,l,p,f,M)}else if(g===5)if(j){h.save(),h.globalCompositeOperation="destination-out";const p=Math.max(f,M)*3;h.fillStyle="rgba(0, 0, 0, 1)",h.beginPath(),h.arc(s,l,p,0,2*Math.PI),h.fill(),h.restore()}else{const p=G(f,M)*(1+O*.01);Xe(h,s,l,p,f,M)}else{h.save(),h.globalAlpha=.8,console.log("Drawing dot at:",s,l,"size:",f,"x",M,"pressure:",a);const p=1+Math.sin(Date.now()/200)*.1,b=f/2*p,w=M/2*p;if(j?(h.globalCompositeOperation="source-over",h.fillStyle="#151E35"):(h.globalCompositeOperation="source-over",h.fillStyle=le()),j){const y=h.createRadialGradient(s,l,0,s,l,Math.max(b,w));y.addColorStop(0,"#151E35"),y.addColorStop(.7,"#151E35"),y.addColorStop(1,"#151E35"),h.fillStyle=y}else{const y=h.createRadialGradient(s,l,0,s,l,Math.max(b,w));y.addColorStop(0,le()),y.addColorStop(.7,le()),y.addColorStop(1,le()),h.fillStyle=y}h.beginPath(),h.ellipse(s,l,b,w,0,0,2*Math.PI),h.fill(),h.restore(),P>15&&!j&&(Y.getCurrentStyleIndex()===0?Math.random()<.7&&(h.save(),h.globalAlpha=.5,pe(h,s,l,P),h.restore()):pe(h,s,l,P))}}else console.error("Canvas context is null! Cannot draw.")}),e.addEventListener("pointermove",n=>{if(n.pointerType==="pen"&&ie&&Je(n),!ie)return;const{x:i,y:o}=Ye(e,n.clientX,n.clientY),a=re[re.length-1],s=Math.max(.001,n.timeStamp-a.t),l=i-a.x,u=o-a.y,r=Math.hypot(l,u)/s,d=n.pointerType==="pen",c=n.pointerType==="touch";n.pointerType;let m=n.pressure!==void 0?n.pressure:.5;d&&(m=Math.max(.1,Math.min(1,m)));let S=G(n.width||1,n.height||1);if(d?S*=.3+m*.7:c&&(S*=.5+m*.5),re.push({x:i,y:o,t:n.timeStamp,speed:r}),!h)return;const f=Math.hypot(i-a.x,o-a.y);let M;d?M=K===2||K===5?.4:.3:M=K===2||K===5?.6:de?.3:.6;const P=Math.max(1,Math.ceil(f/M));let g;d?g=K===2||K===5?3.5:7:g=K===2||K===5?2.5:de?5:4;const b=Math.max(K===2||K===5?4:8,Math.ceil(P*g)),w=n.width||1,y=n.height||1;let E,T,C;de?(E=45,T=45,C=1):(E=Math.max(w,30),T=Math.max(y,30),C=w>1||y>1?1.2:1);const v=E*S*C,L=T*S*C;h.save(),h.globalAlpha=.8;for(let $=0;$<=b;$++){const _=$/b,x=a.x+(i-a.x)*_,R=a.y+(o-a.y)*_,B=Math.sin($*.5)*.1,z=x+B,W=R+B,A=Y.getCurrentStyleIndex();if(A===1){const J=G(v,L)*(1+O*.3)*D;_e(h,z,W,J,v,L)}else if(A===2){const I=G(v,L);Ue(h,z,W,I,v,L)}else if(A===3){const I=G(v,L);je(h,z,W,I,v,L)}else if(A===4){const I=G(v,L);Ne(h,z,W,I,v,L)}else if(A===5){const I=G(v,L)*(1+O*.01);Xe(h,z,W,I,v,L)}else{let I;d?I=.98+Math.random()*.04:I=.95+Math.random()*.1;const J=1+Math.sin((Date.now()+$*40)/160)*.03,N=v/2*I*J,V=L/2*I*J;if(j)h.globalCompositeOperation="source-over",h.fillStyle="#151E35";else if(h.globalCompositeOperation="source-over",A===0){const q=Date.now()*.001,H=window.randomStyleParams||F,U=H.baseHue,at=H.cycleSpeed||8;H.filter&&H.filter!=="none"&&Math.random()<.3&&(h.filter=H.filter);const rt=Math.sin(q*at)*100,lt=(Math.random()-.5)*80+rt,ct=(Math.random()-.5)*40+Math.sin(q*3)*20,ht=(Math.random()-.5)*35+Math.sin(q*2.5)*15,$e=(U+lt+360)%360,xe=Math.max(70,Math.min(100,H.saturation+ct)),Fe=Math.max(35,Math.min(85,H.lightness+ht));h.fillStyle=`hsl(${$e}, ${xe}%, ${Fe}%)`,Math.floor(q*10)%20===0&&console.log(`🎨 Style 1 DRAWING: baseHue=${U}, finalHue=${$e}, saturation=${xe}, lightness=${Fe}, filter=${H.filter}`),H.filter&&H.filter!=="none"&&(h.filter="none")}else h.fillStyle=le();if(h.beginPath(),h.ellipse(x,R,N,V,0,0,2*Math.PI),h.fill(),Math.max(v,L)>10&&!j)if(Y.getCurrentStyleIndex()===0)Math.random()<.6&&(h.save(),h.globalAlpha=.5,pe(h,x,R,Math.max(v,L)/2.5),h.restore());else{let H;d?H=.4:H=.2,Math.random()<H&&(h.save(),h.globalAlpha=.4,pe(h,x,R,Math.max(v,L)/3),h.restore())}}}h.restore()});const t=n=>{if(ie){ie=!1,K===2&&(Ce=!1),e.releasePointerCapture(n.pointerId);try{if(k&&k.state!=="suspended"){const i=k.createOscillator(),o=k.createGain();i.connect(o),o.connect(k.destination),i.frequency.setValueAtTime(400,k.currentTime),i.frequency.exponentialRampToValueAtTime(200,k.currentTime+.2),o.gain.setValueAtTime(.15,k.currentTime),o.gain.exponentialRampToValueAtTime(.01,k.currentTime+.2),i.start(k.currentTime),i.stop(k.currentTime+.2)}}catch(i){console.log("End sound failed:",i)}}};e.addEventListener("pointerup",t),e.addEventListener("pointercancel",t),e.addEventListener("pointerleave",t)}let k=null,ye=!1;function it(){if(!ye)try{k=new(window.AudioContext||window.webkitAudioContext),ye=!0,console.log("Audio context initialized")}catch(e){console.log("Audio not supported"),console.log("Audio not supported",e),ye=!0}}function ot(){(!k||k.state==="suspended")&&k?.resume();try{if(!k)return;const e=k.createOscillator(),t=k.createGain();e.connect(t),t.connect(k.destination),e.frequency.setValueAtTime(400,k.currentTime),e.frequency.exponentialRampToValueAtTime(800,k.currentTime+.2),e.frequency.exponentialRampToValueAtTime(600,k.currentTime+.4),e.frequency.exponentialRampToValueAtTime(900,k.currentTime+.6),t.gain.setValueAtTime(.2,k.currentTime),t.gain.exponentialRampToValueAtTime(.4,k.currentTime+.2),t.gain.exponentialRampToValueAtTime(.2,k.currentTime+.4),t.gain.exponentialRampToValueAtTime(.01,k.currentTime+.6),e.start(k.currentTime),e.stop(k.currentTime+.6)}catch(e){console.log("Audio playback failed:",e)}}function Yt(){(!k||k.state==="suspended")&&k?.resume();try{if(!k)return;const e=k.createOscillator(),t=k.createGain();e.connect(t),t.connect(k.destination),e.frequency.setValueAtTime(300,k.currentTime),e.frequency.exponentialRampToValueAtTime(1500,k.currentTime+.3),t.gain.setValueAtTime(.3,k.currentTime),t.gain.exponentialRampToValueAtTime(.01,k.currentTime+.3),e.start(k.currentTime),e.stop(k.currentTime+.3)}catch(e){console.log("Audio playback failed:",e)}}function Te(){ye||(it(),ot())}document.addEventListener("click",Te);document.addEventListener("touchstart",Te);document.addEventListener("keydown",Te);it();function Jt(){const e=document.getElementById("info-popup");e&&(e.style.display="block")}function st(){const e=document.getElementById("info-popup");e&&(e.style.display="none")}window.showInfoPopup=Jt;window.hideInfoPopup=st;document.addEventListener("click",e=>{const t=document.getElementById("info-popup");t&&e.target===t&&st()});let F={baseHue:216,saturation:90,lightness:50,sparkleIntensity:.3,sparkleSize:2,sparkleCount:3,glowIntensity:.2,pulseSpeed:.02,sizeMultiplier:1,cycleSpeed:8,filter:"none"};window.randomStyleParams=F;function Le(){const e=F.baseHue,t=F.saturation,n=F.lightness;let i=Math.floor(Math.random()*360),o=90,a=50,s=0;const l=15;do{i=Math.floor(Math.random()*360);const P=[80,85,90,95,100];o=P[Math.floor(Math.random()*P.length)];const g=[35,40,45,50,55,60,65];a=g[Math.floor(Math.random()*g.length)],s++}while(s<l&&Math.abs(i-e)<60&&Math.abs(o-t)<20&&Math.abs(a-n)<20);const u=Math.random()*.6+.4,r=Math.random()*3+1,d=Math.floor(Math.random()*12)+4,c=Math.random()*.8+.2,m=Math.random()*.3+.1,S=Math.random()*2+.8,f=["none","hue-rotate(90deg)","hue-rotate(180deg)","saturate(1.5)","brightness(1.2)","contrast(1.3)"],M=f[Math.floor(Math.random()*f.length)];F={baseHue:i,saturation:o,lightness:a,sparkleIntensity:u,sparkleSize:r,sparkleCount:d,glowIntensity:c,pulseSpeed:m,sizeMultiplier:S,cycleSpeed:8,filter:M},window.randomStyleParams=F,console.log(`🎨 Style 1 NEW COLORS: baseHue=${i}, saturation=${o}, lightness=${a}`)}function qt(){const e=[{baseHue:0,saturation:100,lightness:45,cycleSpeed:9},{baseHue:60,saturation:100,lightness:55,cycleSpeed:11},{baseHue:270,saturation:95,lightness:40,cycleSpeed:7},{baseHue:210,saturation:100,lightness:60,cycleSpeed:12},{baseHue:15,saturation:100,lightness:50,cycleSpeed:6},{baseHue:200,saturation:90,lightness:45,cycleSpeed:8},{baseHue:120,saturation:85,lightness:40,cycleSpeed:7},{baseHue:280,saturation:100,lightness:55,cycleSpeed:10},{baseHue:240,saturation:90,lightness:45,cycleSpeed:8},{baseHue:160,saturation:95,lightness:50,cycleSpeed:7},{baseHue:180,saturation:85,lightness:45,cycleSpeed:6},{baseHue:300,saturation:100,lightness:50,cycleSpeed:13},{baseHue:20,saturation:100,lightness:45,cycleSpeed:8},{baseHue:220,saturation:90,lightness:65,cycleSpeed:5},{baseHue:45,saturation:95,lightness:55,cycleSpeed:7}],t=F.baseHue,n=F.saturation,i=F.lightness,o=e.filter(r=>{const d=Math.abs(r.baseHue-t),c=Math.abs(r.saturation-n),m=Math.abs(r.lightness-i);return d>30||c>15||m>15}),a=o.length>0?o:e,s=a[Math.floor(Math.random()*a.length)];F={...F,baseHue:s.baseHue,saturation:s.saturation,lightness:s.lightness,cycleSpeed:s.cycleSpeed};const l=["none","hue-rotate(90deg)","hue-rotate(180deg)","saturate(1.5)","brightness(1.2)","contrast(1.3)"],u=l[Math.floor(Math.random()*l.length)];F={...F,filter:u},window.randomStyleParams=F,console.log(`🎨 Style 1 VIBE CHANGE: baseHue=${s.baseHue}, saturation=${s.saturation}, lightness=${s.lightness}, filter=${u}`)}function Qt(){const e=document.getElementById("app-canvas");if(console.log("Init function called, canvas found:",!!e),!e){console.error("Canvas element not found!");return}console.log("Device capabilities:",{maxTouchPoints:window.navigator.maxTouchPoints,hasPointerEvents:"PointerEvent"in window}),document.addEventListener("contextmenu",g=>g.preventDefault()),document.addEventListener("selectstart",g=>g.preventDefault()),document.addEventListener("dragstart",g=>g.preventDefault()),document.addEventListener("gesturestart",g=>g.preventDefault()),document.addEventListener("gesturechange",g=>g.preventDefault()),document.addEventListener("gestureend",g=>g.preventDefault()),e.addEventListener("contextmenu",g=>g.preventDefault()),e.addEventListener("selectstart",g=>g.preventDefault()),e.addEventListener("dragstart",g=>g.preventDefault()),e.style.touchAction="none",e.style.webkitTouchCallout="none",e.style.webkitUserSelect="none",e.style.userSelect="none",console.log("Initializing canvas context..."),Nt(e),console.log("Canvas context initialized, ctx:",!!h),Ee(e),h&&e&&(Se(e),console.log("Canvas fully initialized and cleared"));const t=()=>Ee(e);window.addEventListener("resize",t),window.addEventListener("orientationchange",t),window.visualViewport?.addEventListener("resize",t),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&Ee(e)}),console.log("Attaching pointer handlers..."),Xt(e),console.log("Pointer handlers attached"),setTimeout(()=>{const g=document.getElementById("splash-screen");g&&(Yt(),g.classList.add("fade-out"),setTimeout(()=>{g.style.display="none";const p=document.querySelector(".one-front-credit");p&&p.classList.add("show")},300))},300),setTimeout(()=>{ot()},200);const n=document.getElementById("style-selector");if(n){const g=()=>{Y.nextStyle();const b=Y.getCurrentStyle();n.textContent=b.icon,n.style.color="white",console.log(`🎨 Switched to ${b.name} style: ${b.description}`),console.log(`🎯 Style index: ${Y.getCurrentStyleIndex()}`),n.title=`Current: ${b.name}
Tap to switch drawing style`};n.addEventListener("click",g),n.addEventListener("touchstart",b=>{b.preventDefault(),g()}),n.addEventListener("touchend",b=>{b.preventDefault()});const p=Y.getCurrentStyle();n.textContent=p.icon,n.style.color="white",n.title=`Current: ${p.name}
Tap to switch drawing style`}const i=document.getElementById("style-switch");if(i){const g=()=>{if(Y.getCurrentStyleIndex()===0){Math.random()<.4?(qt(),console.log("🎨 FORCED vibe change for Style 1!")):(Le(),console.log("🎨 Randomized colors for Style 1!")),O=Math.floor(Math.random()*5);const y=Math.floor(Math.random()*360);i.style.color=`hsl(${y}, 85%, 55%)`,console.log(`🎨 Style 1 randomized: ${["tiny","small","medium","large","huge"][O]} size + new colors!`)}else{Le(),O=Math.floor(Math.random()*5);const w=Math.floor(Math.random()*360);i.style.color=`hsl(${w}, 85%, 55%)`,console.log(`Generated new random style and changed to ${["tiny","small","medium","large","huge"][O]} size!`)}};i.addEventListener("click",g),i.addEventListener("touchstart",b=>{b.preventDefault(),g()}),i.addEventListener("touchend",b=>{b.preventDefault()}),Le();const p=Math.floor(Math.random()*360);i.style.color=`hsl(${p}, 85%, 55%)`}const o=document.getElementById("thickness-slider"),a=document.getElementById("vibration-knob"),s=document.getElementById("thickness-value");if(console.log("Thickness slider found:",!!o),o){const g=()=>{D=parseFloat(o.value),console.log("🎯 Thickness changed to:",D,"Slider value:",o.value),s&&(s.textContent=o.value),h&&e&&console.log("🔄 Thickness updated, next draw will use:",D)};o.addEventListener("input",g),o.addEventListener("change",g),D=parseFloat(o.value),console.log("🎯 Initial thickness:",D),s&&(s.textContent=o.value);const p=G(1,1);console.log("🧪 Test size calculation with thickness",D,":",p)}else console.error("Thickness slider not found!");let l=1;const u=()=>{a&&(l=parseFloat(a.value)),window.vibrationIntensity=l};a?.addEventListener("input",u),u();const r=g=>{if(!o)return;const p=parseFloat(o.value),b=parseFloat(o.step)||.2,w=parseFloat(o.min)||.2,y=parseFloat(o.max)||5;if(g.key==="ArrowLeft"||g.key==="ArrowDown"){const E=Math.max(w,p-b);o.value=E.toString(),D=E,console.log("🎯 Thickness decreased to:",E)}else if(g.key==="ArrowRight"||g.key==="ArrowUp"){const E=Math.min(y,p+b);o.value=E.toString(),D=E,console.log("🎯 Thickness increased to:",E)}};document.addEventListener("keydown",r);const d=document.getElementById("eraser");if(d){const g=()=>{j=!j,j?(d.style.backgroundColor="rgba(255, 255, 255, 0.2)",d.style.border="2px solid rgba(255, 255, 255, 0.5)",console.log("Eraser mode activated! 🧽")):(d.style.backgroundColor="transparent",d.style.border="none",console.log("Drawing mode activated! ✏️"))};d.addEventListener("click",g),d.addEventListener("touchstart",p=>{p.preventDefault(),g()}),d.addEventListener("touchend",p=>{p.preventDefault()})}const c=document.getElementById("clear-canvas");if(c){const g=()=>{h&&e&&(Se(e),console.log("Canvas cleared! ✨"))};c.addEventListener("click",g),c.addEventListener("touchstart",g),c.addEventListener("touchend",g)}const m=document.getElementById("save-as");if(m){const g=()=>{et()};m.addEventListener("click",g),m.addEventListener("touchstart",p=>{p.preventDefault(),g()}),m.addEventListener("touchend",p=>{p.preventDefault()})}const S=document.getElementById("cancel-save");S&&S.addEventListener("click",Me);const f=document.getElementById("confirm-save");f&&f.addEventListener("click",()=>{if(h&&e){const g=document.querySelector('input[name="quality"]:checked'),p=document.querySelector('input[name="format"]:checked');g&&p&&(nt(e,g.value,p.value),Me())}});const M=document.getElementById("save-modal");M&&M.addEventListener("click",g=>{g.target===M&&Me()});function P(g){K=g,console.log(`Switched to Style ${g}`),document.querySelectorAll(".style-button").forEach((p,b)=>{p.classList.toggle("active",b===g-1)})}document.getElementById("style-1")?.addEventListener("click",()=>P(1)),document.getElementById("style-2")?.addEventListener("click",()=>P(2)),document.getElementById("style-3")?.addEventListener("click",()=>P(3))}document.addEventListener("DOMContentLoaded",Qt);export{Qe as W,ft as _,ke as r};
