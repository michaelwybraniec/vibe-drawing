(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const ut="modulepreload",dt=function(n){return"/vibe-drawing/"+n},We={},ht=function(e,t,i){let o=Promise.resolve();if(t&&t.length>0){let g=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=s?.nonce||s?.getAttribute("nonce");o=g(t.map(c=>{if(c=dt(c),c in We)return;We[c]=!0;const f=c.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":ut,f||(u.as="script"),u.crossOrigin="",u.href=c,r&&u.setAttribute("nonce",r),document.head.appendChild(u),f)return new Promise((m,p)=>{u.addEventListener("load",m),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return o.then(s=>{for(const r of s||[])r.status==="rejected"&&a(r.reason);return e().catch(a)})};function Fe(){return typeof navigator<"u"&&"vibrate"in navigator}const mt="vibe.flags",Ke={hapticsEnabled:!0,debug:!1};function ft(n){if(!n)return{};try{return JSON.parse(n)}catch{return{}}}function gt(){if(typeof window>"u")return{...Ke};const n=ft(localStorage.getItem(mt));return{...Ke,...n}}let pt=gt();function Xe(n){return pt[n]}let ie=null,re=null,oe=null;function Ue(n=.5){try{if(ie||(ie=new(window.AudioContext||window.webkitAudioContext)),!ie||re)return;re=ie.createOscillator(),oe=ie.createGain(),re.type="square",re.frequency.value=85,oe.gain.value=Math.min(1,Math.max(.05,n)),re.connect(oe),oe.connect(ie.destination),re.start()}catch{}}function ke(n=.5){if(!oe||!ie)return;const e=Math.min(1,Math.max(.05,n));try{oe.gain.exponentialRampToValueAtTime(e,ie.currentTime+.05)}catch{oe.gain.value=e}}/*! Capacitor: https://capacitorjs.com/ - MIT License */var de;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(de||(de={}));class ze extends Error{constructor(e,t,i){super(e),this.message=e,this.code=t,this.data=i}}const yt=n=>{var e,t;return n?.androidBridge?"android":!((t=(e=n?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},vt=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},i=t.Plugins=t.Plugins||{},o=()=>e!==null?e.name:yt(n),a=()=>o()!=="web",s=d=>{const u=c.get(d);return!!(u?.platforms.has(o())||r(d))},r=d=>{var u;return(u=t.PluginHeaders)===null||u===void 0?void 0:u.find(m=>m.name===d)},g=d=>n.console.error(d),c=new Map,f=(d,u={})=>{const m=c.get(d);if(m)return console.warn(`Capacitor plugin "${d}" already registered. Cannot register plugins twice.`),m.proxy;const p=o(),v=r(d);let w;const h=async()=>(!w&&p in u?w=typeof u[p]=="function"?w=await u[p]():w=u[p]:e!==null&&!w&&"web"in u&&(w=typeof u.web=="function"?w=await u.web():w=u.web),w),y=(A,T)=>{var z,I;if(v){const x=v?.methods.find(k=>T===k.name);if(x)return x.rtype==="promise"?k=>t.nativePromise(d,T.toString(),k):(k,B)=>t.nativeCallback(d,T.toString(),k,B);if(A)return(z=A[T])===null||z===void 0?void 0:z.bind(A)}else{if(A)return(I=A[T])===null||I===void 0?void 0:I.bind(A);throw new ze(`"${d}" plugin is not implemented on ${p}`,de.Unimplemented)}},b=A=>{let T;const z=(...I)=>{const x=h().then(k=>{const B=y(k,A);if(B){const W=B(...I);return T=W?.remove,W}else throw new ze(`"${d}.${A}()" is not implemented on ${p}`,de.Unimplemented)});return A==="addListener"&&(x.remove=async()=>T()),x};return z.toString=()=>`${A.toString()}() { [capacitor code] }`,Object.defineProperty(z,"name",{value:A,writable:!1,configurable:!1}),z},E=b("addListener"),M=b("removeListener"),$=(A,T)=>{const z=E({eventName:A},T),I=async()=>{const k=await z;M({eventName:A,callbackId:k},T)},x=new Promise(k=>z.then(()=>k({remove:I})));return x.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await I()},x},V=new Proxy({},{get(A,T){switch(T){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return v?$:E;case"removeListener":return M;default:return b(T)}}});return i[d]=V,c.set(d,{name:d,proxy:V,platforms:new Set([...Object.keys(u),...v?[p]:[]])}),V};return t.convertFileSrc||(t.convertFileSrc=d=>d),t.getPlatform=o,t.handleError=g,t.isNativePlatform=a,t.isPluginAvailable=s,t.registerPlugin=f,t.Exception=ze,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},bt=n=>n.Capacitor=vt(n),Pe=bt(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Oe=Pe.registerPlugin;class Ze{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let i=!1;this.listeners[e]||(this.listeners[e]=[],i=!0),this.listeners[e].push(t);const a=this.windowListeners[e];a&&!a.registered&&this.addWindowListener(a),i&&this.sendRetainedArgumentsForEvent(e);const s=async()=>this.removeListener(e,t);return Promise.resolve({remove:s})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,i){const o=this.listeners[e];if(!o){if(i){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}return}o.forEach(a=>a(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:i=>{this.notifyListeners(t,i)}}}unimplemented(e="not implemented"){return new Pe.Exception(e,de.Unimplemented)}unavailable(e="not available"){return new Pe.Exception(e,de.Unavailable)}async removeListener(e,t){const i=this.listeners[e];if(!i)return;const o=i.indexOf(t);this.listeners[e].splice(o,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(i=>{this.notifyListeners(e,i)}))}}const Ge=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),_e=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class St extends Ze{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(i=>{if(i.length<=0)return;let[o,a]=i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");o=_e(o).trim(),a=_e(a).trim(),t[o]=a}),t}async setCookie(e){try{const t=Ge(e.key),i=Ge(e.value),o=`; expires=${(e.expires||"").replace("expires=","")}`,a=(e.path||"/").replace("path=",""),s=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${i||""}${o}; path=${a}; ${s};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Oe("CapacitorCookies",{web:()=>new St});const wt=async n=>new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{const o=i.result;e(o.indexOf(",")>=0?o.split(",")[1]:o)},i.onerror=o=>t(o),i.readAsDataURL(n)}),Mt=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(o=>o.toLocaleLowerCase()).reduce((o,a,s)=>(o[a]=n[e[s]],o),{})},Ct=(n,e=!0)=>n?Object.entries(n).reduce((i,o)=>{const[a,s]=o;let r,g;return Array.isArray(s)?(g="",s.forEach(c=>{r=e?encodeURIComponent(c):c,g+=`${a}=${r}&`}),g.slice(0,-1)):(r=e?encodeURIComponent(s):s,g=`${a}=${r}`),`${i}&${g}`},"").substr(1):null,Et=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),o=Mt(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(o.includes("application/x-www-form-urlencoded")){const a=new URLSearchParams;for(const[s,r]of Object.entries(n.data||{}))a.set(s,r);t.body=a.toString()}else if(o.includes("multipart/form-data")||n.data instanceof FormData){const a=new FormData;if(n.data instanceof FormData)n.data.forEach((r,g)=>{a.append(g,r)});else for(const r of Object.keys(n.data))a.append(r,n.data[r]);t.body=a;const s=new Headers(t.headers);s.delete("content-type"),t.headers=s}else(o.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class Pt extends Ze{async request(e){const t=Et(e,e.webFetchExtra),i=Ct(e.params,e.shouldEncodeUrlParams),o=i?`${e.url}?${i}`:e.url,a=await fetch(o,t),s=a.headers.get("content-type")||"";let{responseType:r="text"}=a.ok?e:{};s.includes("application/json")&&(r="json");let g,c;switch(r){case"arraybuffer":case"blob":c=await a.blob(),g=await wt(c);break;case"json":g=await a.json();break;case"document":case"text":default:g=await a.text()}const f={};return a.headers.forEach((d,u)=>{f[u]=d}),{data:g,headers:f,status:a.status,url:a.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Oe("CapacitorHttp",{web:()=>new Pt});const Re=Oe("NativeHaptics",{web:()=>({async start(){},async update(){},async stop(){}})});let se=null;(async()=>{try{se=(await ht(()=>import("./index-B-xTBg5x.js"),[])).Haptics}catch{se=null}})();let ye=null,ve=150,ce=22,ue=!1,we=!1,be=.5;const Se=Pe.getPlatform();let et="medium",Ie=!1;function Tt(n){const e=Math.max(0,Math.min(.25,0));return Math.max(.15,Math.min(1,e/.25))}function zt(n){const e=Math.max(0,Math.min(1,.5));return Math.max(.1,Math.min(1,e))}function Me(n,e){const t=Tt(),i=zt();return Math.max(.1,Math.min(1,i*.6+t*.4))}function It(n,e){const t=Me();return Math.round(18+t*20)}function Lt(n,e){const t=Me();return Math.round(80-t*35)}function xt(n,e){const t=Me();return t>.7?"heavy":t>.4?"medium":"light"}function Ve(){if(Se!=="web"&&!we)try{Re.update({intensity:be});return}catch{}if(se){Se==="ios"?se.impact({style:et}):Se==="android"?se.vibrate({duration:ce}):Fe()?navigator.vibrate(ce):ue?ke(ce/40):(ue=!0,Ue(.4));return}Fe()?navigator.vibrate(ce):ue?ke(ce/40):(ue=!0,Ue(.4))}function At(){if(Xe("hapticsEnabled")){if(Ie){kt();return}if(ue=!1,we=!1,Se!=="web")try{Re.start({intensity:be}),we=!0,Ie=!0;return}catch{}se&&Se==="ios"&&se.impact({style:"medium"}),Ve(),ye=window.setInterval(Ve,ve),Ie=!0}}function kt(n,e){if(!Xe("hapticsEnabled"))return;const t=Me(),i=Math.abs(be-t)>.05;if(be=t,we&&i)try{Re.update({intensity:be});return}catch{we=!1}if(i||!ye){ce=It(),et=xt();const o=Lt();Math.abs(o-ve)>2&&ye!=null?(ve=o,window.clearInterval(ye),ye=window.setInterval(Ve,ve)):ve=o}ue&&ke(Me())}class Vt{constructor(){this.name="Triangle",this.description="Bright neon triangles with glowing effects",this.icon="7",this.currentVariant=0,this.currentTheme=0,this.lastPoint=null,this.drawingSpeed=1,this.colorVariants=[{baseHue:280,saturation:85,lightness:60,name:"Mystical Purple"},{baseHue:100,saturation:100,lightness:50,name:"Electric Neon"},{baseHue:300,saturation:90,lightness:65,name:"Sunset Fuchsia"},{baseHue:180,saturation:80,lightness:55,name:"Ocean Teal"},{baseHue:0,saturation:95,lightness:60,name:"Fire Red"}],this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.glowTrails=[]}draw(e,t,i){const{x:o,y:a,width:s,height:r}=t,{isEraserMode:g}=i,c=this.calculateSizeMultiplier(t,i),f=Math.max(s,r),d=Math.min(1,Math.max(.2,f/30)),u=1,m=.4+d*.6,p=f*u*c*m;e.save(),g?(e.globalCompositeOperation="destination-out",e.fillStyle="#000000"):e.globalCompositeOperation="source-over",this.drawTriangle(e,o,a,p),e.restore()}onStart(e,t){this.glowTrails=[],this.lastPoint=e,this.drawingSpeed=1}onMove(e,t){const{ctx:i,isEraserMode:o,thicknessMultiplier:a,currentSizeLevel:s,sizeMultipliers:r,isWebApp:g}=t;e.length<2||(i.save(),i.globalCompositeOperation=o?"destination-out":"screen",e.forEach((c,f)=>{if(f===0)return;const d=e[f-1];if(!d)return;const u=((c.t||0)-(d.t||0))/16;if(u<=0)return;const m=this.calculateSizeMultiplier(c,t),p=d.x+(c.x-d.x)*u,v=d.y+(c.y-d.y)*u,w=c.width||1,h=c.height||1,y=Math.max(w,h),b=Math.min(1,Math.max(.2,y/30));Math.random()<.01&&console.log(`Touch: w=${w.toFixed(1)}, h=${h.toFixed(1)}, max=${y.toFixed(1)}, pressure=${b.toFixed(2)}`);const E=3.9,M=.4+b*.6,$=.8+Math.random()*.4,V=y*E*m*M*$;if(o)i.globalAlpha=.5,i.fillStyle="#151E35";else{const T=1+Math.sin(u*Math.PI)*.2,z=this.getGlowColor(T);i.globalAlpha=.3,i.fillStyle=z,this.drawTriangle(i,p,v,V*3),i.globalAlpha=.6,i.fillStyle=z,this.drawTriangle(i,p,v,V*2),i.globalAlpha=.9,i.fillStyle=z,this.drawTriangle(i,p,v,V),i.globalAlpha=1,i.fillStyle="#FFFFFF",this.drawTriangle(i,p,v,V*.3),this.glowTrails.push({x:p,y:v,size:V,color:z,life:1,maxLife:1}),Math.random()<.3&&this.addSparkle(i,p,v,z)}}),i.restore())}onEnd(e){this.lastPoint=null,this.drawingSpeed=1}onClear(e){this.glowTrails=[]}animate(e){const{ctx:t}=e;this.glowTrails=this.glowTrails.filter(i=>(i.life-=.03,i.life>0?(t.save(),t.globalCompositeOperation="screen",t.globalAlpha=i.life*.4,t.fillStyle=i.color,this.drawTriangle(t,i.x,i.y,i.size*2),t.restore(),!0):!1))}calculateSizeMultiplier(e,t){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:a,thicknessMultiplier:s}=t,r=Math.sqrt((e.width||1)*(e.height||1));if(i)return .4*(a[o]||1)*s;{const f=Math.max(0,Math.min(1,(r-5)/95));let d;(e.width||0)===0||(e.height||0)===0?d=3.4:d=4.2+f*.4;const m=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+d*.95*this.sizeSmoothingFactor;return this.lastSizeMultiplier=m,m*(a[o]||1)*s}}getGlowColor(e){const t=this.colorVariants[this.currentVariant],i=t.baseHue,o=t.saturation,a=t.lightness,s=Math.sin(e*Math.PI)*30;return`hsl(${(i+s+360)%360}, ${o}%, ${a}%)`}nextColorVariant(){this.currentTheme=(this.currentTheme+1)%5,this.currentVariant=this.currentTheme,console.log(`Triangle color changed to: ${["Mystical Purple","Electric Neon","Sunset Fuchsia","Ocean Teal","Fire Red"][this.currentTheme]} (variant ${this.currentVariant})`)}resetToDefault(){this.currentVariant=0,this.currentTheme=0}getCurrentVariantName(){return["Mystical Purple","Electric Neon","Sunset Fuchsia","Ocean Teal","Fire Red"][this.currentTheme]||"Unknown"}addSparkle(e,t,i,o){e.save(),e.globalAlpha=.8,e.fillStyle=o;for(let a=0;a<4;a++){const s=a*Math.PI/2,r=t+Math.cos(s)*10,g=i+Math.sin(s)*10;this.drawTriangle(e,r,g,2)}e.restore()}drawTriangle(e,t,i,o){const a=this.colorVariants[this.currentVariant],s=[`hsl(${a.baseHue}, ${a.saturation}%, ${a.lightness}%)`,`hsl(${(a.baseHue+120)%360}, ${a.saturation}%, ${a.lightness}%)`,`hsl(${(a.baseHue+240)%360}, ${a.saturation}%, ${a.lightness}%)`],r=t,g=i-o/2,c=t-o/2,f=i+o/2,d=t+o/2,u=i+o/2;e.beginPath(),e.moveTo(r,g),e.lineTo(c,f),e.strokeStyle=s[0],e.lineWidth=3,e.stroke(),e.beginPath(),e.moveTo(c,f),e.lineTo(d,u),e.strokeStyle=s[1],e.lineWidth=3,e.stroke(),e.beginPath(),e.moveTo(d,u),e.lineTo(r,g),e.strokeStyle=s[2],e.lineWidth=3,e.stroke(),e.beginPath(),e.moveTo(r,g),e.lineTo(c,f),e.lineTo(d,u),e.closePath(),e.fillStyle=`hsla(${a.baseHue}, ${a.saturation}%, ${a.lightness}%, 0.3)`,e.fill()}}class $t{constructor(){this.name="Classic",this.description="Smooth classic drawing with rainbow effects",this.currentVariant=0,this.colorVariants=[{baseHue:216,saturation:90,lightness:50,name:"Ocean Blue"},{baseHue:0,saturation:85,lightness:55,name:"Crimson Red"},{baseHue:120,saturation:80,lightness:50,name:"Forest Green"},{baseHue:45,saturation:90,lightness:60,name:"Golden Yellow"},{baseHue:280,saturation:85,lightness:55,name:"Royal Purple"}],this.styleParams={sparkleIntensity:.3,sparkleSize:2,sparkleCount:3,glowIntensity:.2,pulseSpeed:.02,sizeMultiplier:1,cycleSpeed:8,filter:"none"}}draw(e,t,i){const{x:o,y:a,width:s,height:r}=t,{isEraserMode:g,thicknessMultiplier:c,currentSizeLevel:f,sizeMultipliers:d,isWebApp:u}=i,m=Date.now()*.001,p=this.colorVariants[this.currentVariant],v=p.baseHue,w=this.styleParams.cycleSpeed||8;this.styleParams.filter&&this.styleParams.filter!=="none"&&Math.random()<.3&&(e.filter=this.styleParams.filter);const h=Math.sin(m*w)*30,y=(Math.random()-.5)*20+h,b=(Math.random()-.5)*15+Math.sin(m*3)*10,E=(Math.random()-.5)*15+Math.sin(m*2.5)*8,M=(v+y+360)%360,$=Math.max(70,Math.min(100,p.saturation+b)),V=Math.max(35,Math.min(75,p.lightness+E)),A=`hsl(${M}, ${$}%, ${V}%)`,T=Math.min(1,Math.max(.3,c*Math.max(s,r)/50)),z=T*T,k=.25*(d[f]||1)*Math.max(s,r)*(.5+z*1.5),B=u?.9+Math.random()*.2:.8+Math.random()*.4,W=1+Math.sin(Date.now()/160)*.05,L=k*B*W;if(typeof window.reportActualSize=="function"&&window.reportActualSize("Artistic Pen",f,L),e.save(),g)e.globalCompositeOperation="destination-out",e.fillStyle=A,e.beginPath(),e.arc(o,a,L*1.2,0,2*Math.PI),e.fill();else{e.globalCompositeOperation="source-over";const K=.6+z*.4;e.globalAlpha=K,e.fillStyle=A,e.beginPath(),e.arc(o,a,L,0,2*Math.PI),e.fill(),e.globalAlpha=K*.8,e.fillStyle=`hsl(${M}, ${$}%, ${Math.min(95,V+20)}%)`,e.beginPath(),e.arc(o,a,L*.6,0,2*Math.PI),e.fill();const S=.025+z*.05;if(Math.random()<S){const C=Math.floor(z*.8)+1;for(let U=0;U<C;U++){const O=L*(.5+Math.random()*5),R=Math.random()*Math.PI*2,Y=o+Math.cos(R)*O,G=a+Math.sin(R)*O,N=L*(.1+Math.random()*.9),j=`hsl(${M}, ${$}%, ${V+Math.random()*10}%)`;e.globalAlpha=.4*z,e.fillStyle=j,e.beginPath(),e.arc(Y,G,N,0,2*Math.PI),e.fill()}}if(Math.random()<.1+z*.15){const C=L*(1.1+Math.random()*.4),U=.05+z*.1;e.globalAlpha=U,e.fillStyle=`hsl(${M}, ${$*.8}%, ${V*.9}%)`,e.beginPath(),e.arc(o,a,C,0,2*Math.PI),e.fill()}}e.restore()}nextColorVariant(){this.currentVariant=(this.currentVariant+1)%this.colorVariants.length,this.colorVariants[this.currentVariant]}resetToDefault(){this.currentVariant=0}}class Ot{constructor(){this.name="3D Sphere",this.description="Three-dimensional sphere effects with depth and lighting",this.currentVariant=0,this.lastPoint=null,this.colorVariants=[{baseHue:200,saturation:85,lightness:60,name:"Deep Blue"},{baseHue:15,saturation:90,lightness:55,name:"Fire Orange"},{baseHue:120,saturation:80,lightness:50,name:"Emerald Green"},{baseHue:300,saturation:85,lightness:65,name:"Magenta Pink"},{baseHue:60,saturation:90,lightness:70,name:"Bright Yellow"}],this.styleParams={sphereIntensity:.7,depthEffect:.8,lightingAngle:45}}onStart(e,t){}onMove(e,t){const{ctx:i,isEraserMode:o}=t;e.length<2||(this.lastPoint=e[e.length-1],i.save(),i.globalCompositeOperation=o?"destination-out":"source-over",e.forEach((a,s)=>{if(s===0)return;const r=e[s-1],g=((a.t||0)-(r.t||0))/16;if(g<=0)return;const c=r.x+(a.x-r.x)*g,f=r.y+(a.y-r.y)*g;this.draw3DSphere(i,c,f,a,t)}),i.restore())}onEnd(e){const{ctx:t}=e;this.lastPoint&&this.drawFlatEnd(t,this.lastPoint.x,this.lastPoint.y,this.lastPoint,e)}draw(e,t,i){this.draw3DSphere(e,t.x,t.y,t,i)}draw3DSphere(e,t,i,o,a){const{width:s,height:r}=o,{isEraserMode:g,thicknessMultiplier:c,currentSizeLevel:f,sizeMultipliers:d}=a,u=Date.now()*.001,m=this.colorVariants[this.currentVariant],p=m.baseHue,w=.4*(d[f]||1)*c*Math.max(s,r);if(e.save(),g)e.globalCompositeOperation="destination-out",e.fillStyle="#000000",e.beginPath(),e.arc(t,i,w*1.2,0,2*Math.PI),e.fill();else{e.globalCompositeOperation="source-over";const h=(p+Math.sin(u*2)*30)%360,y=m.saturation,b=m.lightness;e.globalAlpha=1,e.fillStyle="#000000",e.beginPath(),e.arc(t+w*.2,i+w*.2,w*.6,0,2*Math.PI),e.fill(),e.globalAlpha=1,e.fillStyle=`hsl(${h}, ${y}%, ${b}%)`,e.beginPath(),e.arc(t,i,w*.7,0,2*Math.PI),e.fill()}e.restore()}drawFlatEnd(e,t,i,o,a){const{width:s,height:r}=o,{isEraserMode:g,thicknessMultiplier:c,currentSizeLevel:f,sizeMultipliers:d}=a,u=Date.now()*.001,m=this.colorVariants[this.currentVariant],p=m.baseHue,w=.4*(d[f]||1)*c*Math.max(s,r);if(e.save(),g)e.globalCompositeOperation="destination-out",e.fillStyle="#000000",e.beginPath(),e.arc(t,i,w*1.2,0,2*Math.PI),e.fill();else{e.globalCompositeOperation="source-over";const h=(p+Math.sin(u*2)*30)%360,y=m.saturation,b=m.lightness;e.globalAlpha=1,e.fillStyle="#000000",e.beginPath(),e.arc(t+w*.2,i+w*.2,w*.6,0,2*Math.PI),e.fill(),e.globalAlpha=1,e.fillStyle=`hsl(${h}, ${y}%, ${b}%)`,e.beginPath(),e.arc(t,i,w*.7,0,2*Math.PI),e.fill()}e.restore()}drawTwoLine3D(e,t,i,o,a){const{width:s,height:r}=o,{isEraserMode:g,thicknessMultiplier:c,currentSizeLevel:f,sizeMultipliers:d}=a,u=Date.now()*.001,m=this.colorVariants[this.currentVariant],p=m.baseHue,w=.4*(d[f]||1)*c*Math.max(s,r);if(e.save(),g)e.globalCompositeOperation="destination-out",e.fillStyle="#000000",e.beginPath(),e.arc(t,i,w*1.2,0,2*Math.PI),e.fill();else{e.globalCompositeOperation="source-over";const h=(p+Math.sin(u*2)*30)%360,y=m.saturation,b=m.lightness,E=w*.3;e.fillStyle=`hsl(${h}, ${y}%, ${Math.min(95,b+20)}%)`,e.beginPath(),e.arc(t-E,i-E,w*.8,0,2*Math.PI),e.fill(),e.fillStyle=`hsl(${h}, ${y}%, ${Math.max(20,b-20)}%)`,e.beginPath(),e.arc(t+E,i+E,w*.8,0,2*Math.PI),e.fill()}e.restore()}nextColorVariant(){this.currentVariant=(this.currentVariant+1)%this.colorVariants.length}resetToDefault(){this.currentVariant=0}}class Rt{constructor(){this.name="Classic Rainbow",this.description="Original rainbow cycling with sparkle effects",this.currentVariant=0,this.colorVariants=[{baseHue:216,saturation:90,lightness:50,name:"Classic Rainbow"},{baseHue:0,saturation:95,lightness:55,name:"Red Spectrum"},{baseHue:120,saturation:85,lightness:50,name:"Green Rainbow"},{baseHue:240,saturation:90,lightness:60,name:"Blue Spectrum"},{baseHue:60,saturation:95,lightness:65,name:"Yellow Rainbow"}],this.styleParams={sparkleIntensity:.3,sparkleSize:2,sparkleCount:3,glowIntensity:.2,pulseSpeed:.02,sizeMultiplier:1,cycleSpeed:8,filter:"none"}}draw(e,t,i){const{x:o,y:a,width:s,height:r}=t,{isEraserMode:g,thicknessMultiplier:c,currentSizeLevel:f,sizeMultipliers:d,isWebApp:u}=i,m=Date.now()*.001,p=this.colorVariants[this.currentVariant],v=p.baseHue,w=this.styleParams.cycleSpeed||8;this.styleParams.filter&&this.styleParams.filter!=="none"&&Math.random()<.3&&(e.filter=this.styleParams.filter);const h=Math.sin(m*w)*100,y=(Math.random()-.5)*80+h,b=(Math.random()-.5)*40+Math.sin(m*3)*20,E=(Math.random()-.5)*35+Math.sin(m*2.5)*15,M=(v+y+360)%360,$=Math.max(70,Math.min(100,p.saturation+b)),V=Math.max(35,Math.min(85,p.lightness+E)),A=`hsl(${M}, ${$}%, ${V}%)`,T=Math.max(s,r)/2*(.95+Math.random()*.1),z=1+Math.sin(Date.now()/160)*.03,I=T*z;if(typeof window.reportActualSize=="function"&&window.reportActualSize("Original Style 1",f,I),e.save(),g)e.globalCompositeOperation="source-over",e.fillStyle="#151E35",e.beginPath(),e.arc(o,a,I,0,2*Math.PI),e.fill();else if(e.globalCompositeOperation="source-over",e.fillStyle=A,e.beginPath(),e.arc(o,a,I,0,2*Math.PI),e.fill(),Math.max(s,r)>10){let x;u?x=.6:x=.3,Math.random()<x&&(e.save(),e.globalAlpha=.5,this.addSparkleEffect(e,o,a,Math.max(s,r)/2.5),e.restore())}this.styleParams.filter&&this.styleParams.filter!=="none"&&(e.filter="none"),e.restore()}addSparkleEffect(e,t,i,o){const a=Math.floor(Math.random()*4)+2,s=o*(.1+Math.random()*.2);for(let r=0;r<a;r++){const g=t+(Math.random()-.5)*o*1.5,c=i+(Math.random()-.5)*o*1.5,f=.4+Math.random()*.4;e.globalAlpha=f,e.fillStyle="#ffffff",e.beginPath(),e.arc(g,c,s,0,2*Math.PI),e.fill()}}nextColorVariant(){this.currentVariant=(this.currentVariant+1)%this.colorVariants.length}resetToDefault(){this.currentVariant=0}}class Ht{constructor(){this.name="Clean Plasma",this.description="Swirling plasma energy with dynamic particles",this.currentVariant=0,this.colorVariants=[{baseHue:280,plasmaHue:280,saturation:100,plasmaSaturation:100,lightness:50,plasmaLightness:70,name:"Purple Plasma"},{baseHue:0,plasmaHue:15,saturation:100,plasmaSaturation:95,lightness:55,plasmaLightness:75,name:"Red Energy"}],this.styleParams={swirlSpeed:.001,particleCount:1},this.plasmaTrail=[],this.lastPlasmaTime=0}draw(e,t,i){const{x:o,y:a,width:s,height:r}=t,{isEraserMode:g,thicknessMultiplier:c,currentSizeLevel:f,sizeMultipliers:d}=i,u=Date.now(),p=.5*(d[f]||1)*c*Math.max(s,r);e.save();const v=this.colorVariants[this.currentVariant],w=v.baseHue;v.plasmaHue;const h=this.styleParams.swirlSpeed||.01;this.styleParams.particleCount;const y=Math.sin(u*h)*.4+.6,b=Math.sin(u*h*1.5)*.3+.7,E=Math.sin(u*h*.7)*.2+.8,M=(y+b+E)/3,$=`hsl(${w}, ${v.saturation}%, ${v.lightness+M*30}%)`,V=Math.sin(u/200)*.4+.6,A=p*V*M;u-this.lastPlasmaTime>150&&(this.plasmaTrail.push({x:o,y:a,size:A,color:$,timestamp:u,angle:Math.random()*Math.PI*2}),this.lastPlasmaTime=u,this.plasmaTrail.length>3&&this.plasmaTrail.shift()),g?(e.globalCompositeOperation="destination-out",e.fillStyle=$,e.beginPath(),e.arc(o,a,A*1.3,0,2*Math.PI),e.fill()):(e.globalCompositeOperation="source-over",e.globalAlpha=.9*M,e.fillStyle=`hsl(${w}, ${v.saturation}%, ${v.lightness+M*15}%)`,e.beginPath(),e.arc(o,a,A*.8,0,2*Math.PI),e.fill(),this.plasmaTrail.slice(-3).forEach((T,z)=>{const I=u-T.timestamp;if(I<500){const x=I/500,k=(1-x)*M*.6,B=T.size*(1-x*.5),W=Math.sin((u-T.timestamp)*h*2)*.3+.7;e.globalAlpha=k*W,e.fillStyle=T.color,e.beginPath(),e.arc(T.x,T.y,B,0,2*Math.PI),e.fill()}})),this.plasmaTrail=this.plasmaTrail.filter(T=>u-T.timestamp<700),e.restore()}nextColorVariant(){this.currentVariant=(this.currentVariant+1)%this.colorVariants.length}resetToDefault(){this.currentVariant=0}getCurrentVariantName(){return this.colorVariants[this.currentVariant].name}}class Dt{constructor(){this.styles=[],this.currentStyleIndex=0,this.styles=[new Vt,new $t,new Ot,new Ht,new Rt],this.currentStyle=this.styles[0]}getCurrentStyle(){return this.currentStyle}getCurrentStyleIndex(){return this.currentStyleIndex}getAllStyles(){return this.styles}switchToStyle(e){e>=0&&e<this.styles.length&&(this.currentStyleIndex=e,this.currentStyle=this.styles[e])}nextStyle(){const e=(this.currentStyleIndex+1)%this.styles.length;this.switchToStyle(e)}previousStyle(){const e=this.currentStyleIndex===0?this.styles.length-1:this.currentStyleIndex-1;this.switchToStyle(e)}onStart(e,t){this.currentStyle.onStart?.(e,t)}onMove(e,t){this.currentStyle.onMove?.(e,t)}onEnd(e){this.currentStyle.onEnd?.(e)}onClear(e){this.currentStyle.onClear?.(e),this.styles.forEach(t=>{t!==this.currentStyle&&t.onClear?.(e)})}animate(e){this.currentStyle.animate?.(e),this.styles.forEach(t=>{t!==this.currentStyle&&t.animate&&t.animate(e)})}}class Bt{constructor(e,t,i){this.slices=[],this.locked=0,this.container=e,this.currentSize=t,this.locked=t+1,this.onSizeChange=i,this.init()}init(){this.container.innerHTML=`
      <div class="pizza-size-selector">
        <div class="pizza" id="pizza">
          <div class="slice s1" data-n="1"></div>
          <div class="slice s2" data-n="2"></div>
          <div class="slice s3" data-n="3"></div>
          <div class="slice s4" data-n="4"></div>
          <div class="slice s5" data-n="5"></div>
          <div class="slice s6" data-n="6"></div>
        </div>
      </div>
    `,this.setupEventListeners()}setupEventListeners(){const e=this.container.querySelector("#pizza");e&&(this.slices=Array.from(e.querySelectorAll(".slice")),e.addEventListener("touchstart",t=>{t.preventDefault(),t.stopPropagation(),e.classList.add("pressed"),this.cycleSize()}),e.addEventListener("touchend",t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("pressed")}),e.addEventListener("click",t=>{t.stopPropagation(),this.cycleSize()}),this.highlight(this.locked))}cycleSize(){this.currentSize=(this.currentSize+1)%6,this.locked=this.currentSize+1,this.highlight(this.locked),this.onSizeChange(this.currentSize)}highlight(e){this.slices.forEach(t=>{t.classList.toggle("active",parseInt(t.dataset.n||"1")<=e)})}setSize(e){this.currentSize=e,this.locked=e+1,this.highlight(this.locked),this.onSizeChange(e)}getSize(){return this.currentSize}}function Wt(){const n=document.querySelector(".one-front-credit");n&&(n.style.transform="scale(0.85)",n.style.opacity="0.7",setTimeout(()=>{n.style.transform="",n.style.opacity=""},200)),"vibrate"in navigator&&navigator.vibrate(50);const e=document.getElementById("info-popup");e&&(e.style.display="block")}function tt(){const n=document.getElementById("info-popup");n&&(n.style.display="none")}let Le=!1;function je(){const n=document.getElementById("menu-toggle"),e=document.getElementById("tools-container");!n||!e||(Le=!Le,Le?(e.classList.add("collapsed"),n.classList.add("collapsed"),n.querySelector(".menu-toggle-icon").textContent="▲",n.style.bottom="25px"):(e.classList.remove("collapsed"),n.classList.remove("collapsed"),n.querySelector(".menu-toggle-icon").textContent="▼",n.style.bottom="120px"),"vibrate"in navigator&&navigator.vibrate(30))}setTimeout(()=>{const n=document.getElementById("app"),e=document.getElementById("splash-screen");if(n&&e&&!n.querySelector("canvas")){e.style.display="none";const t=document.getElementById("info-popup");t&&(t.style.display="block")}},5e3);let l=null,ae=!1,fe=[];const q=new Dt,Q=window.innerWidth>768;let H=2;const he=[1,2,2.5,3,3.5,4];let Ne=.25;const qe=.15;let J=1;const nt=70;let Je=0;const Ft=1e3;window.emergencyClear=function(){const n=document.getElementById("drawing-canvas");n&&me(n),window.gc&&window.gc()};function Kt(){const n=Date.now();if(n-Je<Ft)return;Je=n;const e=performance.memory;if(e){const t=e.usedJSHeapSize/1024/1024,i=e.totalJSHeapSize/1024/1024;if(t/i*100>nt){const a=document.getElementById("drawing-canvas");if(a&&me(a),window.gc&&window.gc(),a){const s=a.getContext("2d");s&&(s.save(),s.fillStyle="rgba(255, 0, 0, 0.8)",s.fillRect(0,0,a.width,a.height),s.fillStyle="white",s.font="bold 24px Arial",s.textAlign="center",s.fillText("Memory Limit Reached",a.width/2,a.height/2-20),s.fillText("Canvas Auto-Cleared",a.width/2,a.height/2+20),s.restore(),setTimeout(()=>{s&&s.clearRect(0,0,a.width,a.height)},2e3))}}}}let D=!1,ee=!1,ge=!1;function Ut(){const n=document.getElementById("debugger-toggle"),e=document.getElementById("debug-info");n&&e&&(n.classList.toggle("active",ee),e.style.display=ee?"block":"none",n.addEventListener("click",t=>{t.stopPropagation(),ee=!ee,n.classList.toggle("active",ee),e.style.display=ee?"block":"none",ee&&He()}))}function Gt(){const n=document.getElementById("labels-toggle");if(n){n.classList.toggle("active",ge);const e=document.querySelectorAll(".tool-label");e.forEach(t=>{const i=t;i.style.display="none"}),n.addEventListener("click",t=>{t.stopPropagation(),ge=!ge,n.classList.toggle("active",ge),e.forEach(i=>{const o=i;o.style.display=ge?"block":"none"})})}}let ne={},Te=0;function _t(n,e,t){ne[n]||(ne[n]={}),ne[n][e]=t;const i=Date.now();i-Te>100&&(Te=i,st())}let F=1,xe=!1;function jt(){const n=D?Math.min(H+4,he.length-1):H;return{ctx:l,isEraserMode:D,thicknessMultiplier:J,currentSizeLevel:n,sizeMultipliers:he,isWebApp:Q}}function _(n,e,t,i,o){const a={x:e,y:t,width:i,height:o,t:Date.now()},s=jt(),r=q.getCurrentStyle();if(ee){const f=.15*(he[H]||1)*J*Math.max(i,o);ne[r.name]||(ne[r.name]={}),ne[r.name][H]=f;const d=Date.now();d-Te>100&&(Te=d,st())}r.draw(n,a,s)}function le(n,e){const t=Math.sqrt(n*e);if(Q)return .15*(he[H]||1)*J;{const a=Math.max(0,Math.min(1,(t-5)/95));let s;n===0||e===0?s=.2:s=.1+a*.2;const r=.98+Math.random()*.04,g=Ne*(1-qe)+s*r*qe;return Ne=g,g*(he[H]||1)*J}}function Ye(n,e,t){const i=n.getBoundingClientRect();return{x:e-i.left,y:t-i.top}}function Ae(n){const e=window.visualViewport,t=e?e.width:window.innerWidth,i=e?e.height:window.innerHeight,o=window.devicePixelRatio||1;n.width=Math.max(1,Math.floor(t*o)),n.height=Math.max(1,Math.floor(i*o)),n.style.width=t+"px",n.style.height=i+"px",l&&(l.scale(o,o),l.lineCap="round",l.lineJoin="round",l.strokeStyle="#111",me(n))}function it(){const n=document.getElementById("save-modal");n&&(n.style.display="block")}function Ce(){const n=document.getElementById("save-modal");n&&(n.style.display="none")}function at(){const n=document.getElementById("processing-spinner");n&&(n.style.display="block")}function Z(){const n=document.getElementById("processing-spinner");n&&(n.style.display="none")}window.openSaveModal=it;window.closeSaveModal=Ce;window.showProcessingSpinner=at;window.hideProcessingSpinner=Z;function Nt(n){switch(n){case"2K":return{width:2048,height:1152};case"5K":return{width:5120,height:2880};case"10K":return{width:10240,height:5760};case"20K":return{width:16384,height:9216};default:return{width:2048,height:1152}}}function qt(n){const t=window.devicePixelRatio||1,i=n.width/(t*2),o=n.height/(t*2),a=16384/i,s=16384/o,r=Math.min(a,s),g=Math.floor(i*r),c=Math.floor(o*r);let f="";return r>=100?f="Browser canvas limit (16K pixels)":r>=50?f="High resolution - excellent quality":r>=20?f="Medium resolution - good quality":f="Limited by canvas size",{maxScale:r,maxWidth:g,maxHeight:c,reason:f}}async function Jt(n,e,t){try{const i=new OffscreenCanvas(2e4,11250),o=i.getContext("2d");if(!o){console.error("Failed to create OffscreenCanvas context"),Z();return}o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.lineWidth=.1,o.lineCap="round",o.lineJoin="round";const a=2e4/n.width;o.scale(a,a),o.drawImage(n,0,0);const s=await i.convertToBlob({type:t==="PNG"?"image/png":"image/jpeg",quality:t==="JPEG"?1:void 0}),r=URL.createObjectURL(s),g=document.createElement("a");g.href=r,g.download=`VIBE-DRAWING-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.${t.toLowerCase()}`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(r),Z()}catch(i){console.error("OffscreenCanvas export failed:",i),Z(),ot(n,e,t)}}function Yt(n,e){try{const t=n.toDataURL("image/png"),i=`
      <svg xmlns="http://www.w3.org/2000/svg" 
           width="${n.width}" 
           height="${n.height}" 
           viewBox="0 0 ${n.width} ${n.height}">
        <image href="${t}" 
               width="${n.width}" 
               height="${n.height}" 
               preserveAspectRatio="none"/>
      </svg>
    `,o=new Blob([i],{type:"image/svg+xml"}),a=URL.createObjectURL(o),s=document.createElement("a");s.href=a,s.download=`VIBE-DRAWING-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.svg`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a),Z()}catch(t){console.error("SVG export failed:",t),Z()}}function ot(n,e,t){try{if(at(),typeof OffscreenCanvas<"u"&&e==="20K"){Jt(n,e,t);return}if(t==="SVG"){Yt(n,e);return}const{width:i,height:o}=Nt(e),a=16384;if(i>a||o>a){console.warn(`Resolution ${e} (${i}x${o}) exceeds browser limits. Using maximum supported size.`),Z();let L="";e==="10K"||e==="20K"?L="Please try a lower resolution like 2K or 5K.":e==="5K"?L="Please try 2K resolution.":L="Please try a lower resolution.",alert(`Resolution ${e} is too large for your browser. ${L}`);return}let s,r;if((e==="10K"||e==="20K")&&(i>a||o>a)){const L=i/o;L>1?(s=a,r=Math.round(a/L)):(r=a,s=Math.round(a*L))}else s=i,r=o;const g=document.createElement("canvas"),c=g.getContext("2d");if(!c){console.error("Failed to create temporary canvas context"),Z();return}const f=n.width/(devicePixelRatio*2),d=n.height/(devicePixelRatio*2),u=f/d;let m,p;e==="2K"?(m=600,p=12,s=f*p,r=d*p):e==="5K"?(m=1200,p=30,s=f*p,r=d*p):e==="10K"?(m=2400,p=60,s=f*p,r=d*p):e==="20K"?(m=4800,p=120,s=f*p,r=d*p):(m=144,p=2,u>i/o?(s=i,r=Math.round(i/u)):(r=o,s=Math.round(o*u)));const v=`${s}x${r}`,w=e==="20K"?"16K (browser limit)":e;if(s>a||r>a){const L=Math.min(a/f,a/d);s=f*L,r=d*L}const h=`${s}x${r}`,y=e==="20K"?"16K (browser limit)":e;if(g.width=s,g.height=r,c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.lineWidth=.5,c.lineCap="round",c.lineJoin="round",e==="20K"?(c.textBaseline="alphabetic",c.textAlign="start",c.fontKerning="normal"):e==="10K"&&(c.textBaseline="alphabetic",c.textAlign="start"),e==="20K"){const L=qt(n),K=document.createElement("canvas"),S=K.getContext("2d");if(S){K.width=L.maxWidth,K.height=L.maxHeight,S.imageSmoothingEnabled=!1,S.textBaseline="alphabetic",S.textAlign="start",S.fontKerning="normal",S.lineWidth=.25,S.lineCap="round",S.lineJoin="round",S.scale(L.maxScale,L.maxScale);const C=S.createLinearGradient(0,0,f,d);C.addColorStop(0,"#1a1a2e"),C.addColorStop(.5,"#16213e"),C.addColorStop(1,"#151E35"),S.fillStyle=C,S.fillRect(0,0,f,d),S.fillStyle="rgba(255, 255, 255, 0.3)";for(let U=0;U<200;U++){const O=Math.random()*f,R=Math.random()*d,Y=Math.random()*3+1;S.beginPath(),S.arc(O,R,Y,0,2*Math.PI),S.fill()}S.drawImage(n,0,0,f,d),c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.drawImage(K,0,0,s,r)}else c.drawImage(n,0,0,s,r)}else{const L=Math.max(s/f,r/d);if(e==="10K"||e==="20K"||L>8){const S=document.createElement("canvas"),C=S.getContext("2d");if(C)if(S.width=6144,S.height=6144*(d/f),C.imageSmoothingEnabled=!0,C.imageSmoothingQuality="high",C.textBaseline="alphabetic",C.textAlign="start",C.fontKerning="normal",C.lineWidth=.25,C.lineCap="round",C.lineJoin="round",C.drawImage(n,0,0,S.width,S.height),e==="10K"||e==="20K"||L>16){const O=document.createElement("canvas"),R=O.getContext("2d");if(R)if(O.width=12288,O.height=12288*(d/f),R.imageSmoothingEnabled=!0,R.imageSmoothingQuality="high",R.textBaseline="alphabetic",R.textAlign="start",R.fontKerning="normal",R.lineWidth=.25,R.lineCap="round",R.lineJoin="round",R.drawImage(S,0,0,O.width,O.height),e==="20K"||L>24){const G=document.createElement("canvas"),N=G.getContext("2d");N?(G.width=16384,G.height=16384*(d/f),N.imageSmoothingEnabled=!0,N.imageSmoothingQuality="high",N.textBaseline="alphabetic",N.textAlign="start",N.fontKerning="normal",N.lineWidth=.25,N.lineCap="round",N.lineJoin="round",N.drawImage(O,0,0,G.width,G.height),c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.textBaseline="alphabetic",c.textAlign="start",c.fontKerning="normal",c.lineWidth=.125,c.lineCap="round",c.lineJoin="round",c.drawImage(G,0,0,s,r)):c.drawImage(O,0,0,s,r)}else c.drawImage(O,0,0,s,r);else c.drawImage(S,0,0,s,r)}else c.drawImage(S,0,0,s,r);else c.drawImage(n,0,0,s,r)}else if(L>4){const K=Math.min(6144,Math.max(f,d)*3),S=document.createElement("canvas"),C=S.getContext("2d");C?(S.width=K,S.height=K*(d/f),C.imageSmoothingEnabled=!0,C.imageSmoothingQuality="high",C.textBaseline="alphabetic",C.textAlign="start",C.fontKerning="normal",C.lineWidth=.25,C.lineCap="round",C.lineJoin="round",C.drawImage(n,0,0,S.width,S.height),c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.textBaseline="alphabetic",c.textAlign="start",c.fontKerning="normal",c.lineWidth=.25,c.lineCap="round",c.lineJoin="round",c.drawImage(S,0,0,s,r)):c.drawImage(n,0,0,s,r)}else c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.textBaseline="alphabetic",c.textAlign="start",c.fontKerning="normal",c.lineWidth=.25,c.lineCap="round",c.lineJoin="round",c.drawImage(n,0,0,s,r)}const b=new Date,E=`VIBE DRAWING by Michael Wybraniec | one-front.com | ${b.toLocaleDateString()} | ${m} DPI`;c.save(),c.textAlign="right",c.textBaseline="bottom";const M=Math.max(8,s/300),$=Math.max(4,s/200),V=$*.8;c.font=`${M}px Inter, sans-serif`;const T=c.measureText(E).width+V*2,z=M+V*2,I=s-T-$,x=r-z-$;c.fillStyle="rgba(0, 0, 0, 0.6)",c.beginPath(),c.roundRect(I,x,T,z,$*.5),c.fill(),c.strokeStyle="rgba(255, 215, 0, 0.2)",c.lineWidth=.5,c.stroke(),c.fillStyle="rgba(255, 255, 255, 0.8)",c.font=`${M}px Inter, sans-serif`,c.fillText(E,s-$-V,r-$-V),c.restore();let k,B,W;switch(t){case"PNG":k="image/png",B=1,W="png";break;case"JPEG":k="image/jpeg",B=.95,W="jpg";break;case"WEBP":k="image/webp",B=.95,W="webp";break;case"TIFF":k="image/png",B=1,W="png",console.warn("TIFF format not supported by browsers, exporting as PNG instead");break;case"PDF":k="image/png",B=1,W="png",console.warn("PDF format not supported by browsers, exporting as PNG instead");break;default:k="image/png",B=1,W="png"}g.toBlob(L=>{if(!L){console.error("Failed to create image blob"),Z();return}Z();const K=URL.createObjectURL(L),S=document.createElement("a");S.href=K;const C=b.toISOString().replace(/[:.]/g,"").slice(0,15);S.download=`VIBE-DRAWING-${C}-${e}.${W}`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(K)},k,B)}catch(i){console.error("Error saving canvas:",i),Z()}}function Qt(n){const e=window.devicePixelRatio||1,t=n.clientWidth,i=n.clientHeight,o=2;if(n.width=t*e*o,n.height=i*e*o,n.style.width=t+"px",n.style.height=i+"px",l=n.getContext("2d",{alpha:!0,antialias:!0,willReadFrequently:!1}),!l){console.error("Failed to get 2D context!");return}l.scale(e*o,e*o),l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.lineCap="round",l.lineJoin="round",l.strokeStyle="#111",l.lineWidth=2,l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.textBaseline="alphabetic",l.textAlign="start",l.fontKerning="normal",me(n)}function me(n){if(!l){console.error("Cannot clear canvas - no context!");return}const e=n.clientWidth,t=n.clientHeight,i="#151E35";l.fillStyle=i,l.fillRect(0,0,e,t);const o=e/2,a=t/2,s=Math.sqrt(o*o+a*a),r=l.createRadialGradient(o,a,0,o,a,s);r.addColorStop(0,"rgba(0, 0, 0, 0)"),r.addColorStop(.7,"rgba(0, 0, 0, 0)"),r.addColorStop(1,"rgba(0, 0, 0, 0.15)"),l.fillStyle=r,l.fillRect(0,0,e,t),l.fillStyle="rgba(255, 255, 255, 0.3)";for(let g=0;g<50;g++){const c=Math.random()*e,f=Math.random()*t,d=Math.random()*2+1;l.beginPath(),l.arc(c,f,d,0,2*Math.PI),l.fill()}l.lineWidth=20,ee&&He()}function He(){const n=document.getElementById("debug-current-info"),e=document.getElementById("debug-size-info");if(!n||!e)return;const t=q.getCurrentStyle(),i=q.getCurrentStyleIndex(),o=performance.memory;let a="N/A",s="N/A",r="#666666",g="";if(o){const m=o.usedJSHeapSize/1024/1024,p=o.totalJSHeapSize/1024/1024,v=m/p*100;a=m.toFixed(1),s=p.toFixed(1),v<30?(r="#66ff66",g="Low"):v<60?(r="#ffff66",g="Medium"):v<80?(r="#ffaa66",g="High"):(r="#ff6666",g="Critical")}const c=[`Style ${i+1}: ${t.name}`,`Size: ${["Tiny","Small","Medium","Large","Huge","Giant"][H]} (${he[H]?.toFixed(2)}x)`,`Thickness: ${J.toFixed(2)}x (Range: 0.2x-5.0x, Arrow Keys)`,`Eraser: ${D?"ON":"OFF"}`,`Memory: <span style="color: ${r}">${a}MB/${s}MB (${g})</span> | Limit: ${nt}%`];n.innerHTML=c.map(m=>`<div>${m}</div>`).join("");const f=["T","S","M","L","H","G"];let d='<div style="color: #ffff00; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">SIZE TRACKING</div>';d+='<div style="margin: 8px 0; color: #cccccc; font-family: monospace; font-size: 11px;">Style '+f.map(m=>m.padStart(6)).join("")+"</div>";const u=Object.keys(ne);u.forEach((m,p)=>{let v=m.padEnd(6);for(let h=0;h<6;h++){const y=ne[m]?.[h];if(y!==void 0){const b=y<1?"#ff6666":y<3?"#ffff66":"#66ff66";v+=`<span style="color: ${b}">${y.toFixed(1).padStart(6)}</span>`}else v+='<span style="color: #666666">0.0'.padStart(6)+"</span>"}const w=p%2===0?"#ffffff":"#cccccc";d+=`<div style="color: ${w}; font-family: monospace; font-size: 11px; margin: 2px 0; padding-left: 8px;">${v}</div>`}),d+='<div style="margin-top: 16px; color: #ffff00; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">PROGRESSION RATIOS</div>',u.forEach(m=>{const p=ne[m];if(p){const v=[];for(let h=0;h<4;h++){const y=p[h],b=p[h+1];if(y!==void 0&&b!==void 0){const E=b/y;v.push(E.toFixed(1))}}const w=`${m}: ${v.join(" → ")}`;d+=`<div style="color: #cccccc; margin: 4px 0; padding-left: 8px; font-family: monospace; font-size: 11px;">${w}</div>`}}),e.innerHTML=d}function st(){ee&&He()}function Xt(n){n.addEventListener("touchstart",t=>t.preventDefault(),{passive:!1}),n.addEventListener("touchmove",t=>t.preventDefault(),{passive:!1}),n.addEventListener("touchend",t=>t.preventDefault(),{passive:!1}),n.addEventListener("pointerdown",t=>{if(t.pointerType,ae||F===2&&xe)return;const i=t.pointerType==="pen",o=t.pointerType==="touch";t.pointerType;let a=t.pressure!==void 0?t.pressure:.5;i&&(a=Math.max(.1,Math.min(1,a))),n.setPointerCapture(t.pointerId),ae=!0,F===2&&(xe=!0),fe=[];const{x:s,y:r}=Ye(n,t.clientX,t.clientY);let g=le(t.width||1,t.height||1);if(i?g*=.3+a*.7:o&&(g*=.5+a*.5),fe.push({x:s,y:r,t:t.timeStamp,width:10,height:10}),At(),l){const c=t.width||1,f=t.height||1;let d,u,m;Q?(d=45,u=45,m=1):(d=Math.max(c,30),u=Math.max(f,30),m=c>1||f>1?1.2:1);const p=d*g*m,v=u*g*m,w=Math.max(p,v),h=q.getCurrentStyleIndex();if(h===0)_(l,s,r,p,v);else if(h===1)if(D){l.save(),l.globalCompositeOperation="destination-out";const y=p/2*(.95+Math.random()*.1),b=1+Math.sin(Date.now()/160)*.03,M=y*b*(1+H*.3)*J,V=Math.max(3,M)*.15;l.fillStyle="rgba(0, 0, 0, 1)",l.beginPath(),l.arc(s,r,V,0,2*Math.PI),l.fill(),l.restore()}else _(l,s,r,p,v);else if(h===2)if(D){l.save(),l.globalCompositeOperation="destination-out";const y=p/2*(.95+Math.random()*.1),b=1+Math.sin(Date.now()/160)*.03,M=y*b*.3;l.fillStyle="rgba(0, 0, 0, 1)",l.beginPath(),l.arc(s,r,M,0,2*Math.PI),l.fill(),l.restore()}else _(l,s,r,p,v);else if(h===3)if(D){l.save(),l.globalCompositeOperation="destination-out";const y=le(p,v),E=Math.max(p,v)*.4*y*1.5;l.fillStyle="rgba(0, 0, 0, 1)",l.beginPath(),l.arc(s,r,E,0,2*Math.PI),l.fill(),l.restore()}else _(l,s,r,p,v);else if(h===4)if(D){l.save(),l.globalCompositeOperation="destination-out";const y=le(p,v),M=Math.max(p,v)*.25*y*(1+H*.3)*J*1.5;l.fillStyle="rgba(0, 0, 0, 1)",l.beginPath(),l.arc(s,r,M,0,2*Math.PI),l.fill(),l.restore()}else _(l,s,r,p,v);else if(h===5)if(D){l.save(),l.globalCompositeOperation="destination-out";const y=Math.max(p,v)*3;l.fillStyle="rgba(0, 0, 0, 1)",l.beginPath(),l.arc(s,r,y,0,2*Math.PI),l.fill(),l.restore()}else _(l,s,r,p,v);else if(h===6)_(l,s,r,p,v);else if(h===7)_(l,s,r,p,v);else{l.save(),l.globalAlpha=.8;const y=1+Math.sin(Date.now()/200)*.1,b=p/2*y,E=v/2*y;if(D?(l.globalCompositeOperation="source-over",l.fillStyle="#151E35"):(l.globalCompositeOperation="source-over",l.fillStyle="#000000"),D){const M=l.createRadialGradient(s,r,0,s,r,Math.max(b,E));M.addColorStop(0,"#151E35"),M.addColorStop(.7,"#151E35"),M.addColorStop(1,"#151E35"),l.fillStyle=M}else{const M=l.createRadialGradient(s,r,0,s,r,Math.max(b,E));M.addColorStop(0,"#000000"),M.addColorStop(.7,"#333333"),M.addColorStop(1,"#666666"),l.fillStyle=M}l.beginPath(),l.ellipse(s,r,b,E,0,0,2*Math.PI),l.fill(),l.restore(),w>15&&!D&&q.getCurrentStyleIndex()===0&&Math.random()<.7&&(l.save(),l.globalAlpha=.5,l.restore())}}else console.error("Canvas context is null! Cannot draw.")}),n.addEventListener("pointermove",t=>{if(ae&&Kt(),t.pointerType,!ae)return;const{x:i,y:o}=Ye(n,t.clientX,t.clientY),a=fe[fe.length-1],s=Math.max(.001,t.timeStamp-(a.t||0)),r=i-a.x,g=o-a.y,c=Math.hypot(r,g)/s,f=c>2,d=!Q,u=t.pointerType==="pen",m=t.pointerType==="touch";t.pointerType;let p=t.pressure!==void 0?t.pressure:.5;u&&(p=Math.max(.1,Math.min(1,p)));let v=le(t.width||1,t.height||1);if(u?v*=.3+p*.7:m&&(v*=.5+p*.5),fe.push({x:i,y:o,t:t.timeStamp,speed:c,width:10,height:10}),!l)return;const w=Math.hypot(i-a.x,o-a.y);let h;u?h=F===2||F===5?.4:.3:d&&f?h=F===2||F===5?3:2.5:h=F===2||F===5?2:Q?.3:1.5;const y=Math.max(1,Math.ceil(w/h));let b;u?b=F===2||F===5?3.5:7:d&&f?b=F===2||F===5?.5:.8:b=F===2||F===5?1:Q?5:1.5;const M=Math.max(F===2||F===5?1:Q?8:2,Math.ceil(y*b)),$=t.width||1,V=t.height||1;let A,T,z;Q?(A=45,T=45,z=1):(A=Math.max($,30),T=Math.max(V,30),z=$>1||V>1?1.2:1);const I=A*v*z,x=T*v*z;l.save(),l.globalAlpha=.8;for(let k=0;k<=M;k++){const B=k/M,W=a.x+(i-a.x)*B,L=a.y+(o-a.y)*B,K=Math.sin(k*.5)*.1,S=W+K,C=L+K,U=q.getCurrentStyleIndex();if(U===0)_(l,S,C,I,x);else if(U===1)if(D){l.save(),l.globalCompositeOperation="destination-out";const O=I/2*(.95+Math.random()*.1),R=1+Math.sin(Date.now()/160)*.03,G=O*R*(1+H*.3)*J,j=Math.max(3,G)*.15;l.fillStyle="rgba(0, 0, 0, 1)",l.beginPath(),l.arc(S,C,j,0,2*Math.PI),l.fill(),l.restore()}else _(l,S,C,I,x);else if(U===2)if(D){l.save(),l.globalCompositeOperation="destination-out";const O=I/2*(.95+Math.random()*.1),R=1+Math.sin(Date.now()/160)*.03,G=O*R*.3;l.fillStyle="rgba(0, 0, 0, 1)",l.beginPath(),l.arc(S,C,G,0,2*Math.PI),l.fill(),l.restore()}else _(l,S,C,I,x);else if(U===3)if(D){l.save(),l.globalCompositeOperation="destination-out";const O=le(I,x),Y=Math.max(I,x)*.4*O*1.5;l.fillStyle="rgba(0, 0, 0, 1)",l.beginPath(),l.arc(S,C,Y,0,2*Math.PI),l.fill(),l.restore()}else _(l,S,C,I,x);else if(U===4)if(D){l.save(),l.globalCompositeOperation="destination-out";const O=le(I,x),G=Math.max(I,x)*.25*O*(1+H*.3)*J*1.5;l.fillStyle="rgba(0, 0, 0, 1)",l.beginPath(),l.arc(S,C,G,0,2*Math.PI),l.fill(),l.restore()}else _(l,S,C,I,x);else if(U===5)_(l,S,C,I,x);else if(U===6)_(l,S,C,I,x);else if(U===7)_(l,S,C,I,x);else{let O;u?O=.98+Math.random()*.04:O=.95+Math.random()*.1;const R=1+Math.sin((Date.now()+k*40)/160)*.03,Y=I/2*O*R,G=x/2*O*R;if(D?(l.globalCompositeOperation="source-over",l.fillStyle="#151E35"):l.globalCompositeOperation="source-over",l.beginPath(),l.ellipse(W,L,Y,G,0,0,2*Math.PI),l.fill(),Math.max(I,x)>10&&!D)if(q.getCurrentStyleIndex()===0){let j;Q?j=.6:d&&f?j=.1:j=.3,j&&Math.random()<j&&(l.save(),l.globalAlpha=.5,l.restore())}else{let j;u?j=.4:Q?j=.2:d&&f?j=.02:j=.1,Math.random()<j&&(l.save(),l.globalAlpha=.4,l.restore())}}}l.restore()});const e=t=>{if(ae){ae=!1,F===2&&(xe=!1),n.releasePointerCapture(t.pointerId);try{if(P&&P.state!=="suspended"){const i=P.createOscillator(),o=P.createGain();i.connect(o),o.connect(P.destination),i.frequency.setValueAtTime(400,P.currentTime),i.frequency.exponentialRampToValueAtTime(200,P.currentTime+.2),o.gain.setValueAtTime(.15,P.currentTime),o.gain.exponentialRampToValueAtTime(.01,P.currentTime+.2),i.start(P.currentTime),i.stop(P.currentTime+.2)}}catch(i){console.error("Error playing drawing end sound:",i)}}};n.addEventListener("pointerup",e),n.addEventListener("pointercancel",e),n.addEventListener("pointerleave",e)}let P=null,Ee=!1;function De(){if(!Ee)try{P=new(window.AudioContext||window.webkitAudioContext),Ee=!0}catch{Ee=!0}}function rt(){P||De(),P&&P.state==="suspended"&&P.resume().catch(console.warn);try{if(!P){console.warn("Audio context not available for splash sound");return}const n=P.createOscillator(),e=P.createGain();n.connect(e),e.connect(P.destination),n.frequency.setValueAtTime(400,P.currentTime),n.frequency.exponentialRampToValueAtTime(800,P.currentTime+.2),n.frequency.exponentialRampToValueAtTime(600,P.currentTime+.4),n.frequency.exponentialRampToValueAtTime(900,P.currentTime+.6),e.gain.setValueAtTime(.2,P.currentTime),e.gain.exponentialRampToValueAtTime(.4,P.currentTime+.2),e.gain.exponentialRampToValueAtTime(.2,P.currentTime+.4),e.gain.exponentialRampToValueAtTime(.01,P.currentTime+.6),n.start(P.currentTime),n.stop(P.currentTime+.6)}catch(n){console.error("Error playing splash sound:",n)}}function Zt(){(!P||P.state==="suspended")&&P?.resume();try{if(!P)return;const n=P.createOscillator(),e=P.createGain();n.connect(e),e.connect(P.destination),n.frequency.setValueAtTime(300,P.currentTime),n.frequency.exponentialRampToValueAtTime(1500,P.currentTime+.3),e.gain.setValueAtTime(.3,P.currentTime),e.gain.exponentialRampToValueAtTime(.01,P.currentTime+.3),n.start(P.currentTime),n.stop(P.currentTime+.3)}catch(n){console.error("Error playing zoom sound:",n)}}function Be(){Ee||(De(),rt())}document.addEventListener("click",Be);document.addEventListener("touchstart",Be);document.addEventListener("keydown",Be);De();window.showInfoPopup=Wt;window.hideInfoPopup=tt;document.addEventListener("click",n=>{const e=document.getElementById("info-popup");e&&n.target===e&&tt()});function en(){const n=document.getElementById("app-canvas");if(!n){console.error("Canvas element not found!");return}document.addEventListener("contextmenu",h=>h.preventDefault()),document.addEventListener("selectstart",h=>h.preventDefault()),document.addEventListener("dragstart",h=>h.preventDefault()),document.addEventListener("gesturestart",h=>h.preventDefault()),document.addEventListener("gesturechange",h=>h.preventDefault()),document.addEventListener("gestureend",h=>h.preventDefault()),n.addEventListener("contextmenu",h=>h.preventDefault()),n.addEventListener("selectstart",h=>h.preventDefault()),n.addEventListener("dragstart",h=>h.preventDefault()),n.style.touchAction="none",n.style.webkitTouchCallout="none",n.style.webkitUserSelect="none",n.style.userSelect="none",Qt(n),Ae(n),l&&n&&me(n);const e=()=>Ae(n);window.addEventListener("resize",e),window.addEventListener("orientationchange",e),window.visualViewport?.addEventListener("resize",e),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&Ae(n)}),Xt(n),setTimeout(()=>{const h=document.getElementById("splash-screen");h&&(Zt(),h.classList.add("fade-out"),setTimeout(()=>{h.style.display="none";const y=document.querySelector(".one-front-credit");y&&y.classList.add("show")},300))},300),setTimeout(()=>{rt()},200);const t=document.getElementById("style-selector");if(t){const h=()=>{t.style.transform="scale(0.85)",t.style.opacity="0.7",setTimeout(()=>{t.style.transform="",t.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),q.nextStyle();const E=q.getCurrentStyle();t.textContent=(q.getCurrentStyleIndex()+1).toString(),t.style.color="white",t.title=`Current: ${E.name}
Tap to switch drawing style`};t.addEventListener("click",h),t.addEventListener("touchstart",E=>{E.preventDefault(),h()}),t.addEventListener("touchend",E=>{E.preventDefault()});const y=document.getElementById("menu-toggle");y&&(y.addEventListener("click",je),y.addEventListener("touchstart",E=>{E.preventDefault(),je()}));const b=q.getCurrentStyle();t.textContent=(q.getCurrentStyleIndex()+1).toString(),t.style.color="white",t.title=`Current: ${b.name}
Tap to switch drawing style`}const i=document.getElementById("style-switch");if(i){const h=()=>{i.style.transform="scale(0.85)",i.style.opacity="0.7",setTimeout(()=>{i.style.transform="",i.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50);const b=q.getCurrentStyle();b.nextColorVariant&&b.nextColorVariant();const E=Math.floor(Math.random()*360);i.style.color=`hsl(${E}, 85%, 55%)`};i.addEventListener("click",h),i.addEventListener("touchstart",b=>{b.preventDefault(),h()}),i.addEventListener("touchend",b=>{b.preventDefault()});const y=Math.floor(Math.random()*360);i.style.color=`hsl(${y}, 85%, 55%)`}const o=document.getElementById("size-selector"),a=document.getElementById("vibration-knob");let s=null;if(o){const h=y=>{if(H=y,"vibrate"in navigator&&navigator.vibrate(30),typeof window.audioContext<"u"&&window.gainNode){const b=window.audioContext,E=window.gainNode,M=b.createOscillator();M.connect(E),M.frequency.setValueAtTime(800+H*200,b.currentTime),M.start(),M.stop(b.currentTime+.1)}};console.log("Mobile detection:",{hasOntouchstart:"ontouchstart"in window,maxTouchPoints:window.navigator.maxTouchPoints,isWebApp:Q,windowWidth:window.innerWidth,userAgent:navigator.userAgent}),console.log("Using PizzaSizeSelector (single-click cycling for all devices)"),s=new Bt(o,H,h)}window.setSizeLevel=h=>{h>=0&&h<6&&(H=h,s&&s.setSize(h))},window.currentSizeLevel=H;let r=1;const g=()=>{a&&(r=parseFloat(a.value)),window.vibrationIntensity=r};a?.addEventListener("input",g),g();const c=h=>{const y=J,b=.2;h.key==="ArrowLeft"||h.key==="ArrowDown"?J=Math.max(.2,y-b):h.key==="ArrowRight"||h.key==="ArrowUp"?J=Math.min(5,y+b):h.key==="["||h.key==="{"?H=Math.max(0,H-1):(h.key==="]"||h.key==="}")&&(H=Math.min(4,H+1))};document.addEventListener("keydown",c);const f=document.getElementById("eraser");if(f){const h=()=>{f.style.transform="scale(0.85)",f.style.opacity="0.7",setTimeout(()=>{f.style.transform="",f.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),D=!D,D?f.classList.add("eraser-active"):f.classList.remove("eraser-active")};f.addEventListener("click",h),f.addEventListener("touchstart",y=>{y.preventDefault(),h()}),f.addEventListener("touchend",y=>{y.preventDefault()})}const d=document.getElementById("clear-canvas");if(d){const h=()=>{d.style.transform="scale(0.85)",d.style.opacity="0.7",setTimeout(()=>{d.style.transform="",d.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),l&&n&&me(n)};d.addEventListener("click",h),d.addEventListener("touchstart",h),d.addEventListener("touchend",h)}const u=document.getElementById("save-as");if(u){const h=()=>{u.style.transform="scale(0.85)",u.style.opacity="0.7",setTimeout(()=>{u.style.transform="",u.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),it()};u.addEventListener("click",h),u.addEventListener("touchstart",y=>{y.preventDefault(),h()}),u.addEventListener("touchend",y=>{y.preventDefault()})}const m=document.getElementById("cancel-save");m&&m.addEventListener("click",()=>{m.style.transform="scale(0.85)",m.style.opacity="0.7",setTimeout(()=>{m.style.transform="",m.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),Ce()});const p=document.getElementById("confirm-save");p&&p.addEventListener("click",()=>{if(p.style.transform="scale(0.85)",p.style.opacity="0.7",setTimeout(()=>{p.style.transform="",p.style.opacity=""},200),"vibrate"in navigator&&navigator.vibrate(50),l&&n){const h=document.querySelector('input[name="quality"]:checked'),y=document.querySelector('input[name="format"]:checked');h&&y&&(ot(n,h.value,y.value),Ce())}});const v=document.getElementById("save-modal");v&&v.addEventListener("click",h=>{h.target===v&&Ce()});function w(h){F=h,document.querySelectorAll(".style-button").forEach((y,b)=>{y.classList.toggle("active",b===h-1)})}document.getElementById("style-1")?.addEventListener("click",()=>w(1)),document.getElementById("style-2")?.addEventListener("click",()=>w(2)),document.getElementById("style-3")?.addEventListener("click",()=>w(3)),nn(),Ut(),Gt()}document.addEventListener("DOMContentLoaded",en);let X=null,te=!1,Qe=.8;const tn={title:"🌙 Gentle Bangs",description:"Safe frequencies with nice bangs and beautiful fades",scale:{notes:[98,110,123.47,130.81,146.83,164.81,174.61,196,220,246.94,261.63,293.66,329.63,349.23,392,440,493.88,523.25,587.33,659.25,698.46,783.99,880,987.77],name:"Safe Frequency Scale"},type:"ambient",tempo:70,melody:[{note:8,duration:1,volume:.8,bang:!0},{note:10,duration:1,volume:.8,bang:!0},{note:12,duration:2,volume:.9,bang:!0},{note:10,duration:1,volume:.8,bang:!0},{note:8,duration:1,volume:.8,bang:!0},{note:9,duration:1,volume:.8,bang:!0},{note:10,duration:2,volume:.9,bang:!0},{note:12,duration:1,volume:.8,bang:!0},{note:13,duration:1,volume:.8,bang:!0},{note:15,duration:3,volume:1,bang:!0}],harmony:[{note:4,duration:4,volume:.6,bang:!0},{note:6,duration:4,volume:.6,bang:!0},{note:8,duration:4,volume:.6,bang:!0},{note:4,duration:4,volume:.6,bang:!0}],bass:[{note:0,duration:2,volume:.7,bang:!0},{note:0,duration:2,volume:.7,bang:!0},{note:1,duration:2,volume:.7,bang:!0},{note:1,duration:2,volume:.7,bang:!0},{note:2,duration:2,volume:.7,bang:!0},{note:2,duration:2,volume:.7,bang:!0},{note:0,duration:4,volume:.8,bang:!0}]};function nn(){const n=document.getElementById("music-control");n?.addEventListener("click",e=>{if(e.preventDefault(),n&&(n.style.transform="scale(0.85)",n.style.opacity="0.7",setTimeout(()=>{n.style.transform="",n.style.opacity=""},200)),"vibrate"in navigator&&navigator.vibrate(50),n&&(n.textContent==="🎵"?n.textContent="🎶":n.textContent="🎵"),te)ct();else try{an()}catch(t){console.error("Error in playMusic:",t)}});try{new(window.AudioContext||window.webkitAudioContext)().close()}catch(e){console.error("Failed to create test audio context:",e)}}async function an(){X&&ct();const n=tn;try{const e=new(window.AudioContext||window.webkitAudioContext);e.state==="suspended"&&await e.resume();const t=e.createGain();t.gain.setValueAtTime(0,e.currentTime),t.gain.linearRampToValueAtTime(Qe*.3,e.currentTime+1),t.connect(e.destination);const i=e.createDelay(1),o=e.createGain(),a=e.createGain();i.delayTime.setValueAtTime(.4,e.currentTime),o.gain.setValueAtTime(.1,e.currentTime),a.gain.setValueAtTime(.05,e.currentTime),t.connect(i),i.connect(o),o.connect(a),a.connect(i),o.connect(e.destination);const s=e.createConvolver(),r=e.createGain();r.gain.setValueAtTime(.08,e.currentTime);const g=e.sampleRate*1,c=e.createBuffer(2,g,e.sampleRate);for(let f=0;f<2;f++){const d=c.getChannelData(f);for(let u=0;u<g;u++){const m=u/e.sampleRate,p=Math.exp(-m*1.5)*(Math.random()*2-1)*.03;d[u]=p}}s.buffer=c,o.connect(s),s.connect(r),r.connect(e.destination),lt(e,t,n),X=new Audio,X.volume=Qe*.4,$e(!0),te=!0,X.audioContext=e,X.masterGain=t,X.track=n}catch(e){console.error("Error playing music:",e),$e(!1),te=!1}}function lt(n,e,t){const i=t.scale.notes,a=60/t.tempo,s=[{note:7,duration:1,volume:.5},{note:8,duration:1,volume:.5},{note:10,duration:2,volume:.6},{note:12,duration:1,volume:.5},{note:10,duration:1,volume:.5},{note:8,duration:1,volume:.5},{note:7,duration:1,volume:.5},{note:5,duration:2,volume:.6},{note:7,duration:1,volume:.5},{note:8,duration:3,volume:.7}],r=[{note:12,duration:1,volume:.6},{note:15,duration:1,volume:.6},{note:17,duration:2,volume:.7},{note:15,duration:1,volume:.6},{note:12,duration:1,volume:.6},{note:10,duration:1,volume:.6},{note:12,duration:2,volume:.7},{note:15,duration:1,volume:.6},{note:17,duration:1,volume:.6},{note:19,duration:3,volume:.8}],g=[{note:15,duration:1,volume:.4},{note:12,duration:1,volume:.4},{note:8,duration:1,volume:.4},{note:5,duration:1,volume:.4},{note:2,duration:2,volume:.5},{note:0,duration:4,volume:.6}],c=[{note:6,duration:1,volume:.5},{note:8,duration:1,volume:.5},{note:9,duration:1,volume:.5},{note:10,duration:2,volume:.6},{note:8,duration:1,volume:.5},{note:6,duration:1,volume:.5},{note:4,duration:1,volume:.5},{note:6,duration:2,volume:.6},{note:8,duration:1,volume:.5},{note:10,duration:1,volume:.5},{note:12,duration:3,volume:.7}],f=[{note:7,duration:1,volume:.5},{note:8,duration:1,volume:.5},{note:10,duration:2,volume:.6},{note:12,duration:1,volume:.5},{note:10,duration:1,volume:.5},{note:8,duration:1,volume:.5},{note:7,duration:1,volume:.5},{note:5,duration:2,volume:.6},{note:7,duration:1,volume:.5},{note:8,duration:3,volume:.7}];pe(n,e,s,i,a),setTimeout(()=>{te&&pe(n,e,r,i,a)},s.reduce((u,m)=>u+m.duration,0)*a*1e3),setTimeout(()=>{te&&pe(n,e,g,i,a)},(s.reduce((u,m)=>u+m.duration,0)+r.reduce((u,m)=>u+m.duration,0))*a*1e3),setTimeout(()=>{te&&pe(n,e,c,i,a)},(s.reduce((u,m)=>u+m.duration,0)+r.reduce((u,m)=>u+m.duration,0)+g.reduce((u,m)=>u+m.duration,0))*a*1e3),setTimeout(()=>{te&&pe(n,e,f,i,a)},(s.reduce((u,m)=>u+m.duration,0)+r.reduce((u,m)=>u+m.duration,0)+g.reduce((u,m)=>u+m.duration,0)+c.reduce((u,m)=>u+m.duration,0))*a*1e3);const d=(s.reduce((u,m)=>u+m.duration,0)+r.reduce((u,m)=>u+m.duration,0)+g.reduce((u,m)=>u+m.duration,0)+c.reduce((u,m)=>u+m.duration,0)+f.reduce((u,m)=>u+m.duration,0))*a;setTimeout(()=>{te&&lt(n,e,t)},d*1e3)}function pe(n,e,t,i,o){let a=n.currentTime;t.forEach((s,r)=>{const g=(i[s.note]||440)*1,c=s.duration*o,f=n.createOscillator(),d=n.createGain();f.type="sine",f.frequency.setValueAtTime(g,a);const u=s.volume*.3,m=s.volume*.15;d.gain.setValueAtTime(0,a),d.gain.linearRampToValueAtTime(u,a+.01),d.gain.linearRampToValueAtTime(m,a+.1),d.gain.setValueAtTime(m,a+c-.5),d.gain.exponentialRampToValueAtTime(.001,a+c),f.connect(d),d.connect(e),f.start(a),f.stop(a+c),a+=c})}function ct(){if(X&&X.audioContext){const n=X.audioContext,e=X.masterGain;e&&e.gain.linearRampToValueAtTime(0,n.currentTime+1),setTimeout(()=>{try{n.close()}catch{}},1e3),X=null,$e(!1),te=!1}}function $e(n){const e=document.getElementById("music-control");e?n?(e.classList.add("playing"),e.textContent="🎶"):(e.classList.remove("playing"),e.textContent="🎵"):console.error("Music button not found!")}window.reportActualSize=_t;export{Ze as W,ht as _,Oe as r};
