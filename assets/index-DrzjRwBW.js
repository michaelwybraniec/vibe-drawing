(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const Ze="modulepreload",et=function(e){return"/vibe-drawing/"+e},Ee={},tt=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){let f=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(r=>({status:"fulfilled",value:r}),r=>({status:"rejected",reason:r}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");o=f(n.map(c=>{if(c=et(c),c in Ee)return;Ee[c]=!0;const d=c.endsWith(".css"),r=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${r}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":Ze,d||(p.as="script"),p.crossOrigin="",p.href=c,l&&p.setAttribute("nonce",l),document.head.appendChild(p),d)return new Promise((h,g)=>{p.addEventListener("load",h),p.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return o.then(a=>{for(const l of a||[])l.status==="rejected"&&s(l.reason);return t().catch(s)})};function Ce(){return typeof navigator<"u"&&"vibrate"in navigator}const nt="vibe.flags",ke={hapticsEnabled:!0,debug:!1};function it(e){if(!e)return{};try{return JSON.parse(e)}catch{return{}}}function ot(){if(typeof window>"u")return{...ke};const e=it(localStorage.getItem(nt));return{...ke,...e}}let st=ot();function oe(e){return st[e]}let V=null,G=null,Y=null;function ze(e=.5){try{if(V||(V=new(window.AudioContext||window.webkitAudioContext)),!V||G)return;G=V.createOscillator(),Y=V.createGain(),G.type="square",G.frequency.value=85,Y.gain.value=Math.min(1,Math.max(.05,e)),G.connect(Y),Y.connect(V.destination),G.start()}catch{}}function ve(e=.5){if(!Y||!V)return;const t=Math.min(1,Math.max(.05,e));try{Y.gain.exponentialRampToValueAtTime(t,V.currentTime+.05)}catch{Y.gain.value=t}}/*! Capacitor: https://capacitorjs.com/ - MIT License */var ee;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(ee||(ee={}));class me extends Error{constructor(t,n,i){super(t),this.message=t,this.code=n,this.data=i}}const at=e=>{var t,n;return e?.androidBridge?"android":!((n=(t=e?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},rt=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},i=n.Plugins=n.Plugins||{},o=()=>t!==null?t.name:at(e),s=()=>o()!=="web",a=r=>{const p=c.get(r);return!!(p?.platforms.has(o())||l(r))},l=r=>{var p;return(p=n.PluginHeaders)===null||p===void 0?void 0:p.find(h=>h.name===r)},f=r=>e.console.error(r),c=new Map,d=(r,p={})=>{const h=c.get(r);if(h)return console.warn(`Capacitor plugin "${r}" already registered. Cannot register plugins twice.`),h.proxy;const g=o(),u=l(r);let w;const m=async()=>(!w&&g in p?w=typeof p[g]=="function"?w=await p[g]():w=p[g]:t!==null&&!w&&"web"in p&&(w=typeof p.web=="function"?w=await p.web():w=p.web),w),M=(S,P)=>{var k,$;if(u){const T=u?.methods.find(z=>P===z.name);if(T)return T.rtype==="promise"?z=>n.nativePromise(r,P.toString(),z):(z,H)=>n.nativeCallback(r,P.toString(),z,H);if(S)return(k=S[P])===null||k===void 0?void 0:k.bind(S)}else{if(S)return($=S[P])===null||$===void 0?void 0:$.bind(S);throw new me(`"${r}" plugin is not implemented on ${g}`,ee.Unimplemented)}},v=S=>{let P;const k=(...$)=>{const T=m().then(z=>{const H=M(z,S);if(H){const I=H(...$);return P=I?.remove,I}else throw new me(`"${r}.${S}()" is not implemented on ${g}`,ee.Unimplemented)});return S==="addListener"&&(T.remove=async()=>P()),T};return k.toString=()=>`${S.toString()}() { [capacitor code] }`,Object.defineProperty(k,"name",{value:S,writable:!1,configurable:!1}),k},L=v("addListener"),b=v("removeListener"),E=(S,P)=>{const k=L({eventName:S},P),$=async()=>{const z=await k;b({eventName:S,callbackId:z},P)},T=new Promise(z=>k.then(()=>z({remove:$})));return T.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await $()},T},C=new Proxy({},{get(S,P){switch(P){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return u?E:L;case"removeListener":return b;default:return v(P)}}});return i[r]=C,c.set(r,{name:r,proxy:C,platforms:new Set([...Object.keys(p),...u?[g]:[]])}),C};return n.convertFileSrc||(n.convertFileSrc=r=>r),n.getPlatform=o,n.handleError=f,n.isNativePlatform=s,n.isPluginAvailable=a,n.registerPlugin=d,n.Exception=me,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},lt=e=>e.Capacitor=rt(e),de=lt(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Pe=de.registerPlugin;class Ye{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let i=!1;this.listeners[t]||(this.listeners[t]=[],i=!0),this.listeners[t].push(n);const s=this.windowListeners[t];s&&!s.registered&&this.addWindowListener(s),i&&this.sendRetainedArgumentsForEvent(t);const a=async()=>this.removeListener(t,n);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,i){const o=this.listeners[t];if(!o){if(i){let s=this.retainedEventArguments[t];s||(s=[]),s.push(n),this.retainedEventArguments[t]=s}return}o.forEach(s=>s(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:i=>{this.notifyListeners(n,i)}}}unimplemented(t="not implemented"){return new de.Exception(t,ee.Unimplemented)}unavailable(t="not available"){return new de.Exception(t,ee.Unavailable)}async removeListener(t,n){const i=this.listeners[t];if(!i)return;const o=i.indexOf(n);this.listeners[t].splice(o,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(i=>{this.notifyListeners(t,i)}))}}const Te=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Ie=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ct extends Ye{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(i=>{if(i.length<=0)return;let[o,s]=i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");o=Ie(o).trim(),s=Ie(s).trim(),n[o]=s}),n}async setCookie(t){try{const n=Te(t.key),i=Te(t.value),o=`; expires=${(t.expires||"").replace("expires=","")}`,s=(t.path||"/").replace("path=",""),a=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${i||""}${o}; path=${s}; ${a};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}Pe("CapacitorCookies",{web:()=>new ct});const ht=async e=>new Promise((t,n)=>{const i=new FileReader;i.onload=()=>{const o=i.result;t(o.indexOf(",")>=0?o.split(",")[1]:o)},i.onerror=o=>n(o),i.readAsDataURL(e)}),dt=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(o=>o.toLocaleLowerCase()).reduce((o,s,a)=>(o[s]=e[t[a]],o),{})},ut=(e,t=!0)=>e?Object.entries(e).reduce((i,o)=>{const[s,a]=o;let l,f;return Array.isArray(a)?(f="",a.forEach(c=>{l=t?encodeURIComponent(c):c,f+=`${s}=${l}&`}),f.slice(0,-1)):(l=t?encodeURIComponent(a):a,f=`${s}=${l}`),`${i}&${f}`},"").substr(1):null,ft=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),o=dt(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[a,l]of Object.entries(e.data||{}))s.set(a,l);n.body=s.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){const s=new FormData;if(e.data instanceof FormData)e.data.forEach((l,f)=>{s.append(f,l)});else for(const l of Object.keys(e.data))s.append(l,e.data[l]);n.body=s;const a=new Headers(n.headers);a.delete("content-type"),n.headers=a}else(o.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class mt extends Ye{async request(t){const n=ft(t,t.webFetchExtra),i=ut(t.params,t.shouldEncodeUrlParams),o=i?`${t.url}?${i}`:t.url,s=await fetch(o,n),a=s.headers.get("content-type")||"";let{responseType:l="text"}=s.ok?t:{};a.includes("application/json")&&(l="json");let f,c;switch(l){case"arraybuffer":case"blob":c=await s.blob(),f=await ht(c);break;case"json":f=await s.json();break;case"document":case"text":default:f=await s.text()}const d={};return s.headers.forEach((r,p)=>{d[p]=r}),{data:f,headers:d,status:s.status,url:s.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}Pe("CapacitorHttp",{web:()=>new mt});const Le=Pe("NativeHaptics",{web:()=>({async start(){},async update(){},async stop(){}})});let x=null;(async()=>{try{x=(await tt(()=>import("./index-CF6hwW4G.js"),[])).Haptics}catch{x=null}})();let se=null,K=70,W=22,J=!1,te=!1,_=.5;const Q=de.getPlatform();let Se="medium",ge=!1;function gt(e){const t=Math.max(0,Math.min(.25,0));return Math.max(.15,Math.min(1,t/.25))}function pt(e){const t=Math.max(0,Math.min(1,.5));return Math.max(.1,Math.min(1,t))}function le(e,t){const n=gt(),i=pt();return Math.max(.1,Math.min(1,i*.6+n*.4))}function Mt(e,t){const n=le();return Math.round(18+n*20)}function yt(e,t){const n=le();return Math.round(80-n*35)}function bt(e,t){const n=le();return n>.7?"heavy":n>.4?"medium":"light"}function we(){if(console.log(`Haptic tick - platform: ${Q}, usingNativeHaptics: ${te}, HapticsBasic: ${!!x}`),Q!=="web"&&!te)try{Le.update({intensity:_}),console.log(`Native haptics update: ${_}`);return}catch(e){console.log(`Native haptics failed: ${e}`)}if(x){Q==="ios"?(console.log(`iOS haptic impact: ${Se}`),x.impact({style:Se}).catch(e=>console.log(`iOS haptic failed: ${e}`))):Q==="android"?(console.log(`Android vibrate: ${W}ms`),x.vibrate({duration:W}).catch(e=>console.log(`Android haptic failed: ${e}`))):Ce()?(console.log(`Web vibrate: ${W}ms`),navigator.vibrate(W)):(console.log(`Audio fallback: ${W/40}`),J?ve(W/40):(J=!0,ze(.4)));return}Ce()?(console.log(`Fallback web vibrate: ${W}ms`),navigator.vibrate(W)):(console.log(`Fallback audio: ${W/40}`),J?ve(W/40):(J=!0,ze(.4)))}function vt(){if(oe("hapticsEnabled")){if(ge){St();return}if(J=!1,te=!1,Q!=="web")try{console.log(`Starting native haptics with intensity: ${_}`),Le.start({intensity:_}),te=!0,ge=!0,console.log("Native haptics started successfully");return}catch(e){console.log(`Native haptics start failed: ${e}`)}x&&Q==="ios"&&(console.log("iOS pre-tap"),x.impact({style:"medium"}).catch(e=>console.log(`iOS pre-tap failed: ${e}`))),we(),se=window.setInterval(we,K),ge=!0,console.log(`Started haptic timer with interval: ${K}ms`)}}function St(e,t){if(!oe("hapticsEnabled"))return;const n=le(),i=Math.abs(_-n)>.05;if(_=n,oe("debug")&&Math.random()<.05&&console.log(`hapticsUpdate - speed: ${e?.toFixed(3)}, pressure: ${t?.toFixed(3)}, intensity: ${n.toFixed(3)}`),te&&i)try{Le.update({intensity:_}),oe("debug")&&console.log(`Native haptics updated to: ${_.toFixed(3)}`);return}catch(o){oe("debug")&&console.log(`Native haptics update failed: ${o}`),te=!1}if(i||!se){W=Mt(),Se=bt();const o=yt();Math.abs(o-K)>2&&se!=null?(K=o,window.clearInterval(se),se=window.setInterval(we,K)):K=o}J&&ve(le())}class wt{constructor(){this.name="Particle",this.description="Smooth particle-based drawing with haptic feedback",this.icon="1",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.previousPoint=null}onStart(t,n){console.log("🎨 Particle style started"),this.previousPoint=t}onMove(t,n){console.log("🎨 ParticleStyle.onMove called");const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:l,isWebApp:f}=n;this.previousPoint&&(i.save(),i.globalCompositeOperation="source-over",t.forEach((c,d)=>{if(!this.previousPoint)return;const r=(c.t-this.previousPoint.t)/16;if(r<=0)return;this.calculateSizeMultiplier(c,n);const p=this.previousPoint.x+(c.x-this.previousPoint.x)*r,h=this.previousPoint.y+(c.y-this.previousPoint.y)*r,g=c.width||1,u=c.height||1,w=.95+Math.random()*.1,m=1+Math.sin((Date.now()+d*40)/160)*.03,M=g/2*w*m,v=u/2*w*m;if(o)i.fillStyle="#151E35";else{const b=1+Math.sin(r*Math.PI)*.12;i.fillStyle=this.getCurrentColor(b)}i.beginPath(),i.ellipse(p,h,M,v,0,0,2*Math.PI),i.fill(),Math.max(g,u)>15&&Math.random()<.2&&(i.save(),i.globalAlpha=.4,this.addSparkleEffect(i,p,h,Math.max(g,u)/3),i.restore()),this.previousPoint=c}),i.restore())}onEnd(t){console.log("🎨 Particle style ended")}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(s[o]||1)*a;{const d=Math.max(0,Math.min(1,(l-5)/95));let r;(t.width||0)===0||(t.height||0)===0?r=.2:r=.1+d*.2;const p=.98+Math.random()*.04,h=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+r*p*this.sizeSmoothingFactor;return this.lastSizeMultiplier=h,h*a}}getCurrentColor(t){const n=Date.now()*.1%360,i=80+Math.sin(Date.now()*.001)*20,o=50+Math.sin(Date.now()*.002)*30;return`hsl(${n}, ${i}%, ${o}%)`}addSparkleEffect(t,n,i,o){const s=3+Math.floor(Math.random()*3);for(let a=0;a<s;a++){const l=Math.PI*2*a/s+Math.random()*.5,f=o*(.5+Math.random()*.5),c=n+Math.cos(l)*f,d=i+Math.sin(l)*f,r=o*.1*(.5+Math.random()*.5);t.fillStyle=`rgba(255, 255, 255, ${.6+Math.random()*.4})`,t.beginPath(),t.arc(c,d,r,0,2*Math.PI),t.fill()}}}class Pt{constructor(){this.name="Lava",this.description="Flowing lava lines that melt and drip",this.icon="2",this.lavaLines=[],this.currentLavaLine=null,this.animationId=null}onStart(t,n){console.log("🌋 Lava style started"),this.currentLavaLine={points:[],startTime:Date.now(),isMelting:!1,meltProgress:0},this.addPointToLavaLine(t,n)}onMove(t,n){const{ctx:i}=n;this.currentLavaLine&&(t.forEach(o=>{this.addPointToLavaLine(o,n)}),this.drawLavaLines(n))}onEnd(t){console.log("🌋 Lava style ended"),this.currentLavaLine&&(this.currentLavaLine.isMelting=!0,this.lavaLines.push(this.currentLavaLine),this.currentLavaLine=null),this.animationId||this.startAnimation(t)}onClear(t){this.lavaLines=[],this.currentLavaLine=null,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}animate(t){this.drawLavaLines(t),this.lavaLines.forEach(n=>{n.isMelting&&(n.meltProgress+=.02,n.meltProgress>=1&&(n.meltProgress=1))}),this.lavaLines=this.lavaLines.filter(n=>n.meltProgress<1),this.lavaLines.length>0||this.currentLavaLine?this.animationId=requestAnimationFrame(()=>this.animate(t)):this.animationId=null}addPointToLavaLine(t,n){if(!this.currentLavaLine)return;const i={x:t.x,y:t.y,sizeMultiplier:this.calculateSizeMultiplier(t,n),touchWidth:t.width||1,touchHeight:t.height||1,time:t.t};this.currentLavaLine.points.push(i)}drawLavaLines(t){const{ctx:n,isEraserMode:i}=t;n.save(),this.currentLavaLine&&this.drawLavaLine(this.currentLavaLine,t,!1),this.lavaLines.forEach(o=>{this.drawLavaLine(o,t,!0)}),n.restore()}drawLavaLine(t,n,i){const{ctx:o,isEraserMode:s}=n;if(t.points.length<2)return;o.save();const a=o.createLinearGradient(0,0,0,o.canvas.height);a.addColorStop(0,"#ff4500"),a.addColorStop(.5,"#ff6347"),a.addColorStop(1,"#ff8c00"),o.strokeStyle=s?"#151E35":a,o.lineCap="round",o.lineJoin="round",o.beginPath(),t.points.forEach((f,c)=>{c===0?o.moveTo(f.x,f.y):o.lineTo(f.x,f.y)});const l=i?Math.max(1,(t.points[0]?.sizeMultiplier||1)*20*(1-t.meltProgress)):(t.points[0]?.sizeMultiplier||1)*20;o.lineWidth=l,o.stroke(),s||(o.shadowColor="#ff4500",o.shadowBlur=10,o.stroke(),o.shadowBlur=0),i&&t.meltProgress>.3&&this.drawDrips(t,n),o.restore()}drawDrips(t,n){const{ctx:i,isEraserMode:o}=n;i.save();const s=Math.floor(t.meltProgress*5),a=o?"#151E35":"#ff6347";for(let l=0;l<s;l++){const f=t.points[Math.floor(Math.random()*t.points.length)];if(!f)continue;const c=20+Math.random()*30,d=f.sizeMultiplier*5;i.fillStyle=a,i.beginPath(),i.ellipse(f.x+(Math.random()-.5)*10,f.y+c,d,c,0,0,2*Math.PI),i.fill()}i.restore()}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(s[o]||1)*a;{const d=Math.max(0,Math.min(1,(l-5)/95));let r;return(t.width||0)===0||(t.height||0)===0?r=.2:r=.1+d*.2,r*a}}startAnimation(t){this.animate(t)}}class Lt{constructor(){this.name="Neon",this.description="Bright neon lines with glowing effects",this.icon="3",this.neonLines=[],this.currentLine=[],this.currentColor="#00ff00"}onStart(t,n){console.log("💡 Neon style started"),this.currentLine=[t],this.currentColor=this.getNeonColor()}onMove(t,n){const{ctx:i}=n;this.currentLine.push(...t),this.drawNeonLines(n)}onEnd(t){console.log("💡 Neon style ended"),this.currentLine.length>1&&this.neonLines.push({points:[...this.currentLine],color:this.currentColor,startTime:Date.now()}),this.currentLine=[]}onClear(t){this.neonLines=[],this.currentLine=[]}drawNeonLines(t){const{ctx:n,isEraserMode:i}=t;n.save(),this.currentLine.length>1&&this.drawNeonLine(this.currentLine,this.currentColor,t,!1),this.neonLines.forEach(o=>{this.drawNeonLine(o.points,o.color,t,!0)}),n.restore()}drawNeonLine(t,n,i,o){const{ctx:s,isEraserMode:a}=i;if(t.length<2)return;s.save();const l=a?"#151E35":n,f=a?"#151E35":this.getGlowColor(n);s.lineCap="round",s.lineJoin="round";for(let c=3;c>=1;c--){if(s.strokeStyle=f,!t[0])return;s.lineWidth=this.calculateLineWidth(t[0],i)*(c*2),s.globalAlpha=.1/c,s.beginPath(),t.forEach((d,r)=>{r===0?s.moveTo(d.x,d.y):s.lineTo(d.x,d.y)}),s.stroke()}if(s.strokeStyle=l,!!t[0]){if(s.lineWidth=this.calculateLineWidth(t[0],i),s.globalAlpha=1,s.beginPath(),t.forEach((c,d)=>{d===0?s.moveTo(c.x,c.y):s.lineTo(c.x,c.y)}),s.stroke(),!a){if(s.strokeStyle="#ffffff",!t[0])return;s.lineWidth=this.calculateLineWidth(t[0],i)*.3,s.globalAlpha=.8,s.stroke()}o&&!a&&Math.random()<.1&&this.addSparkles(t,n,i),s.restore()}}addSparkles(t,n,i){const{ctx:o}=i;o.save();const s=2+Math.floor(Math.random()*3);for(let a=0;a<s;a++){const l=t[Math.floor(Math.random()*t.length)],f=2+Math.random()*3;if(!l)return;const c=l.x+(Math.random()-.5)*20,d=l.y+(Math.random()-.5)*20;o.fillStyle="#ffffff",o.globalAlpha=.8,o.beginPath(),o.arc(c,d,f,0,2*Math.PI),o.fill(),o.fillStyle=n,o.globalAlpha=.3,o.beginPath(),o.arc(c,d,f*2,0,2*Math.PI),o.fill()}o.restore()}calculateLineWidth(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .15*(s[o]||1)*a*15;{const d=Math.max(0,Math.min(1,(l-5)/95));let r;return(t.width||0)===0||(t.height||0)===0?r=.2:r=.1+d*.2,r*a*15}}getNeonColor(){const t=["#00ff00","#ff00ff","#00ffff","#ffff00","#ff0080","#0080ff","#ff8000","#8000ff"];return t[Math.floor(Math.random()*t.length)]||"#ff6b6b"}getGlowColor(t){return t}}class At{constructor(){this.name="Watercolor",this.description="Soft watercolor brush strokes with color blending",this.icon="4",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.brushStrokes=[]}onStart(t,n){console.log("🎨 Watercolor style started"),this.brushStrokes=[]}onMove(t,n){console.log("🎨 WatercolorStyle.onMove called");const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:l,isWebApp:f}=n;t.length<2||(i.save(),i.globalCompositeOperation=o?"destination-out":"multiply",t.forEach((c,d)=>{if(d===0)return;const r=t[d-1];if(!r)return;const p=(c.t-r.t)/16;if(p<=0)return;const h=this.calculateSizeMultiplier(c,n),g=r.x+(c.x-r.x)*p,u=r.y+(c.y-r.y)*p,w=c.width||1;c.height;const m=.8+Math.random()*.4,M=w/2*m*h;if(o)i.globalAlpha=.3,i.fillStyle="rgba(21, 30, 53, 0.3)";else{const L=1+Math.sin(p*Math.PI)*.15,b=this.getWatercolorColor(L);for(let E=0;E<3;E++){const C=(Math.random()-.5)*M*.5,S=(Math.random()-.5)*M*.5,P=M*(.7+Math.random()*.6),k=.1+Math.random()*.2;i.globalAlpha=k,i.fillStyle=b,i.beginPath(),i.arc(g+C,u+S,P,0,2*Math.PI),i.fill()}this.brushStrokes.push({x:g,y:u,size:M,color:b,opacity:.3})}}),i.restore())}onEnd(t){console.log("🎨 Watercolor style ended")}onClear(t){this.brushStrokes=[]}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .2*(s[o]||1)*a;{const d=Math.max(0,Math.min(1,(l-5)/95));let r;(t.width||0)===0||(t.height||0)===0?r=.25:r=.15+d*.25;const p=.95+Math.random()*.1,h=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+r*p*this.sizeSmoothingFactor;return this.lastSizeMultiplier=h,h*(s[o]||1)*a}}getWatercolorColor(t){const n=["#FFB3BA","#BAFFC9","#BAE1FF","#FFFFBA","#FFB3F7","#B3FFE6","#FFD4B3","#E6B3FF"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}}class Et{constructor(){this.name="Chalk",this.description="Dusty chalk strokes with particle effects",this.icon="5",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.particles=[]}onStart(t,n){console.log("🎨 Chalk style started"),this.particles=[]}onMove(t,n){const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:l,isWebApp:f}=n;t.length<2||(i.save(),i.globalCompositeOperation="source-over",t.forEach((c,d)=>{if(d===0)return;const r=t[d-1];if(!r)return;const p=(c.t-r.t)/16;if(p<=0)return;const h=this.calculateSizeMultiplier(c,n),g=r.x+(c.x-r.x)*p,u=r.y+(c.y-r.y)*p,w=c.width||1;c.height;const m=.7+Math.random()*.6,M=w/2*m*h;if(o)i.globalAlpha=.8,i.fillStyle="#151E35";else{const L=1+Math.sin(p*Math.PI)*.1,b=this.getChalkColor(L);i.globalAlpha=.9,i.fillStyle=b,i.beginPath(),i.arc(g,u,M,0,2*Math.PI),i.fill();for(let E=0;E<5;E++){const C=g+(Math.random()-.5)*M*2,S=u+(Math.random()-.5)*M*2,P=Math.random()*M*.3;i.globalAlpha=.6,i.fillStyle=b,i.beginPath(),i.arc(C,S,P,0,2*Math.PI),i.fill(),this.particles.push({x:C,y:S,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,life:1,maxLife:1,color:b})}for(let E=0;E<3;E++){const C=g+(Math.random()-.5)*M,S=u+(Math.random()-.5)*M,P=Math.random()*M*.2;i.globalAlpha=.3,i.fillStyle=b,i.beginPath(),i.arc(C,S,P,0,2*Math.PI),i.fill()}}}),i.restore())}onEnd(t){console.log("🎨 Chalk style ended")}onClear(t){this.particles=[]}animate(t){const{ctx:n}=t;this.particles=this.particles.filter(i=>(i.x+=i.vx,i.y+=i.vy,i.vy+=.1,i.life-=.02,i.life>0?(n.save(),n.globalAlpha=i.life*.5,n.fillStyle=i.color,n.beginPath(),n.arc(i.x,i.y,1,0,2*Math.PI),n.fill(),n.restore(),!0):!1))}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .18*(s[o]||1)*a;{const d=Math.max(0,Math.min(1,(l-5)/95));let r;(t.width||0)===0||(t.height||0)===0?r=.22:r=.12+d*.2;const p=.9+Math.random()*.2,h=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+r*p*this.sizeSmoothingFactor;return this.lastSizeMultiplier=h,h*(s[o]||1)*a}}getChalkColor(t){const n=["#FFFFFF","#F0F0F0","#E8E8E8","#D0D0D0","#FFE4E1","#E6E6FA","#F0F8FF","#F5F5DC"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}}class Ct{constructor(){this.name="Glow",this.description="Bright neon strokes with glowing effects",this.icon="6",this.lastSizeMultiplier=.25,this.sizeSmoothingFactor=.15,this.glowTrails=[]}onStart(t,n){console.log("🎨 Glow style started"),this.glowTrails=[]}onMove(t,n){const{ctx:i,isEraserMode:o,thicknessMultiplier:s,currentSizeLevel:a,sizeMultipliers:l,isWebApp:f}=n;t.length<2||(i.save(),i.globalCompositeOperation=o?"destination-out":"screen",t.forEach((c,d)=>{if(d===0)return;const r=t[d-1];if(!r)return;const p=(c.t-r.t)/16;if(p<=0)return;const h=this.calculateSizeMultiplier(c,n),g=r.x+(c.x-r.x)*p,u=r.y+(c.y-r.y)*p,w=c.width||1;c.height;const m=.9+Math.random()*.2,M=w/2*m*h;if(o)i.globalAlpha=.5,i.fillStyle="#151E35";else{const L=1+Math.sin(p*Math.PI)*.2,b=this.getGlowColor(L);i.globalAlpha=.3,i.fillStyle=b,i.beginPath(),i.arc(g,u,M*3,0,2*Math.PI),i.fill(),i.globalAlpha=.6,i.fillStyle=b,i.beginPath(),i.arc(g,u,M*2,0,2*Math.PI),i.fill(),i.globalAlpha=.9,i.fillStyle=b,i.beginPath(),i.arc(g,u,M,0,2*Math.PI),i.fill(),i.globalAlpha=1,i.fillStyle="#FFFFFF",i.beginPath(),i.arc(g,u,M*.3,0,2*Math.PI),i.fill(),this.glowTrails.push({x:g,y:u,size:M,color:b,life:1,maxLife:1}),Math.random()<.3&&this.addSparkle(i,g,u,b)}}),i.restore())}onEnd(t){console.log("🎨 Glow style ended")}onClear(t){this.glowTrails=[]}animate(t){const{ctx:n}=t;this.glowTrails=this.glowTrails.filter(i=>(i.life-=.03,i.life>0?(n.save(),n.globalCompositeOperation="screen",n.globalAlpha=i.life*.4,n.fillStyle=i.color,n.beginPath(),n.arc(i.x,i.y,i.size*2,0,2*Math.PI),n.fill(),n.restore(),!0):!1))}calculateSizeMultiplier(t,n){const{isWebApp:i,currentSizeLevel:o,sizeMultipliers:s,thicknessMultiplier:a}=n,l=Math.sqrt((t.width||1)*(t.height||1));if(i)return .16*(s[o]||1)*a;{const d=Math.max(0,Math.min(1,(l-5)/95));let r;(t.width||0)===0||(t.height||0)===0?r=.2:r=.1+d*.18;const p=.95+Math.random()*.1,h=this.lastSizeMultiplier*(1-this.sizeSmoothingFactor)+r*p*this.sizeSmoothingFactor;return this.lastSizeMultiplier=h,h*(s[o]||1)*a}}getGlowColor(t){const n=["#FF0080","#00FFFF","#FF00FF","#00FF00","#FFFF00","#FF8000","#8000FF","#00FF80"],i=Math.floor(t*n.length)%n.length;return n[i]||"#ff6b6b"}addSparkle(t,n,i,o){t.save(),t.globalAlpha=.8,t.fillStyle=o;for(let s=0;s<4;s++){const a=s*Math.PI/2,l=n+Math.cos(a)*10,f=i+Math.sin(a)*10;t.beginPath(),t.arc(l,f,2,0,2*Math.PI),t.fill()}t.restore()}}class kt{constructor(){this.styles=[],this.currentStyleIndex=0,this.styles=[new wt,new Pt,new Lt,new At,new Et,new Ct],this.currentStyle=this.styles[0]}getCurrentStyle(){return this.currentStyle}getCurrentStyleIndex(){return this.currentStyleIndex}getAllStyles(){return this.styles}switchToStyle(t){t>=0&&t<this.styles.length&&(this.currentStyleIndex=t,this.currentStyle=this.styles[t],console.log(`🎨 Switched to style: ${this.currentStyle.name}`))}nextStyle(){const t=(this.currentStyleIndex+1)%this.styles.length;this.switchToStyle(t)}previousStyle(){const t=this.currentStyleIndex===0?this.styles.length-1:this.currentStyleIndex-1;this.switchToStyle(t)}onStart(t,n){this.currentStyle.onStart?.(t,n)}onMove(t,n){console.log(`🎯 StyleManager.onMove called for style: ${this.currentStyle.name}, points: ${t.length}`),this.currentStyle.onMove?.(t,n)}onEnd(t){this.currentStyle.onEnd?.(t)}onClear(t){this.currentStyle.onClear?.(t),this.styles.forEach(n=>{n!==this.currentStyle&&n.onClear?.(t)})}animate(t){this.currentStyle.animate?.(t),this.styles.forEach(n=>{n!==this.currentStyle&&n.animate&&n.animate(t)})}}console.log("🎨 Vibe Drawing app starting...");console.log("📍 Current location:",window.location.href);console.log("🌐 User agent:",navigator.userAgent);setTimeout(()=>{const e=document.getElementById("app"),t=document.getElementById("splash-screen");if(e&&t&&!e.querySelector("canvas")){console.log("⚠️ Main app failed to load, showing info popup"),t.style.display="none";const n=document.getElementById("info-popup");n&&(n.style.display="block")}},5e3);let y=null,N=!1,ne=[];const Z=new kt,ae=!("ontouchstart"in window)||window.navigator.maxTouchPoints===0;let O=2;const pe=[.2,.4,.7,1,1.5];let Fe=.25;const $e=.15;let F=1,re=!1,R=1,Me=!1;function D(e,t){const n=Math.sqrt(e*t);if(ae){const i=.15*(pe[O]||1),o=i*F;return Math.random()<.01&&console.log("Web app size calculation:",{baseMultiplier:i,thicknessMultiplier:F,finalMultiplier:o}),o}else{const s=Math.max(0,Math.min(1,(n-5)/95));let a;e===0||t===0?a=.2:a=.1+s*.2;const l=.98+Math.random()*.04,f=Fe*(1-$e)+a*l*$e;Fe=f;const c=f*(pe[O]||1)*F;return Math.random()<.01&&console.log("Size calculation:",{smoothedMultiplier:f,sizeLevel:pe[O],thicknessMultiplier:F,finalMultiplier:c}),c}}function zt(e){const t=B.baseHue,n=B.saturation,i=B.lightness,o=(Math.random()-.5)*40,s=(Math.random()-.5)*30,a=(Math.random()-.5)*20,l=(t+o+360)%360,f=Math.max(60,Math.min(100,n+s)),c=Math.max(30,Math.min(70,i+a));return`hsl(${l}, ${f}%, ${c}%)`}function ye(e){const t=B.baseHue,n=B.saturation,i=B.lightness,o=[t,t+15,t+30,t+45],s=Math.floor(Math.random()*o.length),l=(o[s]||t)+(Math.random()-.5)*10,f=n+Math.random()*15,c=i+Math.random()*30;return`hsl(${l}, ${f}%, ${c}%)`}function ie(e){return zt()}function Tt(e,t,n,i,o,s){const a=Date.now(),l=400,f=a%l/l;e.save();const c=Math.max(o,s)*.1*i,d=Math.sin(f*Math.PI*8)*.5+.5;e.strokeStyle=ye(),e.lineWidth=c*(.15+d*.08),e.lineCap="round",e.globalAlpha=.85+d*.1;const r=Math.sin(f*Math.PI*2)*.4;e.beginPath(),e.moveTo(t-c*.6,n+r),e.lineTo(t+c*.6,n+r),e.stroke();const p=15;for(let w=0;w<p;w++){const m=t-c*.5+w*c*.07,M=Math.sin((f+w*.08)*Math.PI*4)*1,v=(.3+d*.6)*i,L=.7+d*.2;e.globalAlpha=L,e.fillStyle=ye(),e.beginPath(),e.arc(m,n+M,v,0,2*Math.PI),e.fill()}const h=c*.1,g=f*Math.PI*6,u=8;for(let w=0;w<u;w++){const m=g+w*Math.PI*2/u,M=t+Math.cos(m)*h,v=n+Math.sin(m)*h,L=(.15+d*.4)*i,b=.5+d*.2;e.globalAlpha=b,e.fillStyle=ye(),e.beginPath(),e.arc(M,v,L,0,2*Math.PI),e.fill()}e.restore()}function De(e,t,n,i,o,s){Tt(e,t,n,i,o,s)}let q=[],We=0;function Oe(e,t,n,i,o,s){const a=Date.now(),l=Math.max(o,s)*.25*i;e.save();const f=[0,120,240],d=(f[Math.floor(Math.random()*f.length)]||0)+(Math.random()-.5)*20,r=`hsl(${d}, 100%, 60%)`,p=`hsl(${d+120}, 100%, 60%)`,h=`hsl(${d+240}, 100%, 60%)`,g=Math.sin(a/100)*.4+.6,u=l*g,w=Math.sin(a/50)*8,m=t+w,M=n+(Math.random()-.5)*4;if(a-We>30&&(q.push({x:m,y:M,size:u,timestamp:a,glitchOffset:w}),We=a,q.length>12&&q.shift()),q.forEach((v,L)=>{const b=a-v.timestamp;if(b<600){const E=b/600,C=(1-E)*.7,S=v.size*(1-E*.3),P=[r,p,h],k=P[Math.floor(Math.random()*P.length)]||r;e.globalAlpha=C,e.fillStyle=k,e.fillRect(v.x-S/2+v.glitchOffset,v.y-S/2,S,S),Math.random()<.3&&(e.globalAlpha=C*.5,e.fillStyle="#ffffff",e.fillRect(v.x-S/2,v.y-S/4,S,1))}}),e.globalAlpha=.9,e.fillStyle=r,e.fillRect(m-u/2,M-u/2,u,u),e.globalAlpha=.6,e.fillStyle=p,e.fillRect(m-u/2+2,M-u/2,u/3,u),e.globalAlpha=.4,e.fillStyle=h,e.fillRect(m-u/2-2,M-u/2,u/3,u),Math.random()<.4&&(e.globalAlpha=.8,e.fillStyle="#ffffff",e.fillRect(m-u/2,M-u/4,u,2)),Math.random()<.2)for(let v=0;v<5;v++){e.globalAlpha=.6,e.fillStyle=Math.random()>.5?"#ffffff":"#000000";const L=m+(Math.random()-.5)*u,b=M+(Math.random()-.5)*u;e.fillRect(L,b,2,2)}q=q.filter(v=>a-v.timestamp<800),e.restore()}let U=[],He=0;function Be(e,t,n,i,o,s){const a=Date.now(),l=Math.max(o,s)*.2*i;e.save();const f=[0,15,30],d=(f[Math.floor(Math.random()*f.length)]||15)+(Math.random()-.5)*10,r=Math.sin(a/150)*.5+.5,p=Math.sin(a/300)*.3+.7,h=Math.sin(a/600)*.2+.8,g=(r+p+h)/3,u=`hsl(${d}, 100%, ${50+g*30}%)`,w=`hsl(${d+5}, 100%, ${70+g*20}%)`,m=`hsl(${d+10}, 100%, ${40+g*40}%)`,M=Math.sin(a/100)*.3+.7,v=l*M*g;a-He>50&&(U.push({x:t,y:n,size:v,color:u,timestamp:a}),He=a,U.length>10&&U.shift()),e.globalAlpha=.9*g,e.fillStyle=w,e.beginPath(),e.arc(t,n,v*.5,0,2*Math.PI),e.fill(),e.globalAlpha=.8*g,e.fillStyle=u,e.beginPath(),e.arc(t,n,v,0,2*Math.PI),e.fill(),U.slice(-6).forEach((L,b)=>{const E=a-L.timestamp;if(E<600){const C=E/600,S=(1-C)*g*.6,P=L.size*(1-C*.3),k=Math.sin((a-L.timestamp)/100)*.3+.7;e.globalAlpha=S*k,e.fillStyle=L.color,e.beginPath(),e.arc(L.x,L.y,P,0,2*Math.PI),e.fill()}}),e.globalAlpha=.3*g,e.fillStyle=m,e.beginPath(),e.arc(t,n,v*2.5,0,2*Math.PI),e.fill(),Math.random()<.2&&(e.globalAlpha=.7*g,e.fillStyle="#ffffff",e.beginPath(),e.arc(t+(Math.random()-.5)*l,n+(Math.random()-.5)*l,2,0,2*Math.PI),e.fill()),U=U.filter(L=>a-L.timestamp<800),e.restore()}let j=[],Re=0;function Ve(e,t,n,i,o,s){const a=Date.now(),l=Math.max(o,s)*.2*i;e.save();const f=B.baseHue,c=B.saturation,d=B.lightness,r=Math.sin(a/500)*60,p=f+r+(Math.random()-.5)*30,h=c+(Math.random()-.5)*20,g=d+(Math.random()-.5)*15,u=`hsl(${p}, ${h}%, ${g}%)`,w=`hsl(${p}, ${h*.7}%, ${g+5}%)`,m=`hsl(${p}, ${h*.8}%, ${g-10}%)`;if(a-Re>20){const b=Math.random()*.5+.5,E=.4+Math.random()*1.2,C=i*(1+O*.02)*F,S=l*E*b*C,P=(Math.random()-.5)*20,k=(Math.random()-.5)*16,$=t+P,T=n+k;j.push({x:$,y:T,size:S,timestamp:a,pressure:b}),Re=a,j.length>20&&j.shift()}j.forEach(b=>{const E=a-b.timestamp;if(E<1500){const C=E/1500,S=(1-C)*b.pressure*.6,P=b.size*(1-C*.3);e.globalAlpha=S*.4,e.fillStyle=w,e.beginPath(),e.arc(b.x,b.y,P*1.5,0,2*Math.PI),e.fill(),e.globalAlpha=S*.8,e.fillStyle=u,e.beginPath(),e.arc(b.x,b.y,P,0,2*Math.PI),e.fill(),e.globalAlpha=S*.3,e.fillStyle=m,e.beginPath(),e.arc(b.x+1,b.y+1,P*.8,0,2*Math.PI),e.fill()}});const M=Math.sin(a/100)*.3+.7,L=l*M*i*(1+O*.02)*F;if(e.globalAlpha=.4,e.fillStyle=m,e.beginPath(),e.arc(t+2,n+2,L*.7,0,2*Math.PI),e.fill(),e.globalAlpha=.9,e.fillStyle=u,e.beginPath(),e.arc(t,n,L,0,2*Math.PI),e.fill(),Math.random()<.6){const b=Math.floor(Math.random()*8)+3;for(let E=0;E<b;E++){e.globalAlpha=.6,e.fillStyle=w;const C=t+(Math.random()-.5)*l*5,S=n+(Math.random()-.5)*l*4,P=Math.random()*5+1;e.beginPath(),e.arc(C,S,P,0,2*Math.PI),e.fill()}}j=j.filter(b=>a-b.timestamp<2e3),e.restore()}let X=[],xe=0;function _e(e,t,n,i,o,s){const a=Date.now(),l=Math.max(o,s)*.4*i;e.save();const f=[0,60,120,180,240,300],d=(f[Math.floor(Math.random()*f.length)]||0)+(Math.random()-.5)*30,r=`hsl(${d}, 100%, 70%)`,p=`hsl(${d+30}, 80%, 60%)`,h=`hsl(${d+60}, 90%, 90%)`,g=`hsl(${d-30}, 100%, 20%)`;if(a-xe>15){const m=["star","nebula","comet","blackhole"],M=m[Math.floor(Math.random()*m.length)],v=(Math.random()-.5)*8,L=(Math.random()-.5)*6,b=l*(.3+Math.random()*1.5);X.push({x:t,y:n,size:b,velocityX:v,velocityY:L,color:M==="star"?h:M==="nebula"?p:M==="comet"?r:g,type:M,timestamp:a,life:1}),xe=a,X.length>30&&X.shift()}X.forEach(m=>{if(m.velocityX*=.98,m.velocityY*=.98,m.x+=m.velocityX,m.y+=m.velocityY,m.life-=.02,m.life<=0)return;const M=m.life,v=m.size*m.life;switch(e.globalAlpha=M,m.type){case"star":{const L=Math.sin(a/100+m.timestamp)*.3+.7;e.fillStyle=m.color,e.beginPath(),e.arc(m.x,m.y,v*L,0,2*Math.PI),e.fill(),e.strokeStyle=m.color,e.lineWidth=2;for(let b=0;b<4;b++){const E=b*Math.PI/2+a/1e3,C=v*2;e.beginPath(),e.moveTo(m.x,m.y),e.lineTo(m.x+Math.cos(E)*C,m.y+Math.sin(E)*C),e.stroke()}break}case"nebula":e.fillStyle=m.color,e.beginPath(),e.arc(m.x,m.y,v*2,0,2*Math.PI),e.fill(),e.globalAlpha=M*.5,e.fillStyle=p,e.beginPath(),e.arc(m.x,m.y,v*3,0,2*Math.PI),e.fill();break;case"comet":{e.fillStyle=m.color,e.beginPath(),e.arc(m.x,m.y,v,0,2*Math.PI),e.fill();const L=v*4,b=Math.atan2(m.velocityY,m.velocityX);e.strokeStyle=m.color,e.lineWidth=v/2,e.lineCap="round",e.beginPath(),e.moveTo(m.x,m.y),e.lineTo(m.x-Math.cos(b)*L,m.y-Math.sin(b)*L),e.stroke();break}case"blackhole":{e.fillStyle=g,e.beginPath(),e.arc(m.x,m.y,v,0,2*Math.PI),e.fill(),e.globalAlpha=M*.7,e.strokeStyle=r,e.lineWidth=3,e.beginPath(),e.arc(m.x,m.y,v*1.5,0,2*Math.PI),e.stroke(),e.globalAlpha=M*.4,e.beginPath(),e.arc(m.x,m.y,v*.8,0,2*Math.PI),e.stroke();break}}});const u=Math.sin(a/150)*.4+.6,w=l*u;if(e.globalAlpha=.3,e.fillStyle=r,e.beginPath(),e.arc(t,n,w*4,0,2*Math.PI),e.fill(),e.globalAlpha=.9,e.fillStyle=h,e.beginPath(),e.arc(t,n,w,0,2*Math.PI),e.fill(),Math.random()<.1){const m=w*3;for(let M=0;M<12;M++){const v=M*Math.PI*2/12,L=t+Math.cos(v)*m,b=n+Math.sin(v)*m;e.globalAlpha=.8,e.fillStyle=r,e.beginPath(),e.arc(L,b,4,0,2*Math.PI),e.fill()}}X=X.filter(m=>m.life>0),e.restore()}function qe(e,t,n,i){const o=Math.floor(i/10);for(let s=0;s<o;s++){const a=Math.PI*2*s/o,l=i*(.8+Math.random()*.4),f=t+Math.cos(a)*l,c=n+Math.sin(a)*l,d=2+Math.random()*4;e.save(),e.globalAlpha=.6+Math.random()*.4,e.fillStyle="white",e.beginPath(),e.arc(f,c,d,0,2*Math.PI),e.fill(),e.restore()}}function Ue(e,t,n){const i=e.getBoundingClientRect();return{x:t-i.left,y:n-i.top}}function be(e){const t=window.visualViewport,n=t?t.width:window.innerWidth,i=t?t.height:window.innerHeight,o=window.devicePixelRatio||1;e.width=Math.max(1,Math.floor(n*o)),e.height=Math.max(1,Math.floor(i*o)),e.style.width=n+"px",e.style.height=i+"px",console.log("Canvas resized to HD:",e.width,"x",e.height,"devicePixelRatio:",o),y&&(y.scale(o,o),y.lineCap="round",y.lineJoin="round",y.strokeStyle="#111",ue(e))}function It(e){if(y=e.getContext("2d",{alpha:!0,antialias:!0,willReadFrequently:!1}),console.log("Canvas context created:",!!y,"Canvas element:",!!e),!y){console.error("Failed to get 2D context!");return}y.imageSmoothingEnabled=!0,y.imageSmoothingQuality="high",y.lineCap="round",y.lineJoin="round",y.strokeStyle="#111",ue(e),console.log("Canvas context initialized successfully")}function ue(e){if(!y){console.error("Cannot clear canvas - no context!");return}q=[],U=[],j=[],X=[],console.log("Clearing canvas, size:",e.width,"x",e.height);const t=y.createLinearGradient(0,0,e.width,e.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(.5,"#16213e"),t.addColorStop(1,"#0f3460"),y.fillStyle=t,y.fillRect(0,0,e.width,e.height),y.fillStyle="rgba(255, 255, 255, 0.3)";for(let n=0;n<50;n++){const i=Math.random()*e.width,o=Math.random()*e.height,s=Math.random()*2+1;y.beginPath(),y.arc(i,o,s,0,2*Math.PI),y.fill()}y.lineWidth=10,console.log("Canvas cleared and background drawn")}function je(e){console.log("Pointer Event Debug:",{pointerType:e.pointerType,pressure:e.pressure,width:e.width,height:e.height,pointerId:e.pointerId,isPrimary:e.isPrimary,timeStamp:e.timeStamp})}function Ft(e){e.addEventListener("touchstart",n=>n.preventDefault(),{passive:!1}),e.addEventListener("touchmove",n=>n.preventDefault(),{passive:!1}),e.addEventListener("touchend",n=>n.preventDefault(),{passive:!1}),e.addEventListener("pointerdown",n=>{if(n.pointerType==="pen"&&je(n),N||R===2&&Me)return;const i=n.pointerType==="pen",o=n.pointerType==="touch";n.pointerType;let s=n.pressure!==void 0?n.pressure:.5;i&&(s=Math.max(.1,Math.min(1,s)),console.log("Apple Pencil detected - pressure:",s)),e.setPointerCapture(n.pointerId),N=!0,R===2&&(Me=!0),ne=[];const{x:a,y:l}=Ue(e,n.clientX,n.clientY);let f=D(n.width||1,n.height||1);if(i?f*=.3+s*.7:o&&(f*=.5+s*.5),ne.push({x:a,y:l,t:n.timeStamp}),vt(),y){const c=n.width||1,d=n.height||1;let r,p,h;ae?(r=45,p=45,h=1):(r=Math.max(c,30),p=Math.max(d,30),h=c>1||d>1?1.2:1);const g=r*f*h,u=p*f*h,w=Math.max(g,u),m=Z.getCurrentStyleIndex();if(m===1){const v=D(g,u)*(1+O*.3)*F;De(y,a,l,v,g,u)}else if(m===2){const M=D(g,u);Oe(y,a,l,M,g,u)}else if(m===3){const M=D(g,u);Be(y,a,l,M,g,u)}else if(m===4){const M=D(g,u);Ve(y,a,l,M,g,u)}else if(m===5){const M=D(g,u)*(1+O*.01);_e(y,a,l,M,g,u)}else{y.save(),y.globalAlpha=.8,console.log("Drawing dot at:",a,l,"size:",g,"x",u,"pressure:",s);const M=1+Math.sin(Date.now()/200)*.1,v=g/2*M,L=u/2*M;re?(y.globalCompositeOperation="source-over",y.fillStyle="#A8A8DB"):(y.globalCompositeOperation="source-over",y.fillStyle=ie());const b=y.createRadialGradient(a,l,0,a,l,Math.max(v,L));b.addColorStop(0,ie()),b.addColorStop(.7,ie()),b.addColorStop(1,ie()),y.fillStyle=b,y.beginPath(),y.ellipse(a,l,v,L,0,0,2*Math.PI),y.fill(),y.restore(),w>20&&qe(y,a,l,w)}}else console.error("Canvas context is null! Cannot draw.")}),e.addEventListener("pointermove",n=>{if(n.pointerType==="pen"&&N&&je(n),!N)return;const{x:i,y:o}=Ue(e,n.clientX,n.clientY),s=ne[ne.length-1],a=Math.max(.001,n.timeStamp-s.t),l=i-s.x,f=o-s.y,c=Math.hypot(l,f)/a,d=n.pointerType==="pen",r=n.pointerType==="touch";n.pointerType;let p=n.pressure!==void 0?n.pressure:.5;d&&(p=Math.max(.1,Math.min(1,p)));let h=D(n.width||1,n.height||1);if(d?h*=.3+p*.7:r&&(h*=.5+p*.5),ne.push({x:i,y:o,t:n.timeStamp,speed:c}),!y)return;const g=Math.hypot(i-s.x,o-s.y);let u;d?u=R===2?.5:.8:u=R===2?1:ae?.8:1.5;const w=Math.max(1,Math.ceil(g/u));let m;d?m=R===2?3:3.5:m=R===2||ae?2.5:2;const M=Math.max(3,Math.ceil(w*m)),v=n.width||1,L=n.height||1;let b,E,C;ae?(b=45,E=45,C=1):(b=Math.max(v,30),E=Math.max(L,30),C=v>1||L>1?1.2:1);const S=b*h*C,P=E*h*C;y.save(),y.globalAlpha=.8;for(let k=0;k<=M;k++){const $=k/M,T=s.x+(i-s.x)*$,z=s.y+(o-s.y)*$,H=Z.getCurrentStyleIndex();if(H===1){const ce=D(S,P)*(1+O*.3)*F;De(y,T,z,ce,S,P)}else if(H===2){const I=D(S,P);Oe(y,T,z,I,S,P)}else if(H===3){const I=D(S,P);Be(y,T,z,I,S,P)}else if(H===4){const I=D(S,P);Ve(y,T,z,I,S,P)}else if(H===5){const I=D(S,P)*(1+O*.01);_e(y,T,z,I,S,P)}else{let I;d?I=.98+Math.random()*.04:I=.95+Math.random()*.1;const ce=1+Math.sin((Date.now()+k*40)/160)*.03,Je=S/2*I*ce,Qe=P/2*I*ce;if(re?(y.globalCompositeOperation="source-over",y.fillStyle="#151E35"):(y.globalCompositeOperation="source-over",y.fillStyle=ie()),y.beginPath(),y.ellipse(T,z,Je,Qe,0,0,2*Math.PI),y.fill(),Math.max(S,P)>15){let fe;d?fe=.4:fe=.2,Math.random()<fe&&(y.save(),y.globalAlpha=.4,qe(y,T,z,Math.max(S,P)/3),y.restore())}}}y.restore()});const t=n=>{if(N){N=!1,R===2&&(Me=!1),e.releasePointerCapture(n.pointerId);try{if(A&&A.state!=="suspended"){const i=A.createOscillator(),o=A.createGain();i.connect(o),o.connect(A.destination),i.frequency.setValueAtTime(400,A.currentTime),i.frequency.exponentialRampToValueAtTime(200,A.currentTime+.2),o.gain.setValueAtTime(.15,A.currentTime),o.gain.exponentialRampToValueAtTime(.01,A.currentTime+.2),i.start(A.currentTime),i.stop(A.currentTime+.2)}}catch(i){console.log("End sound failed:",i)}}};e.addEventListener("pointerup",t),e.addEventListener("pointercancel",t),e.addEventListener("pointerleave",t)}let A=null,he=!1;function Ge(){if(!he)try{A=new(window.AudioContext||window.webkitAudioContext),he=!0,console.log("Audio context initialized")}catch(e){console.log("Audio not supported"),console.log("Audio not supported",e),he=!0}}function Ne(){(!A||A.state==="suspended")&&A?.resume();try{if(!A)return;const e=A.createOscillator(),t=A.createGain();e.connect(t),t.connect(A.destination),e.frequency.setValueAtTime(400,A.currentTime),e.frequency.exponentialRampToValueAtTime(800,A.currentTime+.2),e.frequency.exponentialRampToValueAtTime(600,A.currentTime+.4),e.frequency.exponentialRampToValueAtTime(900,A.currentTime+.6),t.gain.setValueAtTime(.2,A.currentTime),t.gain.exponentialRampToValueAtTime(.4,A.currentTime+.2),t.gain.exponentialRampToValueAtTime(.2,A.currentTime+.4),t.gain.exponentialRampToValueAtTime(.01,A.currentTime+.6),e.start(A.currentTime),e.stop(A.currentTime+.6)}catch(e){console.log("Audio playback failed:",e)}}function $t(){(!A||A.state==="suspended")&&A?.resume();try{if(!A)return;const e=A.createOscillator(),t=A.createGain();e.connect(t),t.connect(A.destination),e.frequency.setValueAtTime(300,A.currentTime),e.frequency.exponentialRampToValueAtTime(1500,A.currentTime+.3),t.gain.setValueAtTime(.3,A.currentTime),t.gain.exponentialRampToValueAtTime(.01,A.currentTime+.3),e.start(A.currentTime),e.stop(A.currentTime+.3)}catch(e){console.log("Audio playback failed:",e)}}function Ae(){he||(Ge(),Ne())}document.addEventListener("click",Ae);document.addEventListener("touchstart",Ae);document.addEventListener("keydown",Ae);Ge();function Dt(){const e=document.getElementById("info-popup");e&&(e.style.display="block")}function Ke(){const e=document.getElementById("info-popup");e&&(e.style.display="none")}window.showInfoPopup=Dt;window.hideInfoPopup=Ke;document.addEventListener("click",e=>{const t=document.getElementById("info-popup");t&&e.target===t&&Ke()});let B={baseHue:216,saturation:90,lightness:50};function Xe(){const e=Math.floor(Math.random()*360),t=[70,75,80,85,90,95,100],n=t[Math.floor(Math.random()*t.length)],i=[40,45,50,55,60],o=i[Math.floor(Math.random()*i.length)],s=Math.random()*.6+.4,a=Math.random()*3+1,l=Math.floor(Math.random()*12)+4,f=Math.random()*.8+.2,c=Math.random()*.3+.1,d=Math.random()*2+.8;B={baseHue:e,saturation:n,lightness:o,sparkleIntensity:s,sparkleSize:a,sparkleCount:l,glowIntensity:f,pulseSpeed:c,sizeMultiplier:d},console.log(`Generated aggressive pen style: hsl(${e}, ${n}%, ${o}%) - Intensity: ${s.toFixed(2)}`)}function Wt(){const e=document.getElementById("app-canvas");if(console.log("Init function called, canvas found:",!!e),!e){console.error("Canvas element not found!");return}console.log("Device capabilities:",{maxTouchPoints:window.navigator.maxTouchPoints,hasPointerEvents:"PointerEvent"in window}),document.addEventListener("contextmenu",h=>h.preventDefault()),document.addEventListener("selectstart",h=>h.preventDefault()),document.addEventListener("dragstart",h=>h.preventDefault()),document.addEventListener("gesturestart",h=>h.preventDefault()),document.addEventListener("gesturechange",h=>h.preventDefault()),document.addEventListener("gestureend",h=>h.preventDefault()),e.addEventListener("contextmenu",h=>h.preventDefault()),e.addEventListener("selectstart",h=>h.preventDefault()),e.addEventListener("dragstart",h=>h.preventDefault()),e.style.touchAction="none",e.style.webkitTouchCallout="none",e.style.webkitUserSelect="none",e.style.userSelect="none",console.log("Initializing canvas context..."),It(e),console.log("Canvas context initialized, ctx:",!!y),be(e),y&&e&&(ue(e),console.log("Canvas fully initialized and cleared"));const t=()=>be(e);window.addEventListener("resize",t),window.addEventListener("orientationchange",t),window.visualViewport?.addEventListener("resize",t),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&be(e)}),console.log("Attaching pointer handlers..."),Ft(e),console.log("Pointer handlers attached"),setTimeout(()=>{const h=document.getElementById("splash-screen");h&&($t(),h.classList.add("fade-out"),setTimeout(()=>{h.style.display="none";const g=document.querySelector(".one-front-credit");g&&g.classList.add("show")},300))},300),setTimeout(()=>{Ne()},200);const n=document.getElementById("style-selector");if(n){const h=()=>{Z.nextStyle();const u=Z.getCurrentStyle();n.textContent=u.icon,n.style.color="white",console.log(`🎨 Switched to ${u.name} style: ${u.description}`),console.log(`🎯 Style index: ${Z.getCurrentStyleIndex()}`),n.title=`Current: ${u.name}
Tap to switch drawing style`};n.addEventListener("click",h),n.addEventListener("touchstart",u=>{u.preventDefault(),h()}),n.addEventListener("touchend",u=>{u.preventDefault()});const g=Z.getCurrentStyle();n.textContent=g.icon,n.style.color="white",n.title=`Current: ${g.name}
Tap to switch drawing style`}const i=document.getElementById("style-switch");if(i){const h=()=>{Xe(),O=Math.floor(Math.random()*5);const u=Math.floor(Math.random()*360);i.style.color=`hsl(${u}, 85%, 55%)`,console.log(`Generated new random style and changed to ${["tiny","small","medium","large","huge"][O]} size!`)};i.addEventListener("click",h),i.addEventListener("touchstart",u=>{u.preventDefault(),h()}),i.addEventListener("touchend",u=>{u.preventDefault()}),Xe();const g=Math.floor(Math.random()*360);i.style.color=`hsl(${g}, 85%, 55%)`}const o=document.getElementById("thickness-slider"),s=document.getElementById("vibration-knob"),a=document.getElementById("thickness-value");if(console.log("Thickness slider found:",!!o),o){const h=()=>{F=parseFloat(o.value),console.log("🎯 Thickness changed to:",F,"Slider value:",o.value),a&&(a.textContent=o.value),y&&e&&console.log("🔄 Thickness updated, next draw will use:",F)};o.addEventListener("input",h),o.addEventListener("change",h),F=parseFloat(o.value),console.log("🎯 Initial thickness:",F),a&&(a.textContent=o.value);const g=D(1,1);console.log("🧪 Test size calculation with thickness",F,":",g)}else console.error("Thickness slider not found!");let l=1;const f=()=>{s&&(l=parseFloat(s.value)),window.vibrationIntensity=l};s?.addEventListener("input",f),f();const c=h=>{if(!o)return;const g=parseFloat(o.value),u=parseFloat(o.step)||.2,w=parseFloat(o.min)||.2,m=parseFloat(o.max)||5;if(h.key==="ArrowLeft"||h.key==="ArrowDown"){const M=Math.max(w,g-u);o.value=M.toString(),F=M,console.log("🎯 Thickness decreased to:",M)}else if(h.key==="ArrowRight"||h.key==="ArrowUp"){const M=Math.min(m,g+u);o.value=M.toString(),F=M,console.log("🎯 Thickness increased to:",M)}};document.addEventListener("keydown",c);const d=document.getElementById("eraser");if(d){const h=()=>{re=!re,re?(d.style.backgroundColor="rgba(255, 255, 255, 0.2)",d.style.border="2px solid rgba(255, 255, 255, 0.5)",console.log("Eraser mode activated! 🧽")):(d.style.backgroundColor="transparent",d.style.border="none",console.log("Drawing mode activated! ✏️"))};d.addEventListener("click",h),d.addEventListener("touchstart",g=>{g.preventDefault(),h()}),d.addEventListener("touchend",g=>{g.preventDefault()})}const r=document.getElementById("clear-canvas");if(r){const h=()=>{y&&e&&(ue(e),console.log("Canvas cleared! ✨"))};r.addEventListener("click",h),r.addEventListener("touchstart",h),r.addEventListener("touchend",h)}function p(h){R=h,console.log(`Switched to Style ${h}`),document.querySelectorAll(".style-button").forEach((g,u)=>{g.classList.toggle("active",u===h-1)})}document.getElementById("style-1")?.addEventListener("click",()=>p(1)),document.getElementById("style-2")?.addEventListener("click",()=>p(2)),document.getElementById("style-3")?.addEventListener("click",()=>p(3))}document.addEventListener("DOMContentLoaded",Wt);export{Ye as W,tt as _,Pe as r};
